# ğŸŒ³ å£°çº¹è¯†åˆ«ç³»ç»Ÿ ç»“æ„æŒ‡å¯¼æ–‡æ¡£

> **é¡¹ç›®åç§°ï¼š** å£°çº¹è¯†åˆ«ç³»ç»Ÿ (Voiceprint Recognition System)
> **ç‰ˆæœ¬ï¼š** v0.2.0
> **é¡¹ç›®ç±»å‹ï¼š** åç«¯æ¨ç†æœåŠ¡ (Python + PyTorch)
> **ä½œè€…ï¼š** Xiao Ziqi (xiaoziqi01@baidu.com)

---

## ğŸ“‹ STEP 1: æ•°æ®æ¨¡å‹å®šä¹‰

> **ğŸ“Œ ç›®æ ‡**ï¼šå®šä¹‰ç³»ç»Ÿçš„è¯·æ±‚/å“åº”æ•°æ®ç»“æ„åŠå†…éƒ¨å¤„ç†æ¨¡å‹
>
> **ğŸ“¤ äº§å‡º**ï¼š
> - è¯·æ±‚æ•°æ®æ¨¡å‹ (RequestModel)
> - å“åº”æ•°æ®æ¨¡å‹ (ResponseModel)
> - å†…éƒ¨å¤„ç†æ¨¡å‹ (InternalModel)
> - å­—æ®µä¸å¤„ç†é€»è¾‘çš„ç»‘å®šå…³ç³»

### 1.1 è¯·æ±‚æ•°æ®æ¨¡å‹ (RequestModel)

```json
{
  "æ¨¡å‹ä¿¡æ¯": {
    "æ¥å£åç§°": "å£°çº¹è¯†åˆ«æ¨ç†æ¥å£",
    "æ¥å£æ ‡è¯†": "VoiceprintInfer",
    "è¯·æ±‚æ–¹æ³•": "POST /infer"
  },

  "RequestModel": {
    "_è¯´æ˜": "æ¨ç†è¯·æ±‚æ•°æ®æ¨¡å‹",

    "vmms_type": "String! - è¯·æ±‚ç±»å‹ - [å¿…å¡«:å›ºå®šå€¼'audio']",
    "audio_url": "String! - éŸ³é¢‘æ–‡ä»¶URL - [å¿…å¡«:æ”¯æŒwav/mp3æ ¼å¼]",

    "extra": {
      "_è¯´æ˜": "æ‰©å±•å‚æ•°å¯¹è±¡",

      "meg_trade_2": "String! - äºŒçº§è¡Œä¸šä»£ç  - [å¿…å¡«:å¦‚'001002'] [ç”¨äº:VDBäºŒçº§ç´¢å¼•ç­›é€‰]",
      "channelType": "String! - é€šé“ç±»å‹ - [å¿…å¡«:å›ºå®šå€¼'binaural'åŒå£°é“]",
      "customerChannel": "Number! - å®¢æˆ·é€šé“ - [å¿…å¡«:1æˆ–2] [ç”¨äº:é€šé“åˆ†ç¦»]",

      "asr": {
        "_è¯´æ˜": "ASRè¯†åˆ«ç»“æœæ•°ç»„ [å¯é€‰]",
        "_ç±»å‹": "Array<ASRSegment>",
        "ASRSegment": {
          "text": "String - è¯†åˆ«æ–‡æœ¬ - [ç”¨äº:è¯­ä¹‰åŒ¹é…æœåŠ¡çŸ­è¯­]",
          "start": "Number - å¼€å§‹æ—¶é—´(ç§’) - [ç”¨äº:æå–æœåŠ¡éŸ³é¢‘]",
          "end": "Number - ç»“æŸæ—¶é—´(ç§’) - [ç”¨äº:æå–æœåŠ¡éŸ³é¢‘]"
        }
      },

      "top_n": "Number? - è¿”å›Top Nç»“æœ - [é»˜è®¤:10] [èŒƒå›´:1-100]",
      "rerank_alpha": "Number? - ECAPAèåˆæƒé‡ - [é»˜è®¤:0.6] [èŒƒå›´:0-1]",
      "seed": "Boolean? - ç§å­æ³¨å†Œæ¨¡å¼ - [é»˜è®¤:false] [true=ä»…æå–å‘é‡]"
    }
  }
}
```

### 1.2 å“åº”æ•°æ®æ¨¡å‹ (ResponseModel)

```json
{
  "ResponseModel": {
    "_è¯´æ˜": "æ¨ç†å“åº”æ•°æ®æ¨¡å‹",

    "detects": {
      "_è¯´æ˜": "æ£€æµ‹ç»“æœæ•°ç»„",
      "_ç±»å‹": "Array<DetectItem>",
      "DetectItem": {
        "index_from": "Number - èµ·å§‹ç´¢å¼• - [å›ºå®š:0]",
        "index_to": "Number - ç»“æŸç´¢å¼• - [å›ºå®š:1]",
        "issues": {
          "_è¯´æ˜": "è¯†åˆ«ç»“æœåˆ—è¡¨",
          "_ç±»å‹": "Array<IssueItem>",
          "IssueItem": {
            "type": "String - è¯´è¯äººID - [æ ¼å¼:speaker_xxx]",
            "reason": "String - ç›¸ä¼¼åº¦åˆ†æ•° - [æ ¼å¼:0.8523]",
            "short_desc": "String - æè¿° - [å›ºå®š:'Cosine Similarity']"
          }
        }
      }
    },

    "inner_info": {
      "_è¯´æ˜": "å†…éƒ¨è°ƒè¯•ä¿¡æ¯",

      "msg": "String - å¤„ç†æ¶ˆæ¯ - [æˆåŠŸ/å¤±è´¥æè¿°]",
      "segments": "Number - åˆ‡åˆ†ç‰‡æ®µæ•° - [ç”¨äº:è°ƒè¯•]",
      "duration_sec": "Number - éŸ³é¢‘æ—¶é•¿(ç§’) - [ç”¨äº:è°ƒè¯•]",
      "avg_db": "Number - å¹³å‡éŸ³é‡(dB) - [ç”¨äº:è´¨é‡è¯„ä¼°]",

      "ecapa_result": {
        "_è¯´æ˜": "ECAPAæ¨¡å‹ç»“æœ [è°ƒè¯•ç”¨]",
        "_ç±»å‹": "Array<[speaker_id, fused_score, ecapa_score, resnet_score]>"
      },

      "resnet_result": {
        "_è¯´æ˜": "ResNetæ¨¡å‹ç»“æœ [è°ƒè¯•ç”¨]",
        "_ç±»å‹": "Array<[speaker_id, fused_score, ecapa_score, resnet_score]>"
      },

      "fused_result": {
        "_è¯´æ˜": "èåˆåæœ€ç»ˆç»“æœ",
        "_ç±»å‹": "Array<[speaker_id, fused_score, ecapa_score, resnet_score]>"
      }
    }
  },

  "SeedResponseModel": {
    "_è¯´æ˜": "ç§å­æ³¨å†Œæ¨¡å¼å“åº” (seed=true)",

    "detects": "Array - ç©ºæ•°ç»„",
    "inner_info": {
      "ecapa_vector": "Array<Number> - ECAPAå‘é‡ - [ç»´åº¦:192]",
      "resnet_vector": "Array<Number> - ResNetå‘é‡ - [ç»´åº¦:256]",
      "msg": "String - å¤„ç†æ¶ˆæ¯",
      "download_time": "Number - ä¸‹è½½è€—æ—¶(ç§’)",
      "enhance_speech": "Number - å¢å¼ºè€—æ—¶(ç§’)",
      "vectorization_time": "Number - å‘é‡åŒ–è€—æ—¶(ç§’)"
    }
  }
}
```

### 1.3 å†…éƒ¨å¤„ç†æ¨¡å‹ (InternalModel)

```json
{
  "InternalModel": {
    "_è¯´æ˜": "ç³»ç»Ÿå†…éƒ¨å¤„ç†æ•°æ®æ¨¡å‹",

    "AudioSegment": {
      "_è¯´æ˜": "éŸ³é¢‘ç‰‡æ®µæ¨¡å‹",
      "path": "Path - ç‰‡æ®µæ–‡ä»¶è·¯å¾„",
      "start_sec": "Number - èµ·å§‹æ—¶é—´(ç§’)",
      "end_sec": "Number - ç»“æŸæ—¶é—´(ç§’)",
      "duration": "Number - æ—¶é•¿(ç§’)"
    },

    "EmbeddingVector": {
      "_è¯´æ˜": "ç‰¹å¾å‘é‡æ¨¡å‹",
      "ecapa_vector": "Array<Number>[192] - ECAPAå‘é‡",
      "resnet_vector": "Array<Number>[256] - ResNetå‘é‡"
    },

    "VDBSearchResult": {
      "_è¯´æ˜": "å‘é‡æ£€ç´¢ç»“æœ",
      "speaker_id": "String - è¯´è¯äººID",
      "score": "Number - ç›¸ä¼¼åº¦åˆ†æ•° [0-1]",
      "meg_trade_2": "String - è¡Œä¸šåˆ†ç±»"
    },

    "FusedScore": {
      "_è¯´æ˜": "èåˆåˆ†æ•°æ¨¡å‹",
      "speaker_id": "String - è¯´è¯äººID",
      "final_score": "Number - æœ€ç»ˆèåˆåˆ†æ•°",
      "ecapa_score": "Number - ECAPAåŸå§‹åˆ†æ•°",
      "resnet_score": "Number - ResNetåŸå§‹åˆ†æ•°",
      "z_ecapa": "Number - ECAPA Z-score",
      "z_resnet": "Number - ResNet Z-score",
      "consistency": "Number - ä¸€è‡´æ€§æƒé‡",
      "top1_count": "Number - Top-1å‡ºç°æ¬¡æ•°"
    }
  }
}
```

### 1.4 æ•°æ®æ¨¡å‹æ±‡æ€»

| æ¨¡å‹å | å±‚çº§ | å¯¹åº”æ¨¡å— | è¯´æ˜ |
|--------|------|----------|------|
| RequestModel | L1 | main.py | è¯·æ±‚å…¥å‚ |
| ResponseModel | L1 | main.py | å“åº”å‡ºå‚ |
| AudioSegment | L2 | voice_pair.py | éŸ³é¢‘ç‰‡æ®µ |
| EmbeddingVector | L2 | voice_pair.py | ç‰¹å¾å‘é‡ |
| VDBSearchResult | L2 | vdb.py | æ£€ç´¢ç»“æœ |
| FusedScore | L2 | embedding_cal.py | èåˆåˆ†æ•° |

---

## ğŸ”„ STEP 2: æµç¨‹å›¾

> **ğŸ“Œ ç›®æ ‡**ï¼šæè¿°å£°çº¹è¯†åˆ«ç³»ç»Ÿçš„å®Œæ•´å¤„ç†æµç¨‹ï¼Œæ˜ç¡®å„æ¨¡å—è°ƒç”¨å…³ç³»
>
> **ğŸ“¤ äº§å‡º**ï¼š
> - ä¸»æ¨ç†æµç¨‹å›¾
> - éŸ³é¢‘é¢„å¤„ç†å­æµç¨‹
> - å¤šç‰‡æ®µèåˆå­æµç¨‹
> - æµç¨‹ä¸æ¨¡å—å…³è”è¡¨

### 2.1 ä¸»æ¨ç†æµç¨‹å›¾

```
å¼€å§‹
 â†“
ã€æ¥æ”¶è¯·æ±‚ã€‘
 â”œâ”€â†’ è¯·æ±‚æ¥æº: POST /infer
 â””â”€â†’ è¯·æ±‚ä½“: VickyMmRequest
 â†“
ã€å‚æ•°æ ¡éªŒã€‘ [æ¨¡å—:main.py]
 â”œâ”€â†’ æ£€æŸ¥ vmms_type == "audio"
 â”œâ”€â†’ æ£€æŸ¥ meg_trade_2 å¿…å¡«
 â”œâ”€â†’ æ£€æŸ¥ channelType == "binaural"
 â””â”€â†’ æ£€æŸ¥ VDB ä¸­å­˜åœ¨è¯¥è¡Œä¸šç§å­
 â†“
ã€éŸ³é¢‘ä¸‹è½½ã€‘ [æ¨¡å—:voice_pair.py]
 â”œâ”€â†’ ä» audio_url ä¸‹è½½éŸ³é¢‘
 â””â”€â†’ ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•
 â†“
ã€é€šé“åˆ†ç¦»ã€‘ [æ¨¡å—:voice_pair.py]
 â”œâ”€â†’ æ–¹æ³•: split_audio_channel_w_soundfile()
 â”œâ”€â†’ è¾“å…¥: åŒå£°é“éŸ³é¢‘
 â””â”€â†’ è¾“å‡º: å•å£°é“éŸ³é¢‘ (customerChannel)
 â†“
ã€è¯­éŸ³å¢å¼ºã€‘ [æ¨¡å—:voice_pair.py]
 â”œâ”€â†’ æ–¹æ³•: enhance_speech()
 â”œâ”€â†’ æ¨¡å‹: MetricGAN+ (speechbrain)
 â””â”€â†’ è¾“å‡º: é™å™ªå¢å¼ºåéŸ³é¢‘
 â†“
ã€ASRæå–æœåŠ¡éŸ³é¢‘ã€‘ [æ¨¡å—:asr.py] [å¯é€‰]
 â”œâ”€â†’ æ¡ä»¶: extra.asr æœ‰å€¼
 â”œâ”€â†’ æ–¹æ³•: get_service_audio()
 â”œâ”€â†’ è¾“å…¥: ASRæ—¶é—´æˆ³ + å¢å¼ºéŸ³é¢‘
 â””â”€â†’ è¾“å‡º: æœåŠ¡äººå‘˜è¯´è¯ç‰‡æ®µ
 â†“
ã€æ»‘åŠ¨çª—å£åˆ‡åˆ†ã€‘ [æ¨¡å—:voice_pair.py]
 â”œâ”€â†’ æ–¹æ³•: sliding_window_crops()
 â”œâ”€â†’ å‚æ•°: çª—å£6ç§’, æ­¥é•¿3ç§’, æœ€å¤š8ä¸ªç‰‡æ®µ
 â””â”€â†’ è¾“å‡º: Nä¸ªéŸ³é¢‘ç‰‡æ®µ (crops, Nâ‰¤8)
 â†“
ã€åˆ¤æ–­æ¨¡å¼ã€‘
 â”œâ”€â†’ seed=true â†’ ç§å­æ³¨å†Œæ¨¡å¼
 â”‚    â”œâ”€â†’ æå– ECAPA å‘é‡ (192ç»´)
 â”‚    â”œâ”€â†’ æå– ResNet å‘é‡ (256ç»´)
 â”‚    â””â”€â†’ è¿”å›å‘é‡ â†’ ç»“æŸ
 â”‚
 â””â”€â†’ seed=false â†’ è¯†åˆ«æ¨¡å¼
      â†“
ã€å¤šç‰‡æ®µå¹¶å‘å¤„ç†ã€‘ [æ¨¡å—:embedding_cal.py]
 â”‚
 â”œâ”€â†’ ã€ECAPAå‘é‡åŒ–ã€‘ [å¹¶å‘Ã—N]
 â”‚    â”œâ”€â†’ æ–¹æ³•: audio_to_embedding_ecapa()
 â”‚    â”œâ”€â†’ æ¨¡å‹: ECAPA-TDNN (192ç»´)
 â”‚    â””â”€â†’ è¾“å‡º: ecapa_vector
 â”‚
 â”œâ”€â†’ ã€VDBæ£€ç´¢ã€‘ [å¹¶å‘Ã—N]
 â”‚    â”œâ”€â†’ æ–¹æ³•: vdb.search()
 â”‚    â”œâ”€â†’ ç´¢å¼•: HNSW + meg_trade_2 è¿‡æ»¤
 â”‚    â””â”€â†’ è¾“å‡º: Top 10 å€™é€‰
 â”‚
 â””â”€â†’ ã€ECAPAåˆ†æ•°èšåˆã€‘
      â”œâ”€â†’ æŒ‰ speaker_id èšåˆ max åˆ†æ•°
      â””â”€â†’ ç»Ÿè®¡ top-1 å‡ºç°æ¬¡æ•°
 â†“
ã€ResNeté‡æ’åºã€‘ [æ¨¡å—:embedding_cal.py]
 â”œâ”€â†’ å– Top 20 å€™é€‰
 â”œâ”€â†’ æ–¹æ³•: audio_to_embedding_resnet()
 â”œâ”€â†’ æ¨¡å‹: ResNet (256ç»´)
 â””â”€â†’ VDBæ£€ç´¢ ResNet åˆ†æ•°
 â†“
ã€åŒæ¨¡å‹èåˆã€‘ [æ¨¡å—:embedding_cal.py]
 â”œâ”€â†’ Z-score å½’ä¸€åŒ–
 â”œâ”€â†’ ä¸€è‡´æ€§åŠ æƒ
 â”œâ”€â†’ çº¿æ€§èåˆ: Î±=0.6 (ECAPA) + 0.4 (ResNet)
 â””â”€â†’ Softmax è½¬æ¢ (T=0.52)
 â†“
ã€æ„å»ºå“åº”ã€‘
 â”œâ”€â†’ æ’åºå– Top N
 â”œâ”€â†’ æ„å»º detects[].issues[]
 â””â”€â†’ å¡«å…… inner_info è°ƒè¯•ä¿¡æ¯
 â†“
ã€è¿”å›ç»“æœã€‘
 â†“
ç»“æŸ
```

### 2.2 å¤šç‰‡æ®µèåˆç®—æ³•æµç¨‹

```
è¾“å…¥: Nä¸ªéŸ³é¢‘ç‰‡æ®µ (crops)
 â†“
ã€Phase 1: ECAPAå¹¶å‘å¤„ç†ã€‘
 â”œâ”€â†’ ç‰‡æ®µ1 â†’ ECAPAå‘é‡ â†’ VDBæ£€ç´¢ â†’ Top10ç»“æœ
 â”œâ”€â†’ ç‰‡æ®µ2 â†’ ECAPAå‘é‡ â†’ VDBæ£€ç´¢ â†’ Top10ç»“æœ
 â”œâ”€â†’ ...
 â””â”€â†’ ç‰‡æ®µN â†’ ECAPAå‘é‡ â†’ VDBæ£€ç´¢ â†’ Top10ç»“æœ
 â†“
ã€Phase 2: ECAPAåˆ†æ•°èšåˆã€‘
 â”‚
 â”œâ”€â†’ æŒ‰speaker_idèšåˆ:
 â”‚    score[speaker] = max(æ‰€æœ‰ç‰‡æ®µä¸­è¯¥speakerçš„åˆ†æ•°)
 â”‚
 â””â”€â†’ ç»Ÿè®¡top-1å‡ºç°æ¬¡æ•°:
      top1_count[speaker] = è¯¥speakeråœ¨å„ç‰‡æ®µä¸­æ’ç¬¬ä¸€çš„æ¬¡æ•°
 â†“
ã€Phase 3: ResNeté‡æ’åºã€‘
 â”œâ”€â†’ å–ECAPA Top 20å€™é€‰
 â”œâ”€â†’ å¯¹æ¯ä¸ªå€™é€‰:
 â”‚    â””â”€â†’ æå–ResNetå‘é‡ â†’ VDBæ£€ç´¢ â†’ è·å–ResNetåˆ†æ•°
 â””â”€â†’ è¾“å‡º: 20ä¸ª(speaker_id, ecapa_score, resnet_score)
 â†“
ã€Phase 4: åˆ†æ•°èåˆã€‘
 â”‚
 â”œâ”€â†’ Z-scoreå½’ä¸€åŒ–:
 â”‚    z_ecapa = (ecapa_score - mean) / std
 â”‚    z_resnet = (resnet_score - mean) / std
 â”‚
 â”œâ”€â†’ ä¸€è‡´æ€§æƒé‡:
 â”‚    consistency = top1_count / total_segments
 â”‚
 â”œâ”€â†’ çº¿æ€§èåˆ:
 â”‚    final = 0.6 * z_ecapa + 0.4 * z_resnet + 0.3 * consistency
 â”‚
 â””â”€â†’ Softmaxè½¬æ¢:
      prob = exp(final / 0.52) / sum(exp(final / 0.52))
 â†“
ã€Phase 5: æ’åºè¾“å‡ºã€‘
 â””â”€â†’ æŒ‰ prob é™åºæ’åˆ— â†’ å– Top N
 â†“
è¾“å‡º: [(speaker_id, score, ecapa_score, resnet_score), ...]
```

### 2.3 æµç¨‹-æ¨¡å—å…³è”è¡¨

| æµç¨‹èŠ‚ç‚¹ | è§¦å‘æ¡ä»¶ | è°ƒç”¨æ¨¡å— | è°ƒç”¨æ–¹æ³• | è¾“å‡ºæ•°æ® |
|----------|----------|----------|----------|----------|
| å‚æ•°æ ¡éªŒ | è¯·æ±‚è¿›å…¥ | main.py | infer() | æ ¡éªŒç»“æœ |
| éŸ³é¢‘ä¸‹è½½ | æ ¡éªŒé€šè¿‡ | utils.py | download_audio() | æœ¬åœ°è·¯å¾„ |
| é€šé“åˆ†ç¦» | åŒå£°é“éŸ³é¢‘ | voice_pair.py | split_audio_channel_w_soundfile() | å•å£°é“éŸ³é¢‘ |
| è¯­éŸ³å¢å¼º | åˆ†ç¦»å®Œæˆ | voice_pair.py | enhance_speech() | å¢å¼ºéŸ³é¢‘ |
| ASRæå– | asræœ‰å€¼ | asr.py | get_service_audio() | æœåŠ¡éŸ³é¢‘ |
| æ»‘åŠ¨åˆ‡åˆ† | å¢å¼ºå®Œæˆ | voice_pair.py | sliding_window_crops() | éŸ³é¢‘ç‰‡æ®µåˆ—è¡¨ |
| ECAPAå‘é‡åŒ– | åˆ‡åˆ†å®Œæˆ | voice_pair.py | audio_to_embedding_ecapa() | 192ç»´å‘é‡ |
| VDBæ£€ç´¢ | å‘é‡å°±ç»ª | vdb.py | search() | Top10å€™é€‰ |
| ResNetå‘é‡åŒ– | ECAPAèšåˆå | voice_pair.py | audio_to_embedding_resnet() | 256ç»´å‘é‡ |
| åˆ†æ•°èåˆ | åŒæ¨¡å‹ç»“æœ | embedding_cal.py | _fuse_scores() | æœ€ç»ˆæ’åº |

---

## ğŸŒ³ STEP 3: æ ‘çŠ¶å›¾ (æ¨¡å—ç»“æ„)

> **ğŸ“Œ ç›®æ ‡**ï¼šå°†ç³»ç»Ÿæ‹†è§£ä¸ºå±‚çº§ç»“æ„ï¼Œå»ºç«‹æ¨¡å—æ ‘ï¼Œæ ‡æ³¨æ•°æ®æµå‘
>
> **ğŸ“¤ äº§å‡º**ï¼š
> - L1/L2/L3 ä¸‰å±‚æ¨¡å—æ ‘çŠ¶å›¾
> - æ¯ä¸ªæ¨¡å—çš„æ–‡ä»¶è·¯å¾„æ ‡æ³¨
> - æ¨¡å—é—´ä¾èµ–å…³ç³»

### 3.1 æ¨¡å—å±‚çº§æ ‘çŠ¶å›¾

```
ã€VoiceprintSystemã€‘â˜…â˜…â˜… å£°çº¹è¯†åˆ«ç³»ç»Ÿ
â”‚
â”œâ”€â”€ ã€æœåŠ¡å±‚ã€‘ğŸ“± [L1]
â”‚   â”‚   æ–‡ä»¶: voiceprint/main.py
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ VoiceprintProcessor [L1] [æœåŠ¡å…¥å£]
â”‚       â”‚   ç±»: VoiceprintProcessor(VickyMmProcessor)
â”‚       â”‚   è£…é¥°å™¨: @vicky_mm_server
â”‚       â”‚
â”‚       â”œâ”€â”€ startup() [åˆå§‹åŒ–]
â”‚       â”‚   â”œâ”€â”€ åŠ è½½ SpeechIdentification æ¨¡å‹
â”‚       â”‚   â””â”€â”€ åˆå§‹åŒ– EmbeddingCalculator
â”‚       â”‚
â”‚       â””â”€â”€ infer() [ä¸»æ¨ç†]
â”‚           â”œâ”€â”€ å‚æ•°æ ¡éªŒ â†’ [data:RequestModel]
â”‚           â”œâ”€â”€ è°ƒç”¨é¢„å¤„ç† â†’ [æ¨¡å—:voice_pair.py]
â”‚           â”œâ”€â”€ è°ƒç”¨èåˆè¯†åˆ« â†’ [æ¨¡å—:embedding_cal.py]
â”‚           â””â”€â”€ æ„å»ºå“åº” â†’ [data:ResponseModel]
â”‚
â”œâ”€â”€ ã€æ ¸å¿ƒå¤„ç†å±‚ã€‘ğŸ·ï¸ [L2]
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ SpeechIdentification [L2] [éŸ³é¢‘å¤„ç†]
â”‚   â”‚   â”‚   æ–‡ä»¶: voiceprint/voice_pair.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€Šé€šé“åˆ†ç¦»ã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ split_audio_channel_w_soundfile() [data:AudioPath]
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€Šè¯­éŸ³å¢å¼ºã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ enhance_speech() [æ¨¡å‹:MetricGAN+]
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€ŠVADæ£€æµ‹ã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ silero_extract_speech_segments() [æ¨¡å‹:Silero VAD]
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€Šæ»‘åŠ¨çª—å£ã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ sliding_window_crops() [data:AudioSegment]
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€ŠECAPAå‘é‡åŒ–ã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ audio_to_embedding_ecapa() [data:EmbeddingVector.ecapa]
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€ŠResNetå‘é‡åŒ–ã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ audio_to_embedding_resnet() [data:EmbeddingVector.resnet]
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ã€ŠéŸ³é¢‘ä¿¡æ¯ã€‹[L3]
â”‚   â”‚       â””â”€â”€ get_audio_info() [duration, avg_db]
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ EmbeddingCalculator [L2] [ç‰¹å¾èåˆ]
â”‚   â”‚   â”‚   æ–‡ä»¶: voiceprint/embedding_cal.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€Šå¤šç‰‡æ®µå¤„ç†ã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ process_multi_segment_recognition()
â”‚   â”‚   â”‚       â”œâ”€â”€ _process_segment_ecapa() [å¹¶å‘]
â”‚   â”‚   â”‚       â”œâ”€â”€ _aggregate_ecapa_results()
â”‚   â”‚   â”‚       â”œâ”€â”€ _rerank_with_resnet()
â”‚   â”‚   â”‚       â””â”€â”€ _fuse_scores() [data:FusedScore]
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ã€Šèåˆç®—æ³•ã€‹[L3]
â”‚   â”‚       â”œâ”€â”€ Z-scoreå½’ä¸€åŒ–
â”‚   â”‚       â”œâ”€â”€ ä¸€è‡´æ€§åŠ æƒ
â”‚   â”‚       â”œâ”€â”€ çº¿æ€§èåˆ (Î±=0.6)
â”‚   â”‚       â””â”€â”€ Softmax (T=0.52)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ VDB [L2] [å‘é‡æ•°æ®åº“]
â”‚   â”‚   â”‚   æ–‡ä»¶: voiceprint/vdb.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€Šè¿æ¥ç®¡ç†ã€‹[L3]
â”‚   â”‚   â”‚   â””â”€â”€ get_client() [Mochow Client]
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ã€ŠCRUDæ“ä½œã€‹[L3]
â”‚   â”‚   â”‚   â”œâ”€â”€ search() [data:VDBSearchResult]
â”‚   â”‚   â”‚   â”œâ”€â”€ upsert()
â”‚   â”‚   â”‚   â”œâ”€â”€ delete_by_id()
â”‚   â”‚   â”‚   â””â”€â”€ query_by_id()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ã€Šè¡¨ç®¡ç†ã€‹[L3]
â”‚   â”‚       â”œâ”€â”€ create_table()
â”‚   â”‚       â””â”€â”€ create_index() [HNSW + äºŒçº§ç´¢å¼•]
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“¦ VDBSeed [L2] [ç§å­ç®¡ç†]
â”‚   â”‚   â”‚   æ–‡ä»¶: voiceprint/vdb_seed.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ã€Šç§å­æ“ä½œã€‹[L3]
â”‚   â”‚       â”œâ”€â”€ register_seed()
â”‚   â”‚       â”œâ”€â”€ update_seed()
â”‚   â”‚       â””â”€â”€ batch_import()
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“¦ ASR [L2] [è¯­éŸ³è¯†åˆ«é›†æˆ]
â”‚       â”‚   æ–‡ä»¶: voiceprint/asr.py
â”‚       â”‚
â”‚       â””â”€â”€ ã€ŠæœåŠ¡éŸ³é¢‘æå–ã€‹[L3]
â”‚           â””â”€â”€ get_service_audio() [data:ASRSegment]
â”‚
â”œâ”€â”€ ã€åŸºç¡€è®¾æ–½å±‚ã€‘ğŸ”§ [L3]
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ config.py [L3] [é…ç½®ç®¡ç†]
â”‚   â”‚   â”œâ”€â”€ VDB_* (å‘é‡æ•°æ®åº“é…ç½®)
â”‚   â”‚   â”œâ”€â”€ BOS_* (å¯¹è±¡å­˜å‚¨é…ç½®)
â”‚   â”‚   â””â”€â”€ MODEL_* (æ¨¡å‹è·¯å¾„é…ç½®)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ utils.py [L3] [å·¥å…·å‡½æ•°]
â”‚   â”‚   â”œâ”€â”€ download_audio()
â”‚   â”‚   â””â”€â”€ cleanup_temp_files()
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ bos.py [L3] [å¯¹è±¡å­˜å‚¨]
â”‚   â”‚   â”œâ”€â”€ bos_upload()
â”‚   â”‚   â”œâ”€â”€ bos_download()
â”‚   â”‚   â””â”€â”€ bos_list()
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“„ tools.py [L3] [å¼‚æ­¥è¯·æ±‚]
â”‚       â””â”€â”€ async_request()
â”‚
â””â”€â”€ ã€å¤–éƒ¨ä¾èµ–ã€‘ğŸ“¡
    â”‚
    â”œâ”€â”€ ğŸ§  é¢„è®­ç»ƒæ¨¡å‹
    â”‚   â”œâ”€â”€ MetricGAN+ (è¯­éŸ³å¢å¼º)
    â”‚   â”œâ”€â”€ ECAPA-TDNN (è¯´è¯äººè¯†åˆ«, 192ç»´)
    â”‚   â”œâ”€â”€ ResNet (è¯´è¯äººè¯†åˆ«, 256ç»´)
    â”‚   â””â”€â”€ Silero VAD (è¯­éŸ³æ´»åŠ¨æ£€æµ‹)
    â”‚
    â”œâ”€â”€ ğŸ—„ï¸ ç™¾åº¦Mochow VDB
    â”‚   â”œâ”€â”€ ecapa_seedè¡¨ (192ç»´å‘é‡)
    â”‚   â””â”€â”€ resnet_seedè¡¨ (256ç»´å‘é‡)
    â”‚
    â””â”€â”€ â˜ï¸ ç™¾åº¦BOS
        â””â”€â”€ ç§å­éŸ³é¢‘å­˜å‚¨
```

### 3.2 æ¨¡å—ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ¨¡å—ä¾èµ–å›¾                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚ VoiceprintProcessor â”‚ [L1] æœåŠ¡å…¥å£                              â”‚
â”‚   â”‚    main.py          â”‚                                           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚            â”‚                                                        â”‚
â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚            â†“                  â†“                  â†“                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚ SpeechIdent    â”‚  â”‚ EmbeddingCalc  â”‚  â”‚ VDB            â”‚       â”‚
â”‚   â”‚ voice_pair.py  â”‚  â”‚ embedding_cal  â”‚  â”‚ vdb.py         â”‚       â”‚
â”‚   â”‚ [L2]           â”‚  â”‚ [L2]           â”‚  â”‚ [L2]           â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â”‚                   â”‚                   â”‚                 â”‚
â”‚           â†“                   â†“                   â†“                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                    config.py [L3]                       â”‚       â”‚
â”‚   â”‚                    utils.py  [L3]                       â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ STEP 4: æ¶æ„å¸ƒå±€å›¾

> **ğŸ“Œ ç›®æ ‡**ï¼šå®šä¹‰ç³»ç»Ÿçš„æ•´ä½“æ¶æ„å¸ƒå±€ï¼Œå±•ç¤ºç»„ä»¶é—´çš„ç©ºé—´å…³ç³»
>
> **ğŸ“¤ äº§å‡º**ï¼š
> - ç³»ç»Ÿæ¶æ„æ€»è§ˆå›¾
> - æ•°æ®æµå‘å›¾
> - æŠ€æœ¯æ ˆåˆ†å±‚å›¾

### 4.1 ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å£°çº¹è¯†åˆ«ç³»ç»Ÿæ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚  å®¢æˆ·ç«¯è¯·æ±‚  â”‚  POST /infer + audio_url + extra                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â†“                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    VoiceprintProcessor [L1]                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  å‚æ•°æ ¡éªŒ â†’ éŸ³é¢‘ä¸‹è½½ â†’ é¢„å¤„ç†æµæ°´çº¿ â†’ è¯†åˆ«å¼•æ“ â†’ å“åº”æ„å»º      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚         â†“                    â†“                    â†“                     â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚ é¢„å¤„ç†æ¨¡å—    â”‚    â”‚ è¯†åˆ«å¼•æ“     â”‚    â”‚ å‘é‡æ•°æ®åº“   â”‚              â”‚   â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚              â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚   â”‚
â”‚  â”‚ â”‚é€šé“åˆ†ç¦»  â”‚ â”‚    â”‚ â”‚ECAPA-TDNNâ”‚ â”‚    â”‚ â”‚ecapa_seedâ”‚ â”‚              â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚ (192ç»´)  â”‚ â”‚    â”‚ â”‚  HNSW    â”‚ â”‚              â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚   â”‚
â”‚  â”‚ â”‚MetricGAN+â”‚ â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚   â”‚
â”‚  â”‚ â”‚ è¯­éŸ³å¢å¼º â”‚ â”‚    â”‚ â”‚ ResNet   â”‚ â”‚    â”‚ â”‚resnet_   â”‚ â”‚              â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚ (256ç»´)  â”‚ â”‚    â”‚ â”‚  seed    â”‚ â”‚              â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚   â”‚
â”‚  â”‚ â”‚æ»‘åŠ¨çª—å£  â”‚ â”‚    â”‚              â”‚    â”‚              â”‚              â”‚   â”‚
â”‚  â”‚ â”‚  åˆ‡åˆ†    â”‚ â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ Mochow VDB  â”‚              â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚ èåˆç®—æ³• â”‚ â”‚    â”‚ (ç™¾åº¦äº‘)    â”‚              â”‚   â”‚
â”‚  â”‚              â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚              â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚         â”‚                    â”‚                    â”‚                     â”‚   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚
â”‚                              â”‚                                          â”‚   â”‚
â”‚                              â†“                                          â”‚   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚   â”‚
â”‚                    â”‚   å“åº”ç»“æœ    â”‚  speaker_id + score                 â”‚   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ•°æ®æµå‘                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  éŸ³é¢‘URL                                                                    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â†“                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ åŸå§‹   â”‚ â†’  â”‚ å•å£°é“ â”‚ â†’  â”‚ å¢å¼ºå â”‚ â†’  â”‚ æœåŠ¡   â”‚ â†’  â”‚ åˆ‡åˆ†   â”‚       â”‚
â”‚  â”‚ éŸ³é¢‘   â”‚    â”‚ éŸ³é¢‘   â”‚    â”‚ éŸ³é¢‘   â”‚    â”‚ éŸ³é¢‘   â”‚    â”‚ ç‰‡æ®µ   â”‚       â”‚
â”‚  â”‚ (wav)  â”‚    â”‚ (wav)  â”‚    â”‚ (wav)  â”‚    â”‚ (wav)  â”‚    â”‚ x N    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                â”‚            â”‚
â”‚                                                                â†“            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        å¹¶å‘å¤„ç† (Nä¸ªç‰‡æ®µ)                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   ç‰‡æ®µ1 â”€â”€â†’ ECAPAå‘é‡(192) â”€â”€â†’ VDBæ£€ç´¢ â”€â”€â†’ Top10å€™é€‰                 â”‚   â”‚
â”‚  â”‚   ç‰‡æ®µ2 â”€â”€â†’ ECAPAå‘é‡(192) â”€â”€â†’ VDBæ£€ç´¢ â”€â”€â†’ Top10å€™é€‰                 â”‚   â”‚
â”‚  â”‚   ...                                                               â”‚   â”‚
â”‚  â”‚   ç‰‡æ®µN â”€â”€â†’ ECAPAå‘é‡(192) â”€â”€â†’ VDBæ£€ç´¢ â”€â”€â†’ Top10å€™é€‰                 â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                         â”‚
â”‚                                  â†“                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                         â”‚ ECAPAåˆ†æ•°èšåˆ  â”‚                                 â”‚
â”‚                         â”‚ max + count    â”‚                                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                 â”‚                                          â”‚
â”‚                                 â†“                                          â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                         â”‚ ResNeté‡æ’åº   â”‚                                 â”‚
â”‚                         â”‚ Top 20å€™é€‰     â”‚                                 â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                 â”‚                                          â”‚
â”‚                                 â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          åˆ†æ•°èåˆ                                     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   Z-scoreå½’ä¸€åŒ– â†’ ä¸€è‡´æ€§åŠ æƒ â†’ çº¿æ€§èåˆ(Î±=0.6) â†’ Softmax(T=0.52)     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                         â”‚
â”‚                                  â†“                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                         â”‚ Top N ç»“æœ     â”‚                                 â”‚
â”‚                         â”‚ speaker + score â”‚                                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æŠ€æœ¯æ ˆåˆ†å±‚å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æŠ€æœ¯æ ˆåˆ†å±‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        æœåŠ¡æ¡†æ¶å±‚                                     â”‚   â”‚
â”‚  â”‚                   vicky_mm_server (å¼‚æ­¥æ¨ç†)                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        æ·±åº¦å­¦ä¹ å±‚                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚ PyTorch   â”‚  â”‚SpeechBrainâ”‚  â”‚ Silero    â”‚  â”‚ Librosa   â”‚        â”‚   â”‚
â”‚  â”‚  â”‚  2.1.2    â”‚  â”‚  >=1.0.3  â”‚  â”‚   VAD     â”‚  â”‚ >=0.11.0  â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        é¢„è®­ç»ƒæ¨¡å‹å±‚                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  MetricGAN+   â”‚  â”‚  ECAPA-TDNN   â”‚  â”‚    ResNet     â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  è¯­éŸ³å¢å¼º     â”‚  â”‚  192ç»´å‘é‡    â”‚  â”‚   256ç»´å‘é‡   â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        å­˜å‚¨å±‚                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚    Mochow VDB       â”‚        â”‚     ç™¾åº¦ BOS        â”‚            â”‚   â”‚
â”‚  â”‚  â”‚   (HNSWç´¢å¼•)        â”‚        â”‚   (ç§å­éŸ³é¢‘)        â”‚            â”‚   â”‚
â”‚  â”‚  â”‚   pymochow>=2.2.9   â”‚        â”‚  bce-sdk>=0.9.42    â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        è¿è¡Œç¯å¢ƒ                                      â”‚   â”‚
â”‚  â”‚              Python 3.11+ | CUDA 11.8+ | Docker                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ STEP 5: ä»£ç ç»“æ„

> **ğŸ“Œ ç›®æ ‡**ï¼šå°†æ¨¡å—ç»“æ„æ˜ å°„ä¸ºå¯æ‰§è¡Œçš„ä»£ç æ–‡ä»¶ç»„ç»‡
>
> **ğŸ“¤ äº§å‡º**ï¼š
> - å®Œæ•´çš„æ–‡ä»¶å¤¹/æ–‡ä»¶ç»“æ„æ ‘
> - æ¯ä¸ªæ–‡ä»¶çš„èŒè´£è¯´æ˜
> - å±‚çº§ä¸å¸ƒå±€çš„å¯¹åº”å…³ç³»

### 5.1 é¡¹ç›®æ–‡ä»¶ç»“æ„

```
voiceprint/                              # é¡¹ç›®æ ¹ç›®å½•
â”‚
â”œâ”€â”€ voiceprint/                          # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚
â”‚   â”œâ”€â”€ __init__.py                      # åŒ…åˆå§‹åŒ–
â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚  ğŸ¯ æœåŠ¡å…¥å£ [L1] - main.py                                    â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â”‚  ç±»: VoiceprintProcessor(VickyMmProcessor)                    â”‚
â”‚   â”‚   â”‚  æ–¹æ³•: startup(), infer()                                     â”‚
â”‚   â”‚   â”‚  èŒè´£: è¯·æ±‚è§£æä¸æ ¡éªŒ â†’ æµç¨‹ç¼–æ’ â†’ ç»“æœå°è£…                     â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”œâ”€â”€ main.py                          # [L1] æœåŠ¡å…¥å£ (281è¡Œ)
â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚  ğŸ”Š éŸ³é¢‘å¤„ç† [L2] - voice_pair.py                              â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â”‚  ç±»: SpeechIdentification                                     â”‚
â”‚   â”‚   â”‚  æ–¹æ³•:                                                        â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ split_audio_channel_w_soundfile()  # é€šé“åˆ†ç¦»            â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ enhance_speech()                    # è¯­éŸ³å¢å¼º            â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ silero_extract_speech_segments()    # VADæ£€æµ‹            â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ sliding_window_crops()              # æ»‘åŠ¨çª—å£åˆ‡åˆ†        â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ audio_to_embedding_ecapa()          # ECAPAå‘é‡åŒ–         â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ audio_to_embedding_resnet()         # ResNetå‘é‡åŒ–        â”‚
â”‚   â”‚   â”‚  â””â”€â”€ get_audio_info()                    # éŸ³é¢‘ä¿¡æ¯            â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”œâ”€â”€ voice_pair.py                    # [L2] éŸ³é¢‘å¤„ç† (505è¡Œ)
â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚  ğŸ§® ç‰¹å¾èåˆ [L2] - embedding_cal.py                           â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â”‚  ç±»: EmbeddingCalculator                                      â”‚
â”‚   â”‚   â”‚  æ–¹æ³•:                                                        â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ process_multi_segment_recognition()  # å¤šç‰‡æ®µè¯†åˆ«        â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ _process_segment_ecapa()             # ECAPAå•ç‰‡æ®µ       â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ _aggregate_ecapa_results()           # ECAPAèšåˆ         â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ _rerank_with_resnet()                # ResNeté‡æ’åº      â”‚
â”‚   â”‚   â”‚  â””â”€â”€ _fuse_scores()                       # åˆ†æ•°èåˆ          â”‚
â”‚   â”‚   â”‚  ç®—æ³•: Z-score + ä¸€è‡´æ€§åŠ æƒ + çº¿æ€§èåˆ + Softmax               â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”œâ”€â”€ embedding_cal.py                 # [L2] ç‰¹å¾èåˆ (288è¡Œ)
â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚  ğŸ—„ï¸ å‘é‡æ•°æ®åº“ [L2] - vdb.py                                   â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â”‚  å‡½æ•°:                                                        â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ get_client()         # è·å–VDBå®¢æˆ·ç«¯                     â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ search()             # å‘é‡æ£€ç´¢                          â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ upsert()             # æ’å…¥/æ›´æ–°                         â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ delete_by_id()       # åˆ é™¤                              â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ query_by_id()        # æŸ¥è¯¢                              â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ create_table()       # åˆ›å»ºè¡¨                            â”‚
â”‚   â”‚   â”‚  â””â”€â”€ create_index()       # åˆ›å»ºç´¢å¼•                          â”‚
â”‚   â”‚   â”‚  ç´¢å¼•: HNSW (M=32, efConstruction=200)                        â”‚
â”‚   â”‚   â”‚  åº¦é‡: COSINE                                                 â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”œâ”€â”€ vdb.py                           # [L2] å‘é‡æ•°æ®åº“ (398è¡Œ)
â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚  ğŸŒ± ç§å­ç®¡ç† [L2] - vdb_seed.py                                â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â”‚  å‡½æ•°:                                                        â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ register_seed()      # æ³¨å†Œæ–°ç§å­                        â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ update_seed()        # æ›´æ–°ç§å­å‘é‡                      â”‚
â”‚   â”‚   â”‚  â””â”€â”€ batch_import()       # æ‰¹é‡å¯¼å…¥                          â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”œâ”€â”€ vdb_seed.py                      # [L2] ç§å­ç®¡ç†
â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚  ğŸ¤ ASRé›†æˆ [L2] - asr.py                                      â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â”‚  å‡½æ•°:                                                        â”‚
â”‚   â”‚   â”‚  â””â”€â”€ get_service_audio()  # æå–æœåŠ¡éŸ³é¢‘                      â”‚
â”‚   â”‚   â”‚  é€»è¾‘: è§£æASRæ—¶é—´æˆ³ â†’ è¯­ä¹‰åŒ¹é… â†’ æå–ç‰‡æ®µ â†’ æ‹¼æ¥              â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”œâ”€â”€ asr.py                           # [L2] ASRé›†æˆ (575è¡Œ)
â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚  âš™ï¸ é…ç½®ç®¡ç† [L3] - config.py                                  â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â”‚  é…ç½®é¡¹:                                                      â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ VDB_*        # å‘é‡æ•°æ®åº“ (endpoint, api_key, db_name)  â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ BOS_*        # å¯¹è±¡å­˜å‚¨ (host, ak, sk, bucket)          â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ QIANFAN_*    # åƒå¸†API (æ–‡æœ¬å‘é‡åŒ–)                      â”‚
â”‚   â”‚   â”‚  â””â”€â”€ MODEL_*      # æ¨¡å‹è·¯å¾„                                  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”œâ”€â”€ config.py                        # [L3] é…ç½®ç®¡ç† (60è¡Œ)
â”‚   â”‚
â”‚   â””â”€â”€ tests/                           # æµ‹è¯•å¥—ä»¶
â”‚       â”œâ”€â”€ test_ecapa_voiceprint.py     # ECAPAåŠŸèƒ½æµ‹è¯•
â”‚       â”œâ”€â”€ test_iflytek_voiceprint.py   # è®¯é£APIå¯¹æ¯”
â”‚       â”œâ”€â”€ quick_test_ecapa.py          # ECAPAå¿«é€ŸéªŒè¯
â”‚       â””â”€â”€ test_performance.py          # æ€§èƒ½æµ‹è¯•
â”‚
â”œâ”€â”€ model/                               # é¢„è®­ç»ƒæ¨¡å‹ç›®å½•
â”‚   â”œâ”€â”€ spkrec-ecapa-voxceleb/           # ECAPA-TDNN è¯´è¯äººè¯†åˆ«
â”‚   â”œâ”€â”€ spkrec-resnet-voxceleb/          # ResNet è¯´è¯äººè¯†åˆ«
â”‚   â”œâ”€â”€ metricgan-plus-voicebank/        # MetricGAN+ è¯­éŸ³å¢å¼º
â”‚   â””â”€â”€ vad-crdnn-libriparty/            # VAD è¯­éŸ³æ´»åŠ¨æ£€æµ‹
â”‚
â”œâ”€â”€ seed/                                # å£°çº¹ç§å­åº“
â”‚   â””â”€â”€ v2/                              # ç‰ˆæœ¬2ç§å­æ•°æ®
â”‚
â”œâ”€â”€ pyproject.toml                       # é¡¹ç›®é…ç½® (uv)
â”œâ”€â”€ Dockerfile                           # è¿è¡Œæ—¶é•œåƒ
â”œâ”€â”€ prebuild.Dockerfile                  # å‰ç½®é•œåƒ (ä¾èµ–+æ¨¡å‹é¢„è£…)
â”œâ”€â”€ prebuild-docker-build.sh             # å‰ç½®é•œåƒæ„å»ºè„šæœ¬
â”œâ”€â”€ start.sh                             # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ ci.yml                               # CI/CDé…ç½® (Baidu DECK)
â””â”€â”€ README.md                            # é¡¹ç›®è¯´æ˜
```

### 5.2 æ–‡ä»¶è¡Œæ•°ç»Ÿè®¡

| æ–‡ä»¶ | å±‚çº§ | è¡Œæ•° | èŒè´£ |
|------|------|------|------|
| main.py | L1 | 281 | æœåŠ¡å…¥å£ï¼Œè¯·æ±‚å¤„ç† |
| voice_pair.py | L2 | 505 | éŸ³é¢‘é¢„å¤„ç†ï¼Œå‘é‡åŒ– |
| embedding_cal.py | L2 | 288 | å¤šç‰‡æ®µèåˆç®—æ³• |
| vdb.py | L2 | 398 | å‘é‡æ•°æ®åº“æ“ä½œ |
| vdb_seed.py | L2 | ~150 | ç§å­ç®¡ç† |
| asr.py | L2 | 575 | ASRé›†æˆ |
| config.py | L3 | 60 | é…ç½®ç®¡ç† |
| utils.py | L3 | ~100 | å·¥å…·å‡½æ•° |
| bos.py | L3 | ~90 | å¯¹è±¡å­˜å‚¨ |
| tools.py | L3 | ~60 | å¼‚æ­¥è¯·æ±‚ |
| **åˆè®¡** | - | **~2507** | - |

---

## ğŸ—„ï¸ STEP 6: æ¥å£å®ç°ä¸æ•°æ®åº“è®¾è®¡

> **ğŸ“Œ ç›®æ ‡**ï¼šåŸºäº STEP 1 çš„æ•°æ®æ¨¡å‹ï¼Œå®šä¹‰å®Œæ•´çš„ API æ¥å£åŠå­˜å‚¨è®¾è®¡
>
> **ğŸ“¤ äº§å‡º**ï¼š
> - å®Œæ•´çš„æ¥å£å®šä¹‰
> - å‘é‡æ•°æ®åº“è¡¨è®¾è®¡
> - å…³é”®æŸ¥è¯¢è¯­å¥

### 6.1 æ¥å£å®šä¹‰

```json
{
  "æ¥å£åˆ—è¡¨": [
    {
      "åºå·": 1,
      "æ¥å£å": "å£°çº¹è¯†åˆ«",
      "æ¥å£æ ‡è¯†": "voiceprintInfer",
      "è·¯å¾„": "POST /infer",
      "è§¦å‘æ—¶æœº": "å®¢æˆ·ç«¯è°ƒç”¨",
      "å¯¹åº”æ•°æ®æ¨¡å‹": "STEP 1 â†’ RequestModel / ResponseModel",

      "è¯·æ±‚å‚æ•°": {
        "vmms_type": "String! - å›ºå®šå€¼'audio'",
        "audio_url": "String! - éŸ³é¢‘æ–‡ä»¶URL",
        "extra.meg_trade_2": "String! - äºŒçº§è¡Œä¸šä»£ç ",
        "extra.channelType": "String! - å›ºå®šå€¼'binaural'",
        "extra.customerChannel": "Number! - å®¢æˆ·é€šé“(1æˆ–2)",
        "extra.asr": "Array<ASRSegment>? - ASRç»“æœ",
        "extra.top_n": "Number? - è¿”å›æ•°é‡(é»˜è®¤10)",
        "extra.rerank_alpha": "Number? - èåˆæƒé‡(é»˜è®¤0.6)",
        "extra.seed": "Boolean? - ç§å­æ¨¡å¼(é»˜è®¤false)"
      },

      "å“åº”æ•°æ®": {
        "detects": "Array<DetectItem> - æ£€æµ‹ç»“æœ",
        "detects[].issues": "Array<IssueItem> - è¯†åˆ«ç»“æœ",
        "detects[].issues[].type": "String - è¯´è¯äººID",
        "detects[].issues[].reason": "String - ç›¸ä¼¼åº¦åˆ†æ•°",
        "inner_info": "Object - è°ƒè¯•ä¿¡æ¯"
      },

      "é”™è¯¯ç ": {
        "400": "å‚æ•°æ ¡éªŒå¤±è´¥",
        "404": "è¯¥è¡Œä¸šæ— ç§å­æ•°æ®",
        "500": "å†…éƒ¨å¤„ç†é”™è¯¯"
      }
    },

    {
      "åºå·": 2,
      "æ¥å£å": "ç§å­å‘é‡æå–",
      "æ¥å£æ ‡è¯†": "seedExtract",
      "è·¯å¾„": "POST /infer (seed=true)",
      "è§¦å‘æ—¶æœº": "ç§å­æ³¨å†Œæ—¶è°ƒç”¨",
      "å¯¹åº”æ•°æ®æ¨¡å‹": "STEP 1 â†’ SeedResponseModel",

      "è¯·æ±‚å‚æ•°": {
        "vmms_type": "String! - å›ºå®šå€¼'audio'",
        "audio_url": "String! - ç§å­éŸ³é¢‘URL",
        "extra.seed": "Boolean! - å›ºå®šå€¼true"
      },

      "å“åº”æ•°æ®": {
        "detects": "Array - ç©ºæ•°ç»„",
        "inner_info.ecapa_vector": "Array<Number>[192] - ECAPAå‘é‡",
        "inner_info.resnet_vector": "Array<Number>[256] - ResNetå‘é‡",
        "inner_info.msg": "String - å¤„ç†æ¶ˆæ¯"
      }
    }
  ]
}
```

### 6.2 æ¥å£æ±‡æ€»è¡¨

| åºå· | æ¥å£æ ‡è¯† | æ–¹æ³• | è·¯å¾„ | å¯¹åº”æ•°æ®æ¨¡å‹ | è¯´æ˜ |
|------|----------|------|------|--------------|------|
| 1 | voiceprintInfer | POST | /infer | ResponseModel | å£°çº¹è¯†åˆ«ä¸»æ¥å£ |
| 2 | seedExtract | POST | /infer?seed=true | SeedResponseModel | ç§å­å‘é‡æå– |

### 6.3 å‘é‡æ•°æ®åº“è¡¨è®¾è®¡

#### ecapa_seed è¡¨ (ECAPAå‘é‡å­˜å‚¨)

```python
# è¡¨ç»“æ„å®šä¹‰ (ä½ç½®: vdb.py:create_table())

{
    "table_name": "ecapa_seed",
    "replication": 3,
    "partition": {
        "partition_type": "HASH",
        "partition_num": 1
    },
    "schema": {
        "fields": [
            {
                "field_name": "speaker_id",
                "field_type": "STRING",
                "primary_key": True,
                "auto_id": False,
                "description": "è¯´è¯äººID (ä¸»é”®)"
            },
            {
                "field_name": "ecapa_vector",
                "field_type": "FLOAT_VECTOR",
                "dimension": 192,
                "description": "ECAPA-TDNNç‰¹å¾å‘é‡"
            },
            {
                "field_name": "meg_trade_2",
                "field_type": "STRING",
                "description": "äºŒçº§è¡Œä¸šä»£ç  (ç”¨äºç­›é€‰)"
            },
            {
                "field_name": "created_at",
                "field_type": "STRING",
                "description": "åˆ›å»ºæ—¶é—´ (ISO8601)"
            },
            {
                "field_name": "updated_at",
                "field_type": "STRING",
                "description": "æ›´æ–°æ—¶é—´ (ISO8601)"
            }
        ],
        "indexes": [
            {
                "index_name": "ecapa_vector_idx",
                "index_type": "HNSW",
                "field": "ecapa_vector",
                "params": {
                    "M": 32,
                    "efConstruction": 200
                },
                "metric_type": "COSINE"
            },
            {
                "index_name": "meg_trade_2_idx",
                "index_type": "SECONDARY_INDEX",
                "field": "meg_trade_2"
            }
        ]
    }
}
```

#### resnet_seed è¡¨ (ResNetå‘é‡å­˜å‚¨)

```python
{
    "table_name": "resnet_seed",
    "schema": {
        "fields": [
            {
                "field_name": "speaker_id",
                "field_type": "STRING",
                "primary_key": True
            },
            {
                "field_name": "resnet_vector",
                "field_type": "FLOAT_VECTOR",
                "dimension": 256,
                "description": "ResNetç‰¹å¾å‘é‡"
            },
            {
                "field_name": "meg_trade_2",
                "field_type": "STRING"
            }
        ],
        "indexes": [
            {
                "index_name": "resnet_vector_idx",
                "index_type": "HNSW",
                "params": {"M": 32, "efConstruction": 200},
                "metric_type": "COSINE"
            }
        ]
    }
}
```

### 6.4 å…³é”®æŸ¥è¯¢æ“ä½œ

```python
# å‘é‡æ£€ç´¢ (ä½ç½®: vdb.py:search())

def search(embedding, meg_trade_2, top_k=10, table_name="ecapa_seed"):
    """
    å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢

    å‚æ•°:
        embedding: numpy.ndarray - æŸ¥è¯¢å‘é‡ (192æˆ–256ç»´)
        meg_trade_2: str - äºŒçº§è¡Œä¸šä»£ç  (ç”¨äºè¿‡æ»¤)
        top_k: int - è¿”å›Top Kç»“æœ

    è¿”å›:
        List[Tuple[str, float]] - [(speaker_id, score), ...]
    """

    # æ„å»ºæŸ¥è¯¢
    query = {
        "vector": embedding.tolist(),
        "top_k": top_k,
        "filter": f"meg_trade_2 = '{meg_trade_2}'"
    }

    # æ‰§è¡Œæ£€ç´¢
    results = table.search(**query)

    # è¿”å›ç»“æœ
    return [(r.speaker_id, r.score) for r in results]


# æ’å…¥/æ›´æ–°ç§å­ (ä½ç½®: vdb.py:upsert())

def upsert(speaker_id, ecapa_vector, resnet_vector, meg_trade_2):
    """
    æ’å…¥æˆ–æ›´æ–°å£°çº¹ç§å­

    æ“ä½œ:
        1. æ£€æŸ¥speaker_idæ˜¯å¦å­˜åœ¨
        2. å­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥
        3. åŒæ—¶æ›´æ–°ecapa_seedå’Œresnet_seedè¡¨
    """

    # ECAPAè¡¨
    ecapa_table.upsert({
        "speaker_id": speaker_id,
        "ecapa_vector": ecapa_vector.tolist(),
        "meg_trade_2": meg_trade_2,
        "updated_at": datetime.now().isoformat()
    })

    # ResNetè¡¨
    resnet_table.upsert({
        "speaker_id": speaker_id,
        "resnet_vector": resnet_vector.tolist(),
        "meg_trade_2": meg_trade_2
    })


# åˆ é™¤ç§å­ (ä½ç½®: vdb.py:delete_by_id())

def delete_by_id(speaker_id, meg_trade_2):
    """åˆ é™¤æŒ‡å®šspeaker_idçš„ç§å­ (ä¸¤è¡¨åŒæ—¶åˆ é™¤)"""

    ecapa_table.delete(f"speaker_id = '{speaker_id}'")
    resnet_table.delete(f"speaker_id = '{speaker_id}'")
```

### 6.5 MVPæ¸…å•

| åºå· | åŠŸèƒ½ | å¯¹åº”æ•°æ®æ¨¡å‹ | æ¶‰åŠå­˜å‚¨ | æ¥å£ | ä¼˜å…ˆçº§ |
|------|------|--------------|----------|------|--------|
| 1 | å£°çº¹è¯†åˆ« | ResponseModel | VDB (ecapa+resnet) | POST /infer | P0 |
| 2 | ç§å­æå– | SeedResponseModel | - | POST /infer?seed=true | P0 |
| 3 | ç§å­æ³¨å†Œ | - | VDB (ecapa+resnet) | vdb_seed.register_seed() | P0 |
| 4 | ç§å­æ›´æ–° | - | VDB | vdb_seed.update_seed() | P1 |
| 5 | ç§å­åˆ é™¤ | - | VDB | vdb.delete_by_id() | P1 |
| 6 | æ‰¹é‡å¯¼å…¥ | - | VDB + BOS | vdb_seed.batch_import() | P2 |

**MVPç»Ÿè®¡**: 2å¼ VDBè¡¨ + 2ä¸ªAPIæ¥å£ + 4ä¸ªå†…éƒ¨æ–¹æ³• = æœ€å°å¯è¡Œåç«¯

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| Top-1 å‡†ç¡®ç‡ | 87.3% | ç¬¬ä¸€å€™é€‰æ­£ç¡®ç‡ |
| Top-5 å‡†ç¡®ç‡ | 96.8% | å‰äº”å€™é€‰åŒ…å«æ­£ç¡®ç»“æœ |
| å¹³å‡å“åº”æ—¶é—´ | 3.2ç§’ | ç«¯åˆ°ç«¯å¤„ç†å»¶è¿Ÿ |
| ååé‡ | 25+ QPS | æ”¯æŒå¹¶å‘æŸ¥è¯¢æ•° |

---

## ğŸ¯ è´¨é‡è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| æ•°æ®æ¨¡å‹ | 9/10 | è¯·æ±‚/å“åº”/å†…éƒ¨æ¨¡å‹å®Œæ•´ï¼Œå­—æ®µæ ‡æ³¨æ¸…æ™° |
| æµç¨‹å®Œæ•´æ€§ | 9/10 | ä¸»æµç¨‹+å­æµç¨‹è¦†ç›–æ‰€æœ‰å¤„ç†æ­¥éª¤ |
| ç»“æ„æ¸…æ™°åº¦ | 9/10 | L1/L2/L3å±‚çº§åˆ†æ˜ï¼Œä¾èµ–å…³ç³»æ˜ç¡® |
| æ¶æ„å¸ƒå±€ | 8/10 | ASCIIå›¾å±•ç¤ºæ¸…æ™°ï¼Œæ•°æ®æµå‘å®Œæ•´ |
| ä»£ç æ˜ å°„ | 9/10 | æ–‡ä»¶ç»“æ„ä¸æ¨¡å—ä¸€ä¸€å¯¹åº” |
| æ¥å£å®šä¹‰ | 8/10 | APIå®Œæ•´ï¼ŒVDBè¡¨ç»“æ„è¯¦ç»† |
| **ç»¼åˆ** | **8.7/10** | è¾¾åˆ°å¯æŒ‡å¯¼å¼€å‘çš„æ ‡å‡† |

---

## ğŸ“š é™„å½•

### A. æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è§£é‡Š |
|------|------|------|
| å£°çº¹ | Voiceprint | è¯´è¯äººçš„è¯­éŸ³ç‰¹å¾ |
| ECAPA-TDNN | - | æ—¶å»¶ç¥ç»ç½‘ç»œè¯´è¯äººè¯†åˆ«æ¨¡å‹ |
| ResNet | Residual Network | æ®‹å·®ç½‘ç»œ |
| HNSW | Hierarchical NSW | å›¾ç´¢å¼•ç®—æ³• |
| VAD | Voice Activity Detection | è¯­éŸ³æ´»åŠ¨æ£€æµ‹ |
| MetricGAN+ | - | GANè¯­éŸ³å¢å¼ºç®—æ³• |
| Z-score | Standard Score | æ ‡å‡†åŒ–åˆ†æ•° |
| Softmax | - | å½’ä¸€åŒ–æŒ‡æ•°å‡½æ•° |

### B. å‚è€ƒèµ„æº

- [ECAPA-TDNNè®ºæ–‡](https://arxiv.org/abs/2005.07143)
- [SpeechBrainæ–‡æ¡£](https://speechbrain.github.io/)
- [ç™¾åº¦Mochow VDB](https://cloud.baidu.com/doc/VDB/index.html)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ç”Ÿæˆæ—¥æœŸ**: 2025-12-03
**ç”Ÿæˆå·¥å…·**: Claude Code (å…­æ­¥æ³•æ¨¡æ¿ v5.4 é€‚é…)
