2.业务逻辑2.1.销售中心提货单1.使用业务单元：账号所属组织（柳钢集团、柳钢股份、广西钢铁、中金公司）默认【单据类型】：标准提货单，单据按【单据类型】：标准提货单，控制表头、明细字段的显隐性及必填项。2.提货单创建说明：(1)单据来源：由提货单均由分货管理中的提单编制下推生成，此时提货单，单据状态为“暂存”，提货单单据信息由两部分来源：由销售合同通过转换规则携带到提货单，其他信息由分货管理中的提单编制单据携带，提货单只允许修改【计划执行时间】、【计划结束时刻】和【备注】字段信息，其他字段信息不允许修改。(2)单据编号规则：T+基地编码+仓库编码+两位年+两位月+两位日+四位流水（例：T01W022509220001，“01” 为基地编码，“W02” 为仓库编码）(3)时间字段规则：1)【计划执行时间】默认为系统当天时间，允许修改。【计划结束时刻】系统自动计算，允许修改：常规组织（柳钢集团、柳钢股份、广西钢铁）：计划开始时间 + 7 天；中金公司特殊：计划开始时间 + 5 天。2)【计划结束时刻】：系统自动生成，用于控制提货单是否关闭，可手动修改。当前时间超过【计划结束时刻】，提货单自动关闭，回填【关闭状态】为“是”，单据状态改为“关闭状态”。然后通过下传接口（提单电文）传给MMS系统，MMS系统把相关单据设置为关闭，不允许再装车。(4)其它规则1)价证取价`　合同 “销售价格政策” 自动携带至提货单，在“物料明细”增加“价证取价”操作按钮，点击“价证取价”操作按钮，进行取价（支持批量取价），支撑价政取价计算；【具体见价格政策详设】3.提货单提交校验： 提交时系统自动进行以下规则校验，以下校验不通过，进行弹窗报错提示：然后显示报错原因，如果有多条不通过，就显示多条。弹窗提示例子：例子：1、提单数量校验不通过。例子2：1、合同已超期。2、资金校验不通过。(1)上游销售合同单据到期（超出有效期）时，提货单提交不成功，弹窗提示：上游销售合同单据已到期，不允许创建提货单。​(2)提单数量校验：提货单累计数量不得超过合同订货重量（含公差）上限，计算规则；条件1：实际出库累计校验计算规则:本次提货单：明细行【计划重量】 + 对应合同明细行的【已履约重量】（实际已提货重量） ≤ 合同【订货重量】{含公差【订货重量*[1+交货重量公差上限(%)]】}上限。
                               内部资料 注意保密                      10（确保当前实际已提 + 本次计划提的总量，不超过合同可提的最终上限，避免实际超提）条件2：（有效计划累计重量校验）本次提货【计划重量】 + 对应合同明细行的累计有效【计划重量】（所有未终止提货单明细行的计划重量总和） ≤ 合同【订货重量】{含公差【订货重量*[1+交货重量公差上限(%)]】}上限。（确保所有已规划的提货计划总和不超合同上限，避免 “多张未出库提单的计划重量叠加超限”）(3)资金校验：合同 “付款政策” 自动携带至提货单，用于标识货控方式，提交时必须完成货控校验。若客户货款不足，提货单提交操作直接失败，触发 “货款不足，无法提交” 报错。1)货控触发条件：【销售付款方式】的所有类型均校验提货金额是否足够。“资金池余额“/ 合同中【配款金额】>=【价税合计】。2)货控触发时点：操作“提交”按钮； 作用：全额预付款、定金、款到发货业务，均在提货单提交时校验客户货款是否足够。校验通过才能进行后续流程（如下传MMS等）。3)释放触发时点：操作“关闭“按钮作用：将未发货量（尾量）占款金额释放。释放金额=提货单总金额-出库（计量装车单）总金额。提货单关闭条件，自动关闭条件 提货单有效期到期后自动关闭，提货单有效期默认7天。中金公司：提货单审核后需延长有效期。(4)物流园运费校验：提货单物料明细行若选择 【库区】为“物流园仓库”，提交时需先校验账号运费是否足够；运费足够则提交成功，不足则接口返回 “运费不足” 信息。`　首先通过”提单运费电文”接口，把提单信息发给CMS本部物流系统。a　然后CMS本部物流系统通过“运费确认电文”，返回【运费标记】信息，回填【运费标记】，如果运费足够，回填”是”，如果运费不足，回填“否”(5)有效期时间校验：基本信息-计划结束时刻不能超过销售合同-基本信息中的合同有效期。合同到期，不允许提交新提货单。计算规则：合同有效期<计划结束时刻（例如：合同有效期：2025-10-16<计划结束时刻：2025-10-17），提交不成功。4.提货单审批后操作：(1)可信签署触发（合同类型不属于“出口钢材销售”）：`　提货单审批后，单据变为【已审核】状态，自动触发可信签署，系统自动通过“提单推送至可信签署”接口，把提单信息传给可信平台。客户签署后，可信平台通过【核对明细函推送至可信签署】把签署完成信息传回销售系统，回填销售系统提货单表头的【签署状态】字段信息。【备注：若不能自动，就需要增加【可信签署】操作按钮，手动触发】a　提货单单据列表，增加“更新签署状态”按钮，用于调用接口更新【签署状态】信息。b　【签署状态】为 “已签署”之后，将双签 PDF 文档推送至 CRM 系统（接口待新增）。(2)信息下发与系统联动：“已审核”的提货单单据，业务人员点击【下传】，把提货单信息下传到对应系统，具体规则如下：1)物料明细行，向各基地 MMS 系统推送信息：提货单的表头、提货单明细行通过各基地提单接口（
                               内部资料 注意保密                      11见6.外部接口设计）下发提货信息。状态反馈，各基地MMS系统接收销售系统下传接口信息，返回接收成功信息，反填“MMS 下发”完成字段。（一张提货单推送到MMS系统生成一张提货单信息（装车单））1、【基地】为：柳州基地：与本部MMS系统系统对接，点击【下传】后，销售系统通过“提单主表电文接口”、“提单明细电文接口”、“提单车号电文接口”把提单信息传给本部MMS系统，本部MMS系统接收信息成功后，通过接口“本部下传反馈接口”传给销售系统，然后回填【MMS 下发完成】。2、【基地】为：防城港基地：`　与广钢MMS系统对接，点击【下传】后，销售系统通过“广钢提单主表电文”、“广钢提单明细电文”把提单信息传给广钢MMS系统，广钢MMS系统接收信息成功后，通过接口“广钢下传反馈接口”传给销售系统，然后回填【MMS 下发完成】。a　与防城港物流系统（港务中心使用）对接，点击【下传】后，销售系统还需要通过“广钢物流提单主表电文”、“广钢物流提单明细电文”，传给防城港物流系统（港务中心使用）。（备注：目前防城港物流系统是订阅方式取“广钢物流提单主表电文”、“广钢物流提单明细电文”信息。即销售系统只需要把提单信息传一次给：“广钢物流提单主表电文”、“广钢物流提单明细电文”即可）3、【基地】为：玉林中金：与中金MMS系统对接，点击【下传】后，销售系统通过“中金提单主表和明细表电文”，中金MMS系统接收信息成功后，通过接口“中金下传反馈接口”传给销售系统，然后回填【MMS 下发完成】。1、【基地】为：柳州基地、防城港基地、玉林中金：本部物流系统接收信息成功后，通过“物流下传反馈接口”（待新增）传给销售系统，然后回填【物流下发完成】。物流园过户信息接收5.提单关闭流程（表头【出库库区】非物流园仓）(1)系统自动关闭，时间到期关闭：整单关闭：当前时间超过【计划结束时刻】，提货单自动关闭，回填【关闭状态】为“是”，【单据状态】改变为关闭状态。然后通过下传接口（提单电文）传给MMS系统，MMS系统把相关单据设置为关闭，不允许再装车。【基地】为：柳州基地：“提单主表电文接口”【基地】为：防城港基地：“广钢提单主表电文”【基地】为：玉林中金：“中金提单主表和明细表电文”(2)手动关闭：业务人员点击列表【关闭】规则如下：1)提单关闭校验：提货单关闭校验，①明细行关闭：业务人员，点击提货单明细行【行关闭】按钮时，然后通过下传接口（提单电文）传给MMS系统，MMS系统把相关单据设置为关闭，不允许再装车。②提货单整单关闭时：业务人员，点击提货单【关闭】按钮时,然后通过下传接口（提单电文）传给MMS
                               内部资料 注意保密                      12系统，MMS系统把相关单据设置为关闭，不允许再装车。【基地】为：柳州基地：“提单明细电文接口”【基地】为：防城港基地：“广钢提单明细电文”【基地】为：玉林中金：“中金提单主表和明细表电文”(3)提单关闭后续流程：提货单关闭后，待MMS系统接收接口信息，且返回信息接收成功，回填【关闭状态】为是，【单据状态】改变为关闭状态，自动释放 “余款” 且不允许推送生成销售出库单，释放剩余未提货量（欠交量）。接口返回接口如下：【基地】为：柳州基地：“本部下传反馈接口”【基地】为：防城港基地：“广钢下传反馈接口”【基地】为：玉林中金：“中金下传反馈接口”6.过户删除流程（表头【出库库区】为物流园仓）列表增加【过户删除】按钮，业务人员筛选【出库库区】为物流园仓（若非物流园仓，点击【过户删除】报错）的【单据状态】为“已审核”且【单据类型】为【标准提货单】，点击【过户删除】按钮。系统通过接口“过户删除回复电文”WMS本部物流系统系统，WMS本部物流系统接收到信息后，通过“物流下传反馈接口”（待新增）返回接收成功信息。回填【关闭状态】为“是”，【单据状态】改变为关闭状态。自动释放 “余款” 且不允许推送生成销售出库单，释放过户量（计划重量）7.“提货单”变更场景说明：(1)单据状态为“已审核”的提货单，点击“变更”操作，下推生成“提货单变更单”，变更单审批生效后反写内容回原“提货单”；“提货变更单”变更类型：提单时间变更。`　“提单时间变更”的变更内容：计划执行日期、计划结束时刻。提货变更单审批生效后，自动触发推送，（通过电文的变更推送）仅推送变更后的关联的提货单号及计划执行日期、计划结束时刻字段(可以修改)。增加提单日期调整的按钮(列表),校验,单据状态:已审核,未生产出库单(已装车:否),不允许比之前的日期时间早, 允许点击1:没有下推到出库单,(MMS下发完成:否),就可以下推,操作为I2如果下推了, (MMS下发完成:是),那就是先传d再传iu是回退,I是完结