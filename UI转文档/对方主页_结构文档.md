# 🌳 对方主页 结构指导文档

> **页面名称：** 对方主页
> **所属模块：** Profile（个人页模块）
> **页面类型：** 详情页（聚合型）

---

## 📋 STEP 1: 页面数据模型

### 设计理念

```
页面功能：展示其他用户的个人信息、动态内容、服务技能
数据来源：用户信息 + 动态列表 + 技能列表 + 关系状态
核心交互：关注/取消关注、私信、解锁微信、查看动态详情、预约技能
```

### PageModel

```json
{
  "模型信息": {
    "页面名称": "对方主页",
    "页面标识": "OtherUserProfile",
    "所属模块": "Profile",
    "页面类型": "详情页（聚合型）"
  },

  "数据依赖图": "{UserHeaderData} + {TabData} + {ContentData} → 渲染页面 → 用户操作 → {ActionResult}",

  "PageModel": {
    "_说明": "页面级数据模型 [L1]，组合所有区域数据",

    "UserHeaderData": {
      "_说明": "用户头部区域数据 → [→ProfileHeaderArea]",
      "userId": "String - 用户ID - [用于:接口请求、跳转]",
      "coverUrl": "String - 封面背景图URL - [UI:ProfileHeaderArea.背景图]",
      "nickname": "String - 昵称 - [UI:ProfileHeaderArea.昵称] [样式:20sp,白色,粗体]",
      "level": "Number - 等级 - [UI:ProfileHeaderArea.等级标签] [格式:♀18]",
      "isVerified": "Boolean - 是否实名认证 - [UI:ProfileHeaderArea.实名认证标签] [条件:true时显示]",
      "isExpert": "Boolean - 是否大神 - [UI:ProfileHeaderArea.大神标签] [条件:true时显示]",
      "isAvailable": "Boolean - 是否可预约 - [UI:ProfileHeaderArea.可预约标签] [条件:true时显示紫色文字]",
      "distance": "String - 距离 - [UI:ProfileHeaderArea.距离] [格式:X.Xkm]",
      "followerCount": "Number - 粉丝数 - [UI:ProfileHeaderArea.粉丝数] [格式:>=10000显示X.Xw]",
      "isFollowed": "Boolean - 是否已关注 - [状态:关注按钮] [true='已关注'灰色,false='关注'紫色]"
    },

    "TabData": {
      "_说明": "Tab区域数据 → [→TabNavArea]",
      "tabs": "Array<TabItem> - Tab列表 - [UI:TabNavArea]",
      "currentTab": "String(moments|profile|skills) - 当前选中Tab - [状态:控制内容区显示]"
    },

    "MomentsListData": {
      "_说明": "动态列表数据 → [→MomentsContentArea] [条件:currentTab=moments]",
      "list": "Array<MomentItem> - 动态列表 - [UI:MomentsContentArea]",
      "hasMore": "Boolean - 是否有更多 - [控制:加载更多/到底提示]",
      "total": "Number? - 总数 - [可选]"
    },

    "ProfileInfoData": {
      "_说明": "个人资料数据 → [→ProfileContentArea] [条件:currentTab=profile]",
      "residence": "String - 常居地 - [UI:ProfileContentArea.常居地]",
      "ipLocation": "String - IP属地 - [UI:ProfileContentArea.IP]",
      "height": "String - 身高 - [UI:ProfileContentArea.身高] [格式:Xcm]",
      "userId": "String - 用户ID - [UI:ProfileContentArea.ID]",
      "weight": "String - 体重 - [UI:ProfileContentArea.体重] [格式:Xkg]",
      "occupation": "String - 职业 - [UI:ProfileContentArea.职业]",
      "wechat": "String - 微信号 - [UI:ProfileContentArea.微信] [格式:脱敏显示******]",
      "birthday": "String - 生日 - [UI:ProfileContentArea.生日] [格式:MM-DD]"
    },

    "SkillsListData": {
      "_说明": "技能列表数据 → [→SkillsContentArea] [条件:currentTab=skills]",
      "list": "Array<SkillItem> - 技能列表 - [UI:SkillsContentArea]",
      "hasMore": "Boolean - 是否有更多 - [控制:加载更多/到底提示]"
    },

    "ActionBarData": {
      "_说明": "底部操作栏数据 → [→ActionBarArea]",
      "canMessage": "Boolean - 是否可私信 - [控制:私信按钮状态]",
      "canUnlockWechat": "Boolean - 是否可解锁微信 - [控制:解锁微信按钮状态]",
      "unlockPrice": "Number? - 解锁价格 - [UI:解锁按钮文案] [可选]"
    },

    "PageState": {
      "_说明": "页面状态数据",
      "isLoading": "Boolean - 加载中 - [状态:骨架屏/Loading]",
      "isRefreshing": "Boolean - 刷新中 - [状态:下拉刷新指示器]",
      "isError": "Boolean - 加载失败 - [状态:错误提示]",
      "errorMessage": "String? - 错误信息 - [UI:错误提示文案]"
    }
  }
}
```

### ItemModel

```json
{
  "ItemModel": {
    "_说明": "列表项数据模型 [L3]",

    "TabItem": {
      "_说明": "Tab项数据",
      "key": "String(moments|profile|skills) - Tab标识 - [用于:切换判断]",
      "label": "String - Tab文案 - [UI:TabNavArea.Tab文字]",
      "isActive": "Boolean - 是否选中 - [状态:选中下划线+加粗]"
    },

    "MomentItem": {
      "_说明": "动态卡片数据 → [→MomentCard]",

      "id": "String - 动态ID - [用于:跳转详情、操作参数]",
      "type": "String(image|video) - 类型 - [条件:video时显示播放图标]",

      "mediaData": {
        "_说明": "媒体区域 → [→MomentCard.媒体区]",
        "coverUrl": "String - 封面URL - [UI:MomentCard.封面图]",
        "aspectRatio": "Number - 宽高比 - [计算:高度=宽度/ratio]",
        "duration": "Number? - 时长(秒) - [UI:MomentCard.时长标签] [条件:type=video]"
      },

      "textData": {
        "_说明": "文本区域 → [→MomentCard.文本区]",
        "title": "String - 标题 - [UI:MomentCard.标题] [样式:14sp,#333,最多2行省略]"
      },

      "authorData": {
        "_说明": "作者信息 → [→MomentCard.作者区]",
        "userId": "String - 用户ID - [用于:跳转用户主页]",
        "avatar": "String - 头像URL - [UI:MomentCard.头像] [样式:24x24圆形]",
        "nickname": "String - 昵称 - [UI:MomentCard.昵称]"
      },

      "statsData": {
        "_说明": "统计数据 → [→MomentCard.统计区]",
        "likeCount": "Number - 点赞数 - [UI:MomentCard.点赞] [格式:>=10000显示1.2w]",
        "isLiked": "Boolean - 是否已赞 - [状态:点赞图标] [true=红心,false=空心]"
      }
    },

    "SkillItem": {
      "_说明": "技能卡片数据 → [→SkillCard]",

      "id": "String - 技能ID - [用于:跳转详情、预约]",

      "mediaData": {
        "_说明": "缩略图区域 → [→SkillCard.缩略图区]",
        "thumbnailUrl": "String - 缩略图URL - [UI:SkillCard.缩略图] [样式:120x120圆角]"
      },

      "providerData": {
        "_说明": "服务者信息 → [→SkillCard.服务者区]",
        "nickname": "String - 昵称 - [UI:SkillCard.昵称] [样式:16sp,#333,粗体]",
        "level": "Number - 等级 - [UI:SkillCard.等级标签]",
        "isVerified": "Boolean - 是否实名认证 - [UI:SkillCard.实名认证标签]",
        "isExpert": "Boolean - 是否大神 - [UI:SkillCard.大神标签]",
        "distance": "String - 距离 - [UI:SkillCard.距离] [格式:X.Xkm]"
      },

      "skillInfo": {
        "_说明": "技能详情 → [→SkillCard.技能区]",
        "description": "String - 技能描述 - [UI:SkillCard.描述] [样式:14sp,#666,最多2行省略]",
        "tags": "Array<String> - 标签列表 - [UI:SkillCard.标签] [样式:紫色文字]",
        "gameName": "String? - 游戏名称 - [UI:SkillCard.游戏标签] [可选]",
        "gameRank": "String? - 游戏段位 - [UI:SkillCard.段位标签] [可选]"
      },

      "priceData": {
        "_说明": "价格信息 → [→SkillCard.价格区]",
        "price": "Number - 价格 - [UI:SkillCard.价格] [样式:紫色,粗体]",
        "unit": "String(金币/局|金币/小时) - 计价单位 - [UI:SkillCard.单位]"
      }
    }
  }
}
```

### SharedModel

```json
{
  "SharedModel": {
    "_说明": "跨页面复用的数据模型 [L4]",

    "UserBadges": {
      "_说明": "用户徽章组合",
      "level": "Number - 等级",
      "isVerified": "Boolean - 实名认证",
      "isExpert": "Boolean - 大神认证"
    },

    "PaginationInfo": {
      "_说明": "分页信息",
      "page": "Number - 当前页码",
      "pageSize": "Number - 每页数量",
      "hasMore": "Boolean - 是否有更多",
      "total": "Number? - 总数"
    },

    "ActionResult": {
      "_说明": "操作结果",
      "success": "Boolean - 是否成功",
      "message": "String? - 提示信息",
      "newValue": "Any? - 新值"
    }
  }
}
```

### 数据模型汇总表

| 模型名 | 层级 | 对应组件 | 说明 |
|--------|------|----------|------|
| PageModel.UserHeaderData | L1 | ProfileHeaderArea | 用户头部信息 |
| PageModel.TabData | L1 | TabNavArea | Tab导航数据 |
| PageModel.MomentsListData | L1 | MomentsContentArea | 动态列表 |
| PageModel.ProfileInfoData | L1 | ProfileContentArea | 个人资料 |
| PageModel.SkillsListData | L1 | SkillsContentArea | 技能列表 |
| PageModel.ActionBarData | L1 | ActionBarArea | 底部操作栏 |
| ItemModel.TabItem | L3 | TabItem | Tab项 |
| ItemModel.MomentItem | L3 | MomentCard | 动态卡片 |
| ItemModel.SkillItem | L3 | SkillCard | 技能卡片 |
| SharedModel.ActionResult | L4 | - | 操作结果 |

---

## 🔄 STEP 2: 流程图

### 页面初始化流程

```
开始
 ↓
【进入对方主页】
 ├─→ 路由跳转: /profile/other/{userId}
 ├─→ 点击用户头像/昵称: 从任意页面跳转
 └─→ 深链接: xypai://profile/{userId}
 ↓
【页面初始化】
 │
 ├─→ 调用 [API:getUserProfile] → 获取用户基础信息
 │    └─→ 渲染 [→ProfileHeaderArea] 头部信息
 │
 ├─→ 调用 [API:getMomentsList] (page=1) → 获取动态首屏数据
 │    └─→ 渲染 [→MomentsContentArea] 动态瀑布流
 │
 └─→ 初始化监听
      ├─→ 滚动监听 → [触发:ContentArea]
      ├─→ Tab切换监听 → [触发:TabNavArea]
      └─→ 下拉刷新监听 → [触发:ProfileHeaderArea]
 ↓
用户操作
```

### 用户交互路径

```
用户操作
 │
 ├─→ 【ProfileHeaderArea 头部交互】
 │    │
 │    ├─→ 点击返回按钮 [触发:ProfileHeaderArea.BackButton]
 │    │    └─→ 路由返回上一页
 │    │
 │    └─→ 点击关注/已关注按钮 [触发:ProfileHeaderArea.FollowButton]
 │         ├─→ 乐观更新 [状态:FollowButton]
 │         ├─→ 调用 [API:followUser] (isFollowed ? unfollow : follow)
 │         ├─→ 成功 → 保持状态 + 更新粉丝数
 │         └─→ 失败 → 回滚 [状态:FollowButton] + Toast
 │
 ├─→ 【TabNavArea Tab切换】
 │    └─→ 点击TabItem [触发:TabNavArea]
 │         ├─→ 更新选中态 [状态:TabNavArea]
 │         ├─→ tab=moments → 显示 [→MomentsContentArea]
 │         │    └─→ [如果首次] 调用 [API:getMomentsList] (page=1)
 │         ├─→ tab=profile → 显示 [→ProfileContentArea]
 │         │    └─→ [如果首次] 调用 [API:getProfileInfo]
 │         └─→ tab=skills → 显示 [→SkillsContentArea]
 │              └─→ [如果首次] 调用 [API:getSkillsList] (page=1)
 │
 ├─→ 【MomentsContentArea 动态列表交互】[条件:currentTab=moments]
 │    │
 │    ├─→ 下拉刷新 [触发:MomentsContentArea]
 │    │    ├─→ 调用 [API:getMomentsList] (page=1)
 │    │    └─→ 清空重置 [状态:MomentsContentArea]
 │    │
 │    ├─→ 上拉加载 [触发:MomentsContentArea]
 │    │    ├─→ 调用 [API:getMomentsList] (page+1)
 │    │    └─→ 追加数据 [状态:MomentsContentArea]
 │    │
 │    ├─→ 点击MomentCard [触发:MomentCard]
 │    │    └─→ 跳转 → 【动态详情页】(携带 momentId)
 │    │
 │    └─→ 点击点赞图标 [触发:MomentCard.LikeButton]
 │         ├─→ 乐观更新 [状态:MomentCard]
 │         ├─→ 调用 [API:likeMoment]
 │         ├─→ 成功 → 保持状态
 │         └─→ 失败 → 回滚 [状态:MomentCard] + Toast
 │
 ├─→ 【SkillsContentArea 技能列表交互】[条件:currentTab=skills]
 │    │
 │    ├─→ 上拉加载 [触发:SkillsContentArea]
 │    │    ├─→ 调用 [API:getSkillsList] (page+1)
 │    │    └─→ 追加数据 [状态:SkillsContentArea]
 │    │
 │    └─→ 点击SkillCard [触发:SkillCard]
 │         └─→ 跳转 → 【技能详情/预约页】(携带 skillId)
 │
 └─→ 【ActionBarArea 底部操作】
      │
      ├─→ 点击私信按钮 [触发:ActionBarArea.MessageButton]
      │    └─→ 跳转 → 【聊天页】(携带 userId)
      │
      └─→ 点击解锁微信按钮 [触发:ActionBarArea.UnlockButton]
           ├─→ 弹出确认弹窗 → 确认支付
           ├─→ 调用 [API:unlockWechat]
           ├─→ 成功 → 显示微信号 + Toast
           └─→ 失败 → Toast错误信息
 ↓
【状态管理】
 ├─→ isLoading && 首次加载 → 显示骨架屏
 ├─→ isLoading && 加载更多 → 显示底部Loading
 ├─→ isError → 显示错误提示 → 点击重试
 ├─→ list.length=0 → 显示空状态插画
 └─→ hasMore=false → 显示"没有更多了"
 ↓
结束
```

### 流程-组件关联表

| 流程节点 | 触发组件 | 调用接口 | 影响组件 | 状态变化 |
|----------|----------|----------|----------|----------|
| 页面初始化 | - | getUserProfile, getMomentsList | ProfileHeaderArea, MomentsContentArea | loading→loaded |
| 点击返回 | ProfileHeaderArea | - | - | 路由返回 |
| 点击关注 | ProfileHeaderArea | followUser | ProfileHeaderArea | isFollowed切换 |
| Tab切换-动态 | TabNavArea | getMomentsList | MomentsContentArea | 显示动态列表 |
| Tab切换-资料 | TabNavArea | getProfileInfo | ProfileContentArea | 显示个人资料 |
| Tab切换-技能 | TabNavArea | getSkillsList | SkillsContentArea | 显示技能列表 |
| 下拉刷新 | ContentArea | getXXXList(page=1) | ContentArea | 数据重置 |
| 上拉加载 | ContentArea | getXXXList(page+1) | ContentArea | 数据追加 |
| 点击动态卡片 | MomentCard | - | - | 跳转详情页 |
| 点击点赞 | MomentCard | likeMoment | MomentCard | isLiked切换 |
| 点击技能卡片 | SkillCard | - | - | 跳转预约页 |
| 点击私信 | ActionBarArea | - | - | 跳转聊天页 |
| 点击解锁微信 | ActionBarArea | unlockWechat | ProfileContentArea | 显示微信号 |

---

## 🌳 STEP 3: 树状图

```
【Profile模块】★★★
│
├── 【对方主页 OtherUserProfile】📱 [L1] [拆分:5个L2]
│   │   文件: OtherUserProfile/index.tsx
│   │
│   ├── 📍 ProfileHeaderArea [L2] [固定顶部+可折叠]
│   │   │   文件: ProfileHeaderArea/
│   │   │   布局: 相对定位，背景图 + 叠层信息
│   │   │
│   │   ├── 🔙 BackButton [L3] [位置:TL]
│   │   │   └── 返回图标 [data:无] [点击→路由返回]
│   │   │
│   │   ├── 🖼️ CoverImage [L3] [位置:全屏背景]
│   │   │   └── 封面背景图 [data:UserHeaderData.coverUrl]
│   │   │
│   │   ├── 👤 UserInfoOverlay [L3] [位置:BL，叠层]
│   │   │   │   文件: UserInfoOverlay.tsx
│   │   │   │
│   │   │   ├── 昵称 [data:UserHeaderData.nickname]
│   │   │   │   └── [样式:20sp,白色,粗体]
│   │   │   │
│   │   │   ├── 等级标签 [data:UserHeaderData.level]
│   │   │   │   └── [格式:♀{level}] [样式:粉色背景,白色文字]
│   │   │   │
│   │   │   ├── 《BadgeList》[L4] [1模板x2实例]
│   │   │   │   ├── 实名认证标签 [data:UserHeaderData.isVerified] [条件:true显示]
│   │   │   │   └── 大神标签 [data:UserHeaderData.isExpert] [条件:true显示]
│   │   │   │
│   │   │   ├── 状态行 [flex-row]
│   │   │   │   ├── 可预约 [data:UserHeaderData.isAvailable] [条件:true显示] [样式:紫色]
│   │   │   │   ├── 距离 [data:UserHeaderData.distance] [格式:X.Xkm]
│   │   │   │   └── 粉丝数 [data:UserHeaderData.followerCount] [格式:X 粉丝]
│   │   │   │
│   │   │   └── 「关注按钮」[data:UserHeaderData.isFollowed]
│   │   │       └── [状态:true='已关注'灰色, false='关注'紫色边框]
│   │   │
│   │   └── 文件结构:
│   │       ├── index.tsx
│   │       ├── UserInfoOverlay.tsx
│   │       └── types.ts
│   │
│   ├── 🏷️ TabNavArea [L2] [粘性定位]
│   │   │   文件: TabNavArea.tsx
│   │   │   布局: flex-row, center, gap-32px
│   │   │
│   │   └── 《TabItem》[L3] [1模板x3实例] [data:TabData.tabs]
│   │       ├── Tab文字 [data:TabItem.label]
│   │       └── 选中指示器 [data:TabItem.isActive] [条件:true显示下划线]
│   │
│   ├── 🏷️ ContentArea [L2] [flex:1, 可滚动] [条件渲染]
│   │   │   文件: 根据Tab切换显示不同内容
│   │   │
│   │   ├── 📋 MomentsContentArea [L3] [条件:currentTab=moments]
│   │   │   │   文件: MomentsContentArea/
│   │   │   │   布局: grid-cols-2, gap-8px, 瀑布流
│   │   │   │
│   │   │   └── 《MomentCard》[L4] [1模板xN实例] [data:MomentsListData.list]
│   │   │       │   文件: MomentCard/
│   │   │       │
│   │   │       ├── 媒体区 [相对定位]
│   │   │       │   ├── 封面图 [data:MomentItem.mediaData.coverUrl]
│   │   │       │   └── 播放图标 [条件:type=video] [位置:TR]
│   │   │       │
│   │   │       ├── 标题 [data:MomentItem.textData.title]
│   │   │       │   └── [样式:14sp,#333,最多2行省略]
│   │   │       │
│   │   │       └── 底部信息行 [flex-row, space-between]
│   │   │           ├── 作者区 [flex-row]
│   │   │           │   ├── 头像 [data:MomentItem.authorData.avatar] [24x24圆形]
│   │   │           │   └── 昵称 [data:MomentItem.authorData.nickname]
│   │   │           └── 点赞区 [flex-row]
│   │   │               ├── 爱心图标 [data:MomentItem.statsData.isLiked]
│   │   │               └── 点赞数 [data:MomentItem.statsData.likeCount]
│   │   │
│   │   ├── 📋 ProfileContentArea [L3] [条件:currentTab=profile]
│   │   │   │   文件: ProfileContentArea.tsx
│   │   │   │   布局: grid-cols-2, gap-y-16px
│   │   │   │
│   │   │   ├── 区块标题 "个人资料"
│   │   │   │
│   │   │   └── 《ProfileInfoRow》[L4] [1模板x8实例]
│   │   │       ├── 常居地 [data:ProfileInfoData.residence]
│   │   │       ├── IP [data:ProfileInfoData.ipLocation]
│   │   │       ├── 身高 [data:ProfileInfoData.height]
│   │   │       ├── ID [data:ProfileInfoData.userId]
│   │   │       ├── 体重 [data:ProfileInfoData.weight]
│   │   │       ├── 职业 [data:ProfileInfoData.occupation]
│   │   │       ├── 微信 [data:ProfileInfoData.wechat] [格式:脱敏******]
│   │   │       └── 生日 [data:ProfileInfoData.birthday]
│   │   │
│   │   └── 📋 SkillsContentArea [L3] [条件:currentTab=skills]
│   │       │   文件: SkillsContentArea/
│   │       │   布局: flex-col, gap-16px
│   │       │
│   │       └── 《SkillCard》[L4] [1模板xN实例] [data:SkillsListData.list]
│   │           │   文件: SkillCard/
│   │           │
│   │           ├── 缩略图 [data:SkillItem.mediaData.thumbnailUrl]
│   │           │   └── [样式:120x120,圆角8px]
│   │           │
│   │           └── 详情区 [flex-col, flex:1]
│   │               ├── 头部行 [flex-row, space-between]
│   │               │   ├── 昵称+标签 [flex-row]
│   │               │   │   ├── 昵称 [data:SkillItem.providerData.nickname]
│   │               │   │   ├── 等级 [data:SkillItem.providerData.level]
│   │               │   │   └── 徽章组 [BadgeList]
│   │               │   └── 距离 [data:SkillItem.providerData.distance]
│   │               │
│   │               ├── 描述 [data:SkillItem.skillInfo.description]
│   │               │   └── [样式:14sp,#666,最多2行省略]
│   │               │
│   │               └── 底部行 [flex-row, space-between]
│   │                   ├── 标签组 [data:SkillItem.skillInfo.tags]
│   │                   │   └── [样式:紫色文字]
│   │                   └── 价格 [data:SkillItem.priceData]
│   │                       └── [格式:{price} {unit}] [样式:紫色粗体]
│   │
│   └── 📍 ActionBarArea [L2] [固定底部] [条件:currentTab=moments]
│       │   文件: ActionBarArea.tsx
│       │   布局: flex-row, 均分
│       │
│       ├── 「私信」按钮 [data:ActionBarData.canMessage]
│       │   └── [样式:紫色渐变背景,白色文字,图标+文字]
│       │
│       └── 「解锁微信」按钮 [data:ActionBarData.canUnlockWechat]
│           └── [样式:紫色渐变背景,白色文字,锁图标+文字]
│
└── 🔧 服务层（对应 STEP 6 的接口）
    ├── 📡 GET /api/profile/{userId}          → 用户信息 [→ PageModel.UserHeaderData]
    ├── 📡 GET /api/profile/{userId}/info     → 个人资料 [→ PageModel.ProfileInfoData]
    ├── 📡 GET /api/profile/{userId}/moments  → 动态列表 [→ PageModel.MomentsListData]
    ├── 📡 GET /api/profile/{userId}/skills   → 技能列表 [→ PageModel.SkillsListData]
    ├── 📡 POST /api/user/follow              → 关注操作 [→ SharedModel.ActionResult]
    ├── 📡 POST /api/moment/like              → 点赞操作 [→ SharedModel.ActionResult]
    └── 📡 POST /api/user/unlock-wechat       → 解锁微信 [→ SharedModel.ActionResult]
```

### 列表控制（通用）

```
🔄 ListControl [适用于 MomentsContentArea / SkillsContentArea]
├── 加载更多: 上滑 [距底100px] → 调用列表接口(page+1)
├── 下拉刷新: [阈值60px] → 调用列表接口(page=1)
├── 骨架屏: [条件:isLoading且page=1] 显示占位
├── 加载指示: [条件:isLoading且page>1] 显示底部loading
├── 空状态: [条件:list.length=0] 显示空状态插画
└── 到底提示: [条件:hasMore=false] "没有更多了~"
```

### 组件拆分规则

```
三层架构：
├── L1-页面: OtherUserProfile → 拆分 5 个 L2
├── L2-区域: ProfileHeaderArea/TabNavArea/ContentArea/ActionBarArea
└── L3-基础: MomentCard/SkillCard/ProfileInfoRow/TabItem

拆分统计：
├── L2区域组件: 5个
├── L3基础组件: 6个
└── 总计: 11个组件
```

---

## 📍 STEP 4: 布局定位

### 页面整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│  📱 OtherUserProfile [L1]                                        │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                          │   │
│  │               ProfileHeaderArea [L2]                     │   │ 高度: ~50%屏幕
│  │               (背景图 + 叠层用户信息)                      │   │ 可折叠
│  │  ┌────┐                                                  │   │
│  │  │ ← │                                    [相对定位]      │   │
│  │  └────┘                                                  │   │
│  │                                                          │   │
│  │  ┌──────────────────────────────────────────────────┐   │   │
│  │  │  昵称12345  ♀18                        「关注」    │   │   │
│  │  │  ✓实名认证  🏆大神                                 │   │   │
│  │  │  可预约  📍4.6km  102 粉丝                         │   │   │
│  │  └──────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │       动态        资料        技能                       │   │ 高度: 44px
│  │       ━━━                                                │   │ 粘性定位
│  │                  TabNavArea [L2]                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                          │   │
│  │                   ContentArea [L2]                       │   │ flex: 1
│  │              (根据Tab切换显示不同内容)                     │   │ 可滚动
│  │                                                          │   │
│  │                                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  ┌──────────────────┐  ┌──────────────────┐            │   │ 高度: 56px
│  │  │   ✉️  私信        │  │   🔓  解锁微信   │            │   │ + 安全区
│  │  └──────────────────┘  └──────────────────┘            │   │ 固定底部
│  │                    ActionBarArea [L2]                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
布局: flex-col | 整体可滚动（联动折叠头部）
```

### ProfileHeaderArea 布局

```
┌─────────────────────────────────────────────────────────────────┐
│  ProfileHeaderArea [L2]                                          │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                          │   │
│  │                    CoverImage [L3]                       │   │
│  │                    (全屏背景图)                           │   │ 绝对定位
│  │                                                          │   │ 高度: 50%
│  │  ┌────┐                                                  │   │
│  │  │ ← │  [TL, 安全区+12px]                                │   │
│  │  └────┘                                                  │   │
│  │                                                          │   │
│  │                                                          │   │
│  │  ┌──────────────────────────────────────────────────┐   │   │
│  │  │  UserInfoOverlay [L3]                             │   │   │
│  │  │  ┌──────────────────────────────────────────┐    │   │   │
│  │  │  │  昵称12345  [♀18]                        │    │   │   │ 绝对定位
│  │  │  │  [R1]                                    │    │   │   │ bottom: 0
│  │  │  └──────────────────────────────────────────┘    │   │   │
│  │  │  ┌────────────┐ ┌────────────┐   ┌─────────┐    │   │   │
│  │  │  │ ✓实名认证  │ │ 🏆大神     │   │ 关注    │    │   │   │
│  │  │  └────────────┘ └────────────┘   └─────────┘    │   │   │
│  │  │  [R2-C1]        [R2-C2]          [R2-C-Last]    │   │   │
│  │  │  ┌────────────────────────────────────────┐    │   │   │
│  │  │  │  可预约   📍4.6km   102 粉丝            │    │   │   │
│  │  │  │  [R3] flex-row, gap-12px                │    │   │   │
│  │  │  └────────────────────────────────────────┘    │   │   │
│  │  └──────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
布局: relative | 背景图absolute铺满 | UserInfoOverlay绝对定位底部
```

### MomentsContentArea 布局（动态Tab）

```
┌─────────────────────────────────────────────────────────────────┐
│  MomentsContentArea [L3]                                         │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────┐  ┌──────────────────────┐            │
│  │  ┌────────────────┐  │  │  ┌────────────────┐  │            │
│  │  │                │  │  │  │                │  │            │
│  │  │    封面图       │  │  │  │    封面图       │  │            │
│  │  │    (瀑布流)     │  │  │  │                │  │            │
│  │  │           [▶️] │  │  │  │                │  │            │
│  │  └────────────────┘  │  │  └────────────────┘  │            │
│  │  请你们看雪          │  │  请你们看雪          │            │
│  │  ┌────┐            │  │  ┌────┐            │            │
│  │  │ 👤 │ 用户名  ❤️88│  │  │ 👤 │ 用户名  ❤️88│            │
│  │  └────┘            │  │  └────┘            │            │
│  │      MomentCard     │  │      MomentCard     │            │
│  └──────────────────────┘  └──────────────────────┘            │
│  ┌──────────────────────┐  ┌──────────────────────┐            │
│  │                      │  │                      │            │
│  │       ... x N        │  │       ... x N        │            │
│  │                      │  │                      │            │
│  └──────────────────────┘  └──────────────────────┘            │
└─────────────────────────────────────────────────────────────────┘
布局: grid-cols-2, gap-8px | MasonryList瀑布流 | 滚动: scroll-y
```

### MomentCard 布局

```
┌─────────────────────────────────────────┐
│  MomentCard [L4]                         │
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐   │
│  │                                  │   │ 媒体区
│  │            封面图                │   │ 宽度: 100%
│  │         (动态高度)               │   │ 高度: 按比例
│  │                        ┌────┐   │   │
│  │                        │ ▶️ │   │   │ 播放图标 [TR]
│  │                        └────┘   │   │ [条件:type=video]
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │  请你们看雪                      │   │ 标题区
│  │  [最多2行省略]                   │   │ padding: 8px
│  └─────────────────────────────────┘   │
│  ┌─────────────────────────────────┐   │
│  │  ┌────┐                         │   │ 底部信息行
│  │  │ 👤 │ 用户名称      ❤️ 88     │   │ flex-row
│  │  └────┘                         │   │ space-between
│  │  [ML]                    [MR]   │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
布局: flex-col | 圆角: 8px | 背景: white | 阴影: 轻微
```

### ProfileContentArea 布局（资料Tab）

```
┌─────────────────────────────────────────────────────────────────┐
│  ProfileContentArea [L3]                                         │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  个人资料                                                 │   │ 标题
│  └─────────────────────────────────────────────────────────┘   │ 16sp粗体
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────────┐      ┌─────────────────┐          │   │
│  │  │ 常居地  广东 深圳│      │ IP     广东 深圳│          │   │ R1
│  │  └─────────────────┘      └─────────────────┘          │   │
│  │  ┌─────────────────┐      ┌─────────────────┐          │   │
│  │  │ 身高    162cm   │      │ ID     21566842 │          │   │ R2
│  │  └─────────────────┘      └─────────────────┘          │   │
│  │  ┌─────────────────┐      ┌─────────────────┐          │   │
│  │  │ 体重    44kg    │      │ 职业   模特     │          │   │ R3
│  │  └─────────────────┘      └─────────────────┘          │   │
│  │  ┌─────────────────┐      ┌─────────────────┐          │   │
│  │  │ 微信    ******  │      │ 生日   09-29    │          │   │ R4
│  │  └─────────────────┘      └─────────────────┘          │   │
│  │          [C1]                    [C2]                   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
布局: grid-cols-2, gap-x-16px, gap-y-12px | padding: 16px
```

### SkillsContentArea 布局（技能Tab）

```
┌─────────────────────────────────────────────────────────────────┐
│  SkillsContentArea [L3]                                          │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  ┌────────────┐  ┌──────────────────────────────────┐  │   │
│  │  │            │  │  昵称123  ♀19  ✓  🏆      3.2km  │  │   │
│  │  │   缩略图    │  │  [R1] flex-row, space-between    │  │   │
│  │  │  120x120   │  │  ──────────────────────────────  │  │   │
│  │  │            │  │  主打野其他位置都能补...          │  │   │
│  │  │            │  │  [R2] 描述，最多2行               │  │   │
│  │  │            │  │  ──────────────────────────────  │  │   │
│  │  │            │  │  微信区 荣耀王者 巅峰1800+        │  │   │
│  │  │            │  │  [R3-左] 标签                    │  │   │
│  │  │            │  │                        10 金币/局 │  │   │
│  │  │            │  │                        [R3-右]   │  │   │
│  │  └────────────┘  └──────────────────────────────────┘  │   │
│  │       [C1]                     [C2]                     │   │
│  │                    SkillCard [L4]                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                      SkillCard x N                       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
布局: flex-col, gap-12px | padding: 16px | 滚动: scroll-y
```

### ActionBarArea 布局

```
┌─────────────────────────────────────────────────────────────────┐
│  ActionBarArea [L2]                                              │
├─────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────┐  ┌───────────────────────────┐  │
│  │                           │  │                           │  │
│  │      ✉️   私信            │  │      🔓   解锁微信        │  │
│  │                           │  │                           │  │
│  │     MessageButton         │  │      UnlockButton         │  │
│  └───────────────────────────┘  └───────────────────────────┘  │
│           [flex:1]                      [flex:1]                │
│                                                                  │
│  布局: flex-row, gap-12px, padding-h-16px                        │
│  高度: 56px + 底部安全区                                          │
│  背景: 白色 + 顶部阴影                                            │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📁 STEP 5: 代码结构

```
src/modules/
│
├─ Profile/                                    # 个人页模块
│   │
│   ├─ api/                                    # 模块级API
│   │   ├─ apiGetUserProfile.ts                # 获取用户信息
│   │   ├─ apiGetProfileInfo.ts                # 获取个人资料
│   │   ├─ apiGetMomentsList.ts                # 获取动态列表
│   │   ├─ apiGetSkillsList.ts                 # 获取技能列表
│   │   ├─ apiFollowUser.ts                    # 关注/取消关注
│   │   ├─ apiLikeMoment.ts                    # 点赞动态
│   │   └─ apiUnlockWechat.ts                  # 解锁微信
│   │
│   ├─ stores/                                 # 模块级状态
│   │   └─ profileStore.ts                     # 用户资料状态管理
│   │
│   ├─ hooks/                                  # 模块级Hooks
│   │   ├─ useFollow.ts                        # 关注逻辑
│   │   └─ useLike.ts                          # 点赞逻辑
│   │
│   │   ┌─────────────────────────────────────────────────────────────┐
│   │   │  📱 页面 [L1] - OtherUserProfile/index.tsx                   │
│   │   ├─────────────────────────────────────────────────────────────┤
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  ProfileHeaderArea [L2]                              │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  TabNavArea [L2]                                     │   │ 粘性
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  ContentArea [L2] - 条件渲染                         │   │
│   │   │  │    ├── MomentsContentArea                            │   │ flex:1
│   │   │  │    ├── ProfileContentArea                            │   │ 可滚动
│   │   │  │    └── SkillsContentArea                             │   │
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  ActionBarArea [L2]                                  │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   └─────────────────────────────────────────────────────────────┘
│   │
│   ├─ OtherUserProfile/                       # 对方主页
│   │   │
│   │   ├─ index.tsx                           # 页面主文件 [L1]
│   │   ├─ types.ts                            # 类型定义
│   │   ├─ useOtherUserProfile.ts              # 页面状态管理Hook
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 复杂区域 [L2] - ProfileHeaderArea/                   │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌─────────────────────────────────────────────────┐   │
│   │   │   │  │          CoverImage (背景图)                     │   │
│   │   │   │  │  ┌────┐                                         │   │
│   │   │   │  │  │ ← │                                          │   │
│   │   │   │  │  └────┘                                         │   │
│   │   │   │  │  ┌─────────────────────────────────────────┐   │   │
│   │   │   │  │  │ 昵称  等级  徽章列表        「关注」     │   │   │
│   │   │   │  │  │ 状态  距离  粉丝数                      │   │   │
│   │   │   │  │  └─────────────────────────────────────────┘   │   │
│   │   │   │  └─────────────────────────────────────────────────┘   │
│   │   │   │  布局: relative | CoverImage absolute | 叠层bottom      │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ ProfileHeaderArea/                  # 🔵 复杂区域
│   │   │   ├─ index.tsx                       # 区域主文件
│   │   │   ├─ types.ts                        # 类型定义
│   │   │   ├─ UserInfoOverlay.tsx             # 用户信息叠层组件
│   │   │   └─ useProfileHeader.ts             # 区域状态Hook
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - TabNavArea.tsx                       │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │     ┌──────┐  ┌──────┐  ┌──────┐                       │
│   │   │   │     │ 动态 │  │ 资料 │  │ 技能 │                       │
│   │   │   │     │ ━━━  │  │      │  │      │                       │
│   │   │   │     └──────┘  └──────┘  └──────┘                       │
│   │   │   │  布局: flex-row, center, gap-32px | 高度: 44px          │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ TabNavArea.tsx                      # 🟢 简单区域
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 复杂区域 [L3] - MomentsContentArea/                  │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌──────────────┐  ┌──────────────┐                    │
│   │   │   │  │  ┌────────┐  │  │  ┌────────┐  │                    │
│   │   │   │  │  │  封面   │  │  │  │  封面   │  │                    │
│   │   │   │  │  └────────┘  │  │  └────────┘  │                    │
│   │   │   │  │  {标题}      │  │  {标题}      │  ... x N           │
│   │   │   │  │  👤 昵称 ❤️  │  │  👤 昵称 ❤️  │                    │
│   │   │   │  └──────────────┘  └──────────────┘                    │
│   │   │   │  布局: grid-cols-2, gap-8px | 瀑布流 | scroll-y         │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ MomentsContentArea/                 # 🔵 复杂区域
│   │   │   ├─ index.tsx                       # 区域主文件
│   │   │   ├─ types.ts                        # 类型定义
│   │   │   ├─ useMomentsContent.ts            # 列表状态Hook
│   │   │   │
│   │   │   │   ┌─────────────────────────────────────────────────────┐
│   │   │   │   │  🧩 子组件 [L4] - MomentCard/                        │
│   │   │   │   ├─────────────────────────────────────────────────────┤
│   │   │   │   │  ┌─────────────────────────────────────────────┐   │
│   │   │   │   │  │  ┌─────────────────────────────────────┐   │   │
│   │   │   │   │  │  │           封面图                     │   │   │
│   │   │   │   │  │  │                            [▶️]     │   │   │
│   │   │   │   │  │  └─────────────────────────────────────┘   │   │
│   │   │   │   │  │  ┌─────────────────────────────────────┐   │   │
│   │   │   │   │  │  │           标题文字                   │   │   │
│   │   │   │   │  │  └─────────────────────────────────────┘   │   │
│   │   │   │   │  │  ┌─────────────────────────────────────┐   │   │
│   │   │   │   │  │  │  👤 昵称              ❤️ 88        │   │   │
│   │   │   │   │  │  └─────────────────────────────────────┘   │   │
│   │   │   │   │  └─────────────────────────────────────────────┘   │
│   │   │   │   │  布局: flex-col | 圆角: 8px | 1模板 x N实例         │
│   │   │   │   └─────────────────────────────────────────────────────┘
│   │   │   │
│   │   │   └─ MomentCard/                     # 子组件
│   │   │       ├─ index.tsx
│   │   │       └─ types.ts
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L3] - ProfileContentArea.tsx               │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  个人资料                                                │
│   │   │   │  ┌─────────────┐  ┌─────────────┐                      │
│   │   │   │  │ 常居地  值  │  │ IP      值  │                      │
│   │   │   │  │ 身高    值  │  │ ID      值  │                      │
│   │   │   │  │ 体重    值  │  │ 职业    值  │                      │
│   │   │   │  │ 微信    值  │  │ 生日    值  │                      │
│   │   │   │  └─────────────┘  └─────────────┘                      │
│   │   │   │  布局: grid-cols-2, gap-y-12px | padding: 16px          │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ ProfileContentArea.tsx              # 🟢 简单区域
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 复杂区域 [L3] - SkillsContentArea/                   │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌─────────────────────────────────────────────────┐   │
│   │   │   │  │  ┌────────┐  ┌────────────────────────────┐    │   │
│   │   │   │  │  │  缩略图 │  │ 昵称 标签         距离     │    │   │
│   │   │   │  │  │        │  │ 描述文字                   │    │   │
│   │   │   │  │  │        │  │ 标签列表          价格     │    │   │
│   │   │   │  │  └────────┘  └────────────────────────────┘    │   │
│   │   │   │  └─────────────────────────────────────────────────┘   │
│   │   │   │  布局: flex-col, gap-12px | 滚动: scroll-y              │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ SkillsContentArea/                  # 🔵 复杂区域
│   │   │   ├─ index.tsx
│   │   │   ├─ types.ts
│   │   │   ├─ useSkillsContent.ts
│   │   │   │
│   │   │   └─ SkillCard/                      # 子组件
│   │   │       ├─ index.tsx
│   │   │       └─ types.ts
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - ActionBarArea.tsx                    │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌─────────────────┐  ┌─────────────────┐              │
│   │   │   │  │   ✉️  私信      │  │   🔓  解锁微信  │              │
│   │   │   │  └─────────────────┘  └─────────────────┘              │
│   │   │   │  布局: flex-row, gap-12px | 高度: 56px + 安全区         │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   └─ ActionBarArea.tsx                   # 🟢 简单区域
│   │
│   ├─ SharedComponents/                       # 模块共享组件 [L4]
│   │   │
│   │   ├─ BadgeList/                          # 徽章列表组件
│   │   │   ├─ index.tsx
│   │   │   └─ types.ts
│   │   │
│   │   └─ ProfileInfoRow/                     # 资料行组件
│   │       ├─ index.tsx
│   │       └─ types.ts
│   │
│   └─ index.ts                                # 模块入口
│
└─ Common/                                     # 公共模块
    ├─ components/
    │   ├─ WaterfallList/                      # 瀑布流组件
    │   ├─ TabNav/                             # Tab导航组件
    │   └─ ActionButton/                       # 操作按钮组件
    └─ hooks/
        └─ usePagination.ts                    # 分页Hook
```

### 文件命名规范

| 类型 | 命名格式 | 示例 |
|------|----------|------|
| 页面主文件 | index.tsx | OtherUserProfile/index.tsx |
| 类型定义 | types.ts | types.ts |
| 状态管理 | use{Name}.ts | useOtherUserProfile.ts |
| 区域组件 | {Name}Area.tsx 或 {Name}Area/ | ProfileHeaderArea/ |
| 子组件 | {Name}/ | MomentCard/ |
| API接口 | api{Action}{Name}.ts | apiGetUserProfile.ts |

---

## 🗄️ STEP 6: 接口实现与后端设计

### 接口定义

```json
{
  "接口文档信息": {
    "对应页面": "OtherUserProfile",
    "对应数据模型": "STEP 1 → PageModel",
    "版本": "v1.0"
  },

  "接口列表": [
    {
      "序号": 1,
      "接口名": "获取用户主页信息",
      "接口标识": "getUserProfile",
      "路径": "GET /api/profile/{userId}",
      "触发时机": "[API:getUserProfile] 页面初始化",
      "对应数据模型": "STEP 1 → PageModel.UserHeaderData",

      "请求参数": {
        "userId": "String - 用户ID - 路径参数"
      },

      "响应数据": {
        "code": "Number - 状态码 - 200成功",
        "message": "String - 提示信息",
        "data": {
          "_映射": "→ STEP 1: PageModel.UserHeaderData",
          "userId": "String - 用户ID",
          "coverUrl": "String - 封面背景图URL",
          "nickname": "String - 昵称",
          "level": "Number - 等级",
          "isVerified": "Boolean - 是否实名认证",
          "isExpert": "Boolean - 是否大神",
          "isAvailable": "Boolean - 是否可预约",
          "distance": "String - 距离",
          "followerCount": "Number - 粉丝数",
          "isFollowed": "Boolean - 是否已关注"
        }
      },

      "响应示例": {
        "code": 200,
        "message": "success",
        "data": {
          "userId": "12345",
          "coverUrl": "https://xxx.com/cover.jpg",
          "nickname": "昵称12345",
          "level": 18,
          "isVerified": true,
          "isExpert": true,
          "isAvailable": true,
          "distance": "4.6km",
          "followerCount": 102,
          "isFollowed": false
        }
      }
    },

    {
      "序号": 2,
      "接口名": "获取用户动态列表",
      "接口标识": "getMomentsList",
      "路径": "GET /api/profile/{userId}/moments",
      "触发时机": "[API:getMomentsList] Tab=动态时加载",
      "对应数据模型": "STEP 1 → PageModel.MomentsListData",

      "请求参数": {
        "userId": "String - 用户ID - 路径参数",
        "page": "Number - 页码 - 默认1",
        "pageSize": "Number - 每页数量 - 默认20"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "_映射": "→ STEP 1: PageModel.MomentsListData",
          "list": "Array<MomentItem> - 动态列表",
          "hasMore": "Boolean - 是否有更多",
          "total": "Number - 总数"
        }
      },

      "响应示例": {
        "code": 200,
        "data": {
          "list": [
            {
              "id": "m001",
              "type": "video",
              "mediaData": {
                "coverUrl": "https://xxx.com/cover1.jpg",
                "aspectRatio": 0.75,
                "duration": 60
              },
              "textData": {
                "title": "请你们看雪"
              },
              "authorData": {
                "userId": "12345",
                "avatar": "https://xxx.com/avatar.jpg",
                "nickname": "用户名称"
              },
              "statsData": {
                "likeCount": 88,
                "isLiked": false
              }
            }
          ],
          "hasMore": true,
          "total": 50
        }
      }
    },

    {
      "序号": 3,
      "接口名": "获取用户个人资料",
      "接口标识": "getProfileInfo",
      "路径": "GET /api/profile/{userId}/info",
      "触发时机": "[API:getProfileInfo] Tab=资料时加载",
      "对应数据模型": "STEP 1 → PageModel.ProfileInfoData",

      "请求参数": {
        "userId": "String - 用户ID - 路径参数"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "_映射": "→ STEP 1: PageModel.ProfileInfoData",
          "residence": "String - 常居地",
          "ipLocation": "String - IP属地",
          "height": "String - 身高",
          "userId": "String - 用户ID",
          "weight": "String - 体重",
          "occupation": "String - 职业",
          "wechat": "String - 微信号(脱敏)",
          "birthday": "String - 生日"
        }
      },

      "响应示例": {
        "code": 200,
        "data": {
          "residence": "广东 深圳",
          "ipLocation": "广东 深圳",
          "height": "162cm",
          "userId": "21566842",
          "weight": "44kg",
          "occupation": "模特",
          "wechat": "******",
          "birthday": "09-29"
        }
      }
    },

    {
      "序号": 4,
      "接口名": "获取用户技能列表",
      "接口标识": "getSkillsList",
      "路径": "GET /api/profile/{userId}/skills",
      "触发时机": "[API:getSkillsList] Tab=技能时加载",
      "对应数据模型": "STEP 1 → PageModel.SkillsListData",

      "请求参数": {
        "userId": "String - 用户ID - 路径参数",
        "page": "Number - 页码 - 默认1",
        "pageSize": "Number - 每页数量 - 默认20"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "_映射": "→ STEP 1: PageModel.SkillsListData",
          "list": "Array<SkillItem> - 技能列表",
          "hasMore": "Boolean - 是否有更多"
        }
      },

      "响应示例": {
        "code": 200,
        "data": {
          "list": [
            {
              "id": "s001",
              "mediaData": {
                "thumbnailUrl": "https://xxx.com/skill1.jpg"
              },
              "providerData": {
                "nickname": "昵称123",
                "level": 19,
                "isVerified": true,
                "isExpert": true,
                "distance": "3.2km"
              },
              "skillInfo": {
                "description": "主打野其他位置都能补 能c技术万战韩信 这里是技能介绍这里...",
                "tags": ["微信区", "荣耀王者", "巅峰1800+"],
                "gameName": "王者荣耀",
                "gameRank": "巅峰1800+"
              },
              "priceData": {
                "price": 10,
                "unit": "金币/局"
              }
            }
          ],
          "hasMore": true
        }
      }
    },

    {
      "序号": 5,
      "接口名": "关注/取消关注用户",
      "接口标识": "followUser",
      "路径": "POST /api/user/follow",
      "触发时机": "[API:followUser] 点击关注按钮",
      "对应数据模型": "STEP 1 → SharedModel.ActionResult",

      "请求参数": {
        "targetUserId": "String - 目标用户ID",
        "action": "String(follow|unfollow) - 操作类型"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "_映射": "→ STEP 1: SharedModel.ActionResult",
          "success": "Boolean - 是否成功",
          "message": "String? - 提示信息",
          "newFollowerCount": "Number - 新的粉丝数"
        }
      }
    },

    {
      "序号": 6,
      "接口名": "点赞动态",
      "接口标识": "likeMoment",
      "路径": "POST /api/moment/like",
      "触发时机": "[API:likeMoment] 点击点赞按钮",
      "对应数据模型": "STEP 1 → SharedModel.ActionResult",

      "请求参数": {
        "momentId": "String - 动态ID",
        "action": "String(like|unlike) - 操作类型"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "success": "Boolean - 是否成功",
          "newLikeCount": "Number - 新的点赞数"
        }
      }
    },

    {
      "序号": 7,
      "接口名": "解锁微信",
      "接口标识": "unlockWechat",
      "路径": "POST /api/user/unlock-wechat",
      "触发时机": "[API:unlockWechat] 点击解锁微信按钮",
      "对应数据模型": "STEP 1 → SharedModel.ActionResult",

      "请求参数": {
        "targetUserId": "String - 目标用户ID"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "success": "Boolean - 是否成功",
          "wechat": "String - 完整微信号",
          "message": "String? - 提示信息"
        }
      }
    }
  ]
}
```

### 接口汇总表

| 序号 | 接口标识 | 方法 | 路径 | 对应数据模型 | 触发时机 | 缓存 |
|------|----------|------|------|--------------|----------|------|
| 1 | getUserProfile | GET | /api/profile/{userId} | UserHeaderData | 初始化 | 5min |
| 2 | getMomentsList | GET | /api/profile/{userId}/moments | MomentsListData | Tab=动态 | 无 |
| 3 | getProfileInfo | GET | /api/profile/{userId}/info | ProfileInfoData | Tab=资料 | 5min |
| 4 | getSkillsList | GET | /api/profile/{userId}/skills | SkillsListData | Tab=技能 | 无 |
| 5 | followUser | POST | /api/user/follow | ActionResult | 点击关注 | 无 |
| 6 | likeMoment | POST | /api/moment/like | ActionResult | 点击点赞 | 无 |
| 7 | unlockWechat | POST | /api/user/unlock-wechat | ActionResult | 点击解锁 | 无 |

### 数据库表设计

```sql
-- 用户表（对应 STEP 1: PageModel.UserHeaderData）
CREATE TABLE users (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    nickname        VARCHAR(50) NOT NULL COMMENT '昵称 → UserHeaderData.nickname',
    avatar          VARCHAR(500) COMMENT '头像URL',
    cover_url       VARCHAR(500) COMMENT '封面背景图 → UserHeaderData.coverUrl',
    level           INT DEFAULT 1 COMMENT '等级 → UserHeaderData.level',
    gender          TINYINT DEFAULT 0 COMMENT '性别: 0=未知,1=男,2=女',
    is_verified     TINYINT DEFAULT 0 COMMENT '实名认证 → UserHeaderData.isVerified',
    is_expert       TINYINT DEFAULT 0 COMMENT '大神认证 → UserHeaderData.isExpert',
    is_available    TINYINT DEFAULT 0 COMMENT '可预约状态 → UserHeaderData.isAvailable',
    follower_count  INT UNSIGNED DEFAULT 0 COMMENT '粉丝数 → UserHeaderData.followerCount',
    following_count INT UNSIGNED DEFAULT 0 COMMENT '关注数',
    latitude        DECIMAL(10, 7) COMMENT '纬度',
    longitude       DECIMAL(10, 7) COMMENT '经度',
    wechat          VARCHAR(50) COMMENT '微信号 → ProfileInfoData.wechat',
    wechat_unlocked TINYINT DEFAULT 0 COMMENT '微信是否公开',
    status          TINYINT DEFAULT 1 COMMENT '状态: 0=禁用,1=正常',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_status (status),
    INDEX idx_location (latitude, longitude)
) COMMENT '用户表 → PageModel.UserHeaderData';

-- 用户资料表（对应 STEP 1: PageModel.ProfileInfoData）
CREATE TABLE user_profiles (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id         BIGINT NOT NULL COMMENT '用户ID',
    residence       VARCHAR(100) COMMENT '常居地 → ProfileInfoData.residence',
    height          VARCHAR(20) COMMENT '身高 → ProfileInfoData.height',
    weight          VARCHAR(20) COMMENT '体重 → ProfileInfoData.weight',
    occupation      VARCHAR(50) COMMENT '职业 → ProfileInfoData.occupation',
    birthday        VARCHAR(10) COMMENT '生日 → ProfileInfoData.birthday',
    ip_location     VARCHAR(100) COMMENT 'IP属地 → ProfileInfoData.ipLocation',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    UNIQUE KEY uk_user_id (user_id),
    FOREIGN KEY (user_id) REFERENCES users(id)
) COMMENT '用户资料表 → PageModel.ProfileInfoData';

-- 关注关系表（用于判断 isFollowed）
CREATE TABLE user_follows (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    follower_id     BIGINT NOT NULL COMMENT '关注者ID',
    following_id    BIGINT NOT NULL COMMENT '被关注者ID',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,

    UNIQUE KEY uk_follow (follower_id, following_id),
    INDEX idx_following_id (following_id)
) COMMENT '关注关系表 → 判断 isFollowed';

-- 动态表（对应 STEP 1: ItemModel.MomentItem）
CREATE TABLE moments (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id         BIGINT NOT NULL COMMENT '发布者ID → MomentItem.authorData.userId',
    type            VARCHAR(20) DEFAULT 'image' COMMENT '类型 → MomentItem.type',
    cover_url       VARCHAR(500) NOT NULL COMMENT '封面URL → MomentItem.mediaData.coverUrl',
    aspect_ratio    DECIMAL(4, 2) DEFAULT 1.0 COMMENT '宽高比 → MomentItem.mediaData.aspectRatio',
    duration        INT COMMENT '时长(秒) → MomentItem.mediaData.duration',
    title           VARCHAR(200) NOT NULL COMMENT '标题 → MomentItem.textData.title',
    content         TEXT COMMENT '详细内容',
    like_count      INT UNSIGNED DEFAULT 0 COMMENT '点赞数 → MomentItem.statsData.likeCount',
    comment_count   INT UNSIGNED DEFAULT 0 COMMENT '评论数',
    status          TINYINT DEFAULT 1 COMMENT '状态: 0=删除,1=正常,2=审核中',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_user_id (user_id),
    INDEX idx_status_created (status, created_at DESC),
    FOREIGN KEY (user_id) REFERENCES users(id)
) COMMENT '动态表 → ItemModel.MomentItem';

-- 动态点赞表（用于判断 isLiked）
CREATE TABLE moment_likes (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    moment_id       BIGINT NOT NULL COMMENT '动态ID',
    user_id         BIGINT NOT NULL COMMENT '用户ID',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,

    UNIQUE KEY uk_like (moment_id, user_id),
    INDEX idx_user_id (user_id)
) COMMENT '动态点赞表 → 判断 MomentItem.statsData.isLiked';

-- 技能/服务表（对应 STEP 1: ItemModel.SkillItem）
CREATE TABLE skills (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id         BIGINT NOT NULL COMMENT '服务者ID → SkillItem.providerData',
    thumbnail_url   VARCHAR(500) COMMENT '缩略图 → SkillItem.mediaData.thumbnailUrl',
    description     TEXT COMMENT '描述 → SkillItem.skillInfo.description',
    game_name       VARCHAR(50) COMMENT '游戏名称 → SkillItem.skillInfo.gameName',
    game_rank       VARCHAR(50) COMMENT '游戏段位 → SkillItem.skillInfo.gameRank',
    price           DECIMAL(10, 2) NOT NULL COMMENT '价格 → SkillItem.priceData.price',
    price_unit      VARCHAR(20) DEFAULT '金币/局' COMMENT '计价单位 → SkillItem.priceData.unit',
    status          TINYINT DEFAULT 1 COMMENT '状态: 0=下架,1=上架',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    FOREIGN KEY (user_id) REFERENCES users(id)
) COMMENT '技能服务表 → ItemModel.SkillItem';

-- 技能标签表
CREATE TABLE skill_tags (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    skill_id        BIGINT NOT NULL COMMENT '技能ID',
    tag_name        VARCHAR(50) NOT NULL COMMENT '标签名 → SkillItem.skillInfo.tags',
    sort_order      INT DEFAULT 0 COMMENT '排序',

    INDEX idx_skill_id (skill_id),
    FOREIGN KEY (skill_id) REFERENCES skills(id)
) COMMENT '技能标签表 → SkillItem.skillInfo.tags';

-- 微信解锁记录表
CREATE TABLE wechat_unlocks (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id         BIGINT NOT NULL COMMENT '解锁用户ID',
    target_user_id  BIGINT NOT NULL COMMENT '被解锁用户ID',
    price           DECIMAL(10, 2) COMMENT '支付金额',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,

    UNIQUE KEY uk_unlock (user_id, target_user_id),
    INDEX idx_target_user_id (target_user_id)
) COMMENT '微信解锁记录表';
```

### 核心SQL查询

```sql
-- 1. 获取用户主页信息（返回 UserHeaderData）
SELECT
    u.id AS userId,
    u.cover_url AS coverUrl,
    u.nickname,
    u.level,
    u.is_verified AS isVerified,
    u.is_expert AS isExpert,
    u.is_available AS isAvailable,
    u.follower_count AS followerCount,
    -- 计算距离
    ROUND(
        ST_Distance_Sphere(
            POINT(u.longitude, u.latitude),
            POINT(#{currentLng}, #{currentLat})
        ) / 1000, 1
    ) AS distance,
    -- 判断是否已关注
    IF(f.id IS NOT NULL, 1, 0) AS isFollowed
FROM users u
LEFT JOIN user_follows f ON u.id = f.following_id AND f.follower_id = #{currentUserId}
WHERE u.id = #{userId} AND u.status = 1;

-- 2. 获取用户动态列表（返回 MomentsListData）
SELECT
    m.id,
    m.type,
    -- mediaData
    m.cover_url AS coverUrl,
    m.aspect_ratio AS aspectRatio,
    m.duration,
    -- textData
    m.title,
    -- authorData
    u.id AS authorUserId,
    u.avatar AS authorAvatar,
    u.nickname AS authorNickname,
    -- statsData
    m.like_count AS likeCount,
    IF(ml.id IS NOT NULL, 1, 0) AS isLiked
FROM moments m
INNER JOIN users u ON m.user_id = u.id
LEFT JOIN moment_likes ml ON m.id = ml.moment_id AND ml.user_id = #{currentUserId}
WHERE m.user_id = #{userId} AND m.status = 1
ORDER BY m.created_at DESC
LIMIT #{pageSize} OFFSET #{offset};

-- 3. 获取用户个人资料（返回 ProfileInfoData）
SELECT
    up.residence,
    up.ip_location AS ipLocation,
    up.height,
    u.id AS userId,
    up.weight,
    up.occupation,
    -- 微信号脱敏处理
    CASE
        WHEN wu.id IS NOT NULL THEN u.wechat  -- 已解锁，显示完整
        ELSE '******'  -- 未解锁，脱敏显示
    END AS wechat,
    up.birthday
FROM users u
LEFT JOIN user_profiles up ON u.id = up.user_id
LEFT JOIN wechat_unlocks wu ON u.id = wu.target_user_id AND wu.user_id = #{currentUserId}
WHERE u.id = #{userId};

-- 4. 获取用户技能列表（返回 SkillsListData）
SELECT
    s.id,
    s.thumbnail_url AS thumbnailUrl,
    -- providerData
    u.nickname,
    u.level,
    u.is_verified AS isVerified,
    u.is_expert AS isExpert,
    ROUND(
        ST_Distance_Sphere(
            POINT(u.longitude, u.latitude),
            POINT(#{currentLng}, #{currentLat})
        ) / 1000, 1
    ) AS distance,
    -- skillInfo
    s.description,
    s.game_name AS gameName,
    s.game_rank AS gameRank,
    -- priceData
    s.price,
    s.price_unit AS priceUnit
FROM skills s
INNER JOIN users u ON s.user_id = u.id
WHERE s.user_id = #{userId} AND s.status = 1
ORDER BY s.created_at DESC
LIMIT #{pageSize} OFFSET #{offset};

-- 5. 获取技能标签
SELECT tag_name FROM skill_tags WHERE skill_id = #{skillId} ORDER BY sort_order;

-- 6. 关注操作
-- follow:
INSERT INTO user_follows (follower_id, following_id) VALUES (#{currentUserId}, #{targetUserId});
UPDATE users SET follower_count = follower_count + 1 WHERE id = #{targetUserId};
UPDATE users SET following_count = following_count + 1 WHERE id = #{currentUserId};

-- unfollow:
DELETE FROM user_follows WHERE follower_id = #{currentUserId} AND following_id = #{targetUserId};
UPDATE users SET follower_count = GREATEST(follower_count - 1, 0) WHERE id = #{targetUserId};
UPDATE users SET following_count = GREATEST(following_count - 1, 0) WHERE id = #{currentUserId};

-- 7. 点赞操作
-- like:
INSERT INTO moment_likes (moment_id, user_id) VALUES (#{momentId}, #{currentUserId});
UPDATE moments SET like_count = like_count + 1 WHERE id = #{momentId};

-- unlike:
DELETE FROM moment_likes WHERE moment_id = #{momentId} AND user_id = #{currentUserId};
UPDATE moments SET like_count = GREATEST(like_count - 1, 0) WHERE id = #{momentId};

-- 8. 解锁微信
INSERT INTO wechat_unlocks (user_id, target_user_id, price) VALUES (#{currentUserId}, #{targetUserId}, #{price});
SELECT wechat FROM users WHERE id = #{targetUserId};
```

### MVP清单

| 序号 | 功能 | 对应数据模型 | 涉及表 | 接口 | 优先级 |
|------|------|--------------|--------|------|--------|
| 1 | 用户主页信息 | UserHeaderData | users, user_follows | GET /profile/{userId} | P0 |
| 2 | 动态列表 | MomentsListData | moments, users, moment_likes | GET /profile/{userId}/moments | P0 |
| 3 | 个人资料 | ProfileInfoData | users, user_profiles, wechat_unlocks | GET /profile/{userId}/info | P0 |
| 4 | 技能列表 | SkillsListData | skills, users, skill_tags | GET /profile/{userId}/skills | P0 |
| 5 | 关注操作 | ActionResult | user_follows, users | POST /user/follow | P0 |
| 6 | 点赞操作 | ActionResult | moment_likes, moments | POST /moment/like | P1 |
| 7 | 解锁微信 | ActionResult | wechat_unlocks, users | POST /user/unlock-wechat | P1 |

**MVP统计：8张表 + 7个接口 = 最小可行后端**

---

## 🎯 质量评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 数据模型 | 9 | 完整覆盖三个Tab的所有数据，字段与UI绑定清晰 |
| 结构完整性 | 9 | 所有UI元素都有层级标注，L1/L2/L3/L4清晰 |
| 数据绑定 | 9 | 每个动态字段都有[data:xxx]标注 |
| 位置精确度 | 8 | 提供了ASCII可视化布局图，标注了主要尺寸和间距 |
| 组件拆分 | 9 | L1/L2/L3/L4层级合理，复用关系标记完整 |
| 复用标记 | 8 | 1模板xN实例标记完整，共享组件抽取合理 |
| 交互描述 | 9 | 覆盖所有可点击交互，包含乐观更新和回滚机制 |
| 代码映射 | 9 | 完整对应文件结构，可直接创建项目文件夹 |
| 接口+后端 | 9 | 接口响应对应数据模型，数据库表SQL完整可执行 |

**综合评分：8.8/10**

---

*文档版本: v1.0*
*生成时间: 2025-12-01*
*基于模板: 纯结构架构图标准模板 v5.4*
