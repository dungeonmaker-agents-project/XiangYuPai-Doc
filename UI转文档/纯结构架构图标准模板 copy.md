# 🌳 纯结构架构图标准模板 v5.2

> **核心输出：JSON契约 → 流程图 → 树状图 + 布局 → 代码结构 → 后端MVP**
>
> **设计理念：数据驱动，JSON先行，前后端契约优先**

---

## 📥 开始使用

**请提供以下任一输入：**

```
1. UI截图/设计稿图片 - 直接上传页面截图或设计稿
2. 页面描述 - 用文字描述页面的主要功能和布局
3. 原型链接 - 提供Figma/蓝湖等原型工具链接

示例输入：
├── "这是一个发现页面，顶部有Tab切换（关注/热门/同城），下方是瀑布流内容列表"
├── "用户个人中心页面，包含头像、昵称、统计数据、功能入口列表"
└── [直接上传UI截图]
```

**收到输入后，将按六步法生成完整开发文档。**

---

## 🚀 工作流程（必读）

### 六步法：从UI图到可开发文档

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        UI图输入                                          │
│                           ↓                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  STEP 1: 📋 JSON数据契约（最重要！固定整体架构）                    │    │
│  │  ────────────────────────────────────────────────────────────    │    │
│  │  • 分析页面所有数据来源                                            │    │
│  │  • 按接口分类，定义请求/响应结构                                    │    │
│  │  • 这是前后端开发的唯一契约                                         │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                           ↓                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  STEP 2: 🔄 流程图（用户操作流程）                                  │    │
│  │  ────────────────────────────────────────────────────────────    │    │
│  │  • 页面初始化流程（调用哪些接口）                                   │    │
│  │  • 用户交互路径（触发哪些操作接口）                                 │    │
│  │  • 状态管理流程（数据如何流转）                                     │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                           ↓                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  STEP 3: 🌳 树状图（页面结构层级）                                  │    │
│  │  ────────────────────────────────────────────────────────────    │    │
│  │  • L1/L2/L3 三层拆分                                              │    │
│  │  • 标注位置、尺寸、样式                                            │    │
│  │  • 标注数据绑定（来自哪个JSON字段）                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                           ↓                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  STEP 4: 📍 布局定位（位置/行列描述）                               │    │
│  │  ────────────────────────────────────────────────────────────    │    │
│  │  • 九宫格定位 + 行列系统                                           │    │
│  │  • Flex/Grid 布局描述                                             │    │
│  │  • 可视化布局图                                                    │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                           ↓                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  STEP 5: 📁 代码结构（文件夹/文件组织）                             │    │
│  │  ────────────────────────────────────────────────────────────    │    │
│  │  • Modules模块结构                                                │    │
│  │  • 区域组件划分                                                    │    │
│  │  • 文件命名规范                                                    │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                           ↓                                              │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │  STEP 6: 🗄️ 后端MVP（最小可行后端）                                │    │
│  │  ────────────────────────────────────────────────────────────    │    │
│  │  • 核心数据库表设计                                                │    │
│  │  • 核心SQL查询                                                     │    │
│  │  • API实现逻辑                                                     │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                           ↓                                              │
│                      完整开发文档                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 为什么JSON先行？

```
传统方式：UI → 前端开发 → 发现需要数据 → 找后端要接口 → 反复沟通
                                    ↓
                              效率低、返工多

JSON先行：UI → JSON契约 → 前端+后端并行开发 → 联调
                  ↓
            一次定义，双方对齐，减少返工
```

### 快速检查清单

```
□ STEP 1: JSON契约是否覆盖页面所有数据？
□ STEP 2: 流程图是否覆盖所有交互？是否与接口对应？
□ STEP 3: 树状图是否标注了数据绑定来源？
□ STEP 4: 布局图是否清晰可视化？
□ STEP 5: 代码结构是否可直接创建文件夹？
□ STEP 6: 后端MVP是否只包含核心表和接口？
```

---

## 📋 STEP 1: JSON数据契约模板

> **📌 目标**：分析 UI 中所有动态数据来源，定义前后端通信的接口契约（Single Source of Truth）
>
> **📤 产出**：
> - 完整的接口列表（包含请求/响应结构）
> - 每个字段与 UI 元素的绑定关系
> - 接口汇总表（方法、路径、触发时机、缓存策略）
> - 可复用的数据模型定义

### 契约设计原则

```
核心理念：JSON契约是前后端开发的唯一真相来源（Single Source of Truth）

设计原则：
├── 🎯 UI驱动 - 从UI元素反推需要的数据字段
├── 📍 位置绑定 - 每个字段标注绑定到UI的具体位置
├── 🔀 条件标注 - 标明字段的显示条件和业务逻辑
├── 📦 完整性 - 覆盖页面所有动态数据，不遗漏
└── 🔄 可追溯 - 从UI到接口、从接口到数据库可双向追溯
```

### 接口分类体系

```
按触发时机分类：
├── 🔄 初始化接口 - 页面加载时调用（优先级最高）
├── 📜 列表接口 - 分页/刷新/加载更多
├── 🎯 操作接口 - 用户交互触发（点赞、收藏、关注、提交等）
├── 🔧 配置接口 - 获取静态配置（Tab、筛选项，可缓存）
└── 🌐 公共接口 - 跨页面共享（底部导航、用户信息等）

按数据流向分类：
├── 📥 读取类 - GET 请求，获取数据展示
├── 📤 写入类 - POST/PUT/DELETE 请求，提交数据变更
└── 📡 实时类 - WebSocket，实时推送更新
```

### JSON契约完整模板

```json
{
  "文档信息": {
    "页面名称": "[页面中文名]",
    "页面路由": "/[module]/[page]",
    "所属模块": "[模块名]",
    "页面类型": "[列表页|详情页|表单页|聚合页]",
    "版本": "v1.0",
    "最后更新": "YYYY-MM-DD"
  },

  "接口依赖图": "页面初始化 → [配置接口] + [列表接口] → 用户操作 → [操作接口]",

  "接口列表": [
    {
      "序号": 1,
      "接口名": "[接口名称]",
      "接口标识": "[apiGetXxx|apiPostXxx]",
      "路径": "[METHOD] /api/[module]/[action]",
      "触发时机": "[页面初始化|下拉刷新|上拉加载|Tab切换|点击XX|条件:XX时]",
      "调用频率": "[单次|多次(分页)|按需]",
      "缓存策略": "[无|本地缓存Xmin|内存缓存|Redis缓存Xmin]",
      "依赖接口": "[无|依赖接口X返回的字段Y]",
      "错误处理": "[Toast提示|弹窗确认|静默重试|降级显示]",

      "请求参数": {
        "必填参数": {
          "param1": "类型 - 说明 - 示例值",
          "param2": "类型(枚举值1|枚举值2) - 说明 - 默认值"
        },
        "可选参数": {
          "param3": "类型 - 说明 - [条件:仅当XX时需要]",
          "page": "Number - 页码 - 默认1",
          "pageSize": "Number - 每页数量 - 默认20"
        }
      },

      "响应数据": {
        "code": "Number - 状态码 - 200成功",
        "message": "String - 提示信息",
        "data": {
          "field1": "类型 - 说明 - [UI:组件.区域.元素]",
          "field2": "类型(枚举值) - 说明 - [UI:位置] [条件:决定XX显示]",
          "nested": {
            "_说明": "嵌套对象说明",
            "subField1": "类型 - 说明 - [UI:位置]",
            "subField2": "类型 - 说明 - [UI:位置]"
          },
          "list": "[Array<Item>] - 列表数据 - [UI:XX列表]",
          "hasMore": "Boolean - 是否有更多 - [控制:加载更多/到底提示]",
          "total": "Number - 总数 - [可选:用于显示计数]"
        }
      },

      "响应示例": {
        "_说明": "提供一个真实的响应示例，帮助理解数据结构"
      }
    }
  ],

  "数据模型定义": {
    "_说明": "定义可复用的数据结构，避免重复描述",
    "Item": {
      "id": "String - 唯一标识",
      "其他字段": "..."
    },
    "Author": {
      "userId": "String - 用户ID",
      "nickname": "String - 昵称",
      "avatar": "String - 头像URL"
    }
  },

  "状态码定义": {
    "200": "成功",
    "400": "参数错误",
    "401": "未登录",
    "403": "无权限",
    "404": "资源不存在",
    "500": "服务器错误"
  }
}
```

### 常见页面类型的接口模式

```
📋 列表页（如：发现页、消息列表、关注列表）
├── GET  /api/[module]/list           主列表数据（分页）
│   ├── 请求: { tab, page, pageSize, [筛选条件] }
│   └── 响应: { list[], hasMore, total }
├── GET  /api/[module]/tabs           Tab配置（可缓存）
│   └── 响应: { tabs[{ key, label, isDefault }] }
├── POST /api/[module]/[action]       单项操作（点赞、关注等）
│   ├── 请求: { targetId, action }
│   └── 响应: { success, [newCount] }
└── GET  /api/common/tabbar           底部导航（全局共享）

📝 详情页（如：内容详情、用户主页、商品详情）
├── GET  /api/[module]/{id}           主体详情
│   └── 响应: { 基础信息, 统计数据, 用户关系状态 }
├── GET  /api/[module]/{id}/comments  评论列表（分页）
│   ├── 请求: { page, pageSize, sort }
│   └── 响应: { list[], hasMore }
├── GET  /api/[module]/{id}/related   相关推荐
│   └── 响应: { list[] }
└── POST /api/[module]/{id}/[action]  操作（收藏、分享、举报）
    ├── 请求: { action, [reason] }
    └── 响应: { success }

✏️ 表单页（如：发布内容、编辑资料、提交订单）
├── GET  /api/[module]/form-config    表单配置（选项、限制）
│   └── 响应: { fields[], options{}, limits{} }
├── GET  /api/[module]/{id}           编辑时获取原数据
│   └── 响应: { 原有字段值 }
├── POST /api/[module]/create         新建提交
│   ├── 请求: { 表单字段 }
│   └── 响应: { id, success }
├── PUT  /api/[module]/{id}           编辑提交
│   ├── 请求: { 表单字段 }
│   └── 响应: { success }
├── POST /api/[module]/upload         文件上传（图片、视频）
│   ├── 请求: FormData { file, type }
│   └── 响应: { url, [thumbnailUrl], [duration] }
└── POST /api/[module]/draft          草稿保存
    ├── 请求: { 部分字段 }
    └── 响应: { draftId }

🏠 聚合页（如：首页、个人中心）
├── GET  /api/[module]/home           聚合数据
│   └── 响应: { banner[], quickEntry[], sections[] }
├── GET  /api/[module]/section/{type} 分区数据（按需加载）
│   └── 响应: { list[], hasMore }
└── GET  /api/user/profile            用户信息
    └── 响应: { 基础信息, 统计数据, 设置状态 }
```

### 字段类型标注规范

```
基础类型：
├── String              - 字符串
├── Number              - 数字（整数或浮点数）
├── Boolean             - 布尔值
├── Array<T>            - 数组，T为元素类型
└── Object              - 对象

增强标注：
├── String(val1|val2)   - 枚举字符串，列出所有可能值
├── Number(0-100)       - 数字范围
├── String?             - 可选字段（可能不返回）
├── String!             - 必填字段
└── Array<Item>         - 引用数据模型定义

示例：
├── "type": "String(image|video|audio) - 内容类型"
├── "status": "Number(0|1|2) - 状态：0=删除,1=正常,2=审核中"
├── "score": "Number(0-5) - 评分，保留1位小数"
├── "tags": "Array<String> - 标签列表"
└── "author": "Author - 作者信息（引用数据模型）"
```

### 数据字段与UI绑定标注

**标注格式规范：**
```
"字段名": "类型 - 说明 - [标注1] [标注2] ..."

标注类型：
├── [UI:组件.区域.元素]     - UI位置绑定
├── [用于:跳转/调用/计算]    - 字段用途
├── [条件:XXX时显示]        - 条件显示
├── [样式:14sp,2行省略]     - 样式描述
├── [格式:格式化规则]       - 显示格式化
├── [计算:计算公式]         - 计算逻辑
└── [状态:true/false效果]   - 状态切换
```

**【示例A：内容列表页】**
```json
{
  "响应数据": {
    "id": "String - 主体ID - [用于:跳转详情页、操作接口参数]",
    "type": "String(枚举值) - 类型标识 - [条件:决定显示不同图标/标签]",
    "{imageField}": "String - 图片URL - [UI:卡片.图片区.主图]",
    "{ratioField}": "Number - 宽高比 - [计算:高度=宽度/ratio]",
    "{textField}": "String - 文本内容 - [UI:卡片.文本区] [样式:14sp,最多2行,超出省略]",
    "{relatedUser}": {
      "_说明": "关联用户对象",
      "userId": "String - 用户ID - [用于:点击跳转用户主页]",
      "avatar": "String - 头像URL - [UI:卡片.用户区.头像] [样式:20x20圆形]",
      "nickname": "String - 昵称 - [UI:卡片.用户区.昵称]"
    },
    "{countField}": "Number - 计数 - [UI:卡片.统计区] [格式:>=10000显示1.2w]",
    "{statusField}": "Boolean - 状态标识 - [UI:状态图标] [true=激活样式,false=默认样式]",
    "createTime": "String(ISO8601) - 时间 - [格式:刚刚/X分钟前/昨天/MM-DD]"
  }
}
```

**【示例B：表单页】**
```json
{
  "响应数据": {
    "formConfig": {
      "fields": "Array<FieldConfig> - 表单字段配置 - [UI:表单区.字段列表]",
      "options": "Object - 选项数据 - [UI:下拉框/单选/多选的选项]",
      "limits": "Object - 限制条件 - [验证:字数限制/文件大小等]"
    },
    "initialData": {
      "_说明": "编辑模式时的原始数据",
      "{field1}": "类型 - 说明 - [UI:表单.字段1.默认值]",
      "{field2}": "类型 - 说明 - [UI:表单.字段2.默认值]"
    }
  }
}
```

**【示例C：详情页】**
```json
{
  "响应数据": {
    "basicInfo": {
      "_说明": "基础信息区域",
      "{主体字段}": "类型 - 说明 - [UI:详情.基础信息区]"
    },
    "statistics": {
      "_说明": "统计数据区域",
      "{count1}": "Number - 统计1 - [UI:详情.统计区.指标1]",
      "{count2}": "Number - 统计2 - [UI:详情.统计区.指标2]"
    },
    "relationStatus": {
      "_说明": "当前用户与主体的关系状态",
      "{isAction1}": "Boolean - 是否已操作1 - [UI:操作按钮1状态]",
      "{isAction2}": "Boolean - 是否已操作2 - [UI:操作按钮2状态]"
    }
  }
}
```

### 条件字段与业务逻辑标注

**通用标注模式：**

```
条件显示:   [条件:{字段}={值}] - 满足条件时显示
状态切换:   [状态:{字段}] - [true→效果A, false→效果B]
格式化:     [格式:{规则描述}]
计算字段:   [计算:{公式}]
```

**【条件显示字段模式】**
```json
{
  "条件显示": {
    "_说明": "根据某字段值决定是否显示某UI元素",
    "场景1-类型判断": "[条件:type={某值}] - 显示对应图标/标签",
    "场景2-状态判断": "[条件:status={某值}] - 显示对应状态标识",
    "场景3-权限判断": "[条件:hasPermission=true] - 显示操作按钮",
    "场景4-数量判断": "[条件:count>0] - 显示角标/计数",
    "场景5-组合条件": "[条件:A且B] - 同时满足多条件时显示"
  }
}
```

**【状态切换字段模式】**
```json
{
  "状态切换": {
    "_说明": "用户操作可切换的状态字段",
    "二元状态": "{isXxx}: Boolean - [true→激活样式, false→默认样式] [点击切换]",
    "多态状态": "{status}: String(a|b|c) - [a→样式A, b→样式B, c→样式C]"
  }
}
```

**【格式化字段模式】**
```json
{
  "格式化": {
    "_说明": "需要前端格式化显示的字段",
    "数字格式化": "{count}: Number - [<1000原样, >=1000显示Xk, >=10000显示Xw]",
    "时间格式化": "{time}: String - [<1分钟'刚刚', <1小时'X分钟前', <24小时'X小时前', 其他'MM-DD']",
    "大小格式化": "{size}: Number(bytes) - [自动转KB/MB/GB]",
    "距离格式化": "{distance}: Number(meters) - [<1000显示Xm, >=1000显示X.Xkm]"
  }
}
```

**【计算字段模式】**
```json
{
  "计算字段": {
    "_说明": "需要前端计算得出的值",
    "尺寸计算": "{height}: [计算:containerWidth * ratio]",
    "进度计算": "{progress}: [计算:current/total * 100]",
    "差值计算": "{remaining}: [计算:total - used]"
  }
}
```

### 接口汇总表模板

```markdown
| 序号 | 接口名 | 方法 | 路径 | 触发时机 | 缓存 |
|------|--------|------|------|----------|------|
| 1 | 获取{主体}列表 | GET | /api/{module}/list | 初始化/刷新/加载更多 | 无 |
| 2 | {操作}动作 | POST | /api/{module}/{action} | 点击{触发元素} | 无 |
| 3 | {配置}获取 | GET | /api/{module}/config | 页面初始化 | 本地{X}min |
| 4 | 底部导航 | GET | /api/common/tabbar | App初始化 | 本地30min |
```

**常见触发时机：**
- 页面初始化、下拉刷新、上拉加载、Tab切换
- 点击按钮、表单提交、滑动切换
- 条件触发（如：滚动到某位置、定时刷新）

---

## 📐 符号系统

```
【页面】📱   《组件》📋   「按钮/功能」   (注：说明)

位置: [位置:TL/TC/TR/ML/MC/MR/BL/BC/BR]
行列: [R1-C2] [R1:R3-全行] [R-Last]
布局: [布局:flex-row] [布局:grid-cols-2] [gap-12px]
层级: [L1-页面] [L2-区域] [L3-基础]
拆分: [拆分:3个L3] [1模板x4实例] ← 复用XXX
相对: [↗️右上角] [➡️右侧] [⬇️下方] [间距:12px]
尺寸: [尺寸:48x48px] [高度:56px] [圆角:12px]
样式: (白色背景+圆角12px+阴影2px) (16sp#333333粗体)
数据: [data:字段名] ← 标注数据来源
```

---

## 🔄 STEP 2: 流程图模板

> **📌 目标**：基于 STEP 1 的接口契约，描述数据如何在页面流转，明确接口调用时机和用户操作路径
>
> **📤 产出**：
> - 页面初始化流程（进入页面 → 调用哪些接口 → 渲染数据）
> - 用户交互路径（列表交互、单项操作、导航跳转 → 触发哪些接口）
> - 状态管理流程（加载中、加载失败、空数据、到底了）
> - 流程与 STEP 1 接口的直接对应关系
> - 交互涉及的组件区域标注（→ STEP 3 弱关联）

### 流程与组件关联说明

```
标注格式：
├── [API:{接口标识}]     - 调用 STEP 1 定义的接口
├── [→{Area}]           - 数据渲染到 STEP 3 的组件区域
├── [触发:{Area}]       - 用户在某组件区域触发的操作
└── [状态:{Area}]       - 组件区域的状态变化

关联示意：
STEP 1 (数据)  ←──→  STEP 2 (流程)  ←──→  STEP 3 (组件)
   接口契约              数据流转              UI结构
```

### 通用流程图模板

```
开始
 ↓
【进入{页面名}】
 ├─→ 路由跳转: /{module}/{page}
 ├─→ Tab切换: 从{其他Tab}切换
 └─→ 深链接: {scheme}://{path}
 ↓
【页面初始化】
 │
 ├─→ 调用 [API:{configApi}] → 获取配置
 │    └─→ 渲染 [→{TabArea}] Tab列表
 │
 ├─→ 调用 [API:{listApi}] (page=1) → 获取首屏数据
 │    └─→ 渲染 [→{ContentArea}] 内容列表
 │
 └─→ 初始化监听
      ├─→ 滚动监听 → [触发:{ContentArea}]
      └─→ 下拉刷新监听 → [触发:{HeaderArea}]
 ↓
用户操作
 │
 ├─→ 【{ContentArea} 列表交互】
 │    │
 │    ├─→ 下拉刷新 [触发:{ContentArea}]
 │    │    ├─→ 调用 [API:{listApi}] (page=1)
 │    │    └─→ 清空重置 [状态:{ContentArea}]
 │    │
 │    ├─→ 上拉加载 [触发:{ContentArea}]
 │    │    ├─→ 调用 [API:{listApi}] (page+1)
 │    │    └─→ 追加数据 [状态:{ContentArea}]
 │    │
 │    └─→ 滚动浏览 → 图片懒加载
 │
 ├─→ 【{ItemComponent} 单项操作】
 │    │
 │    ├─→ 点击卡片 [触发:{ItemComponent}]
 │    │    └─→ 跳转 → 【{详情页}】(携带 {id})
 │    │
 │    └─→ 点击{操作按钮} [触发:{ItemComponent}.{ActionButton}]
 │         ├─→ 乐观更新 [状态:{ItemComponent}]
 │         ├─→ 调用 [API:{actionApi}]
 │         ├─→ 成功 → 保持状态 + [可选:Toast]
 │         └─→ 失败 → 回滚 [状态:{ItemComponent}] + Toast
 │
 ├─→ 【{TabArea} Tab切换】
 │    └─→ 点击{TabItem} [触发:{TabArea}]
 │         ├─→ 更新选中态 [状态:{TabArea}]
 │         ├─→ 调用 [API:{listApi}] (tab={tabKey}, page=1)
 │         └─→ 替换内容 [状态:{ContentArea}]
 │
 └─→ 【{TabBarArea} 导航跳转】
      └─→ 点击{NavItem} [触发:{TabBarArea}]
           └─→ 跳转 → 【{目标页面}】
 ↓
【状态管理】 [状态:{ContentArea}]
 ├─→ isLoading && page=1 → 显示骨架屏
 ├─→ isLoading && page>1 → 显示底部Loading
 ├─→ isError → 显示错误提示 → 点击重试
 ├─→ list.length=0 → 显示空状态插画
 └─→ hasMore=false → 显示"{到底文案}"
 ↓
结束
```

### 流程模式速查

```
按页面类型选择流程模式：

📋 列表页流程要点：
├── 初始化: [API:config] + [API:list(page=1)]
├── 刷新:   [API:list(page=1)] → 清空重置
├── 加载:   [API:list(page+1)] → 追加数据
├── 操作:   [API:action] → 乐观更新 + 回滚机制
└── 切换:   Tab切换 → 重新加载

📝 详情页流程要点：
├── 初始化: [API:detail(id)] + [API:comments(page=1)]
├── 评论:   [API:comments(page+1)] → 追加
├── 操作:   [API:action] → 收藏/点赞/分享
└── 提交:   [API:comment] → 发表评论 → 插入列表

✏️ 表单页流程要点：
├── 初始化: [API:formConfig] + [可选:API:detail(id)]
├── 输入:   字段校验 → 实时反馈
├── 上传:   [API:upload] → 获取URL
├── 草稿:   [API:draft] → 定时保存
└── 提交:   [API:submit] → 成功跳转/失败提示

🏠 聚合页流程要点：
├── 初始化: [API:home] → 多区块并行渲染
├── 懒加载: 滚动到区块 → [API:section(type)]
├── 刷新:   整体刷新 → 重新调用[API:home]
└── 跳转:   各区块独立跳转逻辑
```

### 流程-组件关联表模板

```markdown
| 流程节点 | 触发组件 | 调用接口 | 影响组件 | 状态变化 |
|----------|----------|----------|----------|----------|
| 页面初始化 | - | {configApi}, {listApi} | {TabArea}, {ContentArea} | loading→loaded |
| 下拉刷新 | {ContentArea} | {listApi}(page=1) | {ContentArea} | refreshing→loaded |
| 上拉加载 | {ContentArea} | {listApi}(page+1) | {ContentArea} | loadingMore→loaded |
| 点击卡片 | {ItemComponent} | - | - | 跳转{详情页} |
| 点击{操作} | {ItemComponent} | {actionApi} | {ItemComponent} | {状态}切换 |
| Tab切换 | {TabArea} | {listApi}(tab=X) | {ContentArea} | 内容替换 |
```

---
## 🌳 STEP 3: 树状图模板

> **📌 目标**：将 UI 页面拆解为层级结构，建立组件树，标注每个元素的数据来源（绑定 STEP 1 的字段）
>
> **📤 产出**：
> - L1/L2/L3 三层组件树状图
> - 每个组件的文件路径标注
> - 数据绑定标注（[data:字段名]）
> - 复用关系标注（← 复用XXX）
> - 标准 Area 命名（NavArea、ContentArea 等）

> **说明**：使用标准 `XXXArea` 命名体系，每个 Area 对应一个布局可视化模板（见 STEP 4）。
> `{xxx}` 表示需根据实际页面替换的占位符。

### 标准 Area 类型

```
页面级 Area（L2区域组件）：
├── NavArea          - 导航区（状态栏+导航栏）
├── TabNavArea       - Tab导航区（顶部Tab切换）
├── ContentListArea  - 内容列表区（瀑布流/网格卡片）
├── ListArea         - 垂直列表区（消息列表/设置列表）
├── FormArea         - 表单区（输入表单）
├── DetailArea       - 详情展示区（内容详情/用户信息）
├── ActionBarArea    - 操作栏区（底部操作按钮）
└── TabBarArea       - 底部导航区（App底部Tab）

子级组件（L3基础组件）：
├── CardItem         - 卡片项（用于ContentListArea）
├── ListItem         - 列表项（用于ListArea）
├── FormItem         - 表单项（用于FormArea）
└── TabItem          - 标签项（用于TabNavArea/TabBarArea）
```

### 通用树状图模板

```
【[模块名]】★★★
│
├── 【[主页面]】📱 [L1] [拆分:X个L2]
│   │   文件: {PageName}/index.[ext]
│   │
│   ├── 📍 {HeaderArea} [L2] [固定顶部]
│   │   │   文件: {HeaderArea}.[ext] 或 {HeaderArea}/
│   │   │   布局: 根据实际 UI 定义
│   │   └── ... [L3] 子组件
│   │
│   ├── 🏷️ {TabArea} [L2] [可选]
│   │   │   文件: {TabArea}.[ext]
│   │   └── 《TabItem》[L3] [1模板x{N}实例]
│   │
│   ├── 🏷️ {ContentArea} [L2] [flex:1, 可滚动]
│   │   │   文件: {ContentArea}/（复杂区域）
│   │   │   ├── index.[ext]
│   │   │   ├── types.[ext]
│   │   │   ├── use{ContentArea}.[ext]
│   │   │   │
│   │   │   └── {ItemComponent}/  [L3] 子组件
│   │   │       ├── index.[ext]
│   │   │       └── ...
│   │   │
│   │   └── 📋 Container [布局:根据UI定义]
│   │       └── 《{ItemComponent}》[L3] [1模板x{N}实例]
│   │           ├── ... 子元素结构
│   │           └── [data:{字段}] 数据绑定
│   │
│   ├── 📍 {ActionArea} [L2] [固定底部] [可选]
│   │   │   文件: {ActionArea}.[ext]
│   │   └── ... 操作按钮/输入框
│   │
│   └── 📍 {FooterArea} [L2] [固定底部] [可选]
│       │   文件: SharedComponents/TabBar/ (如为全局共享)
│       └── 《TabItem》[L3] [1模板x{N}实例]
│
├── 【子页面群】📱
│   ├── 【{页面A}】[L1] = {Area1} + {Area2} + ...
│   ├── 【{页面B}】[L1] = {Area1} + {Area3} + ...
│   └── ...
│
└── 🔧 服务层（对应STEP 1的接口）
    ├── 📡 GET /api/{module}/config    → 配置服务
    ├── 📡 GET /api/{module}/list      → 列表服务
    └── 📡 POST /api/{module}/{action} → 操作服务

树状图标注说明：
├── [L1/L2/L3/L4]  - 层级标识，对应 STEP 4 布局模板和 STEP 5 代码结构
├── [固定顶部/底部] - 位置固定，不随内容滚动
├── [flex:1, 可滚动] - 占据剩余空间，内容可滚动
├── [可选]          - 该区域根据页面需要可有可无
├── [1模板x{N}实例] - 模板复用，数据驱动渲染N个实例
├── [data:{字段}]   - 数据绑定，来自 STEP 1 的 JSON 契约
└── 文件:           - 对应 STEP 5 的代码文件路径
```

### 列表控制（通用）

```
🔄 ListControl [适用于 ContentListArea / ListArea]
├── 加载更多: 上滑 [距底100px] → 调用列表接口(page+1)
├── 下拉刷新: [阈值60px] → 调用列表接口(page=1)
├── 骨架屏: [条件:isLoading且page=1] 显示占位
├── 加载指示: [条件:isLoading且page>1] 显示底部loading
├── 空状态: [条件:list.length=0] 显示空状态插画
└── 到底提示: [条件:hasMore=false] "{到底文案}"
```

---

## 🧩 组件拆分

### 三层架构
```
L1-页面: 完整页面 → 拆分3-7个L2
L2-区域: 功能区块 → 拆分2-6个L3
L3-基础: 最小单元 → 可复用组件
```

### 拆分数量参考
```
简单页面: L2×2-3 + L3×3-5 = 5-8个
中等页面: L2×4-6 + L3×8-12 = 12-18个
复杂页面: L2×6-10 + L3×15-25 = 21-35个
```

### 复用标记
```
← 复用XXX          表示复用某组件
[1模板xN实例]      模板复用N次
[拆分:3个L3]       拆分为3个子组件
复用性: 高(全局) / 中(跨页) / 低(页面内)
```

---

## 📍 STEP 4: 布局定位系统

> **📌 目标**：定义页面和组件的空间布局规则，确定每个元素的位置、尺寸、排列方式
>
> **📤 产出**：
> - 九宫格位置标注（TL/TC/TR/ML/MC/MR/BL/BC/BR）
> - 行列系统描述（[R1-C2]、[R1:R3]）
> - Flex/Grid 布局规则（flex-row、grid-cols-N）
> - 相对位置关系（↗️右上角、⬇️下方）
> - 布局层级定义（L1→L2→L3→L4 的布局职责）

### 九宫格位置
```
┌──────────────────────────────────────────┐
│  TL(左上)   │   TC(正上)   │   TR(右上)  │
├──────────────────────────────────────────┤
│  ML(左中)   │   MC(正中)   │   MR(右中)  │
├──────────────────────────────────────────┤
│  BL(左下)   │   BC(正下)   │   BR(右下)  │
└──────────────────────────────────────────┘
```

### 行列系统
```
[R1]: 第1行        [C1]: 第1列
[R1-C2]: 第1行第2列
[R1:R3]: 第1到3行
[R2-全行]: 第2行全宽
[R-Last]: 最后一行
```

### Flex/Grid布局
```
Flex:
├── flex-row / flex-col
├── space-between / center / start / end
├── flex-item:固定Npx / flex-1

Grid:
├── grid-cols-2 / grid-cols-3
├── gap-12px / gap-x-8px gap-y-12px
├── grid-item:R1-C1 / col-span-2
```

### 相对位置
```
↗️ 右上角    ↘️ 右下角    ↙️ 左下角    ↖️ 左上角
➡️ 右侧      ⬅️ 左侧      ⬆️ 上方      ⬇️ 下方
[偏移:-4px]  [间距:12px]
```

### 布局可视化模板系统

> **设计理念**：布局模板与代码结构一一对应，每个代码文件都有对应的布局描述。
> **查看方式**：STEP 4 定义布局基础规范，STEP 5 展示每个组件的具体布局。

#### 通用布局构建块

```
┌─────────────────────────────────────────────────────────────────┐
│  🔧 基础布局模式（可自由组合）                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  【垂直堆叠】flex-col          【水平排列】flex-row               │
│  ┌─────────────────┐          ┌─────────────────────────────┐   │
│  │    Section A    │          │  Left  │  Center  │  Right  │   │
│  ├─────────────────┤          └─────────────────────────────┘   │
│  │    Section B    │                                            │
│  ├─────────────────┤          【网格布局】grid-cols-{N}          │
│  │    Section C    │          ┌──────┬──────┬──────┐            │
│  └─────────────────┘          │  1   │  2   │  3   │            │
│                               ├──────┼──────┼──────┤            │
│  【嵌套容器】                   │  4   │  5   │  6   │            │
│  ┌─────────────────┐          └──────┴──────┴──────┘            │
│  │ ┌─────┬───────┐ │                                            │
│  │ │     │       │ │          【绝对定位叠层】                    │
│  │ │ A   │   B   │ │          ┌─────────────────┐               │
│  │ │     │       │ │          │     Base        │               │
│  │ └─────┴───────┘ │          │        ┌──────┐ │               │
│  │ ┌─────────────┐ │          │        │Overlay│ │               │
│  │ │      C      │ │          │        └──────┘ │               │
│  │ └─────────────┘ │          └─────────────────┘               │
│  └─────────────────┘                                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

布局属性速记：
├── 方向:    flex-col | flex-row
├── 对齐:    center | start | end | space-between | space-around
├── 换行:    flex-wrap | nowrap
├── 间距:    gap-{N}px | gap-x-{N}px gap-y-{N}px
├── 弹性:    flex-1 | flex:固定{N}px | flex:auto
├── 网格:    grid-cols-{N} | grid-rows-{N}
├── 滚动:    scroll-y | scroll-x | scroll-none
└── 定位:    relative | absolute | fixed | sticky
```

#### 布局层级定义

```
层级      代码对应                  布局职责
─────────────────────────────────────────────────────────
L1       index.[ext] (页面)        组合 L2 区域，定义整体结构
L2       XXXArea.[ext|/]           区域内部布局，可包含 L3
L3       {SubComponent}/           可复用子组件布局
L4       SharedComponents/         跨模块共享组件布局
```

> **详细布局模板见 STEP 5**：每个代码文件都配有对应的布局可视化图。

---

## 📁 STEP 5: 代码结构映射（含布局模板）

> **📌 目标**：将 UI 结构映射为可执行的代码文件组织，定义每个文件的职责和对应的布局模板
>
> **📤 产出**：
> - 完整的文件夹/文件结构树（可直接创建）
> - 每个代码文件对应的 ASCII 布局可视化图
> - 🟢 简单区域（单文件）与 🔵 复杂区域（文件夹）的划分
> - 文件命名规范（index、types、hooks、api 等）
> - 模块级/页面级/区域级的代码组织

> **核心理念**：每个代码文件都有对应的布局模板，代码结构与 UI 布局一一映射。

### 架构理念：薄页面、厚组件
```
模块 → 多个页面 → 多个区域组件

├─ 模块级：共享数据/缓存/状态（api/, stores/, hooks/）
├─ 页面级：页面专属逻辑（api/, hooks/）+ 组合区域组件
└─ 区域组件：核心单元，具体逻辑实现都在这里

区域组件两种形式：
├─ 🟢 简单区域：XXXArea.[ext] 单文件（命名必须以Area结尾）
└─ 🔵 复杂区域：XXXArea/ 文件夹（内含完整结构）
```

### Modules 模块结构（含布局模板）

```
src/modules/
│
├─ {ModuleName}/                         # 业务功能模块
│   │
│   ├─ api/                              # 模块级API（对应STEP 1的接口）
│   │   ├─ apiGetConfig.ts
│   │   ├─ apiGetList.ts
│   │   └─ apiPostAction.ts
│   │
│   ├─ stores/                           # 模块级状态
│   ├─ hooks/                            # 模块级Hooks
│   │
│   │   ┌─────────────────────────────────────────────────────────────┐
│   │   │  📱 页面 [L1] - {PageName}/index.[ext]                       │
│   │   ├─────────────────────────────────────────────────────────────┤
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  {HeaderArea} [L2]                                   │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  {TabArea} [L2] (可选)                               │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  {ContentArea} [L2]                                 │   │
│   │   │  │    └── {ItemComponent} [L3] x N                     │   │ flex:1
│   │   │  └─────────────────────────────────────────────────────┘   │ 可滚动
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  {FooterArea} [L2] (可选)                            │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  布局: flex-col | 组合 L2 区域                              │
│   │   └─────────────────────────────────────────────────────────────┘
│   │
│   ├─ {PageName}/                       # 页面文件夹
│   │   │
│   │   ├─ index.[ext]                   # 页面主文件 [L1]
│   │   ├─ api/                          # 页面级API（可选）
│   │   ├─ hooks/                        # 页面级Hooks（可选）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - {HeaderArea}.[ext]                   │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌────┐      ┌──────────────┐      ┌────┐              │
│   │   │   │  │ ← │      │    {标题}     │      │ ⋮ │              │
│   │   │   │  └────┘      └──────────────┘      └────┘              │
│   │   │   │  [TL]            [TC]              [TR]                │
│   │   │   │  布局: flex-row, space-between | 高度: 固定              │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ {HeaderArea}.[ext]            # 🟢 简单区域（单文件）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - {TabArea}.[ext]                      │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │     ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐            │
│   │   │   │     │Tab 1 │  │Tab 2 │  │Tab 3 │  │Tab N │            │
│   │   │   │     │ ━━━  │  │      │  │      │  │      │            │
│   │   │   │     └──────┘  └──────┘  └──────┘  └──────┘            │
│   │   │   │     [选中]    [默认]    [默认]    [默认]               │
│   │   │   │  布局: flex-row, center, gap-{N}px | 高度: 固定          │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ {TabArea}.[ext]               # 🟢 简单区域（单文件）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 复杂区域 [L2] - {ContentArea}/                       │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌──────────────┐  ┌──────────────┐                    │
│   │   │   │  │  ┌────────┐  │  │  ┌────────┐  │                    │
│   │   │   │  │  │  媒体   │  │  │  │  媒体   │  │                    │
│   │   │   │  │  └────────┘  │  │  └────────┘  │                    │
│   │   │   │  │  {文本内容}   │  │  {文本内容}   │  ... x N           │
│   │   │   │  │  👤 昵称 ❤️  │  │  👤 昵称 ❤️  │                    │
│   │   │   │  └──────────────┘  └──────────────┘                    │
│   │   │   │       [L3]              [L3]                           │
│   │   │   │  布局: grid-cols-{N}, gap-{N}px | 滚动: scroll-y         │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   └─ {ContentArea}/                # 🔵 复杂区域（文件夹）
│   │       │
│   │       ├─ index.[ext]               # 区域主文件
│   │       ├─ types.[ext]               # 类型定义
│   │       ├─ constants.[ext]           # 常量
│   │       ├─ use{ContentArea}.[ext]    # 状态管理Hook
│   │       │
│   │       │   ┌─────────────────────────────────────────────────────┐
│   │       │   │  🧩 子组件 [L3] - {ItemComponent}/                   │
│   │       │   ├─────────────────────────────────────────────────────┤
│   │       │   │  ┌─────────────────────────────────────────────┐   │
│   │       │   │  │  ┌─────────────────────────────────────┐   │   │
│   │       │   │  │  │           {媒体区域}                 │   │   │
│   │       │   │  │  │           [可带角标]                 │   │   │
│   │       │   │  │  └─────────────────────────────────────┘   │   │
│   │       │   │  │  ┌─────────────────────────────────────┐   │   │
│   │       │   │  │  │           {文本区域}                 │   │   │
│   │       │   │  │  └─────────────────────────────────────┘   │   │
│   │       │   │  │  ┌─────────────────────────────────────┐   │   │
│   │       │   │  │  │  {用户}              {操作}          │   │   │
│   │       │   │  │  └─────────────────────────────────────┘   │   │
│   │       │   │  └─────────────────────────────────────────────┘   │
│   │       │   │  布局: flex-col | 复用: 1模板 x N实例                │
│   │       │   └─────────────────────────────────────────────────────┘
│   │       │
│   │       └─ {ItemComponent}/          # 子组件文件夹 [L3]
│   │           ├─ index.[ext]           # 子组件主文件
│   │           ├─ types.[ext]           # 类型（可选）
│   │           └─ on{Action}.[ext]      # 事件处理（可选）
│   │
│   │   ┌─────────────────────────────────────────────────────────────┐
│   │   │  🔄 共享组件 [L4] - SharedComponents/                        │
│   │   ├─────────────────────────────────────────────────────────────┤
│   │   │                                                             │
│   │   │  特点: 跨页面复用 | 高度可配置 | 样式可定制                   │
│   │   │                                                             │
│   │   │  常见组件:                                                   │
│   │   │  ├── Button/    Avatar/    Badge/    Modal/                 │
│   │   │  ├── Toast/     Loading/   Empty/    Card/                  │
│   │   │  └── TabBar/    List/      Input/    ...                    │
│   │   │                                                             │
│   │   └─────────────────────────────────────────────────────────────┘
│   │
│   ├─ SharedComponents/                 # 模块共享组件 [L4]
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔄 TabBar/ [L4]                                         │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│   │   │   │  │   🏠    │ │   🔍    │ │   💬    │ │   👤    │      │
│   │   │   │  │  [🔴]   │ │         │ │  [🔴]   │ │         │      │
│   │   │   │  │  首页   │ │  发现   │ │  消息   │ │  我的   │      │
│   │   │   │  └─────────┘ └─────────┘ └─────────┘ └─────────┘      │
│   │   │   │  布局: flex-row, 均分 | 高度: 80px + 安全区              │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   └─ {ComponentName}/
│   │       ├─ index.[ext]
│   │       ├─ types.[ext]
│   │       └─ styles.[ext]
│   │
│   └─ index.[ext]                       # 模块入口
│
└─ Common/                               # 公共模块
    ├─ components/                       # 全局共享组件
    │   ├─ TabBar/
    │   └─ WaterfallList/
    └─ api/
        └─ apiGetTabbar.ts
```

### 布局模板快速参考

```
根据 UI 特征选择对应布局：

页面类型           L2区域组合                        主内容区布局
─────────────────────────────────────────────────────────────────────────
列表页            Header + [Tab] + Content + TabBar   grid-cols-N / flex-col
详情页            Header + Content + ActionBar        flex-col, scroll-y
表单页            Header + Form + ActionBar           flex-col, gap-{N}px
聚合页            Header + 多Section + TabBar         flex-col, 各Section独立

子组件类型         布局模式
─────────────────────────────────────────────────────────────────────────
卡片组件           flex-col: 媒体 → 文本 → 信息行
列表项组件         flex-row: 左(固定) → 中(flex-1) → 右(固定)
表单项组件         flex-col: 标签 → 输入 → 错误提示
Tab项组件          flex-col, center: 图标 → 文字 → 角标(叠层)
```

### 文件命名规范
```
类型          命名格式                        示例
─────────────────────────────────────────────────────────
主组件        index.[ext]                     index.tsx
类型定义      types.[ext]                     types.ts
常量          constants.[ext]                 constants.ts
状态管理      use{Name}.[ext]                 useLoginArea.ts
事件处理      on{Name}[Action].[ext]          onPhoneChange.ts
导航          navigateTo{Target}.[ext]        navigateToProfile.ts
API接口       api{Name}[Action].[ext]         apiUserLogin.ts
数据处理      process{Name}[Data].[ext]       processUserData.ts
```

---

## 🗄️ STEP 6: 后端MVP设计

> **📌 目标**：从 STEP 1 的 JSON 契约反推最小可行后端，设计核心数据库表和实现逻辑
>
> **📤 产出**：
> - 核心数据库表设计（建表 SQL）
> - 核心 SQL 查询语句（列表查询、操作增删）
> - MVP 清单表（功能、涉及表、接口、优先级）
> - 性能优化检查点（索引、冗余、分页、缓存）

### 设计原则

```
MVP = Minimum Viable Product（最小可行产品）

核心原则：
├─ 只设计核心表，不过度设计
├─ 只实现必要字段，后续迭代增加
├─ 冗余计数字段（如like_count），避免频繁COUNT
├─ 先跑通流程，再优化性能
└─ 一个页面通常只需要 3-5 张表
```

### 从JSON契约推导数据库表

> **核心思路**：JSON响应中的每个对象/嵌套结构通常对应一张表，状态字段通常需要关系表。

```
STEP 1 的 JSON 响应              →     数据库表推导
─────────────────────────────────────────────────────────────
{
  "{relatedUser}": {             →     users 表（用户表几乎必需）
    "userId": "...",                   ├─ id
    "nickname": "...",                 ├─ nickname
    "avatar": "..."                    └─ avatar
  },
  "{主体字段1}": "...",          →     {主体}表
  "{主体字段2}": "...",                ├─ id
  "{countField}": 88,                  ├─ user_id (FK → users)
                                       ├─ {业务字段}...
                                       └─ {count}_count (冗余计数)
  "{statusField}": true/false    →     {关系}表（判断当前用户状态）
}                                      ├─ {主体}_id
                                       └─ user_id

推导规则：
├── 嵌套对象 → 独立表 + 外键关联
├── 计数字段 → 主体表冗余字段 + 关系表统计
├── 状态字段(is_xxx) → 关系表(当前用户与主体的关系)
└── 数组字段 → 子表 + 外键关联
```

### 数据库表模板

```sql
-- 用户表（几乎所有业务都需要）
CREATE TABLE users (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT,
    nickname    VARCHAR(50) NOT NULL COMMENT '昵称',
    avatar      VARCHAR(500) COMMENT '头像URL',
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT '用户表';

-- 内容/主体表（根据业务命名：contents, posts, products...）
CREATE TABLE {主体表名} (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id     BIGINT NOT NULL COMMENT '创建者ID',
    -- 业务字段...
    {count}_count INT UNSIGNED DEFAULT 0 COMMENT 'XX计数(冗余)',
    status      TINYINT DEFAULT 1 COMMENT '状态: 0=删除, 1=正常',
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at  DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_user_id (user_id),
    INDEX idx_status_created (status, created_at DESC)
) COMMENT '{主体}表';

-- 关系表（关注、点赞、收藏等）
CREATE TABLE {关系表名} (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT,
    {主体}_id   BIGINT NOT NULL,
    user_id     BIGINT NOT NULL,
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP,

    UNIQUE KEY uk_{关系} ({主体}_id, user_id),
    INDEX idx_user_id (user_id)
) COMMENT '{关系}表';
```

### 核心SQL模板

```sql
-- 列表查询（带关联用户信息 + 当前用户操作状态）
SELECT
    m.id,
    m.{业务字段},
    m.{count}_count,
    m.created_at,
    -- 关联用户
    u.id AS author_id,
    u.nickname AS author_nickname,
    u.avatar AS author_avatar,
    -- 当前用户是否已操作（点赞/收藏/关注）
    IF(r.id IS NOT NULL, 1, 0) AS is_{action}
FROM {主体表} m
INNER JOIN users u ON m.user_id = u.id
-- 可选：筛选条件（如只查关注的人）
-- INNER JOIN follows f ON m.user_id = f.following_id AND f.follower_id = #{currentUserId}
LEFT JOIN {关系表} r ON m.id = r.{主体}_id AND r.user_id = #{currentUserId}
WHERE m.status = 1
ORDER BY m.created_at DESC
LIMIT #{pageSize} OFFSET #{offset};

-- 操作：新增关系
INSERT INTO {关系表} ({主体}_id, user_id) VALUES (#{id}, #{userId});
UPDATE {主体表} SET {count}_count = {count}_count + 1 WHERE id = #{id};

-- 操作：删除关系
DELETE FROM {关系表} WHERE {主体}_id = #{id} AND user_id = #{userId};
UPDATE {主体表} SET {count}_count = GREATEST({count}_count - 1, 0) WHERE id = #{id};
```

### 后端MVP清单模板

```
| 序号 | 功能 | 涉及表 | 接口 | 优先级 |
|------|------|--------|------|--------|
| 1 | 列表查询 | users, {主体表} | GET /list | P0 |
| 2 | 操作功能 | {关系表} | POST /action | P0 |
| 3 | 分页加载 | - | query params | P0 |
| 4 | 状态判断 | {关系表} | 列表返回 | P0 |

MVP统计：{N}张表 + {M}个接口 = 最小可行后端
```

### 性能优化检查点

```
□ 索引：主要查询字段是否有索引？
□ 冗余：频繁COUNT的字段是否冗余存储？
□ 分页：是否使用LIMIT OFFSET？（大数据量需改游标分页）
□ N+1：是否存在循环查询？（改为JOIN或批量查询）
□ 缓存：热点数据是否缓存？（用户信息、配置信息）
```

---

## 📱 响应式规格

```
手机: 320-428px  │ grid-cols-1/2 │ gap-8-12px │ 14-16sp
平板: 768-1024px │ grid-cols-2/3 │ gap-12-16px │ 16-18sp
桌面: 1280px+    │ grid-cols-3/4 │ gap-16-24px │ 18-20sp
```

---

## 💡 快速参考

### 描述流程
```
1. 层级 [L1/L2/L3]
2. 位置 [R1-C2] 或 [位置:TL]
3. 布局 [布局:flex-row]
4. 尺寸 [尺寸:48x48px]
5. 样式 (白色+圆角12px)
6. 相对 [↗️XXX右上角]
7. 数据 [data:fieldName]  ← 新增
8. 交互 点击→跳转
9. 复用 ← 复用XXX
```

### 常用位置
```
返回按钮: [位置:TL] [R2-C1]
页面标题: [位置:TC] [R2-居中]
操作按钮: [位置:TR] [R2-C-Last]
用户头像: [位置:行首] [flex:固定48px]
时间戳:   [位置:行末] [⬇️标题下方]
未读角标: [↗️头像右上角, 偏移:-4px]
底部导航: [R-Last-全行] [固定底部]
```

---

## 🎯 期望效果

### 输入 UI 图后可实现
```
✅ 完整的JSON数据契约（前后端对齐）          ← 新增
✅ 完整的页面结构树状图（层级清晰、数据绑定）
✅ 精准的组件拆分方案（L1/L2/L3三层）
✅ 详细的布局定位描述（九宫格、行列、可视化图）
✅ 清晰的用户操作流程图（入口、路径、状态）
✅ 规范的代码文件结构（模块→页面→区域组件）
✅ 最小可行后端设计（表结构、SQL、接口实现）  ← 新增
```

### 质量评估标准
```
评分维度              优秀(9-10)              良好(7-8)           合格(5-6)
─────────────────────────────────────────────────────────────────────────────
JSON契约      接口完整+字段绑定UI     接口完整            主要接口有定义
结构完整性    所有元素都有层级标注    90%元素有标注       主要元素有标注
数据绑定      所有动态数据有标注      主要数据有标注      有部分标注
位置精确度    精确到像素和间距        有行列和九宫格      有大致位置
组件拆分      L1/L2/L3清晰合理        层级基本清晰        有基本拆分
复用标记      模板和实例标记完整      主要复用有标记      有部分标记
交互描述      所有交互都有描述        主要交互有描述      有基本交互
代码映射      完整对应文件结构        主要组件有映射      有基本映射
后端MVP       表+SQL+接口完整         有表结构和接口      有基本设计
```

### 综合评分目标
```
🎯 目标分数：8分以上

达到8分标准：
├─ JSON契约覆盖所有接口，字段与UI绑定清晰
├─ 树状图覆盖所有可见元素，标注数据来源
├─ 每个元素都有位置和尺寸描述
├─ 组件拆分层级清晰（L1→L2→L3）
├─ 复用关系标记完整
├─ 交互流程描述清晰，与接口对应
├─ 代码结构可直接指导开发
└─ 后端MVP可直接建表和实现接口
```

---

## 📝 完整输出模板

当收到UI图时，按以下顺序输出：

```markdown
# 🌳 [页面名称] 结构指导文档

> **页面名称：** XXX
> **所属模块：** XXX
> **页面类型：** 列表页/详情页/表单页

---

## 📋 STEP 1: JSON数据契约

[接口列表JSON]

### 接口汇总表
| 序号 | 接口名 | 方法 | 路径 | 触发时机 |

---

## 🔄 STEP 2: 流程图

[用户操作流程 - 与接口调用对应]

---

## 🌳 STEP 3: 树状图

[带数据绑定的树状图]

---

## 📍 STEP 4: 布局定位

[可视化布局图]

---

## 📁 STEP 5: 代码结构

[文件夹结构]

---

## 🗄️ STEP 6: 后端MVP

### 数据库表设计
[建表SQL]

### 核心SQL查询
[查询SQL]

### MVP清单
| 序号 | 功能 | 涉及表 | 接口 | 优先级 |

---

## 🎯 质量评估

| 维度 | 评分 | 说明 |
```

---

*v5.2 - JSON契约优先 + 六步法 + 后端MVP = 完整开发指导*

*v5.2更新：*
- *通用化改造：将具体示例改为`{占位符}`格式，适用于任意业务场景*
- *新增多场景示例：列表页、表单页、详情页的JSON绑定示例*
- *树状图增加三种模式：网格列表、垂直列表、表单*
- *条件字段标注改为通用模式说明*
- *修正Features→Modules命名一致性*
