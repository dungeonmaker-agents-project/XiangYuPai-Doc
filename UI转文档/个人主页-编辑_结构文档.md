# 🌳 个人主页-编辑 结构指导文档

> **页面名称：** 个人资料编辑页
> **所属模块：** User（用户模块）
> **页面类型：** 表单页

---

## 📋 STEP 1: 页面数据模型

### PageModel

```json
{
  "模型信息": {
    "页面名称": "个人资料编辑页",
    "页面标识": "ProfileEditPage",
    "所属模块": "User",
    "页面类型": "表单页"
  },

  "数据依赖图": "{ProfileData} → 渲染表单 → 用户编辑 → {UpdateResult}",

  "PageModel": {
    "_说明": "页面级数据模型 [L1]，组合所有区域数据",

    "HeaderData": {
      "_说明": "头部区域数据 → [→HeaderArea]",
      "title": "String - 页面标题 - [UI:HeaderArea.标题] 固定值:'个人资料'"
    },

    "AvatarData": {
      "_说明": "头像区域数据 → [→AvatarArea]",
      "avatarUrl": "String - 头像URL - [UI:AvatarArea.头像图片]"
    },

    "BasicInfoData": {
      "_说明": "基本资料区域数据 → [→BasicInfoArea]",
      "nickname": "String - 昵称 - [UI:BasicInfoArea.昵称项.值] [限制:20字]",
      "gender": "String?(male|female) - 性别 - [UI:BasicInfoArea.性别项.值] [格式:male→男,female→女,null→暂未选择]",
      "bio": "String? - 个人介绍 - [UI:BasicInfoArea.个人介绍项.值] [限制:30字] [条件:超出省略显示]",
      "birthday": "String?(YYYY-MM-DD) - 生日 - [UI:BasicInfoArea.生日项.值] [格式:YYYY-MM-DD]",
      "height": "Number? - 身高(cm) - [UI:BasicInfoArea.身高项.值] [格式:Xcm] [条件:null→暂未选择]",
      "weight": "Number? - 体重(kg) - [UI:BasicInfoArea.体重项.值] [格式:Xkg] [条件:null→暂未选择]",
      "occupation": "Array<String>? - 职业 - [UI:BasicInfoArea.职业项.值] [格式:逗号分隔] [条件:空→暂未选择]",
      "location": "String? - 常居地 - [UI:BasicInfoArea.常居地项.值] [格式:城市名]",
      "wechat": "String? - 微信号 - [UI:BasicInfoArea.微信项.值]"
    },

    "PageState": {
      "_说明": "页面状态数据",
      "isLoading": "Boolean - 加载中 - [状态:骨架屏/Loading]",
      "isSaving": "Boolean - 保存中 - [状态:按钮Loading]",
      "isError": "Boolean - 加载失败 - [状态:错误提示]"
    }
  }
}
```

### ItemModel（编辑项模型）

```json
{
  "ItemModel": {
    "_说明": "表单项数据模型 [L3]",

    "ProfileFieldItem": {
      "_说明": "资料字段项 → [→FieldItem组件]",
      "fieldKey": "String - 字段标识 - [用于:更新接口参数key]",
      "label": "String - 字段名称 - [UI:FieldItem.标签]",
      "value": "String? - 字段值 - [UI:FieldItem.值] [条件:null→显示placeholder]",
      "placeholder": "String - 占位文案 - [UI:FieldItem.占位] 默认:'暂未选择'",
      "editType": "String(text|textarea|picker|actionSheet|tagInput|subPage) - 编辑类型 - [用于:决定编辑交互方式]",
      "maxLength": "Number? - 最大长度 - [验证:限制输入字数] [可选]",
      "hasArrow": "Boolean - 是否显示箭头 - [UI:FieldItem.箭头图标] 默认:true"
    },

    "PickerOption": {
      "_说明": "选择器选项 → [→Picker组件]",
      "value": "String|Number - 选项值 - [用于:提交数据]",
      "label": "String - 选项显示文本 - [UI:Picker.选项文字]"
    },

    "ActionSheetOption": {
      "_说明": "操作面板选项 → [→ActionSheet组件]",
      "key": "String - 选项标识 - [用于:事件处理]",
      "label": "String - 选项文案 - [UI:ActionSheet.选项文字]",
      "isDestructive": "Boolean? - 是否危险操作 - [样式:红色文字]"
    },

    "OccupationTag": {
      "_说明": "职业标签 → [→TagItem组件]",
      "name": "String - 职业名称 - [UI:TagItem.文字]",
      "canDelete": "Boolean - 是否可删除 - [UI:TagItem.删除按钮]"
    }
  }
}
```

### SharedModel

```json
{
  "SharedModel": {
    "_说明": "跨页面复用的数据模型 [L4]",

    "UpdateResult": {
      "_说明": "更新操作结果",
      "success": "Boolean - 是否成功",
      "message": "String? - 提示信息",
      "updatedField": "String? - 更新的字段名",
      "newValue": "Any? - 新值"
    },

    "UploadResult": {
      "_说明": "上传结果",
      "success": "Boolean - 是否成功",
      "url": "String? - 上传后的URL",
      "message": "String? - 错误信息"
    },

    "LocationData": {
      "_说明": "地区数据",
      "provinceCode": "String - 省份编码",
      "provinceName": "String - 省份名称",
      "cityCode": "String - 城市编码",
      "cityName": "String - 城市名称"
    }
  }
}
```

### 数据模型汇总

| 模型名 | 层级 | 对应组件 | 说明 |
|--------|------|----------|------|
| PageModel | L1 | ProfileEditPage | 页面级数据，组合所有区域 |
| HeaderData | L2 | HeaderArea | 导航头部数据 |
| AvatarData | L2 | AvatarArea | 头像区域数据 |
| BasicInfoData | L2 | BasicInfoArea | 基本资料表单数据 |
| ProfileFieldItem | L3 | FieldItem | 单个资料字段项 |
| PickerOption | L3 | Picker | 选择器选项 |
| ActionSheetOption | L3 | ActionSheet | 操作面板选项 |
| OccupationTag | L3 | TagItem | 职业标签项 |
| UpdateResult | L4 | - | 更新结果(共享) |
| UploadResult | L4 | - | 上传结果(共享) |

---

## 🔄 STEP 2: 流程图

```
开始
 ↓
【进入个人资料编辑页】
 ├─→ 路由跳转: /user/profile/edit
 └─→ 从个人主页点击"编辑资料"
 ↓
【页面初始化】
 │
 ├─→ 调用 [API:getProfile] → 获取用户资料
 │    └─→ 渲染 [→AvatarArea] + [→BasicInfoArea]
 │
 └─→ 调用 [API:getOptions] → 获取选项配置(可选，可缓存)
      └─→ 身高/体重范围、地区列表
 ↓
用户操作
 │
 ├─→ 【AvatarArea 头像操作】
 │    │
 │    └─→ 点击头像区域 [触发:AvatarArea]
 │         ├─→ 弹出ActionSheet [状态:AvatarActionSheet]
 │         │    ├─→ 选择"拍照" → 调用相机 → 获取图片
 │         │    ├─→ 选择"从手机相册选择" → 打开相册 → 获取图片
 │         │    ├─→ 选择"保存图片" → 保存当前头像到相册
 │         │    └─→ 选择"取消" → 关闭ActionSheet
 │         │
 │         └─→ 获取图片后
 │              ├─→ 调用 [API:uploadAvatar] → 上传头像
 │              ├─→ 成功 → 更新 [状态:AvatarArea] + Toast
 │              └─→ 失败 → Toast错误提示
 │
 ├─→ 【BasicInfoArea 文本输入类字段】(昵称/个人介绍)
 │    │
 │    ├─→ 点击昵称项 [触发:BasicInfoArea.昵称]
 │    │    ├─→ 跳转 → 【昵称编辑子页面】
 │    │    │    ├─→ 输入框 + 字数统计(X/20字)
 │    │    │    ├─→ 点击"完成" → 调用 [API:updateProfile] → 返回
 │    │    │    └─→ 点击"取消" → 返回不保存
 │    │    └─→ 返回后更新 [状态:BasicInfoArea.昵称]
 │    │
 │    └─→ 点击个人介绍项 [触发:BasicInfoArea.个人介绍]
 │         ├─→ 跳转 → 【个人介绍编辑子页面】
 │         │    ├─→ 多行输入框 + 字数统计(X/30字)
 │         │    ├─→ 点击"完成" → 调用 [API:updateProfile] → 返回
 │         │    └─→ 点击"取消" → 返回不保存
 │         └─→ 返回后更新 [状态:BasicInfoArea.个人介绍]
 │
 ├─→ 【BasicInfoArea ActionSheet类字段】(性别)
 │    │
 │    └─→ 点击性别项 [触发:BasicInfoArea.性别]
 │         ├─→ 弹出ActionSheet [状态:GenderActionSheet]
 │         │    ├─→ 选择"男" → gender='male'
 │         │    ├─→ 选择"女" → gender='female'
 │         │    └─→ 选择"取消" → 关闭
 │         ├─→ 调用 [API:updateProfile]
 │         └─→ 更新 [状态:BasicInfoArea.性别]
 │
 ├─→ 【BasicInfoArea Picker类字段】(生日/身高/体重/常居地)
 │    │
 │    ├─→ 点击生日项 [触发:BasicInfoArea.生日]
 │    │    ├─→ 弹出DatePicker [状态:BirthdayPicker]
 │    │    │    └─→ 年/月/日三列滚轮
 │    │    ├─→ 点击"确定" → 调用 [API:updateProfile]
 │    │    └─→ 点击"取消" → 关闭Picker
 │    │
 │    ├─→ 点击身高项 [触发:BasicInfoArea.身高]
 │    │    ├─→ 弹出Picker [状态:HeightPicker]
 │    │    │    └─→ 单列滚轮(XXcm)
 │    │    ├─→ 点击"确定" → 调用 [API:updateProfile]
 │    │    └─→ 点击"取消" → 关闭Picker
 │    │
 │    ├─→ 点击体重项 [触发:BasicInfoArea.体重]
 │    │    ├─→ 弹出Picker [状态:WeightPicker]
 │    │    │    └─→ 单列滚轮(XXkg)
 │    │    ├─→ 点击"确定" → 调用 [API:updateProfile]
 │    │    └─→ 点击"取消" → 关闭Picker
 │    │
 │    └─→ 点击常居地项 [触发:BasicInfoArea.常居地]
 │         ├─→ 弹出CityPicker [状态:LocationPicker]
 │         │    └─→ 省份/城市两列联动滚轮
 │         ├─→ 点击"确定" → 调用 [API:updateProfile]
 │         └─→ 点击"取消" → 关闭Picker
 │
 ├─→ 【BasicInfoArea 职业编辑】
 │    │
 │    └─→ 点击职业项 [触发:BasicInfoArea.职业]
 │         ├─→ 跳转 → 【职业编辑子页面】
 │         │    ├─→ 已选职业标签列表(可删除)
 │         │    ├─→ "添加职业"按钮 → 弹出输入/选择
 │         │    ├─→ 点击"完成" → 调用 [API:updateProfile] → 返回
 │         │    └─→ 点击"取消" → 返回不保存
 │         └─→ 返回后更新 [状态:BasicInfoArea.职业]
 │
 ├─→ 【BasicInfoArea 微信编辑】
 │    │
 │    └─→ 点击微信项 [触发:BasicInfoArea.微信]
 │         ├─→ 跳转 → 【微信编辑子页面】
 │         │    ├─→ 微信号输入框(带清除按钮)
 │         │    ├─→ 解锁微信设置项
 │         │    ├─→ 点击"完成" → 调用 [API:updateProfile] → 返回
 │         │    └─→ 点击"取消" → 返回不保存
 │         └─→ 返回后更新 [状态:BasicInfoArea.微信]
 │
 └─→ 【HeaderArea 导航操作】
      └─→ 点击返回按钮 [触发:HeaderArea.返回]
           └─→ 返回上一页(个人主页)
 ↓
【状态管理】
 ├─→ isLoading=true → 显示骨架屏/Loading
 ├─→ isSaving=true → 显示保存Loading
 └─→ isError=true → 显示错误提示 + 重试
 ↓
结束
```

### 流程-组件关联表

| 流程节点 | 触发组件 | 调用接口 | 影响组件 | 状态变化 |
|----------|----------|----------|----------|----------|
| 页面初始化 | - | getProfile | AvatarArea, BasicInfoArea | loading→loaded |
| 点击头像 | AvatarArea | - | AvatarActionSheet | 显示ActionSheet |
| 选择图片并上传 | AvatarActionSheet | uploadAvatar | AvatarArea | 头像更新 |
| 点击昵称 | BasicInfoArea | - | - | 跳转昵称编辑页 |
| 保存昵称 | NicknameEditPage | updateProfile | BasicInfoArea | 昵称更新 |
| 点击性别 | BasicInfoArea | - | GenderActionSheet | 显示ActionSheet |
| 选择性别 | GenderActionSheet | updateProfile | BasicInfoArea | 性别更新 |
| 点击生日 | BasicInfoArea | - | BirthdayPicker | 显示Picker |
| 确认生日 | BirthdayPicker | updateProfile | BasicInfoArea | 生日更新 |
| 点击身高 | BasicInfoArea | - | HeightPicker | 显示Picker |
| 确认身高 | HeightPicker | updateProfile | BasicInfoArea | 身高更新 |
| 点击体重 | BasicInfoArea | - | WeightPicker | 显示Picker |
| 确认体重 | WeightPicker | updateProfile | BasicInfoArea | 体重更新 |
| 点击职业 | BasicInfoArea | - | - | 跳转职业编辑页 |
| 保存职业 | OccupationEditPage | updateProfile | BasicInfoArea | 职业更新 |
| 点击常居地 | BasicInfoArea | - | LocationPicker | 显示Picker |
| 确认常居地 | LocationPicker | updateProfile | BasicInfoArea | 常居地更新 |
| 点击微信 | BasicInfoArea | - | - | 跳转微信编辑页 |
| 保存微信 | WechatEditPage | updateProfile | BasicInfoArea | 微信更新 |
| 点击返回 | HeaderArea | - | - | 返回上一页 |

---

## 🌳 STEP 3: 树状图

```
【User模块】★★★
│
├── 【ProfileEditPage 个人资料编辑页】📱 [L1] [拆分:3个L2]
│   │   文件: ProfileEdit/index.tsx
│   │
│   ├── 📍 HeaderArea [L2] [固定顶部]
│   │   │   文件: HeaderArea.tsx
│   │   │   布局: flex-row, space-between, 高度:44px+状态栏
│   │   │
│   │   ├── 《BackButton》[L3] [位置:TL]
│   │   │   └── ← 返回图标 [点击→返回上一页]
│   │   │
│   │   └── 《Title》[L3] [位置:TC]
│   │       └── "个人资料" [data:HeaderData.title] [样式:17sp,#000,粗体]
│   │
│   ├── 🏷️ AvatarArea [L2] [白色背景卡片]
│   │   │   文件: AvatarArea.tsx
│   │   │   布局: flex-row, space-between, padding:16px
│   │   │
│   │   ├── 《Label》[L3] [位置:ML]
│   │   │   └── "头像" [样式:16sp,#333]
│   │   │
│   │   └── 《AvatarWithArrow》[L3] [位置:MR]
│   │       ├── 头像图片 [data:AvatarData.avatarUrl] [尺寸:56x56px,圆形]
│   │       └── > 箭头图标 [样式:#999]
│   │       └── [点击→弹出AvatarActionSheet]
│   │
│   └── 🏷️ BasicInfoArea [L2] [flex:1, 可滚动]
│       │   文件: BasicInfoArea/
│       │   │   ├── index.tsx
│       │   │   ├── types.ts
│       │   │   └── FieldItem/
│       │   布局: flex-col, 白色背景卡片
│       │
│       ├── 《SectionTitle》[L3]
│       │   └── "基本资料" [样式:14sp,#666,padding:16px]
│       │
│       └── 📋 FieldList [布局:flex-col]
│           │
│           ├── 《FieldItem》[L3] [1模板x10实例]
│           │   │   文件: FieldItem/index.tsx
│           │   │   布局: flex-row, space-between, padding:16px, 高度:56px
│           │   │
│           │   ├── Label [位置:ML]
│           │   │   └── [data:ProfileFieldItem.label] [样式:16sp,#333]
│           │   │
│           │   └── ValueWithArrow [位置:MR] [布局:flex-row,center]
│           │       ├── Value [data:ProfileFieldItem.value]
│           │       │   └── [样式:16sp,#999] [条件:null→显示placeholder]
│           │       └── > 箭头 [data:ProfileFieldItem.hasArrow]
│           │
│           │   实例列表:
│           │   ├── 昵称项 [label:"昵称"] [editType:subPage] [maxLength:20]
│           │   │   └── [data:BasicInfoData.nickname] [点击→跳转NicknameEditPage]
│           │   │
│           │   ├── 性别项 [label:"性别"] [editType:actionSheet]
│           │   │   └── [data:BasicInfoData.gender] [点击→弹出GenderActionSheet]
│           │   │
│           │   ├── 个人介绍项 [label:"个人介绍"] [editType:subPage] [maxLength:30]
│           │   │   └── [data:BasicInfoData.bio] [点击→跳转BioEditPage]
│           │   │
│           │   ├── 生日项 [label:"生日"] [editType:picker]
│           │   │   └── [data:BasicInfoData.birthday] [点击→弹出BirthdayPicker]
│           │   │
│           │   ├── 身高项 [label:"身高"] [editType:picker]
│           │   │   └── [data:BasicInfoData.height] [点击→弹出HeightPicker]
│           │   │
│           │   ├── 体重项 [label:"体重"] [editType:picker]
│           │   │   └── [data:BasicInfoData.weight] [点击→弹出WeightPicker]
│           │   │
│           │   ├── 职业项 [label:"职业"] [editType:subPage]
│           │   │   └── [data:BasicInfoData.occupation] [点击→跳转OccupationEditPage]
│           │   │
│           │   ├── 常居地项 [label:"常居地"] [editType:picker]
│           │   │   └── [data:BasicInfoData.location] [点击→弹出LocationPicker]
│           │   │
│           │   └── 微信项 [label:"微信"] [editType:subPage]
│           │       └── [data:BasicInfoData.wechat] [点击→跳转WechatEditPage]
│           │
│           └── 《Divider》[L3] [1模板x9实例]
│               └── 分割线 [高度:1px,#F5F5F5]
│
├── 【子页面群】📱
│   │
│   ├── 【NicknameEditPage 昵称编辑页】[L1]
│   │   │   文件: NicknameEdit/index.tsx
│   │   │   布局: flex-col, 全屏
│   │   │
│   │   ├── 📍 SubHeaderArea [L2] [固定顶部]
│   │   │   │   布局: flex-row, space-between
│   │   │   ├── "取消" [位置:TL] [点击→返回不保存]
│   │   │   ├── "昵称" [位置:TC] [样式:17sp,粗体]
│   │   │   └── "完成" [位置:TR] [样式:紫色] [点击→保存并返回]
│   │   │
│   │   └── 🏷️ InputArea [L2]
│   │       ├── 《TextInput》[L3]
│   │       │   └── [data:nickname] [单行输入] [带清除按钮]
│   │       └── 《CharCount》[L3]
│   │           └── "X/20字" [位置:BR] [样式:14sp,#999]
│   │
│   ├── 【BioEditPage 个人介绍编辑页】[L1]
│   │   │   文件: BioEdit/index.tsx
│   │   │   布局: 同NicknameEditPage
│   │   │
│   │   ├── 📍 SubHeaderArea [L2]
│   │   │   └── 标题:"个人介绍"
│   │   │
│   │   └── 🏷️ InputArea [L2]
│   │       ├── 《TextArea》[L3]
│   │       │   └── [data:bio] [多行输入]
│   │       └── 《CharCount》[L3]
│   │           └── "X/30字"
│   │
│   ├── 【OccupationEditPage 职业编辑页】[L1]
│   │   │   文件: OccupationEdit/index.tsx
│   │   │
│   │   ├── 📍 SubHeaderArea [L2]
│   │   │   └── 标题:"职业"
│   │   │
│   │   └── 🏷️ TagArea [L2]
│   │       │   布局: flex-row, flex-wrap, gap:12px
│   │       │
│   │       ├── 《OccupationTag》[L3] [1模板xN实例]
│   │       │   │   布局: flex-row, center, 圆角胶囊
│   │       │   ├── 职业名称 [data:OccupationTag.name]
│   │       │   └── × 删除按钮 [data:OccupationTag.canDelete]
│   │       │
│   │       └── 《AddButton》[L3]
│   │           └── "添加职业" + ⊕ [点击→添加新职业]
│   │
│   └── 【WechatEditPage 微信编辑页】[L1]
│       │   文件: WechatEdit/index.tsx
│       │
│       ├── 📍 SubHeaderArea [L2]
│       │   └── 标题:"微信"
│       │
│       └── 🏷️ FormArea [L2]
│           │   布局: flex-col, 白色卡片
│           │
│           ├── 《WechatInputItem》[L3]
│           │   ├── "微信" [label]
│           │   └── 输入框 [data:wechat] [带清除按钮]
│           │
│           └── 《UnlockWechatItem》[L3]
│               ├── "解锁微信" [label]
│               └── "暂未设置" / 已设置状态 [value]
│
├── 【弹出组件】🔲
│   │
│   ├── 《AvatarActionSheet》[L3] ← 复用ActionSheet
│   │   │   文件: Common/components/ActionSheet/
│   │   │   布局: 底部弹出, 圆角顶部
│   │   │
│   │   ├── 选项列表 [布局:flex-col]
│   │   │   ├── "拍照" [点击→打开相机]
│   │   │   ├── "从手机相册选择" [点击→打开相册]
│   │   │   └── "保存图片" [点击→保存到相册]
│   │   │
│   │   └── "取消" [分隔样式] [点击→关闭]
│   │
│   ├── 《GenderActionSheet》[L3] ← 复用ActionSheet
│   │   ├── "男" [点击→gender='male']
│   │   ├── "女" [点击→gender='female']
│   │   └── "取消"
│   │
│   ├── 《BirthdayPicker》[L3] ← 复用DatePicker
│   │   │   文件: Common/components/DatePicker/
│   │   │   布局: 底部弹出
│   │   │
│   │   ├── Header [布局:flex-row, space-between]
│   │   │   ├── "取消" [位置:TL]
│   │   │   ├── "生日" [位置:TC]
│   │   │   └── "确定" [位置:TR] [样式:紫色]
│   │   │
│   │   └── PickerColumns [布局:flex-row]
│   │       ├── 年份列 [YYYY年]
│   │       ├── 月份列 [M月]
│   │       └── 日期列 [D日]
│   │
│   ├── 《HeightPicker》[L3] ← 复用Picker
│   │   │   文件: Common/components/Picker/
│   │   │
│   │   ├── Header
│   │   │   └── 标题:"身高"
│   │   └── PickerColumn [单列]
│   │       └── XXXcm [范围:140-220cm]
│   │
│   ├── 《WeightPicker》[L3] ← 复用Picker
│   │   ├── Header
│   │   │   └── 标题:"体重"
│   │   └── PickerColumn [单列]
│   │       └── XXkg [范围:30-150kg]
│   │
│   └── 《LocationPicker》[L3] ← 复用CityPicker
│       │   文件: Common/components/CityPicker/
│       │
│       ├── Header
│       │   └── 标题:"常居地"
│       └── PickerColumns [布局:flex-row] [联动]
│           ├── 省份列
│           └── 城市列
│
└── 🔧 服务层（对应 STEP 6 的接口）
    ├── 📡 GET /api/user/profile         → 获取用户资料 [→ PageModel]
    ├── 📡 PUT /api/user/profile         → 更新用户资料 [→ UpdateResult]
    ├── 📡 POST /api/user/avatar/upload  → 上传头像 [→ UploadResult]
    └── 📡 GET /api/common/regions       → 获取地区数据 [→ LocationData[]]
```

### 列表控制（表单页特有）

```
🔄 FormControl [适用于 BasicInfoArea]
├── 即时保存: 每个字段编辑完成后立即调用更新接口
├── 乐观更新: 先更新UI，失败后回滚
├── 字段校验: 提交前校验字数限制等
└── 加载状态: 保存时显示Loading指示器
```

---

## 📍 STEP 4: 布局定位

### 页面整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│  📱 ProfileEditPage [L1]                                        │
│  布局: flex-col | 背景: #F5F5F5                                  │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  HeaderArea [L2] [固定顶部]                               │   │
│  │  ┌────┐        ┌──────────────┐                         │   │
│  │  │ ← │        │   个人资料    │                          │   │
│  │  └────┘        └──────────────┘                         │   │
│  │  [TL]              [TC]                                  │   │
│  │  布局: flex-row, space-between | 高度: 44px+SafeArea      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  AvatarArea [L2] [白色卡片]                               │   │
│  │  ┌────────┐                          ┌──────┐  ┌──┐     │   │
│  │  │  头像   │                          │ 🖼️  │  │ > │     │   │
│  │  └────────┘                          │ 56px │  └──┘     │   │
│  │  [ML]                                └──────┘  [MR]     │   │
│  │  布局: flex-row, space-between | padding: 16px           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  BasicInfoArea [L2] [白色卡片] [flex:1, scroll-y]        │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │  基本资料 [SectionTitle]                          │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │  昵称            门前游过一群鸭  >                 │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  性别                  暂未选择  >                 │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  个人介绍      这里是个人介绍这里是...  >          │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  生日               1999-09-29  >                 │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  身高                  暂未选择  >                 │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  体重                  暂未选择  >                 │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  职业                  暂未选择  >                 │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  常居地                    深圳  >                 │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  微信            213438647210  >                  │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │  布局: flex-col | FieldItem高度: 56px                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### FieldItem 布局详图

```
┌─────────────────────────────────────────────────────────────────┐
│  FieldItem [L3]                                                 │
│  布局: flex-row, space-between, align-center                    │
│  尺寸: 宽度:100%, 高度:56px, padding:0 16px                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────┐                        ┌────────────────┐ ┌────┐  │
│  │   Label  │                        │     Value      │ │  > │  │
│  │  16sp    │                        │  16sp #999     │ │ 箭头│  │
│  │  #333    │                        │  右对齐 省略    │ └────┘  │
│  └──────────┘                        └────────────────┘         │
│  [flex:固定]                          [flex:1]         [固定]    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### ActionSheet 布局详图

```
┌─────────────────────────────────────────────────────────────────┐
│  Overlay [全屏遮罩] [背景:rgba(0,0,0,0.5)]                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                                                                  │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  ActionSheet [底部弹出] [圆角顶部:12px]                    │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │               拍照                               │    │    │ 高度:56px
│  │  ├─────────────────────────────────────────────────┤    │    │
│  │  │           从手机相册选择                          │    │    │ 高度:56px
│  │  ├─────────────────────────────────────────────────┤    │    │
│  │  │              保存图片                            │    │    │ 高度:56px
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  [间隔:8px]                                             │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │               取消                               │    │    │ 高度:56px
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  布局: flex-col, center | 底部安全区                     │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

### Picker 布局详图

```
┌─────────────────────────────────────────────────────────────────┐
│  Overlay [全屏遮罩]                                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Picker [底部弹出]                                        │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │  ┌────────┐    ┌──────────┐    ┌────────┐      │    │    │
│  │  │  │  取消   │    │   生日    │    │  确定   │      │    │    │
│  │  │  │ #333   │    │   标题    │    │  紫色   │      │    │    │
│  │  │  └────────┘    └──────────┘    └────────┘      │    │    │
│  │  │  [TL]            [TC]           [TR]            │    │    │
│  │  │  Header: flex-row, space-between | 高度:44px     │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │  ┌─────────┐  ┌─────────┐  ┌─────────┐         │    │    │
│  │  │  │ 1998年  │  │   8月   │  │  19日   │         │    │    │
│  │  │  │ 1999年  │  │   9月   │  │  20日   │  ← 选中 │    │    │
│  │  │  │ 2000年  │  │  10月   │  │  21日   │         │    │    │
│  │  │  └─────────┘  └─────────┘  └─────────┘         │    │    │
│  │  │  PickerColumns: flex-row, 均分 | 高度:216px      │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  布局: flex-col | 底部安全区                             │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

### 子页面（文本编辑）布局详图

```
┌─────────────────────────────────────────────────────────────────┐
│  📱 NicknameEditPage / BioEditPage [L1]                         │
│  布局: flex-col | 背景: #F5F5F5                                  │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  SubHeaderArea [L2] [固定顶部]                            │   │
│  │  ┌────────┐    ┌──────────┐    ┌────────┐              │   │
│  │  │  取消   │    │   昵称    │    │  完成   │              │   │
│  │  │ #333   │    │   标题    │    │  紫色   │              │   │
│  │  └────────┘    └──────────┘    └────────┘              │   │
│  │  [TL]            [TC]           [TR]                    │   │
│  │  布局: flex-row, space-between | 高度: 44px+SafeArea      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  InputArea [L2] [白色背景]                                │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │  门前游过一群鸭                            ⊗    │    │   │
│  │  │  [TextInput/TextArea]                 [清除按钮] │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │                                        ┌────────────┐   │   │
│  │                                        │   7/20字   │   │   │
│  │                                        │  [BR]#999  │   │   │
│  │                                        └────────────┘   │   │
│  │  布局: flex-col | padding: 16px                          │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 职业编辑页布局详图

```
┌─────────────────────────────────────────────────────────────────┐
│  📱 OccupationEditPage [L1]                                     │
│  布局: flex-col | 背景: #F5F5F5                                  │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  SubHeaderArea [L2]                                       │   │
│  │  取消           职业           完成                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  TagArea [L2] [白色背景] [flex:1]                         │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │  ┌─────────────┐   ┌─────────────────┐          │    │   │
│  │  │  │  模特    ⊗  │   │  添加职业    ⊕  │          │    │   │
│  │  │  │ [已选标签]   │   │  [添加按钮]     │          │    │   │
│  │  │  └─────────────┘   └─────────────────┘          │    │   │
│  │  │  布局: flex-row, flex-wrap, gap:12px              │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │  padding: 16px                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 微信编辑页布局详图

```
┌─────────────────────────────────────────────────────────────────┐
│  📱 WechatEditPage [L1]                                         │
│  布局: flex-col | 背景: #F5F5F5                                  │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  SubHeaderArea [L2]                                       │   │
│  │  取消           微信           完成                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  FormArea [L2] [白色卡片]                                 │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │  微信                    sunny0713    ⊗         │    │   │ 高度:56px
│  │  │  [Label]                 [Input]    [清除]       │    │   │
│  │  ├─────────────────────────────────────────────────┤    │   │
│  │  │  解锁微信                        暂未设置        │    │   │ 高度:56px
│  │  │  [Label]                         [Value]        │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │  布局: flex-col | 圆角:12px                              │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📁 STEP 5: 代码结构

```
src/modules/
│
├─ User/                                    # 用户模块
│   │
│   ├─ api/                                 # 模块级API
│   │   ├─ apiGetProfile.ts                 # 获取用户资料
│   │   ├─ apiUpdateProfile.ts              # 更新用户资料
│   │   └─ apiUploadAvatar.ts               # 上传头像
│   │
│   ├─ stores/                              # 模块级状态
│   │   └─ useUserStore.ts                  # 用户状态管理
│   │
│   ├─ hooks/                               # 模块级Hooks
│   │   └─ useUserProfile.ts                # 用户资料Hook
│   │
│   │   ┌─────────────────────────────────────────────────────────────┐
│   │   │  📱 主页面 [L1] - ProfileEdit/index.tsx                      │
│   │   ├─────────────────────────────────────────────────────────────┤
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  HeaderArea [L2]                                     │   │
│   │   │  │  ← 返回            个人资料                           │   │
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  AvatarArea [L2]                                     │   │
│   │   │  │  头像                                    [🖼️] >      │   │
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  BasicInfoArea [L2]                                  │   │
│   │   │  │  基本资料                                             │   │
│   │   │  │  ────────────────────────────────────────────        │   │
│   │   │  │  昵称             门前游过一群鸭  >                    │   │
│   │   │  │  性别                   暂未选择  >                    │   │
│   │   │  │  ...                                                  │   │
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  布局: flex-col                                            │
│   │   └─────────────────────────────────────────────────────────────┘
│   │
│   ├─ ProfileEdit/                         # 个人资料编辑页 [L1]
│   │   │
│   │   ├─ index.tsx                        # 页面主文件
│   │   ├─ types.ts                         # 类型定义
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - HeaderArea.tsx                       │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌────┐        ┌──────────────┐                        │
│   │   │   │  │ ← │        │   个人资料    │                         │
│   │   │   │  └────┘        └──────────────┘                        │
│   │   │   │  布局: flex-row, space-between                          │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ HeaderArea.tsx                   # 🟢 导航头部区域
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - AvatarArea.tsx                       │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  头像                                    [🖼️] >         │
│   │   │   │  布局: flex-row, space-between                          │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ AvatarArea.tsx                   # 🟢 头像区域
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 复杂区域 [L2] - BasicInfoArea/                       │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  基本资料                                                │
│   │   │   │  ┌──────────────────────────────────────────────┐       │
│   │   │   │  │  FieldItem [L3] x 10                          │       │
│   │   │   │  │  昵称 / 性别 / 个人介绍 / 生日 / 身高 /        │       │
│   │   │   │  │  体重 / 职业 / 常居地 / 微信                   │       │
│   │   │   │  └──────────────────────────────────────────────┘       │
│   │   │   │  布局: flex-col | scroll-y                              │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   └─ BasicInfoArea/                   # 🔵 基本资料区域（复杂）
│   │       │
│   │       ├─ index.tsx                    # 区域主文件
│   │       ├─ types.ts                     # 类型定义
│   │       ├─ useBasicInfoArea.ts          # 状态管理Hook
│   │       │
│   │       │   ┌─────────────────────────────────────────────────────┐
│   │       │   │  🧩 子组件 [L3] - FieldItem/                         │
│   │       │   ├─────────────────────────────────────────────────────┤
│   │       │   │  ┌────────────────────────────────────────────┐    │
│   │       │   │  │  {Label}                    {Value}   >    │    │
│   │       │   │  └────────────────────────────────────────────┘    │
│   │       │   │  布局: flex-row, space-between                      │
│   │       │   └─────────────────────────────────────────────────────┘
│   │       │
│   │       └─ FieldItem/                   # 字段项组件 [L3]
│   │           ├─ index.tsx
│   │           └─ types.ts
│   │
│   ├─ NicknameEdit/                        # 昵称编辑页 [L1]
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  📱 子页面 - NicknameEdit/index.tsx                      │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  取消          昵称          完成                        │
│   │   │   │  ┌──────────────────────────────────────────────┐       │
│   │   │   │  │  门前游过一群鸭                          ⊗   │       │
│   │   │   │  └──────────────────────────────────────────────┘       │
│   │   │   │                                         7/20字          │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ index.tsx
│   │   └─ types.ts
│   │
│   ├─ BioEdit/                             # 个人介绍编辑页 [L1]
│   │   ├─ index.tsx
│   │   └─ types.ts
│   │
│   ├─ OccupationEdit/                      # 职业编辑页 [L1]
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  📱 子页面 - OccupationEdit/index.tsx                    │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  取消          职业          完成                        │
│   │   │   │  ┌────────────┐  ┌──────────────────┐                  │
│   │   │   │  │ 模特   ⊗  │  │  添加职业    ⊕  │                  │
│   │   │   │  └────────────┘  └──────────────────┘                  │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ index.tsx
│   │   ├─ types.ts
│   │   └─ TagItem/                         # 职业标签组件 [L3]
│   │       └─ index.tsx
│   │
│   ├─ WechatEdit/                          # 微信编辑页 [L1]
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  📱 子页面 - WechatEdit/index.tsx                        │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  取消          微信          完成                        │
│   │   │   │  ┌──────────────────────────────────────────────┐       │
│   │   │   │  │  微信                    sunny0713    ⊗     │       │
│   │   │   │  ├──────────────────────────────────────────────┤       │
│   │   │   │  │  解锁微信                      暂未设置       │       │
│   │   │   │  └──────────────────────────────────────────────┘       │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ index.tsx
│   │   └─ types.ts
│   │
│   └─ index.ts                             # 模块入口
│
└─ Common/                                  # 公共模块
    │
    ├─ components/                          # 全局共享组件 [L4]
    │   │
    │   │   ┌─────────────────────────────────────────────────────────┐
    │   │   │  🔄 ActionSheet/ [L4]                                    │
    │   │   ├─────────────────────────────────────────────────────────┤
    │   │   │  底部弹出操作面板                                         │
    │   │   │  ┌──────────────────────────────────────────────┐       │
    │   │   │  │  选项1                                        │       │
    │   │   │  │  选项2                                        │       │
    │   │   │  │  选项3                                        │       │
    │   │   │  ├──────────────────────────────────────────────┤       │
    │   │   │  │  取消                                         │       │
    │   │   │  └──────────────────────────────────────────────┘       │
    │   │   └─────────────────────────────────────────────────────────┘
    │   │
    │   ├─ ActionSheet/
    │   │   ├─ index.tsx
    │   │   └─ types.ts
    │   │
    │   │   ┌─────────────────────────────────────────────────────────┐
    │   │   │  🔄 Picker/ [L4]                                         │
    │   │   ├─────────────────────────────────────────────────────────┤
    │   │   │  取消        标题        确定                            │
    │   │   │  ┌──────────────────────────────────────────────┐       │
    │   │   │  │  │  选项1  │  选项A  │  选项X  │              │       │
    │   │   │  │  │  选项2  │  选项B  │  选项Y  │  ← 选中     │       │
    │   │   │  │  │  选项3  │  选项C  │  选项Z  │              │       │
    │   │   │  └──────────────────────────────────────────────┘       │
    │   │   └─────────────────────────────────────────────────────────┘
    │   │
    │   ├─ Picker/
    │   │   ├─ index.tsx
    │   │   ├─ PickerColumn.tsx
    │   │   └─ types.ts
    │   │
    │   ├─ DatePicker/                      # 日期选择器
    │   │   ├─ index.tsx
    │   │   └─ types.ts
    │   │
    │   ├─ CityPicker/                      # 城市选择器
    │   │   ├─ index.tsx
    │   │   └─ types.ts
    │   │
    │   ├─ TextInput/                       # 文本输入框
    │   │   ├─ index.tsx
    │   │   └─ types.ts
    │   │
    │   ├─ TextArea/                        # 多行文本输入
    │   │   ├─ index.tsx
    │   │   └─ types.ts
    │   │
    │   └─ Toast/                           # 轻提示
    │       └─ index.tsx
    │
    └─ api/
        └─ apiGetRegions.ts                 # 获取地区数据
```

### 文件命名规范

| 类型 | 命名格式 | 示例 |
|------|----------|------|
| 主组件 | index.tsx | ProfileEdit/index.tsx |
| 类型定义 | types.ts | ProfileEdit/types.ts |
| 状态管理 | use{Name}.ts | useBasicInfoArea.ts |
| API接口 | api{Action}.ts | apiUpdateProfile.ts |
| 区域组件 | {Name}Area.tsx | HeaderArea.tsx |
| 子组件 | {Name}/index.tsx | FieldItem/index.tsx |

---

## 🗄️ STEP 6: 接口实现与后端设计

### 接口定义

```json
{
  "接口文档信息": {
    "对应页面": "ProfileEditPage",
    "对应数据模型": "STEP 1 → PageModel",
    "版本": "v1.0"
  },

  "接口列表": [
    {
      "序号": 1,
      "接口名": "获取用户资料",
      "接口标识": "getProfile",
      "路径": "GET /api/user/profile",
      "触发时机": "[API:getProfile] 页面初始化",
      "对应数据模型": "STEP 1 → PageModel.BasicInfoData",

      "请求参数": {},

      "响应数据": {
        "code": "Number - 状态码 - 200成功",
        "message": "String - 提示信息",
        "data": {
          "_映射": "→ STEP 1: PageModel",
          "avatarUrl": "String - 头像URL - [UI:AvatarArea.头像]",
          "nickname": "String - 昵称 - [UI:BasicInfoArea.昵称]",
          "gender": "String?(male|female) - 性别 - [UI:BasicInfoArea.性别]",
          "bio": "String? - 个人介绍 - [UI:BasicInfoArea.个人介绍]",
          "birthday": "String?(YYYY-MM-DD) - 生日 - [UI:BasicInfoArea.生日]",
          "height": "Number? - 身高(cm) - [UI:BasicInfoArea.身高]",
          "weight": "Number? - 体重(kg) - [UI:BasicInfoArea.体重]",
          "occupation": "Array<String>? - 职业列表 - [UI:BasicInfoArea.职业]",
          "location": "String? - 常居地 - [UI:BasicInfoArea.常居地]",
          "locationCode": "String? - 常居地编码 - [用于:城市选择器回显]",
          "wechat": "String? - 微信号 - [UI:BasicInfoArea.微信]",
          "wechatUnlockPrice": "Number? - 解锁微信价格 - [UI:WechatEdit.解锁设置]"
        }
      },

      "响应示例": {
        "code": 200,
        "message": "success",
        "data": {
          "avatarUrl": "https://xxx.com/avatar/123.jpg",
          "nickname": "门前游过一群鸭",
          "gender": null,
          "bio": "这里是个人介绍这里是个人介绍",
          "birthday": "1999-09-29",
          "height": null,
          "weight": null,
          "occupation": [],
          "location": "深圳",
          "locationCode": "440300",
          "wechat": "213438647210",
          "wechatUnlockPrice": null
        }
      }
    },

    {
      "序号": 2,
      "接口名": "更新用户资料",
      "接口标识": "updateProfile",
      "路径": "PUT /api/user/profile",
      "触发时机": "[API:updateProfile] 编辑字段后保存",
      "对应数据模型": "STEP 1 → SharedModel.UpdateResult",

      "请求参数": {
        "field": "String - 更新的字段名 - nickname|gender|bio|birthday|height|weight|occupation|location|wechat",
        "value": "Any - 新的字段值 - 类型与字段对应"
      },

      "请求示例": {
        "field": "nickname",
        "value": "新昵称"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "message": "String - 提示信息",
        "data": {
          "_映射": "→ STEP 1: SharedModel.UpdateResult",
          "success": "Boolean - 是否成功",
          "updatedField": "String - 更新的字段名",
          "newValue": "Any - 新值"
        }
      },

      "响应示例": {
        "code": 200,
        "message": "更新成功",
        "data": {
          "success": true,
          "updatedField": "nickname",
          "newValue": "新昵称"
        }
      },

      "字段校验规则": {
        "nickname": "1-20字符，不能为空",
        "gender": "male|female",
        "bio": "0-30字符",
        "birthday": "YYYY-MM-DD格式，不能晚于今天",
        "height": "140-220的整数",
        "weight": "30-150的整数",
        "occupation": "数组，每项1-10字符，最多5个",
        "location": "城市编码",
        "wechat": "6-20字符，字母数字下划线"
      }
    },

    {
      "序号": 3,
      "接口名": "上传头像",
      "接口标识": "uploadAvatar",
      "路径": "POST /api/user/avatar/upload",
      "触发时机": "[API:uploadAvatar] 选择图片后上传",
      "对应数据模型": "STEP 1 → SharedModel.UploadResult",

      "请求参数": {
        "file": "File - 图片文件 - [格式:jpg/png/webp] [限制:5MB]"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "message": "String - 提示信息",
        "data": {
          "_映射": "→ STEP 1: SharedModel.UploadResult",
          "success": "Boolean - 是否成功",
          "url": "String - 上传后的头像URL",
          "thumbnailUrl": "String? - 缩略图URL"
        }
      },

      "响应示例": {
        "code": 200,
        "message": "上传成功",
        "data": {
          "success": true,
          "url": "https://xxx.com/avatar/new-123.jpg",
          "thumbnailUrl": "https://xxx.com/avatar/new-123_thumb.jpg"
        }
      }
    },

    {
      "序号": 4,
      "接口名": "获取地区数据",
      "接口标识": "getRegions",
      "路径": "GET /api/common/regions",
      "触发时机": "[API:getRegions] 点击常居地时调用（可缓存）",
      "缓存策略": "本地缓存7天",

      "请求参数": {
        "parentCode": "String? - 父级编码 - 不传返回省份列表"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "regions": "Array<RegionItem> - 地区列表",
          "RegionItem": {
            "code": "String - 地区编码",
            "name": "String - 地区名称",
            "hasChildren": "Boolean - 是否有下级"
          }
        }
      },

      "响应示例": {
        "code": 200,
        "data": {
          "regions": [
            { "code": "110000", "name": "北京", "hasChildren": true },
            { "code": "310000", "name": "上海", "hasChildren": true },
            { "code": "440000", "name": "广东", "hasChildren": true }
          ]
        }
      }
    }
  ]
}
```

### 接口汇总表

| 序号 | 接口标识 | 方法 | 路径 | 对应数据模型 | 触发时机 | 缓存 |
|------|----------|------|------|--------------|----------|------|
| 1 | getProfile | GET | /api/user/profile | BasicInfoData | 页面初始化 | 无 |
| 2 | updateProfile | PUT | /api/user/profile | UpdateResult | 保存字段 | 无 |
| 3 | uploadAvatar | POST | /api/user/avatar/upload | UploadResult | 上传头像 | 无 |
| 4 | getRegions | GET | /api/common/regions | RegionItem[] | 选择地区 | 7天 |

### 数据库表设计

```sql
-- 用户表（对应 STEP 1: PageModel.BasicInfoData）
CREATE TABLE users (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    avatar_url      VARCHAR(500) COMMENT '头像URL → avatarUrl',
    nickname        VARCHAR(50) NOT NULL COMMENT '昵称 → nickname [限制:20字]',
    gender          ENUM('male', 'female') COMMENT '性别 → gender',
    bio             VARCHAR(100) COMMENT '个人介绍 → bio [限制:30字]',
    birthday        DATE COMMENT '生日 → birthday',
    height          SMALLINT UNSIGNED COMMENT '身高(cm) → height [范围:140-220]',
    weight          SMALLINT UNSIGNED COMMENT '体重(kg) → weight [范围:30-150]',
    location_code   VARCHAR(10) COMMENT '常居地编码 → locationCode',
    location_name   VARCHAR(50) COMMENT '常居地名称 → location',
    wechat          VARCHAR(50) COMMENT '微信号 → wechat',
    wechat_unlock_price DECIMAL(10,2) COMMENT '解锁微信价格 → wechatUnlockPrice',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',

    INDEX idx_nickname (nickname)
) COMMENT '用户表 → PageModel.BasicInfoData';

-- 用户职业表（对应 STEP 1: BasicInfoData.occupation）
CREATE TABLE user_occupations (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id     BIGINT NOT NULL COMMENT '用户ID → FK users.id',
    occupation  VARCHAR(20) NOT NULL COMMENT '职业名称 → occupation[]',
    sort_order  TINYINT DEFAULT 0 COMMENT '排序顺序',
    created_at  DATETIME DEFAULT CURRENT_TIMESTAMP,

    UNIQUE KEY uk_user_occupation (user_id, occupation),
    INDEX idx_user_id (user_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) COMMENT '用户职业表 → BasicInfoData.occupation';

-- 地区表（对应 STEP 6: getRegions接口）
CREATE TABLE regions (
    code        VARCHAR(10) PRIMARY KEY COMMENT '地区编码',
    name        VARCHAR(50) NOT NULL COMMENT '地区名称',
    parent_code VARCHAR(10) COMMENT '父级编码',
    level       TINYINT NOT NULL COMMENT '层级: 1=省, 2=市, 3=区',
    sort_order  INT DEFAULT 0 COMMENT '排序',

    INDEX idx_parent (parent_code),
    INDEX idx_level (level)
) COMMENT '地区表 → LocationData';
```

### 核心SQL查询

```sql
-- 获取用户资料（返回 STEP 1: PageModel）
SELECT
    u.id,
    u.avatar_url AS avatarUrl,
    u.nickname,
    u.gender,
    u.bio,
    DATE_FORMAT(u.birthday, '%Y-%m-%d') AS birthday,
    u.height,
    u.weight,
    u.location_code AS locationCode,
    u.location_name AS location,
    u.wechat,
    u.wechat_unlock_price AS wechatUnlockPrice
FROM users u
WHERE u.id = #{userId};

-- 获取用户职业列表
SELECT occupation
FROM user_occupations
WHERE user_id = #{userId}
ORDER BY sort_order;

-- 更新用户昵称
UPDATE users
SET nickname = #{nickname}, updated_at = NOW()
WHERE id = #{userId};

-- 更新用户性别
UPDATE users
SET gender = #{gender}, updated_at = NOW()
WHERE id = #{userId};

-- 更新用户生日
UPDATE users
SET birthday = #{birthday}, updated_at = NOW()
WHERE id = #{userId};

-- 更新用户身高
UPDATE users
SET height = #{height}, updated_at = NOW()
WHERE id = #{userId};

-- 更新用户体重
UPDATE users
SET weight = #{weight}, updated_at = NOW()
WHERE id = #{userId};

-- 更新用户常居地
UPDATE users
SET location_code = #{locationCode},
    location_name = #{locationName},
    updated_at = NOW()
WHERE id = #{userId};

-- 更新用户头像
UPDATE users
SET avatar_url = #{avatarUrl}, updated_at = NOW()
WHERE id = #{userId};

-- 更新用户职业（先删后插）
DELETE FROM user_occupations WHERE user_id = #{userId};

INSERT INTO user_occupations (user_id, occupation, sort_order)
VALUES
    (#{userId}, #{occupation1}, 1),
    (#{userId}, #{occupation2}, 2);

-- 获取省份列表
SELECT code, name,
       (SELECT COUNT(*) FROM regions r2 WHERE r2.parent_code = r1.code) > 0 AS hasChildren
FROM regions r1
WHERE level = 1
ORDER BY sort_order;

-- 获取城市列表（根据省份编码）
SELECT code, name,
       (SELECT COUNT(*) FROM regions r2 WHERE r2.parent_code = r1.code) > 0 AS hasChildren
FROM regions r1
WHERE parent_code = #{provinceCode}
ORDER BY sort_order;
```

### MVP清单

| 序号 | 功能 | 对应数据模型 | 涉及表 | 接口 | 优先级 |
|------|------|--------------|--------|------|--------|
| 1 | 获取用户资料 | BasicInfoData | users, user_occupations | GET /profile | P0 |
| 2 | 更新昵称 | UpdateResult | users | PUT /profile | P0 |
| 3 | 更新性别 | UpdateResult | users | PUT /profile | P0 |
| 4 | 更新个人介绍 | UpdateResult | users | PUT /profile | P0 |
| 5 | 更新生日 | UpdateResult | users | PUT /profile | P0 |
| 6 | 更新身高体重 | UpdateResult | users | PUT /profile | P1 |
| 7 | 更新职业 | UpdateResult | user_occupations | PUT /profile | P1 |
| 8 | 更新常居地 | UpdateResult | users | PUT /profile | P1 |
| 9 | 上传头像 | UploadResult | users | POST /avatar/upload | P0 |
| 10 | 获取地区数据 | RegionItem[] | regions | GET /regions | P1 |
| 11 | 更新微信 | UpdateResult | users | PUT /profile | P1 |

**MVP统计：3张表 + 4个接口 = 最小可行后端**

---

## 🎯 质量评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 数据模型 | 9 | 模型完整，字段与UI绑定清晰，包含PageModel/ItemModel/SharedModel |
| 结构完整性 | 9 | 所有UI元素都有层级标注，主页面+子页面+弹出组件全覆盖 |
| 数据绑定 | 9 | 每个动态元素都标注了[data:字段名] |
| 位置精确度 | 8 | 提供了九宫格定位和详细布局图，包含尺寸和间距 |
| 组件拆分 | 9 | L1/L2/L3层级清晰，简单区域与复杂区域划分合理 |
| 复用标记 | 9 | ActionSheet/Picker等共享组件标记完整 |
| 交互描述 | 9 | 流程图覆盖所有交互路径，包括弹窗和子页面 |
| 代码映射 | 9 | 文件结构清晰，可直接创建项目文件夹 | 
| 接口+后端 | 9 | 接口对应数据模型，表设计完整，SQL可执行 |

**综合评分：8.9分**

---

*文档版本: v1.0*
*生成时间: 2024*
*基于模板: 纯结构架构图标准模板 v5.4*
