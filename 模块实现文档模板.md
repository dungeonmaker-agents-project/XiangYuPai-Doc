# 模块实现文档模板 v3.0

> **适用项目**: XiangYuPai (向娱拍)
> **输入**: UI结构文档 (STEP 1-6)
> **输出**: PRD文档 + 前端执行文档 + 后端执行文档

---

## 目录

- [第一部分：项目技术栈](#第一部分项目技术栈)
- [第二部分：命名规范](#第二部分命名规范)
- [第三部分：公共组件](#第三部分公共组件)
- [第四部分：PRD文档模板](#第四部分prd文档模板)
- [第五部分：前端执行文档模板](#第五部分前端执行文档模板)
- [第六部分：后端执行文档模板](#第六部分后端执行文档模板)

---

# 第一部分：项目技术栈

## 1.1 前端技术栈 (XiangYuPai-RNExpoAPP)

| 技术 | 版本 | 用途 |
|------|------|------|
| React Native | 0.81.4 | 跨平台框架 |
| Expo | ~54.0.10 | 开发工具链 |
| Expo Router | ~6.0.8 | 文件路由系统 |
| TypeScript | ~5.9.2 | 类型系统 (严格模式) |
| Zustand | ^5.0.8 | 状态管理 |
| Axios | via client.ts | HTTP请求+缓存+重试 |
| React Navigation | ^7.1.8 | 导航框架 |

**项目路径**: `E:/Users/Administrator/Documents/GitHub/XiangYuPai-RNExpoAPP`

## 1.2 后端技术栈 (RuoYi-Cloud-Plus)

| 技术 | 版本 | 用途 |
|------|------|------|
| Java | 17 | 运行时 |
| Spring Boot | 3.5.7 | 应用框架 |
| Spring Cloud | 2025.0.0 | 微服务框架 |
| MyBatis-Plus | 3.5.14 | ORM框架 |
| Apache Dubbo | - | RPC框架 |
| MySQL | 8.0 | 数据库 |
| Sa-Token | 1.44.0 | 认证框架 |
| Nacos | - | 配置中心+服务发现 |
| Redisson | 3.51.0 | Redis客户端 |

**项目路径**: `E:/Users/Administrator/Documents/GitHub/RuoYi-Cloud-Plus`

## 1.3 微服务端口分配

| 服务 | 端口 | 职责 |
|------|------|------|
| xypai-auth | 8200 | 认证服务 |
| xypai-app-bff | 9400 | BFF聚合层 |
| xypai-user | 9405 | 用户+技能服务 |
| xypai-content | 9406 | 内容服务 |
| xypai-order | 9407 | 订单服务 |
| xypai-payment | 9408 | 支付服务 |
| xypai-chat | 9409 | 聊天服务 |

---

# 第二部分：命名规范

## 2.1 前端命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 模块目录 | PascalCase | `GameSkill/` |
| 页面文件夹 | PascalCase + Page | `GameSkillListPage/` |
| 区域组件 | PascalCase + Area | `FilterArea.tsx` |
| 子组件文件夹 | PascalCase | `SkillServiceCard/` |
| Hook文件 | camelCase + use | `useSkillList.ts` |
| Store文件 | camelCase + Store | `skillListStore.ts` |
| API文件 | camelCase + Api | `skillApi.ts` |
| 类型文件 | types/index.ts | `types/index.ts` |
| 样式文件 | styles.ts | `styles.ts` |

**目录结构示例**:
```
src/features/{Module}/
├── index.ts                      # 模块入口
├── 快速理解.md                    # 模块说明文档
├── types/index.ts                # 类型定义
├── api/{module}Api.ts            # API接口
├── stores/{module}Store.ts       # Zustand Store
├── {PageName}Page/               # 页面文件夹
│   ├── index.tsx                 # 页面主文件
│   ├── {Area}Area.tsx            # 区域组件
│   └── {Component}/              # 子组件文件夹
│       ├── index.tsx
│       └── types.ts
└── SharedComponents/             # 模块共享组件
```

## 2.2 后端命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 模块名 | xypai-{module} | `xypai-user` |
| 包路径 | org.dromara.{module} | `org.dromara.user` |
| Entity | PascalCase | `Skill.java` |
| DTO | Feature + Dto | `SkillListQueryDto.java` |
| VO | Feature + Vo | `SkillServiceItemVo.java` |
| Controller | Feature + Controller | `SkillController.java` |
| Service接口 | I + Feature + Service | `ISkillService.java` |
| Service实现 | Feature + ServiceImpl | `SkillServiceImpl.java` |
| Mapper | Entity + Mapper | `SkillMapper.java` |

**目录结构示例**:
```
xypai-{module}/src/main/java/org/dromara/{module}/
├── controller/
│   └── app/                      # App端接口
│       └── {Feature}Controller.java
├── domain/
│   ├── entity/                   # 实体类
│   ├── dto/                      # 请求DTO
│   └── vo/                       # 响应VO
├── mapper/                       # Mapper接口
├── service/
│   ├── I{Feature}Service.java    # 接口
│   └── impl/
│       └── {Feature}ServiceImpl.java
└── 快速理解.md
```

## 2.3 数据库命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 表名 | snake_case (复数或单数) | `skills`, `user` |
| 字段名 | snake_case | `skill_name`, `user_id` |
| 主键 | {table}_id | `skill_id`, `user_id` |
| 外键字段 | {ref_table}_id | `user_id` |
| 布尔字段 | is_{name} | `is_online`, `is_verified` |
| 时间戳 | created_at / updated_at | DATETIME |
| 软删除 | deleted | TINYINT(1) DEFAULT 0 |
| 乐观锁 | version | INT DEFAULT 0 |

## 2.4 API路径规范

| 操作 | 方法 | 路径模式 | 示例 |
|------|------|---------|------|
| 列表查询 | GET | `/api/{module}/list` | `/api/skill/list` |
| 详情查询 | GET | `/api/{module}/detail/{id}` | `/api/skill/detail/123` |
| 配置获取 | GET | `/api/{module}/config` | `/api/skill/config` |
| 创建 | POST | `/api/{module}/create` | `/api/skill/create` |
| 更新 | PUT | `/api/{module}/update` | `/api/skill/update` |
| 删除 | DELETE | `/api/{module}/delete/{id}` | `/api/skill/delete/123` |

---

# 第三部分：公共组件

## 3.1 前端公共组件

| 组件/工具 | 路径 | 用途 | 使用方式 |
|----------|------|------|---------|
| ThemedText | `@/components/ThemedText` | 主题文本 | `<ThemedText>` |
| ThemedView | `@/components/ThemedView` | 主题容器 | `<ThemedView>` |
| Colors | `@/constants/theme` | 主题颜色 | `Colors.light.text` |
| API Client | `@/services/api/client` | HTTP客户端 | `client.get()` |
| 全局Store | `@/stores/` | 全局状态 | `useUserStore()` |
| locationStore | `@/stores/locationStore` | 位置数据 | `useLocationStore()` |
| configStore | `@/stores/configStore` | 应用配置 | `useConfigStore()` |

**导入示例**:
```typescript
import { ThemedText, ThemedView } from '@/components';
import { Colors } from '@/constants/theme';
import { useLocationStore } from '@/stores';
import { client } from '@/services/api/client';
```

## 3.2 后端公共组件

| 组件 | 所在模块 | 用途 | 使用方式 |
|------|---------|------|---------|
| BaseController | ruoyi-common-web | 控制器基类 | `extends BaseController` |
| R&lt;T&gt; | ruoyi-common-core | 统一响应 | `R.ok(data)` / `R.fail(msg)` |
| PageQuery | ruoyi-common-mybatis | 分页参数 | `extends PageQuery` |
| BaseMapper&lt;T&gt; | MyBatis-Plus | Mapper基类 | `extends BaseMapper<Entity>` |
| IService&lt;T&gt; | MyBatis-Plus | Service基类 | `extends IService<Entity>` |
| ServiceImpl&lt;M,T&gt; | MyBatis-Plus | Service实现基类 | `extends ServiceImpl<Mapper, Entity>` |
| @DubboService | Apache Dubbo | RPC服务暴露 | `@DubboService` |
| LoginHelper | Sa-Token | 获取登录用户 | `LoginHelper.getUserId()` |

**响应格式**:
```java
// 成功响应
R.ok()                    // { code: 200, msg: "操作成功", data: null }
R.ok(data)                // { code: 200, msg: "操作成功", data: {...} }
R.ok("自定义消息", data)   // { code: 200, msg: "自定义消息", data: {...} }

// 失败响应
R.fail()                  // { code: 500, msg: "操作失败", data: null }
R.fail("错误信息")         // { code: 500, msg: "错误信息", data: null }
```

---

# 第四部分：PRD文档模板

> **用途**: 给产品经理、设计师、测试人员查看
> **特点**: 技术无关，关注业务需求和用户体验

```markdown
# {页面名称} PRD

> **版本**: v1.0
> **更新日期**: YYYY-MM-DD
> **关联文档**: [{页面名称}_结构文档.md](./xxx_结构文档.md)

---

## 1. 产品概述

### 1.1 页面信息
| 属性 | 值 |
|------|------|
| 页面名称 | {中文名称} |
| 页面标识 | {PageIdentifier} |
| 所属模块 | {ModuleName} |
| 页面类型 | 列表页/详情页/表单页 |
| 入口路径 | {描述用户如何到达此页面} |

### 1.2 核心价值
{一句话描述页面的核心价值和解决的用户问题}

---

## 2. 目标用户与使用场景

### 2.1 目标用户
| 用户类型 | 特征 | 核心诉求 |
|---------|------|---------|
| {用户类型1} | {特征描述} | {诉求描述} |
| {用户类型2} | {特征描述} | {诉求描述} |

### 2.2 典型场景
| 场景 | 用户行为 | 预期结果 |
|------|---------|---------|
| 场景1 | {用户做什么} | {期望看到什么} |
| 场景2 | {用户做什么} | {期望看到什么} |

---

## 3. 功能需求

### 3.1 功能清单
| 功能模块 | 功能点 | 优先级 | 说明 |
|---------|-------|--------|------|
| {模块1} | {功能点} | P0/P1/P2 | {说明} |

### 3.2 功能详述

#### 3.2.1 {功能模块1}
**功能描述**: {详细描述}

**交互流程**:
1. 用户操作: {操作描述}
2. 系统响应: {响应描述}
3. 结果反馈: {反馈描述}

**业务规则**:
- 规则1: {描述}
- 规则2: {描述}

#### 3.2.2 {功能模块2}
...

---

## 4. 页面状态

| 状态 | 触发条件 | 显示内容 | 用户操作 |
|------|---------|---------|---------|
| Loading | 数据加载中 | 骨架屏/Loading动画 | 等待 |
| Empty | 无数据 | 空状态插图+文案 | 引导操作 |
| Error | 加载失败 | 错误提示+重试按钮 | 点击重试 |
| Normal | 数据加载成功 | 正常内容 | 正常交互 |

---

## 5. 业务规则

### 5.1 数据规则
| 规则 | 说明 |
|------|------|
| 默认排序 | {描述默认排序逻辑} |
| 分页规则 | 每页{N}条，{加载方式} |
| 缓存策略 | {描述缓存时间和更新策略} |

### 5.2 权限规则
| 操作 | 权限要求 |
|------|---------|
| 查看列表 | {登录/游客/VIP} |
| {其他操作} | {权限要求} |

---

## 6. 数据埋点

| 事件名称 | 触发时机 | 上报参数 | 用途 |
|---------|---------|---------|------|
| page_view | 页面曝光 | page_id | PV统计 |
| {事件名} | {触发时机} | {参数} | {用途} |

---

## 7. 验收标准

### 7.1 功能验收
- [ ] {验收点1}
- [ ] {验收点2}

### 7.2 性能要求
| 指标 | 要求 |
|------|------|
| 首屏加载 | < 2s |
| 列表滚动 | 60fps |
| 接口响应 | < 500ms |

---

## 8. 优先级与里程碑

| 阶段 | 功能范围 | 优先级 |
|------|---------|--------|
| MVP | {核心功能} | P0 |
| V1.1 | {增强功能} | P1 |
| V1.2 | {扩展功能} | P2 |

---

*文档版本: v1.0*
*最后更新: YYYY-MM-DD*
```

---

# 第五部分：前端执行文档模板

> **用途**: 给前端开发者/Agent执行代码生成
> **特点**: 包含完整的类型定义、API对接、组件结构

```markdown
# {页面名称} - 前端执行文档

> **版本**: v1.0
> **关联文档**:
> - [{页面名称}_结构文档.md](./xxx_结构文档.md) (数据模型来源)
> - [{页面名称}_PRD.md](./xxx_PRD.md) (业务需求)

---

## 1. 模块信息

| 属性 | 值 |
|------|------|
| 模块名称 | {ModuleName} |
| 模块路径 | `src/features/{ModuleName}/` |
| 页面名称 | {PageName} |
| 页面路由 | `/{route}/path` |
| 深链接 | `xyp://{route}/{param}` |

---

## 2. 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React Native | 0.81.4 | 跨平台框架 |
| Expo | ~54.0.10 | 开发工具链 |
| Expo Router | ~6.0.8 | 文件路由 |
| TypeScript | ~5.9.2 | 类型系统 |
| Zustand | ^5.0.8 | 状态管理 |

---

## 3. 目录结构

```
src/features/{ModuleName}/
├── index.ts                          # 模块入口
├── 快速理解.md                        # 模块说明
├── types/
│   └── index.ts                      # 类型定义
├── api/
│   └── {module}Api.ts                # API接口
├── stores/
│   └── {module}Store.ts              # Zustand Store
├── {PageName}Page/
│   ├── index.tsx                     # 页面主文件 [L1]
│   ├── {Area1}Area.tsx               # 区域组件 [L2]
│   ├── {Area2}Area.tsx               # 区域组件 [L2]
│   └── {Component}/                  # 子组件 [L3]
│       ├── index.tsx
│       └── types.ts
└── SharedComponents/
    └── {SharedComponent}/
```

---

## 4. 类型定义

> 来源: 结构文档 STEP 1 数据模型

```typescript
// types/index.ts

// ==================== PageModel ====================
export interface PageModel {
  headerData: HeaderData;
  filterData: FilterData;
  tabData: TabData;
  listData: ListData;
  pageState: PageState;
}

// ==================== HeaderData ====================
export interface HeaderData {
  title: string;
  // ... 从结构文档 STEP 1 提取
}

// ==================== FilterData ====================
export interface FilterData {
  // ... 从结构文档 STEP 1 提取
}

// ==================== TabData ====================
export interface TabItem {
  key: string;
  label: string;
  isActive: boolean;
}

export interface TabData {
  tabs: TabItem[];
  currentTab: string;
}

// ==================== ListData ====================
export interface {ItemType} {
  // ... 从结构文档 STEP 1 ItemModel 提取
}

export interface ListData {
  list: {ItemType}[];
  hasMore: boolean;
  total?: number;
}

// ==================== PageState ====================
export interface PageState {
  isLoading: boolean;
  isRefreshing: boolean;
  isError: boolean;
  errorMessage?: string;
}

// ==================== API Types ====================
export interface ConfigResponse {
  tabs: TabItem[];
  filters: FilterItem[];
}

export interface ListQueryParams {
  page: number;
  pageSize: number;
  // ... 筛选参数
}

export interface ListResponse {
  list: {ItemType}[];
  hasMore: boolean;
  total: number;
}
```

---

## 5. API接口

> 来源: 结构文档 STEP 6 接口定义

```typescript
// api/{module}Api.ts

import { client } from '@/services/api/client';
import type { ConfigResponse, ListQueryParams, ListResponse } from '../types';

const BASE_URL = '/api/{module}';

export const {module}Api = {
  /**
   * 获取页面配置
   * @对应后端 GET /api/{module}/config
   */
  getConfig: async (params: { gameId: string }): Promise<ConfigResponse> => {
    return client.get(`${BASE_URL}/config`, { params });
  },

  /**
   * 获取列表数据
   * @对应后端 GET /api/{module}/list
   */
  getList: async (params: ListQueryParams): Promise<ListResponse> => {
    return client.get(`${BASE_URL}/list`, { params });
  },

  // ... 其他接口
};

// ==================== Mock数据 ====================
export const MOCK_CONFIG: ConfigResponse = {
  tabs: [
    { key: 'all', label: '全部', isActive: true },
    // ...
  ],
  filters: [
    // ...
  ],
};

export const MOCK_LIST: ListResponse = {
  list: [
    // ... Mock列表项
  ],
  hasMore: true,
  total: 100,
};
```

---

## 6. Store设计

```typescript
// stores/{module}Store.ts

import { create } from 'zustand';
import { devtools } from 'zustand/middleware';
import type { ListData, FilterData, TabData, PageState } from '../types';
import { {module}Api } from '../api/{module}Api';

interface {Module}State {
  // Data
  tabData: TabData;
  filterData: FilterData;
  listData: ListData;
  pageState: PageState;

  // Actions
  fetchConfig: (gameId: string) => Promise<void>;
  fetchList: (params: ListQueryParams) => Promise<void>;
  refreshList: () => Promise<void>;
  loadMore: () => Promise<void>;
  setFilter: (key: string, value: any) => void;
  setTab: (tabKey: string) => void;
  reset: () => void;
}

const initialState = {
  tabData: { tabs: [], currentTab: '' },
  filterData: { /* ... */ },
  listData: { list: [], hasMore: true, total: 0 },
  pageState: { isLoading: false, isRefreshing: false, isError: false },
};

export const use{Module}Store = create<{Module}State>()(
  devtools(
    (set, get) => ({
      ...initialState,

      fetchConfig: async (gameId) => {
        // 实现
      },

      fetchList: async (params) => {
        // 实现
      },

      // ... 其他actions
    }),
    { name: '{module}-store' }
  )
);

// Selectors
export const use{Module}List = () => use{Module}Store((s) => s.listData.list);
export const use{Module}Loading = () => use{Module}Store((s) => s.pageState.isLoading);
```

---

## 7. 组件实现清单

### 7.1 L1 页面组件

| 组件 | 文件 | 职责 |
|------|------|------|
| {PageName}Page | `{PageName}Page/index.tsx` | 组合L2区域，管理页面状态 |

### 7.2 L2 区域组件

| 组件 | 文件 | 职责 | 布局 |
|------|------|------|------|
| NavArea | `NavArea.tsx` | 导航栏 | 固定顶部 |
| FilterArea | `FilterArea.tsx` | 筛选栏 | 固定顶部 |
| TabArea | `TabArea.tsx` | Tab切换 | 固定顶部 |
| ContentListArea | `ContentListArea/index.tsx` | 列表区域 | flex:1 scroll |

### 7.3 L3 基础组件

| 组件 | 文件 | 数据来源 | 复用 |
|------|------|---------|------|
| {ItemCard} | `{ItemCard}/index.tsx` | `ListData.list[i]` | 1模板xN实例 |
| FilterDropdown | `SharedComponents/FilterDropdown/` | `FilterData` | 复用 |
| TabButton | `SharedComponents/TabButton/` | `TabData.tabs[i]` | 1模板xN实例 |

---

## 8. 路由配置

```typescript
// app/{route}/index.tsx 或 app/{route}/[param].tsx

import { {PageName}Page } from '@/src/features/{ModuleName}';

export default function {PageName}Screen() {
  return <{PageName}Page />;
}
```

**路由参数**:
| 参数 | 类型 | 说明 |
|------|------|------|
| {param} | string | {参数说明} |

---

## 9. 实现步骤

1. [ ] 创建目录结构
2. [ ] 实现 `types/index.ts` - 类型定义
3. [ ] 实现 `api/{module}Api.ts` - API接口 + Mock
4. [ ] 实现 `stores/{module}Store.ts` - 状态管理
5. [ ] 实现 L3 基础组件
6. [ ] 实现 L2 区域组件
7. [ ] 组装 L1 页面组件
8. [ ] 配置路由
9. [ ] 编写 `快速理解.md`

---

## 10. 公共组件复用

| 组件 | 路径 | 用途 |
|------|------|------|
| ThemedText | `@/components/ThemedText` | 主题文本 |
| ThemedView | `@/components/ThemedView` | 主题容器 |
| Colors | `@/constants/theme` | 颜色常量 |
| locationStore | `@/stores/locationStore` | 位置数据 |

---

## 11. 质量检查清单

- [ ] 类型定义与结构文档 STEP 1 数据模型一致
- [ ] API接口与结构文档 STEP 6 接口定义一致
- [ ] API包含Mock数据，可独立运行
- [ ] 组件命名符合规范 (PascalCase + Area/Card等后缀)
- [ ] Store使用Zustand，包含selectors
- [ ] 已生成 `快速理解.md`
- [ ] 路由配置正确

---

*文档版本: v1.0*
*最后更新: YYYY-MM-DD*
```

---

# 第六部分：后端执行文档模板

> **用途**: 给后端开发者/Agent执行代码生成
> **特点**: 包含完整的DTO/VO定义、SQL、Controller/Service实现

```markdown
# {页面名称} - 后端执行文档

> **版本**: v1.0
> **关联文档**:
> - [{页面名称}_结构文档.md](./xxx_结构文档.md) (接口定义来源)
> - [{页面名称}_PRD.md](./xxx_PRD.md) (业务需求)

---

## 1. 模块信息

| 属性 | 值 |
|------|------|
| 所属服务 | xypai-{module} |
| 服务端口 | {port} |
| 包路径 | org.dromara.{module} |
| 数据库 | xypai_{module} |

---

## 2. 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Java | 17 | 运行时 |
| Spring Boot | 3.5.7 | 应用框架 |
| MyBatis-Plus | 3.5.14 | ORM |
| MySQL | 8.0 | 数据库 |
| Sa-Token | 1.44.0 | 认证 |

---

## 3. 目录结构

```
xypai-{module}/src/main/java/org/dromara/{module}/
├── controller/
│   └── app/
│       └── {Feature}Controller.java      # REST API
├── domain/
│   ├── entity/
│   │   └── {Entity}.java                 # 实体 (可能已存在)
│   ├── dto/
│   │   └── {Feature}QueryDto.java        # 请求DTO
│   └── vo/
│       └── {Feature}ItemVo.java          # 响应VO
├── mapper/
│   └── {Entity}Mapper.java               # Mapper (可能已存在)
├── service/
│   ├── I{Feature}Service.java            # 接口
│   └── impl/
│       └── {Feature}ServiceImpl.java     # 实现
└── 快速理解.md                            # 更新
```

---

## 4. 数据库表

> 来源: 结构文档 STEP 6 数据库设计

### 4.1 现有表 (已存在)

| 表名 | 说明 | 关键字段 |
|------|------|---------|
| {table1} | {说明} | {字段列表} |
| {table2} | {说明} | {字段列表} |

### 4.2 新增表 (如需要)

```sql
-- 新增表 DDL (如果需要)
CREATE TABLE `{new_table}` (
    `{table}_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键',
    -- 业务字段
    `field1` VARCHAR(100) NOT NULL COMMENT '字段1',
    `field2` INT DEFAULT 0 COMMENT '字段2',
    -- 系统字段
    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '删除标记',
    `version` INT NOT NULL DEFAULT 0 COMMENT '乐观锁',
    PRIMARY KEY (`{table}_id`),
    KEY `idx_deleted` (`deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='{表说明}';
```

---

## 5. API接口设计

> 来源: 结构文档 STEP 6 接口列表

### 5.1 {接口1名称}

| 属性 | 值 |
|------|------|
| 路径 | `{METHOD} /api/{module}/{action}` |
| 触发时机 | {描述} |
| 认证要求 | {是否需要登录} |

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| param1 | String | 是 | {说明} |
| param2 | Integer | 否 | {说明} |

**响应数据**:
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    // 响应结构
  }
}
```

### 5.2 {接口2名称}
...

---

## 6. DTO/VO定义

### 6.1 请求DTO

```java
// domain/dto/{Feature}QueryDto.java

package org.dromara.{module}.domain.dto;

import lombok.Data;
import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.*;

@Data
@Schema(description = "{功能}查询参数")
public class {Feature}QueryDto {

    @Schema(description = "{字段说明}")
    @NotBlank(message = "{字段}不能为空")
    private String param1;

    @Schema(description = "页码", defaultValue = "1")
    private Integer page = 1;

    @Schema(description = "每页数量", defaultValue = "20")
    private Integer pageSize = 20;

    // ... 其他参数
}
```

### 6.2 响应VO

```java
// domain/vo/{Feature}ItemVo.java

package org.dromara.{module}.domain.vo;

import lombok.Data;
import lombok.Builder;
import io.swagger.v3.oas.annotations.media.Schema;

@Data
@Builder
@Schema(description = "{功能}列表项")
public class {Feature}ItemVo {

    @Schema(description = "ID")
    private Long id;

    @Schema(description = "{字段说明}")
    private String field1;

    // ... 其他字段 (从结构文档 STEP 1 ItemModel 映射)
}
```

---

## 7. Mapper实现

```java
// mapper/{Entity}Mapper.java (新增方法或新建)

package org.dromara.{module}.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.apache.ibatis.annotations.*;
import org.dromara.{module}.domain.entity.{Entity};
import org.dromara.{module}.domain.vo.{Feature}ItemVo;
import java.util.List;

@Mapper
public interface {Entity}Mapper extends BaseMapper<{Entity}> {

    /**
     * 查询{功能}列表
     * @对应前端 GET /api/{module}/list
     */
    @Select("""
        SELECT
            -- 字段映射
            t1.field1 AS field1,
            t2.field2 AS field2
        FROM {table1} t1
        LEFT JOIN {table2} t2 ON t1.id = t2.ref_id
        WHERE t1.deleted = 0
          AND (#{param1} IS NULL OR t1.field1 = #{param1})
        ORDER BY t1.created_at DESC
        LIMIT #{pageSize} OFFSET #{offset}
        """)
    List<{Feature}ItemVo> selectList(@Param("param1") String param1,
                                      @Param("pageSize") Integer pageSize,
                                      @Param("offset") Integer offset);

    /**
     * 统计总数
     */
    @Select("""
        SELECT COUNT(*)
        FROM {table1} t1
        WHERE t1.deleted = 0
          AND (#{param1} IS NULL OR t1.field1 = #{param1})
        """)
    Long countList(@Param("param1") String param1);
}
```

---

## 8. Service实现

### 8.1 接口定义

```java
// service/I{Feature}Service.java

package org.dromara.{module}.service;

import org.dromara.{module}.domain.dto.{Feature}QueryDto;
import org.dromara.{module}.domain.vo.{Feature}ItemVo;
import java.util.List;

public interface I{Feature}Service {

    /**
     * 获取列表
     */
    List<{Feature}ItemVo> getList({Feature}QueryDto dto);

    /**
     * 获取总数
     */
    Long getCount({Feature}QueryDto dto);
}
```

### 8.2 实现类

```java
// service/impl/{Feature}ServiceImpl.java

package org.dromara.{module}.service.impl;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.dromara.{module}.domain.dto.{Feature}QueryDto;
import org.dromara.{module}.domain.vo.{Feature}ItemVo;
import org.dromara.{module}.mapper.{Entity}Mapper;
import org.dromara.{module}.service.I{Feature}Service;
import java.util.List;

@Service
@RequiredArgsConstructor
public class {Feature}ServiceImpl implements I{Feature}Service {

    private final {Entity}Mapper {entity}Mapper;

    @Override
    public List<{Feature}ItemVo> getList({Feature}QueryDto dto) {
        int offset = (dto.getPage() - 1) * dto.getPageSize();
        return {entity}Mapper.selectList(
            dto.getParam1(),
            dto.getPageSize(),
            offset
        );
    }

    @Override
    public Long getCount({Feature}QueryDto dto) {
        return {entity}Mapper.countList(dto.getParam1());
    }
}
```

---

## 9. Controller实现

```java
// controller/app/{Feature}Controller.java

package org.dromara.{module}.controller.app;

import lombok.RequiredArgsConstructor;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.dromara.common.core.domain.R;
import org.dromara.common.web.core.BaseController;
import org.dromara.{module}.domain.dto.{Feature}QueryDto;
import org.dromara.{module}.domain.vo.{Feature}ItemVo;
import org.dromara.{module}.service.I{Feature}Service;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Tag(name = "{功能}接口")
@RestController
@RequestMapping("/api/{module}")
@RequiredArgsConstructor
public class {Feature}Controller extends BaseController {

    private final I{Feature}Service {feature}Service;

    @Operation(summary = "获取列表")
    @GetMapping("/list")
    public R<Map<String, Object>> getList(@Validated {Feature}QueryDto dto) {
        List<{Feature}ItemVo> list = {feature}Service.getList(dto);
        Long total = {feature}Service.getCount(dto);

        Map<String, Object> result = new HashMap<>();
        result.put("list", list);
        result.put("total", total);
        result.put("hasMore", (dto.getPage() * dto.getPageSize()) < total);

        return R.ok(result);
    }
}
```

---

## 10. Gateway配置

```yaml
# 添加到 gateway 路由配置
- id: xypai-{module}-{feature}
  uri: lb://xypai-{module}
  predicates:
    - Path=/api/{module}/**
  filters:
    - StripPrefix=0
```

---

## 11. 实现步骤

1. [ ] 创建/更新 DTO: `{Feature}QueryDto.java`
2. [ ] 创建/更新 VO: `{Feature}ItemVo.java`
3. [ ] 扩展 Mapper: 添加查询方法
4. [ ] 创建 Service: 接口 + 实现
5. [ ] 创建 Controller: REST API
6. [ ] 配置 Gateway 路由
7. [ ] 更新 `快速理解.md`
8. [ ] 测试接口

---

## 12. 质量检查清单

- [ ] DTO字段与结构文档 STEP 6 请求参数一致
- [ ] VO字段与结构文档 STEP 1 ItemModel映射正确
- [ ] SQL包含 `deleted = 0` 过滤
- [ ] Controller使用 `R<T>` 响应包装
- [ ] API路径符合规范 `/api/{module}/{action}`
- [ ] 已添加Swagger注解 (`@Tag`, `@Operation`, `@Schema`)
- [ ] 已配置Gateway路由
- [ ] 已更新 `快速理解.md`

---

*文档版本: v1.0*
*最后更新: YYYY-MM-DD*
```

---

# 附录：文档生成流程

```
┌─────────────────────────────────────────────────────────────────────┐
│  输入: UI结构文档 (STEP 1-6)                                         │
└─────────────────────────────────────────────────────────────────────┘
                                 ↓
┌─────────────────────────────────────────────────────────────────────┐
│  STEP 1: 生成 PRD文档                                                │
│  ─────────────────────                                              │
│  - 提取业务需求 (从流程图、交互描述)                                   │
│  - 定义功能清单和优先级                                               │
│  - 定义验收标准                                                      │
└─────────────────────────────────────────────────────────────────────┘
                                 ↓
┌─────────────────────────────────────────────────────────────────────┐
│  STEP 2: 生成 前端执行文档                                           │
│  ─────────────────────────                                          │
│  - 提取类型定义 (从 STEP 1 数据模型)                                  │
│  - 提取API接口 (从 STEP 6)                                           │
│  - 定义组件结构 (从 STEP 3 树状图, STEP 5 代码结构)                    │
│  - 生成Store设计                                                     │
└─────────────────────────────────────────────────────────────────────┘
                                 ↓
┌─────────────────────────────────────────────────────────────────────┐
│  STEP 3: 生成 后端执行文档                                           │
│  ─────────────────────────                                          │
│  - 提取接口定义 (从 STEP 6)                                          │
│  - 提取数据库设计 (从 STEP 6)                                         │
│  - 定义DTO/VO (从 STEP 1 + STEP 6)                                   │
│  - 生成SQL (从 STEP 6 核心SQL)                                        │
└─────────────────────────────────────────────────────────────────────┘
```

---

*模板版本: v3.0*
*更新日期: 2025-12-08*
*适用项目: XiangYuPai (向娱拍)*
