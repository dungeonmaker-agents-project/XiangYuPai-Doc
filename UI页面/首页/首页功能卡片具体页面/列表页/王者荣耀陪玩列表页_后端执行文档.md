# 王者荣耀技能服务列表页 - 后端执行文档

> **版本**: v2.0
> **更新日期**: 2025-12-09
> **关联文档**:
> - [王者荣耀陪玩列表页_结构文档.md](./王者荣耀陪玩列表页_结构文档.md) (接口定义来源)
> - [王者荣耀陪玩列表页_PRD.md](./王者荣耀陪玩列表页_PRD.md) (业务需求)
> - [王者荣耀陪玩列表页_前端执行文档.md](./王者荣耀陪玩列表页_前端执行文档.md) (前端对接)
> **后端架构**:
> - BFF服务: `xypai-app-bff` (端口: 9400) - 接收前端REST请求
> - 领域服务: `xypai-user` (端口: 9401) - 提供RPC实现
> - 数据库: `xypai_user` (MySQL)

---

## 1. 模块信息

| 属性 | 值 |
|------|------|
| BFF服务 | xypai-app-bff (端口: 9400) |
| 领域服务 | xypai-user (端口: 9401) |
| 包路径 | org.dromara.appbff / org.dromara.user |
| 数据库 | xypai_user |
| 功能说明 | 技能服务列表查询、配置获取、订单创建 |
| 调用模式 | App → Gateway(8080) → BFF(9400) → Dubbo RPC → xypai-user(9401) |

---

## 2. 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Java | 17 | 运行时 |
| Spring Boot | 3.5.7 | 应用框架 |
| MyBatis-Plus | 3.5.14 | ORM |
| MySQL | 8.0 | 数据库 |
| Sa-Token | 1.44.0 | 认证 |
| Nacos | - | 配置中心 |
| Dubbo | 3.x | RPC框架 |

---

## 3. 目录结构

### 3.1 BFF层 (xypai-app-bff)

```
xypai-app-bff/src/main/java/org/dromara/appbff/
├── controller/
│   └── SkillListController.java           # REST API [/api/skill/*]
├── domain/
│   ├── dto/
│   │   ├── SkillListQueryDTO.java         # 列表查询参数 (含嵌套SkillFiltersDTO)
│   │   └── ServiceOrderDTO.java           # 订单创建参数
│   └── vo/
│       ├── SkillConfigVO.java             # 配置响应 (tabs, filters, quickTags)
│       ├── SkillListResultVO.java         # 列表结果包装 (list, total, hasMore)
│       ├── SkillServiceItemVO.java        # 列表项 (嵌套VOs结构)
│       └── ServiceOrderResultVO.java      # 订单结果
└── service/
    ├── SkillListService.java              # 服务接口
    └── impl/
        └── SkillListServiceImpl.java      # 服务实现 (调用RemoteAppUserService RPC)
```

### 3.2 领域服务层 (xypai-user)

```
xypai-user/src/main/java/org/dromara/user/
├── controller/feign/
│   └── RemoteAppUserServiceImpl.java      # RPC接口实现 [提供给BFF调用]
├── domain/
│   ├── entity/
│   │   ├── User.java                      # 用户实体
│   │   └── Skill.java                     # 技能实体
│   └── vo/
│       ├── SkillServiceVo.java            # RPC响应VO
│       └── SkillServicePageResult.java    # RPC分页结果
├── mapper/
│   ├── UserMapper.java                    # 用户Mapper
│   └── SkillMapper.java                   # 技能Mapper (含复杂查询SQL)
└── service/
    └── ISkillService.java                 # 技能服务接口
```

### 3.3 API层 (xypai-api-appuser)

```
xypai-api-appuser/src/main/java/org/dromara/appuser/api/
├── RemoteAppUserService.java              # RPC接口定义
└── domain/
    ├── dto/
    │   └── SkillServiceQueryDto.java      # RPC查询参数
    └── vo/
        ├── SkillServiceVo.java            # RPC响应VO
        └── SkillServicePageResult.java    # RPC分页结果
```

---

## 4. 数据库表

> 数据库文件: `xypai-modules/xypai-user/sql/xypai_user.sql`

### 4.1 现有表

| 表名 | 说明 | 关键字段 |
|------|------|---------|
| users | 用户基础信息 | user_id, nickname, avatar, gender, birthday, is_online, is_real_verified, is_god_verified, is_vip, location_code, latitude, longitude |
| skills | 技能信息 | skill_id, user_id, skill_name, skill_type, game_name, game_rank, peak_score, server, game_attrs, description, price, price_unit, rating, order_count, is_online |

### 4.2 字段与UI映射

**users 表映射**:
| DB字段 | VO字段 | 说明 |
|--------|--------|------|
| user_id | SkillServiceItemVO.userId | 用户ID |
| nickname | basicData.nickname | 昵称 |
| avatar | avatarData.avatarUrl | 头像URL |
| gender | basicData.gender | 性别 (male/female) |
| birthday | basicData.age | 计算年龄 |
| is_online | basicData.isOnline | 是否在线 |
| is_real_verified | verificationData.isRealVerified | 实名认证 |
| is_god_verified | verificationData.isGodVerified | 大神认证 |
| is_vip | verificationData.isVip | VIP |
| latitude/longitude | basicData.distance | 计算距离 |

**skills 表映射**:
| DB字段 | VO字段 | 说明 |
|--------|--------|------|
| skill_id | SkillServiceItemVO.skillId | 技能ID |
| skill_name | skillData.skillName | 技能名称 |
| game_name | skillData.gameName | 游戏名称 |
| game_rank | skillData.gameRank | 游戏段位 |
| peak_score | skillData.peakScore | 巅峰分 |
| server | skillData.server | 服务区 (qq/wechat) |
| game_attrs | skillData.gameAttrs | 位置/标签 JSON |
| description | skillData.description | 技能描述 |
| price | priceData.price | 单价 |
| price_unit | priceData.unit | 单位 |
| rating | skillData.rating | 评分 |
| order_count | skillData.orderCount | 订单数 |

---

## 5. API接口设计

### 5.1 获取页面配置

| 属性 | 值 |
|------|------|
| 路径 | `GET /api/skill/config` |
| BFF处理 | SkillListController.getSkillConfig() |
| RPC调用 | RemoteAppUserService.querySkillServiceList() (获取tab统计) |
| 触发时机 | 页面初始化 |
| 认证要求 | 不需要登录 |

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| gameId | String | 是 | 游戏ID，如 'honor_of_kings' |

**响应数据**:
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "gameInfo": {
      "gameId": "honor_of_kings",
      "gameName": "王者荣耀",
      "icon": "https://..."
    },
    "tabs": [
      { "value": "glory_king", "label": "荣耀王者", "count": 120 },
      { "value": "boost", "label": "代练上分", "count": 85 },
      { "value": "coach", "label": "教练指导", "count": 42 },
      { "value": "companion", "label": "陪玩娱乐", "count": 200 },
      { "value": "expert", "label": "大神带飞", "count": 65 }
    ],
    "filterOptions": {
      "sortOptions": [
        { "value": "smart", "label": "智能排序" },
        { "value": "newest", "label": "最新上架" },
        { "value": "recent", "label": "最近活跃" },
        { "value": "popular", "label": "人气最高" },
        { "value": "price_asc", "label": "价格最低" },
        { "value": "price_desc", "label": "价格最高" }
      ],
      "genderOptions": [
        { "value": "all", "label": "全部" },
        { "value": "female", "label": "小姐姐" },
        { "value": "male", "label": "小哥哥" }
      ],
      "statusOptions": [
        { "value": "online", "label": "在线" },
        { "value": "active_3d", "label": "3天内活跃" },
        { "value": "active_7d", "label": "7天内活跃" }
      ],
      "regionOptions": [
        { "value": "qq", "label": "QQ区" },
        { "value": "wechat", "label": "微信区" }
      ],
      "rankOptions": [
        { "value": "glory_king", "label": "荣耀王者" },
        { "value": "king", "label": "最强王者" },
        { "value": "star", "label": "至尊星耀" },
        { "value": "diamond", "label": "永恒钻石" },
        { "value": "platinum", "label": "尊贵铂金" }
      ],
      "priceRangeOptions": [
        { "value": "4-9", "label": "4-9金币" },
        { "value": "10-19", "label": "10-19金币" },
        { "value": "20+", "label": "20金币以上" }
      ],
      "positionOptions": [
        { "value": "jungle", "label": "打野" },
        { "value": "mid", "label": "中路" },
        { "value": "top", "label": "对抗路" },
        { "value": "bot", "label": "发育路" },
        { "value": "support", "label": "辅助" }
      ],
      "tagOptions": [
        { "value": "glory_king", "label": "荣耀王者" },
        { "value": "boost", "label": "带粉上分" },
        { "value": "esports", "label": "电竞陪练师" },
        { "value": "voice", "label": "声优陪玩" },
        { "value": "official", "label": "官方认证" }
      ]
    },
    "quickTags": [
      { "id": "qt_glory", "label": "荣耀王者", "filterKey": "rank", "filterValue": "glory_king" },
      { "id": "qt_boost", "label": "带粉上分", "filterKey": "tags", "filterValue": "boost" },
      { "id": "qt_esports", "label": "电竞陪练师", "filterKey": "tags", "filterValue": "esports" },
      { "id": "qt_companion", "label": "陪玩", "filterKey": "tabType", "filterValue": "companion" }
    ]
  }
}
```

### 5.2 获取技能服务列表

| 属性 | 值 |
|------|------|
| 路径 | `GET /api/skill/list` 或 `POST /api/skill/list` |
| BFF处理 | SkillListController.getSkillList() / querySkillList() |
| RPC调用 | RemoteAppUserService.querySkillServiceList() |
| 触发时机 | 页面初始化/下拉刷新/上拉加载/筛选/Tab切换 |
| 认证要求 | 不需要登录 (登录用户可获取个性化推荐) |

**请求参数 (SkillListQueryDTO)**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| gameId | String | 是 | 游戏ID，如 'honor_of_kings' |
| tabType | String | 否 | 服务类型Tab: glory_king/boost/coach/companion/expert |
| sortBy | String | 否 | 排序方式: smart/newest/recent/popular/price_asc/price_desc |
| gender | String | 否 | 性别: all/female/male |
| pageNum | Integer | 是 | 页码，默认1 |
| pageSize | Integer | 是 | 每页数量，默认20 |
| latitude | Double | 否 | 纬度，用于距离计算 |
| longitude | Double | 否 | 经度，用于距离计算 |
| filters | SkillFiltersDTO | 否 | 高级筛选条件 (POST方法时通过Body传递) |

**高级筛选参数 (SkillFiltersDTO)**:
| 参数 | 类型 | 说明 |
|------|------|------|
| status | String | 在线状态: online/active_3d/active_7d |
| region | List\<String\> | 大区: ["qq", "wechat"] |
| rank | List\<String\> | 段位: ["glory_king", "king", "star"] |
| priceRange | String | 价格区间: 4-9/10-19/20+ |
| position | List\<String\> | 位置: ["jungle", "mid", "top", "bot", "support"] |
| tags | List\<String\> | 标签: ["glory_king", "boost", "esports"] |
| location | String | 所在地: same_city |
| cityCode | String | 城市编码 |

**响应数据**:
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "list": [
      {
        "skillId": 1001,
        "userId": 2001,
        "avatarData": {
          "avatarUrl": "https://cdn.xypai.com/avatar/user_2001.jpg"
        },
        "basicData": {
          "nickname": "GameMaster",
          "gender": "female",
          "age": 19,
          "distance": 3200,
          "distanceDisplay": "3.2km",
          "isOnline": true
        },
        "verificationData": {
          "isRealVerified": true,
          "isGodVerified": true,
          "isVip": false
        },
        "skillData": {
          "skillName": "王者荣耀陪玩",
          "gameName": "王者荣耀",
          "gameRank": "荣耀王者",
          "peakScore": 1800,
          "server": "wechat",
          "gameAttrs": {
            "position": ["jungle", "mid"],
            "tags": ["荣耀王者", "巅峰赛"]
          },
          "description": "主打野其他位置都能补...",
          "rating": 4.9,
          "orderCount": 256
        },
        "priceData": {
          "price": 10.00,
          "unit": "金币/局",
          "displayText": "10金币/局"
        }
      }
    ],
    "total": 156,
    "hasMore": true
  }
}
```

### 5.3 创建技能服务订单

| 属性 | 值 |
|------|------|
| 路径 | `POST /api/skill/order` |
| BFF处理 | SkillListController.createSkillOrder() |
| 触发时机 | 用户点击下单 |
| 认证要求 | 需要登录 |

---

## 6. DTO/VO定义

### 6.1 请求DTO - SkillListQueryDTO

```java
package org.dromara.appbff.domain.dto;

import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import lombok.Data;
import java.io.Serializable;
import java.util.List;

/**
 * Skill List Query Request DTO
 * Invocation: GET/POST /api/skill/list endpoint
 * Core Logic: Encapsulates query parameters with pagination, sorting, and filtering
 */
@Data
@Schema(description = "Skill list query request")
public class SkillListQueryDTO implements Serializable {

    private static final long serialVersionUID = 1L;

    /* ==================== Primary Query Parameters ==================== */

    @Schema(description = "Game identifier", example = "honor_of_kings", requiredMode = Schema.RequiredMode.REQUIRED)
    @NotBlank(message = "Game ID cannot be empty")
    private String gameId;

    @Schema(description = "Tab type filter: glory_king, boost, coach, companion, expert")
    private String tabType;

    @Schema(description = "Sort order: smart, newest, recent, popular, price_asc, price_desc")
    private String sortBy;

    @Schema(description = "Gender filter: all, female, male")
    private String gender;

    /* ==================== Pagination Parameters ==================== */

    @Schema(description = "Page number", example = "1", requiredMode = Schema.RequiredMode.REQUIRED)
    @NotNull(message = "Page number cannot be null")
    @Min(value = 1, message = "Page number must be at least 1")
    private Integer pageNum = 1;

    @Schema(description = "Page size", example = "20", requiredMode = Schema.RequiredMode.REQUIRED)
    @NotNull(message = "Page size cannot be null")
    @Min(value = 1, message = "Page size must be at least 1")
    private Integer pageSize = 20;

    /* ==================== Location Parameters ==================== */

    @Schema(description = "User latitude for distance calculation")
    private Double latitude;

    @Schema(description = "User longitude for distance calculation")
    private Double longitude;

    /* ==================== Advanced Filters ==================== */

    @Schema(description = "Advanced filter conditions")
    private SkillFiltersDTO filters;

    /**
     * Skill Filters Inner DTO
     * Contains advanced filtering options: status, region, rank, priceRange, position, tags, location
     */
    @Data
    @Schema(description = "Skill advanced filter conditions")
    public static class SkillFiltersDTO implements Serializable {

        private static final long serialVersionUID = 1L;

        @Schema(description = "Online status: online, active_3d, active_7d")
        private String status;

        @Schema(description = "Game region: qq, wechat")
        private List<String> region;

        @Schema(description = "Rank filter: platinum, diamond, star, king, glory_king")
        private List<String> rank;

        @Schema(description = "Price range: 4-9, 10-19, 20+")
        private String priceRange;

        @Schema(description = "Position filter: jungle, top, mid, bot, support")
        private List<String> position;

        @Schema(description = "Tag filter: glory_king, expert, peak, boost, official, voice")
        private List<String> tags;

        @Schema(description = "Location filter: same_city")
        private String location;

        @Schema(description = "City code for location filtering")
        private String cityCode;
    }
}
```

### 6.2 响应VO - SkillServiceItemVO

```java
package org.dromara.appbff.domain.vo;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import java.io.Serializable;
import java.math.BigDecimal;
import java.util.List;

/**
 * Skill Service Item VO - Single item in skill service list
 * Structure: Follows PRD specification with nested data groups
 * Data Flow: Domain Service -> BFF Assembler -> This VO -> Frontend
 */
@Data
@Schema(description = "Skill service item for list display")
public class SkillServiceItemVO implements Serializable {

    private static final long serialVersionUID = 1L;

    /* ==================== Primary Identifiers ==================== */

    @Schema(description = "Skill ID")
    private Long skillId;

    @Schema(description = "Service provider user ID")
    private Long userId;

    /* ==================== Nested Data Groups ==================== */

    @Schema(description = "Avatar display data")
    private AvatarDataVO avatarData;

    @Schema(description = "Basic user profile data")
    private BasicDataVO basicData;

    @Schema(description = "Verification badges and status")
    private VerificationDataVO verificationData;

    @Schema(description = "Skill and game related data")
    private SkillDataVO skillData;

    @Schema(description = "Pricing information")
    private PriceDataVO priceData;

    /* ==================== Nested VO Classes ==================== */

    @Data
    @Schema(description = "Avatar display data")
    public static class AvatarDataVO implements Serializable {
        private static final long serialVersionUID = 1L;

        @Schema(description = "User avatar URL")
        private String avatarUrl;
    }

    @Data
    @Schema(description = "Basic user profile data")
    public static class BasicDataVO implements Serializable {
        private static final long serialVersionUID = 1L;

        @Schema(description = "User display nickname")
        private String nickname;

        @Schema(description = "Gender: male, female")
        private String gender;

        @Schema(description = "User age")
        private Integer age;

        @Schema(description = "Distance in meters")
        private Integer distance;

        @Schema(description = "Formatted distance display")
        private String distanceDisplay;

        @Schema(description = "Online status flag")
        private Boolean isOnline;
    }

    @Data
    @Schema(description = "Verification badges and status")
    public static class VerificationDataVO implements Serializable {
        private static final long serialVersionUID = 1L;

        @Schema(description = "Real name verification status")
        private Boolean isRealVerified;

        @Schema(description = "God certification status")
        private Boolean isGodVerified;

        @Schema(description = "VIP membership status")
        private Boolean isVip;
    }

    @Data
    @Schema(description = "Skill and game related data")
    public static class SkillDataVO implements Serializable {
        private static final long serialVersionUID = 1L;

        @Schema(description = "Skill/service name")
        private String skillName;

        @Schema(description = "Game name")
        private String gameName;

        @Schema(description = "Game rank title")
        private String gameRank;

        @Schema(description = "Peak score")
        private Integer peakScore;

        @Schema(description = "Game server platform: qq, wechat")
        private String server;

        @Schema(description = "Game attributes")
        private GameAttrsVO gameAttrs;

        @Schema(description = "Service description text")
        private String description;

        @Schema(description = "Average rating (0-5)")
        private Double rating;

        @Schema(description = "Total completed order count")
        private Integer orderCount;
    }

    @Data
    @Schema(description = "Game attributes parsed from JSON")
    public static class GameAttrsVO implements Serializable {
        private static final long serialVersionUID = 1L;

        @Schema(description = "Preferred positions")
        private List<String> position;

        @Schema(description = "Skill tags")
        private List<String> tags;
    }

    @Data
    @Schema(description = "Pricing information")
    public static class PriceDataVO implements Serializable {
        private static final long serialVersionUID = 1L;

        @Schema(description = "Price amount")
        private BigDecimal price;

        @Schema(description = "Pricing unit")
        private String unit;

        @Schema(description = "Formatted price display text")
        private String displayText;
    }
}
```

### 6.3 响应VO - SkillConfigVO

```java
package org.dromara.appbff.domain.vo;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import java.io.Serializable;
import java.util.List;

/**
 * Skill Configuration Response VO
 * Contains: game info, tabs, filter options, quick tags
 */
@Data
@Schema(description = "Skill configuration response")
public class SkillConfigVO implements Serializable {

    private static final long serialVersionUID = 1L;

    @Schema(description = "Current game information")
    private GameInfoVO gameInfo;

    @Schema(description = "Tab categories")
    private List<TabVO> tabs;

    @Schema(description = "Available filter options")
    private FilterOptionsVO filterOptions;

    @Schema(description = "Quick filter tags")
    private List<QuickTagVO> quickTags;

    @Data
    public static class GameInfoVO implements Serializable {
        private static final long serialVersionUID = 1L;
        private String gameId;
        private String gameName;
        private String icon;
    }

    @Data
    public static class TabVO implements Serializable {
        private static final long serialVersionUID = 1L;
        private String value;
        private String label;
        private Integer count;
    }

    @Data
    public static class FilterOptionsVO implements Serializable {
        private static final long serialVersionUID = 1L;
        private List<OptionVO> sortOptions;
        private List<OptionVO> genderOptions;
        private List<OptionVO> statusOptions;
        private List<OptionVO> regionOptions;
        private List<OptionVO> rankOptions;
        private List<OptionVO> priceRangeOptions;
        private List<OptionVO> positionOptions;
        private List<OptionVO> tagOptions;
    }

    @Data
    public static class OptionVO implements Serializable {
        private static final long serialVersionUID = 1L;
        private String value;
        private String label;
    }

    @Data
    public static class QuickTagVO implements Serializable {
        private static final long serialVersionUID = 1L;
        private String id;
        private String label;
        private String filterKey;
        private String filterValue;
    }
}
```

### 6.4 响应VO - SkillListResultVO

```java
package org.dromara.appbff.domain.vo;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import java.io.Serializable;
import java.util.List;

/**
 * Skill Service List Result VO
 * Response wrapper for paginated skill service list queries
 */
@Data
@Schema(description = "技能服务列表结果")
public class SkillListResultVO implements Serializable {

    private static final long serialVersionUID = 1L;

    @Schema(description = "技能服务列表")
    private List<SkillServiceItemVO> list;

    @Schema(description = "总数量")
    private Long total;

    @Schema(description = "是否有更多")
    private Boolean hasMore;
}
```

---

## 7. Controller实现 (BFF层)

```java
package org.dromara.appbff.controller;

import org.dromara.appbff.domain.dto.SkillListQueryDTO;
import org.dromara.appbff.domain.dto.ServiceOrderDTO;
import org.dromara.appbff.domain.vo.*;
import org.dromara.appbff.service.SkillListService;
import org.dromara.common.core.domain.R;
import org.dromara.common.satoken.utils.LoginHelper;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

/**
 * SkillListController - New skill service list page API
 * Endpoints: /api/skill/config, /api/skill/list, /api/skill/order
 */
@RestController
@RequestMapping("/api/skill")
@Tag(name = "技能服务列表", description = "新版技能服务列表页接口")
@RequiredArgsConstructor
@Validated
public class SkillListController {

    private final SkillListService skillListService;

    /**
     * Get skill list page configuration
     * @对应前端 skillApi.getConfig()
     */
    @GetMapping("/config")
    @Operation(summary = "获取技能列表页配置")
    public R<SkillConfigVO> getSkillConfig(
        @Parameter(description = "游戏ID") @RequestParam String gameId) {
        return R.ok(skillListService.getSkillConfig(gameId));
    }

    /**
     * Query skill service list (GET method)
     * @对应前端 skillApi.getList()
     */
    @GetMapping("/list")
    @Operation(summary = "获取技能服务列表")
    public R<SkillListResultVO> getSkillList(@Valid SkillListQueryDTO queryDTO) {
        Long userId = LoginHelper.getUserId();
        return R.ok(skillListService.querySkillList(queryDTO, userId));
    }

    /**
     * Query skill service list (POST method with complex filters)
     * @对应前端 skillApi.getList() with advanced filters
     */
    @PostMapping("/list")
    @Operation(summary = "获取技能服务列表(POST)")
    public R<SkillListResultVO> querySkillList(
        @ModelAttribute SkillListQueryDTO queryDTO,
        @RequestBody(required = false) SkillListQueryDTO.SkillFiltersDTO filters) {
        if (filters != null) {
            queryDTO.setFilters(filters);
        }
        Long userId = LoginHelper.getUserId();
        return R.ok(skillListService.querySkillList(queryDTO, userId));
    }

    /**
     * Create skill service order
     * @对应前端 skillApi.createOrder()
     */
    @PostMapping("/order")
    @Operation(summary = "创建技能服务订单")
    public R<ServiceOrderResultVO> createSkillOrder(@Valid @RequestBody ServiceOrderDTO orderDTO) {
        Long userId = LoginHelper.getUserId();
        return R.ok(skillListService.createSkillOrder(orderDTO, userId));
    }
}
```

---

## 8. Service实现 (BFF层)

```java
package org.dromara.appbff.service.impl;

import lombok.RequiredArgsConstructor;
import org.apache.dubbo.config.annotation.DubboReference;
import org.dromara.appbff.domain.dto.SkillListQueryDTO;
import org.dromara.appbff.domain.vo.*;
import org.dromara.appbff.service.SkillListService;
import org.dromara.appuser.api.RemoteAppUserService;
import org.dromara.appuser.api.domain.dto.SkillServiceQueryDto;
import org.dromara.appuser.api.domain.vo.SkillServicePageResult;
import org.dromara.appuser.api.domain.vo.SkillServiceVo;
import org.springframework.stereotype.Service;

/**
 * Skill List Service Implementation (BFF Layer)
 * Invocation: SkillController -> SkillListService -> RemoteAppUserService (Dubbo RPC)
 * Core Logic: Orchestrates RPC calls, transforms DTOs/VOs for frontend
 */
@Service
@RequiredArgsConstructor
public class SkillListServiceImpl implements SkillListService {

    @DubboReference
    private RemoteAppUserService remoteAppUserService;

    private static final Map<String, String> GAME_NAME_MAP = Map.of(
        "honor_of_kings", "王者荣耀",
        "league_of_legends", "英雄联盟",
        "peace_elite", "和平精英"
    );

    @Override
    public SkillConfigVO getSkillConfig(String gameId) {
        // Build game info, tabs, filter options, quick tags
        // See actual implementation for full details
    }

    @Override
    public SkillListResultVO querySkillList(SkillListQueryDTO queryDTO, Long userId) {
        // Convert BFF DTO to remote DTO
        SkillServiceQueryDto remoteQueryDto = convertToRemoteQueryDto(queryDTO, userId);

        // Call remote service via Dubbo RPC
        SkillServicePageResult remoteResult = remoteAppUserService.querySkillServiceList(remoteQueryDto);

        // Transform remote VOs to BFF VOs
        // Return SkillListResultVO with list, total, hasMore
    }

    /**
     * Field Mapping: BFF -> Remote
     * gameId -> skillType
     * tabType -> tabType
     * sortBy -> sortBy
     * gender -> gender
     * pageNum -> pageNum
     * pageSize -> pageSize
     * filters.region -> gameArea (take first)
     * filters.rank -> ranks
     * filters.priceRange -> priceRanges
     * filters.position -> positions
     * filters.tags -> tags
     */
    private SkillServiceQueryDto convertToRemoteQueryDto(SkillListQueryDTO dto, Long userId) {
        // Conversion logic
    }
}
```

---

## 9. Gateway配置

```yaml
# ruoyi-gateway 路由配置
# 路由到BFF服务

spring:
  cloud:
    gateway:
      routes:
        # xypai-app-bff 技能服务列表路由
        - id: xypai-app-bff-skill
          uri: lb://xypai-app-bff
          predicates:
            - Path=/api/skill/**
          filters:
            - StripPrefix=0
```

### 架构图

```
┌─────────────────┐
│   App 客户端     │
└────────┬────────┘
         │ REST API
         │ /api/skill/*
         ↓
┌─────────────────┐
│  Gateway (8080) │  ← 路由到 BFF 服务
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│ xypai-app-bff   │  ← 接收 /api/skill/* 请求
│ (端口: 9400)    │     SkillListController
└────────┬────────┘
         │ Dubbo RPC 调用
         │ RemoteAppUserService
         ↓
┌─────────────────┐
│  xypai-user     │  ← 领域服务实现
│  (端口: 9401)   │     RemoteAppUserServiceImpl
└────────┬────────┘
         │ MyBatis Plus
         ↓
┌─────────────────┐
│ xypai_user      │  ← MySQL 数据库
│ (skills + users)│
└─────────────────┘
```

---

## 10. 前后端字段对照表

| 前端参数 | BFF DTO | 远程RPC DTO | 说明 |
|---------|---------|------------|------|
| gameId | gameId | skillType | 游戏标识 |
| tabType | tabType | tabType | Tab类型 |
| sortBy | sortBy | sortBy | 排序方式 |
| gender | gender | gender | 性别筛选 |
| pageNum | pageNum | pageNum | 页码 |
| pageSize | pageSize | pageSize | 每页数量 |
| latitude | latitude | latitude | 纬度 |
| longitude | longitude | longitude | 经度 |
| filters.status | filters.status | status | 在线状态 |
| filters.region | filters.region | gameArea | 大区 |
| filters.rank | filters.rank | ranks | 段位 |
| filters.priceRange | filters.priceRange | priceRanges | 价格区间 |
| filters.position | filters.position | positions | 位置 |
| filters.tags | filters.tags | tags | 标签 |
| filters.cityCode | filters.cityCode | cityCode | 城市编码 |

---

## 11. 实现状态

- [x] SkillListController.java - REST API 已实现
- [x] SkillListQueryDTO.java - 请求参数 已实现
- [x] SkillFiltersDTO.java - 高级筛选 已实现
- [x] SkillConfigVO.java - 配置响应 已实现
- [x] SkillListResultVO.java - 列表结果 已实现
- [x] SkillServiceItemVO.java - 列表项 已实现
- [x] SkillListService.java - 服务接口 已实现
- [x] SkillListServiceImpl.java - 服务实现 已实现
- [x] Gateway路由配置 已配置

---

## 12. 质量检查清单

### 12.1 DTO/VO
- [x] DTO字段与前端对齐 (gameId, tabType, sortBy, pageNum)
- [x] VO使用嵌套结构 (avatarData, basicData, verificationData, skillData, priceData)
- [x] 所有字段都有@Schema注解

### 12.2 Controller
- [x] Controller使用 `R<T>` 响应包装
- [x] API路径符合规范 `/api/skill/**`
- [x] 支持GET和POST两种方式查询列表
- [x] 已添加Swagger注解

### 12.3 配置
- [x] Gateway路由已配置到 xypai-app-bff
- [x] 路由Path与Controller路径一致

---

*文档版本: v2.0*
*最后更新: 2025-12-09*

## 更新记录

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v2.0 | 2025-12-09 | 全面对齐实际BFF实现: API路径 `/api/service/*` → `/api/skill/*`; 参数名 serviceType/sortType/page → tabType/sortBy/pageNum; 添加嵌套filters结构; Controller更新为SkillListController; 更新所有DTO/VO代码 |
| v1.1 | 2025-12-09 | 对齐BFF架构 |
| v1.0 | 2025-12-08 | 初始版本 |
