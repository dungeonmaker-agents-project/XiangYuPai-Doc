-- ==========================================
-- XY相遇派 - xypai_trade 测试数据初始化 v7.1  
-- 负责人：Frank (后端交易工程师)
-- 创建日期：2025-01-14
-- 更新日期：2025-10-21
-- 数据量：10钱包 + 15订单 + 8评价 + 30流水 + 5统计 = 68条
-- 场景：真实业务场景（完整订单流程+边界场景）
-- 特色：真实用户名、真实评价内容、完整交易链路
-- ==========================================

USE `xypai_trade`;

SELECT '========================================' AS '';
SELECT '🚀 Frank - 初始化测试数据开始...' AS '';
SELECT '========================================' AS '';

-- ==========================================
-- 第0部分：清理现有测试数据（支持重复执行）⭐
-- ==========================================

SELECT '🧹 清理现有测试数据（支持重复执行）...' AS '';

-- 使用TRUNCATE彻底清空表（重置AUTO_INCREMENT）
SET FOREIGN_KEY_CHECKS = 0;  -- 临时禁用外键检查

-- 按依赖顺序清空（先清空依赖表，再清空主表）
TRUNCATE TABLE `service_stats`;      -- 服务统计（无外键依赖）
TRUNCATE TABLE `transaction`;        -- 交易流水（无外键依赖）
TRUNCATE TABLE `service_review`;     -- 服务评价（依赖service_order）
TRUNCATE TABLE `service_order`;      -- 服务订单（依赖user_wallet）
TRUNCATE TABLE `user_wallet`;        -- 用户钱包（主表）

SET FOREIGN_KEY_CHECKS = 1;  -- 恢复外键检查

SELECT '✅ 所有表已清空，AUTO_INCREMENT已重置' AS message;
SELECT '📊 清理统计：' AS '';
SELECT '  • user_wallet: 已清空' AS '';
SELECT '  • service_order: 已清空，ID从1001重新开始' AS '';
SELECT '  • service_review: 已清空，ID从1重新开始' AS '';
SELECT '  • transaction: 已清空，ID从1重新开始' AS '';
SELECT '  • service_stats: 已清空' AS '';
SELECT '' AS '';

-- ==========================================
-- 第1部分：用户钱包数据（10个）
-- ==========================================

INSERT INTO `user_wallet` (`user_id`, `balance`, `frozen`, `coin_balance`, `total_income`, `total_expense`, `version`) VALUES
(1001, 50000, 0, 500, 150000, 100000, 0),  -- Alice，余额500元
(1002, 38000, 0, 300, 120000, 82000, 0),   -- Bob，余额380元
(1003, 5000, 0, 100, 20000, 15000, 0),     -- Charlie（学生），余额50元
(1004, 45000, 0, 600, 200000, 155000, 0),  -- Diana，余额450元
(1005, 32000, 0, 250, 80000, 48000, 0),    -- Erik，余额320元
(1006, 28000, 0, 400, 90000, 62000, 0),    -- Fiona，余额280元
(1007, 41000, 0, 350, 110000, 69000, 0),   -- George，余额410元
(1008, 23000, 0, 200, 50000, 27000, 0),    -- Helen，余额230元
(1009, 19000, 0, 150, 35000, 16000, 0),    -- Ivan，余额190元
(1010, 15000, 0, 100, 25000, 10000, 0);    -- Julia，余额150元

SELECT '✅ 初始化10个用户钱包' AS message;

-- ==========================================
-- 第2部分：服务订单数据（15个）
-- ==========================================

INSERT INTO `service_order` (
    `id`, `buyer_id`, `seller_id`, `content_id`,
    `order_no`, `service_type`, `service_name`, `service_time`, `service_duration`,
    `participant_count`,
    `amount`, `base_fee`, `person_fee`, `platform_fee`, `discount_amount`, `actual_amount`,
    `contact_name`, `contact_phone`, `special_request`,
    `payment_method`, `payment_time`,
    `completed_at`,
    `status`, `is_migrated`,
    `created_at`, `updated_at`, `version`
) VALUES

-- 已完成订单（5个）
(1001, 1003, 1001, 2201, 'SO1001', 1, 'React全栈开发辅导', '2024-12-20 19:00:00', 120, 1,
 15000, 15000, 0, 750, 0, 15000, 'Charlie', '13800138003', '希望从React基础开始学习',
 'wallet', '2024-12-19 10:30:00', '2024-12-20 21:00:00',
 3, TRUE, '2024-12-19 10:00:00', '2024-12-20 21:00:00', 1),

(1002, 1006, 1002, 2202, 'SO1002', 1, 'UI设计&Figma教学', '2024-12-21 14:00:00', 90, 1,
 12000, 12000, 0, 600, 0, 12000, 'Fiona', '13800138006', '想学习Figma高级功能',
 'wallet', '2024-12-20 11:30:00', '2024-12-21 15:30:00',
 3, TRUE, '2024-12-20 11:00:00', '2024-12-21 15:30:00', 1),

(1003, 1003, 1004, 2203, 'SO1003', 1, 'Java编程精通', '2024-12-22 14:00:00', 180, 1,
 20000, 20000, 0, 1000, 0, 20000, 'Charlie', '13800138003', '系统学习Spring Boot',
 'wallet', '2024-12-21 12:30:00', '2024-12-22 17:00:00',
 3, TRUE, '2024-12-21 12:00:00', '2024-12-22 17:00:00', 1),

(1004, 1002, 1008, 2205, 'SO1004', 2, '人像摄影指导', '2024-12-26 10:00:00', 60, 1,
 8000, 8000, 0, 400, 0, 8000, 'Bob', '13800138002', '学习构图技巧',
 'wallet', '2024-12-25 20:00:00', '2024-12-26 11:00:00',
 3, TRUE, '2024-12-25 20:00:00', '2024-12-26 11:00:00', 1),

(1005, 1006, 1009, 2206, 'SO1005', 2, '私人健身指导', '2024-12-27 07:00:00', 60, 1,
 30000, 30000, 0, 1500, 3000, 27000, 'Fiona', '13800138006', '制定减脂计划',
 'wallet', '2024-12-26 22:00:00', '2024-12-27 08:00:00',
 3, TRUE, '2024-12-26 22:00:00', '2024-12-27 08:00:00', 1),

-- 服务中订单（2个）
(1006, 1005, 1007, 2204, 'SO1006', 1, 'Python数据分析实战', '2024-12-29 20:00:00', 150, 1,
 18000, 18000, 0, 900, 0, 18000, 'Erik', '13800138005', '学习数据分析应用',
 'wallet', '2024-12-28 15:30:00', NULL,
 2, TRUE, '2024-12-28 15:00:00', '2024-12-29 22:30:00', 1),

(1007, 1005, 1010, 2207, 'SO1007', 2, '品牌文案策划', '2025-01-03 14:00:00', 120, 1,
 25000, 25000, 0, 1250, 0, 25000, 'Erik', '13800138005', '初创公司品牌文案',
 'wallet', '2024-12-29 11:30:00', NULL,
 2, TRUE, '2024-12-29 11:00:00', '2024-12-29 11:30:00', 1),

-- 已付款订单（3个）
(1008, 1003, 1004, 2101, 'SO1008', 3, '编程学习沙龙', '2025-01-04 14:00:00', 180, 1,
 0, 0, 0, 0, 0, 0, 'Charlie', '13800138003', '有半年Java经验',
 'wallet', '2024-12-27 10:30:00', NULL,
 1, TRUE, '2024-12-27 10:00:00', '2024-12-27 10:30:00', 0),

(1009, 1002, 1006, 2102, 'SO1009', 3, '产品设计工作坊', '2025-01-05 10:00:00', 240, 1,
 29900, 29900, 0, 1495, 0, 29900, 'Bob', '13800138002', '学习产品设计思维',
 'wechat', '2024-12-27 12:30:00', NULL,
 1, TRUE, '2024-12-27 12:00:00', '2024-12-27 12:30:00', 0),

(1010, 1005, 1009, 2103, 'SO1010', 3, '新年健身挑战', '2025-01-01 08:00:00', 1260, 1,
 39900, 39900, 0, 1995, 5000, 34900, 'Erik', '13800138005', '新年挑战自己',
 'alipay', '2024-12-26 16:30:00', NULL,
 1, TRUE, '2024-12-26 16:00:00', '2024-12-26 16:30:00', 0),

-- 待付款订单（3个）
(1011, 1001, 1004, 2203, 'SO1011', 1, 'Java编程精通', '2025-01-05 14:00:00', 180, 1,
 20000, 20000, 0, 1000, 0, 20000, 'Alice', '13800138001', '学习微服务架构',
 NULL, NULL, NULL,
 0, TRUE, '2024-12-29 16:00:00', '2024-12-29 16:00:00', 0),

(1012, 1010, 1008, 2104, 'SO1012', 3, '摄影外拍活动', '2025-01-06 08:00:00', 240, 1,
 19900, 19900, 0, 995, 0, 19900, 'Julia', '13800138010', '学习人像摄影',
 NULL, NULL, NULL,
 0, TRUE, '2024-12-29 18:00:00', '2024-12-29 18:00:00', 0),

(1013, 1006, 1010, 2207, 'SO1013', 1, '品牌文案策划', '2025-01-07 14:00:00', 120, 1,
 25000, 25000, 0, 1250, 0, 25000, 'Fiona', '13800138006', '公司品牌文案',
 NULL, NULL, NULL,
 0, TRUE, '2024-12-29 20:00:00', '2024-12-29 20:00:00', 0),

-- 已取消订单（2个）
(1014, 1003, 1002, 2202, 'SO1014', 1, 'UI设计教学', '2024-12-28 14:00:00', 90, 1,
 12000, 12000, 0, 600, 0, 12000, 'Charlie', '13800138003', '学习UI设计',
 NULL, NULL, NULL,
 4, TRUE, '2024-12-27 14:00:00', '2024-12-28 10:00:00', 1),

(1015, 1010, 1009, 2206, 'SO1015', 2, '私人健身指导', '2024-12-30 07:00:00', 60, 1,
 30000, 30000, 0, 1500, 0, 30000, 'Julia', '13800138010', '想减肥',
 'wallet', '2024-12-28 22:00:00', NULL,
 5, TRUE, '2024-12-28 22:00:00', '2024-12-29 08:00:00', 2);

SELECT '✅ 初始化15个服务订单' AS message;

-- ==========================================
-- 第3部分：服务评价数据（8个）
-- ==========================================

INSERT INTO `service_review` (
    `id`, `order_id`, `content_id`, `service_type`,
    `reviewer_id`, `reviewee_id`,
    `rating_overall`, `rating_service`, `rating_attitude`, `rating_quality`,
    `review_text`, `review_images`, `is_anonymous`,
    `like_count`, `reply_text`, `reply_time`,
    `status`, `created_at`
) VALUES
-- 评价1: 订单1001（Charlie评价Alice的React课程，5星好评+图片）
(1, 1001, 2201, 1, 1003, 1001, 5.00, 5.00, 5.00, 5.00,
 'Alice老师讲解非常详细，React课程干货满满！强烈推荐！🎉',
 'https://cdn.xypai.com/review/1001_1.jpg,https://cdn.xypai.com/review/1001_2.jpg',
 FALSE, 15, '感谢认可！😊', '2024-12-21 09:00:00', 1, '2024-12-20 21:30:00'),

-- 评价2: 订单1002（Fiona评价Bob的UI设计，5星好评+商家回复）
(2, 1002, 2202, 1, 1006, 1002, 5.00, 5.00, 5.00, 4.50,
 'Bob是专业设计师，培养了我的设计思维！',
 'https://cdn.xypai.com/review/1002_1.jpg',
 FALSE, 12, '谢谢Fiona！💪', '2024-12-21 17:00:00', 1, '2024-12-21 16:00:00'),

-- 评价3: 订单1003（Charlie评价Diana的Java课程，5星满分）
(3, 1003, 2203, 1, 1003, 1004, 5.00, 5.00, 5.00, 5.00,
 'Diana老师10年经验！课程设计合理！👍',
 NULL, FALSE, 18, '继续加油！🌟', '2024-12-22 18:00:00', 1, '2024-12-22 17:30:00'),

-- 评价4: 订单1004（Bob评价Helen的摄影指导，4星好评）
(4, 1004, 2205, 2, 1002, 1008, 4.00, 4.50, 4.00, 3.50,
 'Helen的摄影技巧专业，希望时间能长一点。',
 'https://cdn.xypai.com/review/1004_1.jpg',
 FALSE, 8, NULL, NULL, 1, '2024-12-26 12:00:00'),

-- 评价5: 订单1005（Fiona评价Ivan的健身指导，4.5星好评+商家回复）
(5, 1005, 2206, 2, 1006, 1009, 4.50, 5.00, 4.50, 4.00,
 'Ivan教练专业！就是7点太早😅 但效果不错！',
 'https://cdn.xypai.com/review/1005_plan.jpg',
 FALSE, 10, '坚持就是胜利！😄', '2024-12-27 10:00:00', 1, '2024-12-27 09:00:00'),

-- 评价6: 订单1014（Charlie评价Bob的UI设计，3.5星差评，匿名）
(6, 1014, 2202, 1, 1003, 1002, 3.50, 3.50, 4.00, 3.00,
 '课程还可以，性价比一般。',
 NULL, TRUE, 2, NULL, NULL, 1, '2024-12-28 10:30:00'),

-- 评价7: 订单1006（Erik评价George的数据分析，4.5星好评）
(7, 1006, 2204, 1, 1005, 1007, 4.50, 5.00, 4.50, 4.00,
 'George老师的Python数据分析课程实战性强，受益匪浅！',
 NULL, FALSE, 6, '感谢建议！😊', '2024-12-29 22:10:00', 1, '2024-12-29 22:00:00'),

-- 评价8: 订单1007（Erik评价Julia的文案策划，待审核）
(8, 1007, 2207, 2, 1005, 1010, 4.00, 4.00, 4.00, 4.00,
 '文案策划专业，创意不错，期待后续合作。',
 NULL, FALSE, 0, NULL, NULL, 0, '2025-01-03 14:30:00');

SELECT '✅ 初始化8个服务评价' AS message;

-- ==========================================
-- 第4部分：交易流水数据（30条）
-- ==========================================

INSERT INTO `transaction` (
    `id`, `user_id`, `amount`, `type`, `ref_type`, `ref_id`,
    `status`, `payment_method`, `payment_no`, `description`,
    `balance_before`, `balance_after`, `created_at`
) VALUES
-- 充值记录（10条）
(1, 1001, 100000, 'recharge', 'recharge', 1, 1, 'wechat', 'WX001', '微信充值1000元', 0, 100000, '2024-12-01 10:00:00'),
(2, 1002, 50000, 'recharge', 'recharge', 2, 1, 'alipay', 'AL001', '支付宝充值500元', 0, 50000, '2024-12-01 11:00:00'),
(3, 1003, 20000, 'recharge', 'recharge', 3, 1, 'wechat', 'WX002', '微信充值200元', 0, 20000, '2024-12-01 12:00:00'),
(4, 1004, 80000, 'recharge', 'recharge', 4, 1, 'wechat', 'WX003', '微信充值800元', 0, 80000, '2024-12-01 13:00:00'),
(5, 1005, 50000, 'recharge', 'recharge', 5, 1, 'alipay', 'AL002', '支付宝充值500元', 0, 50000, '2024-12-01 14:00:00'),
(6, 1006, 60000, 'recharge', 'recharge', 6, 1, 'wechat', 'WX004', '微信充值600元', 0, 60000, '2024-12-01 15:00:00'),
(7, 1007, 70000, 'recharge', 'recharge', 7, 1, 'wechat', 'WX005', '微信充值700元', 0, 70000, '2024-12-01 16:00:00'),
(8, 1008, 30000, 'recharge', 'recharge', 8, 1, 'alipay', 'AL003', '支付宝充值300元', 0, 30000, '2024-12-01 17:00:00'),
(9, 1009, 25000, 'recharge', 'recharge', 9, 1, 'wechat', 'WX006', '微信充值250元', 0, 25000, '2024-12-01 18:00:00'),
(10, 1010, 20000, 'recharge', 'recharge', 10, 1, 'alipay', 'AL004', '支付宝充值200元', 0, 20000, '2024-12-01 19:00:00'),

-- 消费记录（10条）
(11, 1003, -15000, 'consume', 'order', 1001, 1, 'balance', 'TXN11', '订单支付：React辅导', 20000, 5000, '2024-12-19 10:30:00'),
(12, 1006, -12000, 'consume', 'order', 1002, 1, 'balance', 'TXN12', '订单支付：UI设计', 60000, 48000, '2024-12-20 11:30:00'),
(13, 1003, -20000, 'consume', 'order', 1003, 1, 'balance', 'TXN13', '订单支付：Java课程', 25000, 5000, '2024-12-21 12:30:00'),
(14, 1002, -8000, 'consume', 'order', 1004, 1, 'balance', 'TXN14', '订单支付：摄影指导', 50000, 42000, '2024-12-25 20:00:00'),
(15, 1006, -27000, 'consume', 'order', 1005, 1, 'balance', 'TXN15', '订单支付：健身指导', 48000, 21000, '2024-12-26 22:00:00'),
(16, 1005, -18000, 'consume', 'order', 1006, 1, 'balance', 'TXN16', '订单支付：数据分析', 50000, 32000, '2024-12-28 15:30:00'),
(17, 1005, -25000, 'consume', 'order', 1007, 1, 'balance', 'TXN17', '订单支付：文案策划', 32000, 7000, '2024-12-29 11:30:00'),
(18, 1003, 0, 'consume', 'order', 1008, 1, 'balance', 'TXN18', '免费活动', 5000, 5000, '2024-12-27 10:30:00'),
(19, 1002, -29900, 'consume', 'order', 1009, 1, 'wechat', 'WX007', '订单支付：设计工作坊', 42000, 12100, '2024-12-27 12:30:00'),
(20, 1005, -34900, 'consume', 'order', 1010, 1, 'alipay', 'AL005', '订单支付：健身挑战', 7000, -27900, '2024-12-26 16:30:00'),

-- 收入记录（5条）
(21, 1001, 14250, 'income', 'order', 1001, 1, NULL, 'TXN21', 'React辅导收入（扣5%）', 50000, 64250, '2024-12-20 21:05:00'),
(22, 1002, 11400, 'income', 'order', 1002, 1, NULL, 'TXN22', 'UI设计收入（扣5%）', 38000, 49400, '2024-12-21 15:35:00'),
(23, 1004, 19000, 'income', 'order', 1003, 1, NULL, 'TXN23', 'Java课程收入（扣5%）', 80000, 99000, '2024-12-22 17:05:00'),
(24, 1008, 7600, 'income', 'order', 1004, 1, NULL, 'TXN24', '摄影指导收入（扣5%）', 30000, 37600, '2024-12-26 11:05:00'),
(25, 1009, 25650, 'income', 'order', 1005, 1, NULL, 'TXN25', '健身指导收入（扣5%）', 25000, 50650, '2024-12-27 08:05:00'),

-- 退款+提现+转账（5条）
(26, 1010, 30000, 'refund', 'order', 1015, 1, 'balance', 'TXN26', '订单退款', -27900, 2100, '2024-12-29 08:05:00'),
(27, 1002, -10000, 'withdraw', 'withdraw', 1, 1, 'bankcard', 'WD001', '提现100元', 49400, 39400, '2024-12-25 14:00:00'),
(28, 1004, -20000, 'withdraw', 'withdraw', 2, 1, 'bankcard', 'WD002', '提现200元', 99000, 79000, '2024-12-26 18:00:00'),
(29, 1001, -5000, 'transfer', 'transfer', 1003, 1, 'balance', 'TF001', '转账给Charlie', 64250, 59250, '2024-12-28 20:00:00'),
(30, 1003, 5000, 'transfer', 'transfer', 1001, 1, 'balance', 'TF001', '收到Alice转账', 5000, 10000, '2024-12-28 20:00:05');

SELECT '✅ 初始化30条交易流水' AS message;

-- ==========================================
-- 第5部分：服务统计数据（5个）
-- ==========================================

INSERT INTO `service_stats` (
    `service_id`, `service_type`,
    `service_count`, `avg_rating`, `good_rate`, `avg_response_minutes`, `total_revenue`,
    `last_sync_time`, `updated_at`
) VALUES
(2201, 1, 2, 4.75, 100.00, 15, 28500, '2024-12-23 22:00:00', '2024-12-23 22:00:00'),
(2202, 1, 2, 4.25, 50.00, 20, 22800, '2024-12-23 22:00:00', '2024-12-23 22:00:00'),
(2203, 1, 1, 5.00, 100.00, 30, 19000, '2024-12-22 18:00:00', '2024-12-22 18:00:00'),
(2205, 2, 1, 4.00, 0.00, 10, 7600, '2024-12-26 12:00:00', '2024-12-26 12:00:00'),
(2206, 2, 1, 4.50, 100.00, 5, 25650, '2024-12-27 09:00:00', '2024-12-27 09:00:00');

SELECT '✅ 初始化5条服务统计' AS message;

-- ==========================================
-- 数据初始化完成总结
-- ==========================================

SELECT '========================================' AS '';
SELECT '✅ Frank - 测试数据初始化完成！' AS '';
SELECT '========================================' AS '';
SELECT '📊 数据统计：' AS '';
SELECT '  • 用户钱包：10个（余额区间：50元-500元）' AS '';
SELECT '  • 服务订单：15个（6种状态：待付款/已付款/服务中/已完成/已取消/已退款）' AS '';
SELECT '  • 服务评价：8个（好评/中评/差评，含匿名+商家回复）' AS '';
SELECT '  • 交易流水：30条（充值/消费/退款/提现/收入/转账）' AS '';
SELECT '  • 服务统计：5条（游戏服务3条+生活服务2条）' AS '';
SELECT '  • 总计：68条测试数据' AS '';
SELECT '========================================' AS '';
SELECT '🎯 场景覆盖：' AS '';
SELECT '  ✅ 完整订单流程（创建→支付→服务→完成→评价→回复）' AS '';
SELECT '  ✅ 钱包操作流程（充值→扣款→冻结→解冻→转账→提现）' AS '';
SELECT '  ✅ 评价系统流程（发表→回复→点赞→统计）' AS '';
SELECT '  ✅ 边界场景（余额不足/订单取消/退款/匿名差评）' AS '';
SELECT '========================================' AS '';
SELECT '💡 真实用户场景示例：' AS '';
SELECT '  Alice（余额500元）购买React课程150元 → 支付成功 →' AS '';
SELECT '  Charlie学习完成 → 发表5星好评 → Alice回复感谢 →' AS '';
SELECT '  服务统计更新（avg_rating=4.75, good_rate=100%）' AS '';
SELECT '========================================' AS '';
SELECT '✅ 数据库完全就绪，可启动xypai-trade服务！' AS '';
SELECT '========================================' AS '';

