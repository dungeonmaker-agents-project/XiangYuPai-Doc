# 关注粉丝接口文档

## 概述
本文档定义粉丝与关注功能的所有接口,包括查看粉丝列表、关注列表、搜索粉丝、关注/取消关注操作等。

---

## 一、查看粉丝列表

### 用户操作
1. 点击"我的"页面的"粉丝"入口
2. 系统跳转到粉丝页面,默认显示"粉丝"Tab
3. **页面加载完成** → 触发接口

### 接口定义
**接口:** `GET /api/users/fans`

**参数:**
```typescript
{
  page: number;        // 页码,从1开始
  pageSize: number;    // 每页数量,建议20
  userId?: string;     // 可选,查看指定用户的粉丝(不传则查看当前登录用户)
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "获取成功",
  data: {
    total: number;     // 粉丝总数
    hasMore: boolean;  // 是否还有更多数据
    list: Array<{
      userId: string;              // 用户ID
      nickname: string;            // 用户昵称
      avatar: string;              // 头像URL
      signature: string;           // 个性签名
      gender: "male" | "female";   // 性别
      age: number;                 // 年龄
      isVerified: boolean;         // 是否实名认证
      followStatus: "none" | "following" | "mutual";  // 关注状态: 未关注/已关注/互相关注
      followTime: string;          // 关注时间 (ISO 8601格式)
    }>;
  }
}
```

### 前端验证
- 必须已登录
- page 必须 ≥ 1
- pageSize 建议 20,范围 10-50

### 前端行为
- 成功后:
  - 显示粉丝列表
  - 根据 followStatus 显示不同按钮状态
    - "none" → 显示"关注"按钮(紫色填充)
    - "following" → 显示"已关注"按钮(浅紫色描边)
    - "mutual" → 显示"互相关注"按钮(浅紫色描边)
  - 实名认证用户显示"实名认证"标签
  - 底部支持上拉加载更多
  - 显示"没有更多了"提示(当 hasMore=false)
- 失败后:显示错误提示

---

## 二、查看关注列表

### 用户操作
1. 点击"我的"页面的"关注"入口,或在粉丝页面切换到"关注"Tab
2. **Tab切换完成/页面加载完成** → 触发接口

### 接口定义
**接口:** `GET /api/users/following`

**参数:**
```typescript
{
  page: number;        // 页码,从1开始
  pageSize: number;    // 每页数量,建议20
  userId?: string;     // 可选,查看指定用户的关注列表(不传则查看当前登录用户)
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "获取成功",
  data: {
    total: number;     // 关注总数
    hasMore: boolean;  // 是否还有更多数据
    list: Array<{
      userId: string;              // 用户ID
      nickname: string;            // 用户昵称
      avatar: string;              // 头像URL
      signature: string;           // 个性签名
      gender: "male" | "female";   // 性别
      age: number;                 // 年龄
      isVerified: boolean;         // 是否实名认证
      followStatus: "following" | "mutual";  // 关注状态: 已关注/互相关注(关注列表中不会有none状态)
      followTime: string;          // 关注时间 (ISO 8601格式)
    }>;
  }
}
```

### 前端验证
- 必须已登录
- page 必须 ≥ 1
- pageSize 建议 20,范围 10-50

### 前端行为
- 成功后:
  - 显示关注列表
  - 根据 followStatus 显示不同按钮状态
    - "following" → 显示"已关注"按钮(浅紫色描边)
    - "mutual" → 显示"互相关注"按钮(浅紫色描边)
  - 实名认证用户显示"实名认证"标签
  - 底部支持上拉加载更多
  - 显示"没有更多了"提示(当 hasMore=false)
- 失败后:显示错误提示

---

## 三、搜索粉丝

### 用户操作
1. 在"粉丝"Tab页面,点击右上角搜索图标
2. 打开搜索页面,输入框自动聚焦
3. 输入搜索关键词
4. **输入完成(防抖500ms)** → 触发接口

### 接口定义
**接口:** `GET /api/users/fans/search`

**参数:**
```typescript
{
  keyword: string;     // 搜索关键词(搜索用户昵称)
  page: number;        // 页码,从1开始
  pageSize: number;    // 每页数量,建议20
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "搜索成功",
  data: {
    total: number;     // 搜索结果总数
    hasMore: boolean;  // 是否还有更多数据
    list: Array<{
      userId: string;              // 用户ID
      nickname: string;            // 用户昵称(高亮匹配关键词)
      avatar: string;              // 头像URL
      signature: string;           // 个性签名
      gender: "male" | "female";   // 性别
      age: number;                 // 年龄
      isVerified: boolean;         // 是否实名认证
      followStatus: "none" | "following" | "mutual";  // 关注状态
      followTime: string;          // 关注时间
    }>;
  }
}
```

### 前端验证
- keyword 不能为空
- keyword 长度 1-30 字符
- 输入防抖处理(500ms)

### 前端行为
- 成功后:
  - 显示搜索结果列表
  - 关键词高亮显示(用户昵称中匹配的部分)
  - 空结果时显示"暂无搜索结果"提示
  - 支持上拉加载更多搜索结果
- 失败后:显示错误提示
- 点击"取消"按钮:返回粉丝列表页面,不保存搜索状态

---

## 四、搜索关注列表

### 用户操作
1. 在"关注"Tab页面,点击右上角搜索图标
2. 打开搜索页面,输入框自动聚焦
3. 输入搜索关键词
4. **输入完成(防抖500ms)** → 触发接口

### 接口定义
**接口:** `GET /api/users/following/search`

**参数:**
```typescript
{
  keyword: string;     // 搜索关键词(搜索用户昵称)
  page: number;        // 页码,从1开始
  pageSize: number;    // 每页数量,建议20
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "搜索成功",
  data: {
    total: number;     // 搜索结果总数
    hasMore: boolean;  // 是否还有更多数据
    list: Array<{
      userId: string;              // 用户ID
      nickname: string;            // 用户昵称(高亮匹配关键词)
      avatar: string;              // 头像URL
      signature: string;           // 个性签名
      gender: "male" | "female";   // 性别
      age: number;                 // 年龄
      isVerified: boolean;         // 是否实名认证
      followStatus: "following" | "mutual";  // 关注状态
      followTime: string;          // 关注时间
    }>;
  }
}
```

### 前端验证
- keyword 不能为空
- keyword 长度 1-30 字符
- 输入防抖处理(500ms)

### 前端行为
- 成功后:
  - 显示搜索结果列表
  - 关键词高亮显示(用户昵称中匹配的部分)
  - 空结果时显示"暂无搜索结果"提示
  - 支持上拉加载更多搜索结果
- 失败后:显示错误提示
- 点击"取消"按钮:返回关注列表页面,不保存搜索状态

---

## 五、关注用户

### 用户操作
1. 在粉丝列表或搜索结果中,找到未关注的用户
2. **点击"关注"按钮** → 触发接口

### 接口定义
**接口:** `POST /api/users/follow`

**参数:**
```typescript
{
  targetUserId: string;  // 要关注的用户ID
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "关注成功",
  data: {
    followStatus: "following" | "mutual";  // 更新后的关注状态
    followTime: string;                     // 关注时间
  }
}
```

### 前端验证
- 必须已登录
- targetUserId 不能为空
- 不能关注自己
- 防抖处理(防止重复点击)

### 前端行为
- 成功后:
  - 更新按钮状态:
    - 如果返回 "following" → 显示"已关注"按钮(浅紫色描边)
    - 如果返回 "mutual" → 显示"互相关注"按钮(浅紫色描边)
  - 显示 Toast 提示:"关注成功"
  - 更新本地列表数据(无需刷新整个列表)
  - 如果在粉丝列表中关注,且对方也关注了你,状态变为"互相关注"
- 失败后:
  - 显示错误提示
  - 按钮状态恢复

---

## 六、取消关注

### 用户操作
1. 在关注列表、粉丝列表或搜索结果中,找到已关注的用户
2. **点击"已关注"或"互相关注"按钮** → 显示确认对话框
3. **点击确认** → 触发接口

### 接口定义
**接口:** `DELETE /api/users/follow/{targetUserId}`

**参数:**
```typescript
// 路径参数
{
  targetUserId: string;  // 要取消关注的用户ID
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "已取消关注",
  data: {
    followStatus: "none";  // 更新后的关注状态(取消后为none)
  }
}
```

### 前端验证
- 必须已登录
- targetUserId 不能为空
- 防抖处理(防止重复点击)

### 前端行为
- 点击"已关注"或"互相关注"按钮时:
  - 显示确认对话框:"确定要取消关注吗?"
  - 提供"取消"和"确定"按钮
- 成功后:
  - 如果在关注列表页面:
    - 从列表中移除该用户
    - 更新列表总数
  - 如果在粉丝列表页面:
    - 更新按钮状态为"关注"(紫色填充)
    - 如果原来是"互相关注",变为"关注"按钮
  - 显示 Toast 提示:"已取消关注"
  - 更新本地缓存数据
- 失败后:
  - 显示错误提示
  - 按钮状态恢复

---

## 七、获取关注统计

### 用户操作
1. 进入"我的"页面
2. **页面加载** → 触发接口(获取关注数和粉丝数)

### 接口定义
**接口:** `GET /api/users/{userId}/follow-stats`

**参数:**
```typescript
// 路径参数
{
  userId: string;  // 用户ID(可选,不传则获取当前登录用户)
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "获取成功",
  data: {
    followingCount: number;  // 关注数
    fansCount: number;       // 粉丝数
  }
}
```

### 前端验证
- 无特殊验证要求

### 前端行为
- 成功后:
  - 在"我的"页面显示"关注"和"粉丝"数量
  - 格式: "关注 123" | "粉丝 456"
  - 数字较大时使用缩写(如: 10.5K, 1.2M)
- 失败后:显示默认值 0

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 查看粉丝列表 | 进入粉丝页面 | `/api/users/fans` | GET |
| 2 | 查看关注列表 | 切换到关注Tab | `/api/users/following` | GET |
| 3 | 搜索粉丝 | 在粉丝页搜索 | `/api/users/fans/search` | GET |
| 4 | 搜索关注列表 | 在关注页搜索 | `/api/users/following/search` | GET |
| 5 | 关注用户 | 点击"关注"按钮 | `/api/users/follow` | POST |
| 6 | 取消关注 | 点击"已关注"并确认 | `/api/users/follow/{targetUserId}` | DELETE |
| 7 | 获取关注统计 | 加载"我的"页面 | `/api/users/{userId}/follow-stats` | GET |

---

## 通用验证规则

### 登录状态
- 所有接口都需要登录状态
- 未登录时跳转至登录页

### 搜索关键词
- 长度: 1-30 字符
- 不能为空
- 支持中文、英文、数字
- 前后自动去除空格
- 防抖处理: 500ms

### 分页参数
- page: ≥ 1,默认 1
- pageSize: 10-50,建议 20
- 首次加载: page=1
- 上拉加载更多: page 递增

### 用户ID
- 不能为空
- 必须是有效的用户ID格式
- 不能操作自己(关注/取消关注场景)

---

## 非接口操作

以下操作不触发接口调用(纯前端交互):

- **点击"取消"按钮** - 关闭搜索页面,返回列表页
- **Tab切换动画** - "关注"和"粉丝"Tab切换的视觉效果
- **搜索框聚焦** - 打开搜索页面时输入框自动聚焦
- **列表滚动** - 列表上下滚动(不加载新数据时)
- **显示/隐藏确认对话框** - 取消关注时的确认弹窗(点击确定后才触发接口)
- **实名认证标签显示** - 根据 isVerified 字段前端判断是否显示
- **性别年龄图标** - 根据 gender 和 age 字段前端渲染

---

## 数据传递

### 页面跳转传递
**从"我的"页面 → 粉丝/关注页面:**
- 传递: 当前用户的 userId(可选,默认为登录用户)
- 方式: 路由参数

**从列表页 → 用户主页:**
- 传递: 点击的用户 userId
- 方式: 路由参数
- 用途: 查看该用户的详细主页

### 状态同步
操作成功后需要同步到:
- **关注/取消关注后:**
  - 当前列表项的按钮状态
  - "我的"页面的关注数/粉丝数统计
  - 用户主页的关注状态按钮
  - 全局用户关系缓存

---

## 异常处理

| 场景 | HTTP状态码 | 前端处理方式 |
|-----|-----------|------------|
| 未登录 | 401 | 跳转登录页 |
| 用户不存在 | 404 | 显示:"用户不存在或已注销" |
| 重复关注 | 409 | 显示:"已经关注过该用户" |
| 自己关注自己 | 400 | 显示:"不能关注自己" |
| 搜索关键词为空 | 400 | 显示:"请输入搜索关键词" |
| 搜索关键词过长 | 400 | 显示:"搜索关键词不能超过30字符" |
| 参数错误 | 400 | 显示具体错误信息 |
| 网络错误 | - | 显示:"网络异常,请稍后重试" + 重试按钮 |
| 服务器错误 | 500 | 显示:"服务异常,请稍后重试" |
| 关注数量达到上限 | 403 | 显示:"关注数量已达上限" |
| 被对方拉黑 | 403 | 显示:"无法关注该用户" |

---

## 交互细节说明

### 按钮状态说明
1. **"关注"按钮** (followStatus = "none")
   - 样式: 紫色填充背景,白色文字
   - 宽度: 60px
   - 圆角: 16px
   - 点击后: 触发关注接口

2. **"已关注"按钮** (followStatus = "following")
   - 样式: 浅紫色描边,紫色文字,透明背景
   - 宽度: 80px
   - 圆角: 16px
   - 点击后: 显示取消关注确认对话框

3. **"互相关注"按钮** (followStatus = "mutual")
   - 样式: 浅紫色描边,紫色文字,透明背景
   - 宽度: 96px
   - 圆角: 16px
   - 点击后: 显示取消关注确认对话框

### 列表项布局
- **头像**: 左侧,圆形,直径 48px
- **用户信息**: 中间,垂直排列
  - 第一行: 昵称 + 性别年龄图标 + 实名认证标签
  - 第二行: 个性签名(灰色文字,单行省略)
- **操作按钮**: 右侧,垂直居中对齐

### 空状态提示
- **粉丝列表为空**: "还没有粉丝哦~"
- **关注列表为空**: "还没有关注任何人~"
- **搜索无结果**: "暂无搜索结果"
- **加载完所有数据**: "没有更多了"

### 加载状态
- **首次加载**: 显示骨架屏(3-5个占位项)
- **上拉加载更多**: 底部显示加载指示器
- **下拉刷新**: 顶部显示刷新指示器

---

## 数据格式规范

### 时间格式
- 使用 ISO 8601 格式: `2024-11-13T09:41:00Z`
- 前端显示转换规则:
  - 1分钟内: "刚刚"
  - 1小时内: "X分钟前"
  - 24小时内: "X小时前"
  - 超过24小时: "MM-DD"
  - 跨年: "YYYY-MM-DD"

### 数字格式
- 关注数/粉丝数:
  - < 10000: 直接显示数字
  - ≥ 10000: 显示 "X.XW" (如: 1.2W)
  - ≥ 100000: 显示 "XXW" (如: 12W)

### 头像处理
- 支持格式: jpg, png, webp
- 加载失败时显示默认头像
- 建议使用CDN加速
- 图片尺寸: 列表中使用缩略图(96x96)

---

## 关注关系说明

### 关注状态定义
1. **none (未关注)**
   - 当前用户未关注对方
   - 显示"关注"按钮

2. **following (已关注)**
   - 当前用户已关注对方
   - 对方未关注当前用户
   - 显示"已关注"按钮

3. **mutual (互相关注)**
   - 当前用户已关注对方
   - 对方也关注了当前用户
   - 显示"互相关注"按钮

### 状态转换规则
- `none` → 点击"关注" → `following` 或 `mutual`
  - 如果对方已关注你 → `mutual`
  - 如果对方未关注你 → `following`
- `following` → 点击取消关注 → `none`
- `mutual` → 点击取消关注 → `none`
  - 你取消关注后,对方对你的关注状态不变
  - 在对方的粉丝列表中,你的状态变为 `following`(对方关注你,你未关注对方)
