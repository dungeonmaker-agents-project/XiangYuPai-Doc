# 对方主页接口文档

## 概述
本文档定义对方主页（查看其他用户主页）的所有接口，包括用户资料查看、动态浏览、技能列表、互动操作等功能。

---

## 一、获取对方主页基础信息

### 用户操作
1. 从任意页面点击其他用户的头像或昵称
2. **进入对方主页** → 触发接口

### 接口定义
**接口:** `GET /api/users/{userId}/profile`

**参数:**
```typescript
{
  userId: number;  // 对方用户ID（路径参数）
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "获取成功",
  data: {
    userId: number;              // 用户ID
    nickname: string;            // 昵称，如 "昵称12345"
    avatar: string;              // 头像URL
    backgroundImage: string;     // 背景图URL
    isOnline: boolean;           // 在线状态
    distance: string;            // 距离显示，如 "4.8km"
    followersCount: number;      // 粉丝数，如 102
    followingCount: number;      // 关注数，如 201
    isFollowed: boolean;         // 当前用户是否已关注对方
    canViewProfile: boolean;     // 是否可以查看资料（根据隐私设置）
    canViewMoments: boolean;     // 是否可以查看动态
    canViewSkills: boolean;      // 是否可以查看技能
  }
}
```

### 前端验证
- 必须处于登录状态
- userId必须为有效的数字

### 前端行为
- 成功后：
  - 显示用户基础信息（头像、昵称、在线状态）
  - 显示距离和粉丝数
  - 根据isFollowed状态显示"关注"或"已关注"按钮
  - 根据隐私权限显示或隐藏相应Tab页
  - 默认显示"动态"Tab
- 失败后：
  - 404: 显示"用户不存在或已注销"
  - 403: 显示"该用户已设置隐私保护"

---

## 二、关注/取消关注对方

### 用户操作
1. 在对方主页顶部
2. **点击"关注"按钮** → 触发关注接口
3. **点击"已关注"按钮** → 触发取消关注接口

### 接口定义
**接口:** `POST /api/users/{userId}/follow`

**参数:**
```typescript
{
  userId: number;  // 对方用户ID（路径参数）
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "关注成功",
  data: {
    isFollowed: boolean;         // 关注状态：true
    followersCount: number;      // 对方的粉丝数（+1）
  }
}
```

**取消关注接口:** `DELETE /api/users/{userId}/follow`

**响应数据:**
```typescript
{
  code: 200,
  message: "已取消关注",
  data: {
    isFollowed: boolean;         // 关注状态：false
    followersCount: number;      // 对方的粉丝数（-1）
  }
}
```

### 前端验证
- 必须处于登录状态
- 不能关注自己

### 前端行为
- 关注成功后：
  - 按钮文字变为"已关注"，样式变为已关注状态
  - 粉丝数 +1
  - 显示Toast："关注成功"
  - 防抖处理：2秒内不可重复点击
- 取消关注成功后：
  - 按钮文字变为"关注"，样式变为未关注状态
  - 粉丝数 -1
  - 显示Toast："已取消关注"
- 失败后：显示具体错误提示

---

## 三、获取对方动态列表

### 用户操作
1. 在对方主页
2. **切换到"动态"Tab** → 触发接口

### 接口定义
**接口:** `GET /api/users/{userId}/moments`

**参数:**
```typescript
{
  userId: number;      // 对方用户ID（路径参数）
  page: number;        // 页码，默认1
  pageSize: number;    // 每页数量，默认10
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "获取成功",
  data: {
    total: number;     // 总数量
    hasMore: boolean;  // 是否有更多
    list: Array<{
      momentId: number;           // 动态ID
      userId: number;             // 发布者ID
      nickname: string;           // 发布者昵称，如 "用户名称"
      avatar: string;             // 发布者头像URL
      content: string;            // 动态文字内容（如有）
      mediaType: "image" | "video";  // 媒体类型
      mediaUrl: string;           // 媒体URL（封面图或视频）
      thumbnail: string;          // 缩略图URL
      isVideo: boolean;           // 是否为视频
      likeCount: number;          // 点赞数，如 88
      commentCount: number;       // 评论数
      isLiked: boolean;           // 当前用户是否已点赞
      isLocked: boolean;          // 是否需要解锁查看（付费内容）
      unlockPrice?: number;       // 解锁价格（如需要）
      publishTime: string;        // 发布时间，ISO格式
      publishTimeDisplay: string; // 发布时间显示，如 "3.20m"
    }>
  }
}
```

### 前端验证
- 必须处于登录状态
- 检查canViewMoments权限

### 前端行为
- 成功后：
  - 首屏显示：加载第1页数据
  - 下拉刷新：重新加载第1页，替换列表
  - 上拉加载：加载下一页，追加到列表末尾
  - 显示视频播放按钮（video类型）
  - 显示点赞数和用户名称
  - 锁定内容显示"解锁信息"按钮
  - 时间显示格式：3.20m（分钟）、2h（小时）、1d（天）
- 失败后：
  - 403: 显示"对方已设置隐私，无法查看动态"
  - 其他: 显示错误提示

---

## 四、动态点赞/取消点赞

### 用户操作
1. 在动态列表中
2. **点击某条动态的点赞区域** → 触发点赞/取消点赞接口

### 接口定义
**接口:** `POST /api/moments/{momentId}/like`

**参数:**
```typescript
{
  momentId: number;  // 动态ID（路径参数）
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "点赞成功",
  data: {
    isLiked: boolean;      // 点赞状态：true
    likeCount: number;     // 点赞数（+1）
  }
}
```

**取消点赞接口:** `DELETE /api/moments/{momentId}/like`

**响应数据:**
```typescript
{
  code: 200,
  message: "已取消点赞",
  data: {
    isLiked: boolean;      // 点赞状态：false
    likeCount: number;     // 点赞数（-1）
  }
}
```

### 前端验证
- 必须处于登录状态

### 前端行为
- 点赞成功后：
  - 点赞图标变为已点赞样式（红色爱心）
  - 点赞数 +1
  - 防抖处理：500ms内不可重复点击
- 取消点赞成功后：
  - 点赞图标变为未点赞样式（空心爱心）
  - 点赞数 -1
- 失败后：显示错误提示

---

## 五、解锁付费动态

### 用户操作
1. 在动态列表中
2. **点击"解锁信息"按钮** → 触发接口

### 接口定义
**接口:** `POST /api/moments/{momentId}/unlock`

**参数:**
```typescript
{
  momentId: number;  // 动态ID（路径参数）
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "解锁成功",
  data: {
    mediaUrl: string;          // 完整媒体URL
    remainingBalance: number;  // 剩余余额
  }
}
```

### 前端验证
- 必须处于登录状态
- 解锁前显示确认对话框：
  - 标题："解锁内容"
  - 内容："需要消耗 X 金币解锁此内容，是否继续?"
  - 按钮："取消" / "确认解锁"

### 前端行为
- 成功后：
  - 移除"解锁信息"按钮
  - 显示完整内容
  - 更新用户余额显示
  - 显示Toast："解锁成功"
- 失败后：
  - 400: 显示"已解锁，无需重复购买"
  - 402: 显示"金币余额不足，请先充值"
  - 其他: 显示错误提示

---

## 六、打开私信聊天

### 用户操作
1. 在动态列表中
2. **点击"私信"按钮** → 跳转到聊天页面

### 前端验证
- 必须处于登录状态
- 检查是否被对方拉黑

### 前端行为
- 跳转到聊天页面：`/chat/${userId}`
- 传递参数：
  - userId: 对方用户ID
  - nickname: 对方昵称
  - avatar: 对方头像
- 不触发后端接口（在聊天页面加载时才调用聊天相关接口）

---

## 七、获取对方技能列表

### 用户操作
1. 在对方主页
2. **切换到"技能"Tab** → 触发接口

### 接口定义
**接口:** `GET /api/users/{userId}/skills`

**参数:**
```typescript
{
  userId: number;      // 对方用户ID（路径参数）
  page: number;        // 页码，默认1
  pageSize: number;    // 每页数量，默认10
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "获取成功",
  data: {
    total: number;     // 总数量
    hasMore: boolean;  // 是否有更多
    list: Array<{
      skillId: number;               // 技能ID
      skillName: string;             // 技能名称，如 "昵称123"
      coverImage: string;            // 技能封面图URL
      tags: string[];                // 标签数组，如 ["线上技能", "⭐3"]
      serviceType: "online" | "offline";  // 服务类型：线上/线下
      price: number;                 // 价格（金币/小时），如 10
      priceUnit: string;             // 价格单位显示，如 "金币/小时"
      description: string;           // 技能描述
      skillCategory: string;         // 技能分类
      isAvailable: boolean;          // 是否可预约
      rating: number;                // 评分，如 3（对应⭐3）
      orderCount: number;            // 接单数
      distanceDisplay?: string;      // 距离显示（线下技能），如 "3.20m"
    }>
  }
}
```

### 前端验证
- 必须处于登录状态
- 检查canViewSkills权限

### 前端行为
- 成功后：
  - 首屏显示：加载第1页数据
  - 下拉刷新：重新加载第1页，替换列表
  - 上拉加载：加载下一页，追加到列表末尾
  - 显示技能卡片：封面图、名称、标签、价格、描述
  - 标签显示：服务类型（线上/线下） + 评分星级
  - 价格显示：红色高亮，格式 "10 金币/小时"
  - 线下技能显示距离信息
- 失败后：
  - 403: 显示"对方已设置隐私，无法查看技能"
  - 其他: 显示错误提示

---

## 八、查看技能详情

### 用户操作
1. 在技能列表中
2. **点击某个技能卡片** → 跳转到技能详情页

### 前端验证
- 必须处于登录状态

### 前端行为
- 跳转到技能详情页：`/skills/${skillId}`
- 传递参数：
  - skillId: 技能ID
  - userId: 对方用户ID
- 在详情页触发获取技能详情接口（不在此文档范围）

---

## 九、获取对方个人资料

### 用户操作
1. 在对方主页
2. **切换到"资料"Tab** → 触发接口

### 接口定义
**接口:** `GET /api/users/{userId}/profile-detail`

**参数:**
```typescript
{
  userId: number;  // 对方用户ID（路径参数）
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "获取成功",
  data: {
    // 个人资料
    personalInfo: {
      currentLocation: string;   // 常居地，如 "广东 深圳"
      ipLocation: string;        // IP属地，如 "广东 深圳"
      height: number;            // 身高（cm），如 162
      weight: number;            // 体重（kg），如 44
      idNumber: string;          // ID号码（脱敏），如 "21566842"
      occupation: string;        // 职业（可能被隐藏 "******"）
      birthday: string;          // 生日，如 "09-29"（可能被隐藏）
    },
    // 隐私设置
    privacy: {
      showOccupation: boolean;   // 是否显示职业
      showBirthday: boolean;     // 是否显示生日
    }
  }
}
```

### 前端验证
- 必须处于登录状态
- 检查canViewProfile权限

### 前端行为
- 成功后：
  - 显示"个人资料"区域
  - 以表格形式展示：
    - 常居地、IP属地（两列布局）
    - 身高、ID（两列布局）
    - 体重、职业（两列布局，职业可能隐藏为 "******"）
    - 微信、生日（两列布局，可能隐藏）
  - 隐藏字段显示为 "******"
  - 数据格式：
    - 身高：162cm
    - 体重：44kg
    - 生日：09-29
- 失败后：
  - 403: 显示"对方已设置隐私，无法查看资料"
  - 其他: 显示错误提示

---

## 十、查看粉丝/关注列表

### 用户操作
1. 在对方主页顶部
2. **点击粉丝/关注数区域** → 跳转到列表页

### 前端验证
- 必须处于登录状态
- 检查隐私权限

### 前端行为
- 跳转到粉丝/关注列表页：`/users/${userId}/followers` 或 `/users/${userId}/following`
- 传递参数：
  - userId: 对方用户ID
  - type: "followers" | "following"
- 在列表页触发相应接口（不在此文档范围）

---

## 十一、举报/拉黑用户

### 用户操作
1. 在对方主页顶部
2. **点击右上角"..."菜单** → 打开操作菜单
3. 选择"举报"或"拉黑" → 触发接口

### 接口定义

**举报接口:** `POST /api/users/{userId}/report`

**参数:**
```typescript
{
  userId: number;      // 被举报用户ID（路径参数）
  reason: string;      // 举报原因
  description: string; // 详细描述（可选）
  evidence: string[];  // 证据图片URL数组（可选）
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "举报成功，我们会尽快处理",
  data: null
}
```

**拉黑接口:** `POST /api/users/{userId}/block`

**参数:**
```typescript
{
  userId: number;  // 被拉黑用户ID（路径参数）
}
```

**响应数据:**
```typescript
{
  code: 200,
  message: "已拉黑该用户",
  data: null
}
```

### 前端验证
- 必须处于登录状态
- 不能举报/拉黑自己
- 举报原因不能为空

### 前端行为
- 举报成功后：
  - 关闭举报对话框
  - 显示Toast："举报成功，我们会尽快处理"
  - 停留在当前页面
- 拉黑成功后：
  - 显示确认对话框："确定要拉黑该用户吗？拉黑后将无法看到对方的任何内容"
  - 确认后执行拉黑
  - 显示Toast："已拉黑该用户"
  - 返回上一页
- 失败后：显示错误提示

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 获取主页基础信息 | 进入对方主页 | `/api/users/{userId}/profile` | GET |
| 2 | 关注用户 | 点击"关注"按钮 | `/api/users/{userId}/follow` | POST |
| 3 | 取消关注 | 点击"已关注"按钮 | `/api/users/{userId}/follow` | DELETE |
| 4 | 获取动态列表 | 切换到"动态"Tab | `/api/users/{userId}/moments` | GET |
| 5 | 动态点赞 | 点击动态点赞 | `/api/moments/{momentId}/like` | POST |
| 6 | 取消动态点赞 | 再次点击已点赞动态 | `/api/moments/{momentId}/like` | DELETE |
| 7 | 解锁付费动态 | 点击"解锁信息"按钮 | `/api/moments/{momentId}/unlock` | POST |
| 8 | 获取技能列表 | 切换到"技能"Tab | `/api/users/{userId}/skills` | GET |
| 9 | 获取个人资料 | 切换到"资料"Tab | `/api/users/{userId}/profile-detail` | GET |
| 10 | 举报用户 | 点击"举报" | `/api/users/{userId}/report` | POST |
| 11 | 拉黑用户 | 点击"拉黑" | `/api/users/{userId}/block` | POST |

---

## 通用验证规则

### 登录状态
- 所有接口都需要登录状态
- 未登录时跳转至登录页

### 用户ID
- 必须为有效的正整数
- 不能操作不存在的用户ID

### 列表加载
- 首屏加载：page=1, pageSize=10
- 下拉刷新：重新请求page=1
- 上拉加载：page+1
- 显示加载状态指示器

### 防抖处理
- 关注/取消关注：2秒内不可重复点击
- 点赞/取消点赞：500ms内不可重复点击
- 解锁付费内容：需确认对话框

### 隐私权限
- 根据返回的权限字段（canViewProfile、canViewMoments、canViewSkills）控制Tab显示
- 权限不足时显示友好提示，不显示对应Tab

---

## 非接口操作

以下操作不触发接口调用（纯前端交互）：

- **点击"私信"按钮** - 跳转到聊天页面（/chat/${userId}），不调用接口
- **点击技能卡片** - 跳转到技能详情页（/skills/${skillId}），在详情页再加载数据
- **点击动态视频** - 播放视频，不调用接口
- **切换Tab页** - 切换UI显示，仅在首次切换时调用对应接口
- **点击粉丝/关注数** - 跳转到列表页（/users/${userId}/followers），在列表页再加载数据
- **返回上一页** - 使用路由返回，不调用接口
- **打开操作菜单** - 显示"举报"/"拉黑"选项，不调用接口

---

## 数据传递

### 跨页面传递
**从列表页 → 对方主页:**
- 传递：`userId`（对方用户ID）
- 方式：路由参数

**从对方主页 → 聊天页:**
- 传递：`userId`（对方用户ID）、`nickname`、`avatar`
- 方式：路由参数

**从对方主页 → 技能详情页:**
- 传递：`skillId`（技能ID）、`userId`（对方用户ID）
- 方式：路由参数

### 状态同步
操作成功后需要同步到：
- **关注/取消关注：** 更新主页的关注按钮状态、粉丝数
- **点赞动态：** 更新动态列表中的点赞状态、点赞数
- **解锁内容：** 更新动态显示为已解锁状态
- **拉黑用户：** 返回上一页，从列表中移除该用户

### 缓存策略
- **基础信息：** 缓存5分钟，切换Tab时不重新加载
- **动态列表：** 每次切换Tab重新加载
- **技能列表：** 每次切换Tab重新加载
- **个人资料：** 每次切换Tab重新加载

---

## 异常处理

| 场景 | 前端处理方式 |
|-----|------------|
| 未登录（401） | 跳转登录页 |
| 权限不足（403） | 显示："对方已设置隐私，无法查看此内容" |
| 用户不存在（404） | 显示："用户不存在或已注销" |
| 参数错误（400） | 显示具体错误信息（如"举报原因不能为空"） |
| 余额不足（402） | 显示："金币余额不足，请先充值" + 跳转充值页按钮 |
| 已拉黑（403） | 显示："您已被对方拉黑" |
| 网络错误 | 显示："网络异常，请稍后重试" + 重试按钮 |
| 服务器错误（500） | 显示："服务异常，请稍后重试" |

---

## 特殊交互说明

### 在线状态显示
- 在线：显示绿色"在线"徽章
- 离线：不显示徽章
- 实时性要求：不要求实时，使用接口返回的状态即可

### 距离显示格式
- 小于1km：显示米，如 "850m"
- 大于等于1km：显示公里，保留1位小数，如 "4.8km"
- 超过100km：显示 "100+km"

### 时间显示格式
- 1分钟内：显示 "刚刚"
- 1小时内：显示分钟，如 "3.20m"（3分20秒）
- 1天内：显示小时，如 "2h"
- 1周内：显示天，如 "3d"
- 超过1周：显示日期，如 "01-15"

### 数字显示格式
- 小于1000：直接显示数字，如 "88"
- 1000-9999：显示千位，如 "1.2k"
- 10000+：显示万位，如 "1.2w"

### 隐私字段显示
- 未设置或隐藏：显示 "******"
- 已设置且公开：显示真实内容

### Tab切换缓存
- 首次切换到某个Tab：调用接口加载数据
- 再次切换回已加载的Tab：使用缓存数据，不重新请求
- 下拉刷新：清除缓存，重新加载

---

## 性能优化建议

### 图片加载
- 使用缩略图URL加载列表图片
- 点击查看大图时加载原图
- 实现图片懒加载（进入可视区域时加载）

### 列表分页
- 每页加载10条数据
- 实现虚拟滚动（长列表）
- 上拉加载时显示加载指示器

### 网络优化
- Tab数据预加载：进入主页时预加载"动态"Tab数据
- 接口防抖：避免短时间内重复请求
- 请求合并：同一用户的多个请求可考虑合并

### 用户体验
- 骨架屏：首次加载时显示骨架屏
- 乐观更新：点赞/关注立即更新UI，失败后回滚
- 错误重试：网络失败时提供重试按钮
- 离线提示：无网络时显示友好提示

---
