# 用户主页模块接口文档

## 概述
本文档定义用户主页模块的所有接口，包括用户操作触发时机和前端参数要求。

---

## 一、查看用户主页

### 用户操作
1. 用户在任意页面点击其他用户头像/昵称
2. **系统跳转至用户主页** → 触发接口

### 接口定义
**接口:** `GET /api/user/profile/header`

**参数:**
```typescript
{
  userId: string | number;  // 目标用户ID，从路由参数获取
}
```

**响应数据:**
```typescript
{
  userId: number;
  nickname: string;         // 昵称（如：昵称12345）
  avatar: string;           // 头像URL
  age: number;              // 年龄
  isOnline: boolean;        // 在线状态
  distance: string;         // 距离（如：4.6km）
  followingCount: number;   // 关注数
  followersCount: number;   // 粉丝数
  badges: string[];         // 徽章列表（如：['实名认证', '大神']）
  isFollowing: boolean;     // 当前用户是否已关注
  isMyProfile: boolean;     // 是否为当前用户本人
}
```

### 前端行为
- 加载成功后显示用户头部信息
- 根据 `isMyProfile` 判断显示"编辑"或"关注"按钮
- 默认展示"动态"Tab内容（触发接口二）

---

## 二、浏览动态Tab

### 用户操作
1. 进入用户主页（默认Tab）
2. 或点击"动态"Tab
3. **系统加载动态列表** → 触发接口

### 接口定义
**接口:** `GET /api/user/profile/posts`

**参数:**
```typescript
{
  userId: string | number;  // 用户ID
  pageNum: number;          // 页码（从1开始）
  pageSize: number;         // 每页数量（建议20）
}
```

**响应数据:**
```typescript
{
  total: number;
  list: Array<{
    postId: number;
    contentType: 'video' | 'image' | 'text';
    coverUrl: string;       // 封面/缩略图
    mediaUrls: string[];    // 媒体URL列表
    content: string;        // 文字内容
    authorInfo: {
      userId: number;
      nickname: string;
      avatar: string;
    };
    likeCount: number;
    isLiked: boolean;
    commentCount: number;
    createTime: string;
  }>;
}
```

### 前端行为
- 首次加载：pageNum=1
- 下拉刷新：重置pageNum=1
- 上拉加载：pageNum递增

---

## 三、浏览收藏Tab

### 用户操作
1. 用户点击"收藏"Tab
2. **系统加载收藏列表** → 触发接口

### 接口定义
**接口:** `GET /api/user/profile/favorites`

**参数:**
```typescript
{
  userId: string | number;
  pageNum: number;
  pageSize: number;
}
```

**响应数据:** （结构同动态列表，额外包含）
```typescript
{
  total: number;
  list: Array<{
    // ... 同动态列表
    collectTime: string;    // 收藏时间
  }>;
}
```

### 前端验证
- 查看他人主页时，可能返回403错误（权限不足）
- 需根据用户隐私设置判断

### 前端行为
- 权限不足时显示："该内容仅本人可见"
- 加载逻辑同动态Tab

---

## 四、浏览点赞Tab

### 用户操作
1. 用户点击"点赞"Tab
2. **系统加载点赞列表** → 触发接口

### 接口定义
**接口:** `GET /api/user/profile/likes`

**参数:**
```typescript
{
  userId: string | number;
  pageNum: number;
  pageSize: number;
}
```

**响应数据:** （结构同动态列表，额外包含）
```typescript
{
  total: number;
  list: Array<{
    // ... 同动态列表
    likeTime: string;       // 点赞时间
  }>;
}
```

### 前端验证
- 查看他人主页时，可能返回403错误（权限不足）

### 前端行为
- 权限不足时显示："该内容仅本人可见"
- 加载逻辑同动态Tab

---

## 五、浏览资料Tab

### 用户操作
1. 用户点击"资料"Tab
2. **系统加载用户资料** → 触发接口

### 接口定义
**接口:** `GET /api/user/profile/info`

**参数:**
```typescript
{
  userId: string | number;
}
```

**响应数据:**
```typescript
{
  personalInfo: {
    residence: string;      // 常居地（如：广东 深圳）
    ipLocation: string;     // IP属地（如：广东 深圳）
    height: string;         // 身高（如：162cm）
    weight: string;         // 体重（如：44kg）
    wechat: string;         // 微信号
    userId: string;         // 用户ID
    occupation: string;     // 职业
    birthday: string;       // 生日（如：09-29）
  };
  skills: Array<{
    skillId: number;
    skillName: string;      // 技能名称
    skillIcon: string;      // 技能图标URL
    price?: number;         // 技能定价（可选）
    isOnline: boolean;      // 是否上架
  }>;
}
```

### 前端行为
- 显示个人资料信息
- 显示技能列表（图标+名称）
- 如果是本人主页，显示"添加技能"按钮

---

## 六、查看动态详情

### 用户操作
1. 用户在任意Tab中点击动态卡片
2. **系统跳转至动态详情页** → 触发接口

### 接口定义
**接口:** `GET /api/post/detail`

**参数:**
```typescript
{
  postId: string | number;  // 动态ID，从路由参数获取
}
```

**响应数据:**
```typescript
{
  postDetail: {
    postId: number;
    authorInfo: {
      userId: number;
      nickname: string;
      avatar: string;
      distance: string;
    };
    contentType: 'video' | 'image' | 'text';
    mediaUrls: string[];
    content: string;
    tags: string[];         // 话题标签（如：['#S10全球总决赛']）
    location: string;       // 发布地点
    createTime: string;
    viewCount: number;
    likeCount: number;
    favoriteCount: number;
    commentCount: number;
    isLiked: boolean;
    isFavorited: boolean;
  };
  comments: Array<{
    commentId: number;
    userInfo: {
      userId: number;
      nickname: string;
      avatar: string;
    };
    content: string;
    location: string;
    createTime: string;
    likeCount: number;
    isLiked: boolean;
    replyCount: number;
  }>;
}
```

### 前端行为
- 显示动态详情和评论列表
- 更新浏览数（viewCount）
- 底部显示互动按钮（点赞/收藏/评论）

---

## 七、关注/取消关注用户

### 用户操作
1. 用户在他人主页点击"关注"按钮
2. **系统切换关注状态** → 触发接口

### 接口定义
**接口:** `POST /api/user/follow`

**参数:**
```typescript
{
  targetUserId: string | number;  // 目标用户ID
  action: 'follow' | 'unfollow'; // 操作类型
}
```

**响应数据:**
```typescript
{
  isFollowing: boolean;       // 更新后的关注状态
  followersCount: number;     // 更新后的粉丝数
}
```

### 前端验证
- 不能关注自己（按钮不显示）
- 需要登录状态

### 前端行为
- 成功后：
  - 更新按钮状态（关注 ↔ 已关注）
  - 更新粉丝数显示
- 失败后：显示错误提示

---

## 八、点赞/取消点赞动态

### 用户操作
1. 用户在动态卡片或详情页点击"点赞"按钮
2. **系统切换点赞状态** → 触发接口

### 接口定义
**接口:** `POST /api/post/like`

**参数:**
```typescript
{
  postId: string | number;
  action: 'like' | 'unlike';
}
```

**响应数据:**
```typescript
{
  isLiked: boolean;           // 更新后的点赞状态
  likeCount: number;          // 更新后的点赞数
}
```

### 前端验证
- 需要登录状态
- 防抖处理：300ms内不能重复点击

### 前端行为
- 成功后：
  - 更新点赞按钮状态（图标+颜色）
  - 更新点赞数显示
- 失败后：恢复原状态

---

## 九、收藏/取消收藏动态

### 用户操作
1. 用户在动态详情页点击"收藏"按钮
2. **系统切换收藏状态** → 触发接口

### 接口定义
**接口:** `POST /api/post/favorite`

**参数:**
```typescript
{
  postId: string | number;
  action: 'collect' | 'uncollect';
}
```

**响应数据:**
```typescript
{
  isFavorited: boolean;       // 更新后的收藏状态
  favoriteCount: number;      // 更新后的收藏数
}
```

### 前端验证
- 需要登录状态
- 防抖处理：300ms内不能重复点击

### 前端行为
- 成功后：
  - 更新收藏按钮状态（图标+颜色）
  - 更新收藏数显示
  - 收藏成功提示："收藏成功"
- 失败后：恢复原状态

---

## 十、发表评论

### 用户操作
1. 用户在动态详情页底部输入评论内容
2. 用户点击"发送"按钮
3. **系统提交评论** → 触发接口

### 接口定义
**接口:** `POST /api/post/comment`

**参数:**
```typescript
{
  postId: string | number;      // 动态ID
  content: string;              // 评论内容
  parentCommentId?: number;     // 可选，回复评论时传入
}
```

**响应数据:**
```typescript
{
  commentId: number;            // 新评论ID
  createTime: string;           // 评论时间
  commentCount: number;         // 更新后的评论数
}
```

### 前端验证
- 内容不能为空
- 内容不能为纯空格
- 长度限制：1-500字符
- 需要登录状态

### 前端行为
- 成功后：
  - 清空输入框
  - 评论列表顶部插入新评论
  - 更新评论数显示
  - 提示："评论成功"
- 失败后：
  - 保留输入内容
  - 显示错误提示

---

## 十一、点赞/取消点赞评论

### 用户操作
1. 用户在评论列表中点击评论的"点赞"图标
2. **系统切换点赞状态** → 触发接口

### 接口定义
**接口:** `POST /api/comment/like`

**参数:**
```typescript
{
  commentId: string | number;
  action: 'like' | 'unlike';
}
```

**响应数据:**
```typescript
{
  isLiked: boolean;           // 更新后的点赞状态
  likeCount: number;          // 更新后的点赞数
}
```

### 前端验证
- 需要登录状态
- 防抖处理：300ms内不能重复点击

### 前端行为
- 成功后：
  - 更新点赞图标状态（空心 ↔ 实心）
  - 更新点赞数显示
- 失败后：恢复原状态

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 查看用户主页 | 点击用户头像 | `/api/user/profile/header` | GET |
| 2 | 浏览动态Tab | 点击动态Tab | `/api/user/profile/posts` | GET |
| 3 | 浏览收藏Tab | 点击收藏Tab | `/api/user/profile/favorites` | GET |
| 4 | 浏览点赞Tab | 点击点赞Tab | `/api/user/profile/likes` | GET |
| 5 | 浏览资料Tab | 点击资料Tab | `/api/user/profile/info` | GET |
| 6 | 查看动态详情 | 点击动态卡片 | `/api/post/detail` | GET |
| 7 | 关注用户 | 点击关注按钮 | `/api/user/follow` | POST |
| 8 | 点赞动态 | 点击点赞按钮 | `/api/post/like` | POST |
| 9 | 收藏动态 | 点击收藏按钮 | `/api/post/favorite` | POST |
| 10 | 发表评论 | 点击发送按钮 | `/api/post/comment` | POST |
| 11 | 点赞评论 | 点击评论点赞 | `/api/comment/like` | POST |

---

## 通用验证规则

### 登录状态
所有POST接口都需要用户登录状态，未登录时：
- 弹出提示："请先登录"
- 跳转至登录页

### 防抖处理
所有点赞、收藏类操作需防抖处理：
- 300ms内不能重复点击
- 防止用户快速连点

### 分页加载
所有列表接口（动态/收藏/点赞）：
- 首屏：pageNum=1, pageSize=20
- 下拉刷新：重置pageNum=1
- 上拉加载：pageNum递增
- 无更多数据时：显示"没有更多了"

### 数字显示
所有计数显示：
- < 10000：直接显示（88, 9999）
- ≥ 10000：显示万位（1.2w, 10w+）

### 时间显示
所有时间字段：
- < 1分钟：显示"刚刚"
- < 1小时：显示"X分钟前"
- < 24小时：显示"X小时前"
- 昨天：显示"昨天HH:mm"
- 更早：显示"MM-DD"

### 距离显示
- < 100km：显示"X.Xkm"（如：4.6km）
- ≥ 100km：显示"100km+"

---

## 非接口操作

以下操作不触发接口调用（纯前端交互）：

- **Tab切换动画** - 切换Tab时的视觉效果
- **图片预览** - 点击图片放大查看
- **视频播放** - 点击播放视频（媒体URL已在列表接口返回）
- **下拉刷新动画** - 下拉刷新的加载动画
- **上拉加载动画** - 上拉加载的加载动画
- **返回操作** - 点击返回按钮，使用路由返回
- **编辑按钮点击** - 点击"编辑"按钮，跳转至编辑页（编辑接口在"个人资料编辑模块"中定义）

---

## 数据传递

### 跨页面传递
**从用户主页 → 动态详情页：**
- 传递：`postId`（动态ID）
- 方式：路由参数

**从动态详情页 → 返回用户主页：**
- 需同步状态：点赞状态、收藏状态、评论数
- 方式：全局状态管理或事件回调

### 状态同步
互动操作（点赞/收藏/评论）成功后：
- 更新当前页面状态
- 更新全局缓存
- 其他页面切换回来时自动刷新

---

## 异常处理

| 场景 | 前端处理方式 |
|-----|------------|
| 权限不足（403） | 显示："该内容仅本人可见" |
| 用户不存在（404） | 显示："用户不存在或已注销" |
| 网络错误 | 显示："网络异常，请稍后重试" + 重试按钮 |
| 服务器错误（500） | 显示："服务异常，请稍后重试" |
| 接口超时 | 显示："请求超时，请重试" |
| 未登录（401） | 跳转登录页 |

