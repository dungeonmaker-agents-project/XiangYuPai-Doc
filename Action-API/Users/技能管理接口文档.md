# 技能管理模块接口文档

## 概述
本文档定义技能管理模块的所有接口，包括添加、编辑、删除技能，以及线上/线下技能的不同配置要求。

---

## 一、获取技能列表

### 用户操作
1. 用户进入个人资料页的"资料"Tab
2. **系统显示技能列表** → 触发接口

### 接口定义
**接口:** `GET /api/user/skills`

**参数:**
```typescript
{
  userId?: string | number;  // 可选，查看他人技能时传入，不传则查看自己
}
```

**响应数据:**
```typescript
{
  skills: Array<{
    skillId: number;
    skillType: 'online' | 'offline';  // 线上/线下
    skillName: string;                // 技能名称（如：王者荣耀）
    skillIcon: string;                // 技能图标URL
    title: string;                    // 标题（线上技能）
    description: string;              // 描述
    images: string[];                 // 展示图片列表
    
    // 线上技能特有字段
    rank?: string;                    // 段位（如：最强王者）
    pricePerGame?: number;           // 定价（金币/局）
    
    // 线下技能特有字段
    availableTime?: string;          // 可用时间（如：6月9号 10:00）
    location?: string;               // 地点
    pricePerHour?: number;          // 定价（金币/小时）
    
    isOnline: boolean;               // 是否上架
    createTime: string;
  }>
}
```

### 前端行为
- 显示技能图标和名称
- 区分线上/线下技能的显示样式
- 如果是本人主页，显示"添加技能"按钮

---

## 二、添加线上技能

### 用户操作流程
```
[资料Tab] 
  ↓ 点击"添加技能"
[添加技能页 - 选择技能类型]
  ↓ 选择线上技能（如：王者荣耀）
  ↓ 填写标题
  ↓ 填写描述（可选）
  ↓ 添加图片（可选）
  ↓ 点击"段位"
[段位选择器]
  ↓ 选择段位（永恒钻石/至尊星耀/最强王者/QQ区/微信区/非凡王者/无双王者）
  ↓ 点击"确定"
  ↓ 点击"定价"
[定价输入框]
  ↓ 输入定价
  ↓ 点击"确定"
  ↓ 点击右上角"完成"
  → 触发接口
```

### 接口1：选择技能类型后加载技能配置

**接口:** `GET /api/skills/config`

**参数:**
```typescript
{
  skillName: string;  // 技能名称（如：王者荣耀）
}
```

**响应数据:**
```typescript
{
  skillName: string;
  skillIcon: string;
  skillType: 'online' | 'offline';
  rankOptions?: string[];    // 段位选项列表（线上技能）
  defaultPrice?: number;     // 默认定价
}
```

### 接口2：创建线上技能

**接口:** `POST /api/user/skills/online`

**参数:**
```typescript
{
  skillName: string;         // 技能名称（如：王者荣耀）
  title: string;             // 标题（如：描述一下技能吧...）
  description?: string;      // 描述（0-200字）
  images?: string[];         // 图片URL列表
  rank: string;              // 段位（如：最强王者）
  pricePerGame: number;      // 定价（金币/局）
}
```

**响应数据:**
```typescript
{
  skillId: number;           // 新创建的技能ID
  skillName: string;
  skillIcon: string;
  title: string;
  description: string;
  images: string[];
  rank: string;
  pricePerGame: number;
  isOnline: boolean;         // 默认为true
  createTime: string;
}
```

### 前端验证
- **技能名称**: 必选，从技能列表选择
- **标题**: 
  - 可以为空
  - 长度：0-50字符
  - 占位符："添加标题"
- **描述**: 
  - 可以为空
  - 长度：0-200字符
  - 显示字符计数：X/200字
  - 占位符："添加正文"
- **图片**:
  - 可选
  - 最多9张
  - 单张大小：≤5MB
  - 格式：jpg, jpeg, png, webp
- **段位**: 必选，从段位选项中选择
- **定价**: 
  - 必填
  - 范围：1-9999金币/局
  - 整数

### 前端行为
- 成功后：
  - 返回资料页
  - 刷新技能列表
  - 提示："添加成功"
- 失败后：
  - 保留已填写内容
  - 显示错误提示

---

## 三、添加线下技能

### 用户操作流程
```
[资料Tab] 
  ↓ 点击"添加技能"
[添加技能页 - 选择技能类型]
  ↓ 选择线下技能（如：探店、按摩等）
  ↓ 填写标题
  ↓ 填写描述（可选）
  ↓ 添加图片（可选）
  ↓ 点击"时间"
[时间选择器]
  ↓ 选择日期和时间（6月/7月/8月 + 日期 + 小时）
  ↓ 点击"确定"
  ↓ 点击"地点"
[地点选择器]
  ↓ 选择地点（城市）
  ↓ 点击"确定"
  ↓ 点击"定价"
[定价输入框]
  ↓ 输入定价
  ↓ 点击"确定"
  ↓ 点击右上角"完成"
  → 触发接口
```

### 接口定义
**接口:** `POST /api/user/skills/offline`

**参数:**
```typescript
{
  skillName: string;         // 技能名称（如：探店）
  title: string;             // 标题
  description?: string;      // 描述（如：描述一下活动详情吧...）
  images?: string[];         // 图片URL列表
  availableTime: string;     // 可用时间（格式：YYYY-MM-DD HH:mm）
  location: string;          // 地点（城市名）
  pricePerHour: number;      // 定价（金币/小时）
}
```

**响应数据:**
```typescript
{
  skillId: number;
  skillName: string;
  skillIcon: string;
  title: string;
  description: string;
  images: string[];
  availableTime: string;
  location: string;
  pricePerHour: number;
  isOnline: boolean;
  createTime: string;
}
```

### 前端验证
- **技能名称**: 必选，从技能列表选择
- **标题**: 
  - 可以为空
  - 长度：0-50字符
  - 占位符："添加标题"
- **描述**: 
  - 可以为空
  - 长度：0-200字符
  - 显示字符计数：X/200字
  - 占位符："描述一下活动详情吧..."
- **图片**: 同线上技能
- **时间**: 
  - 必选
  - 不能选择过去的时间
  - 选择范围：未来3个月内
- **地点**: 必选，从城市列表选择
- **定价**: 
  - 必填
  - 范围：1-9999金币/小时
  - 整数

### 前端行为
- 成功后：
  - 返回资料页
  - 刷新技能列表
  - 提示："添加成功"
- 失败后：
  - 保留已填写内容
  - 显示错误提示

---

## 四、上传技能图片

### 用户操作
1. 用户在添加/编辑技能页点击"+"添加图片区域
2. 选择图片（相机/相册）
3. **系统上传图片** → 触发接口

### 接口定义
**接口:** `POST /api/skills/images/upload`

**参数:**
```typescript
{
  file: File;                // 图片文件（multipart/form-data）
}
```

**响应数据:**
```typescript
{
  imageUrl: string;          // 上传后的图片URL
}
```

### 前端验证
- 图片格式：jpg, jpeg, png, webp
- 图片大小：≤ 5MB
- 最多上传9张

### 前端行为
- 上传成功后：显示缩略图
- 上传失败：显示错误提示
- 显示上传进度

---

## 五、编辑技能

### 用户操作
1. 用户在技能列表长按某个技能
2. 或点击技能详情页的"编辑"按钮
3. **系统进入编辑页** → 触发加载接口
4. 用户修改相关信息
5. 用户点击"完成"按钮
6. **系统提交修改** → 触发更新接口

### 接口1：获取技能详情

**接口:** `GET /api/user/skills/{skillId}`

**参数:**
```typescript
{
  skillId: string | number;  // 路径参数
}
```

**响应数据:**
```typescript
{
  skillId: number;
  skillType: 'online' | 'offline';
  skillName: string;
  skillIcon: string;
  title: string;
  description: string;
  images: string[];
  
  // 线上技能字段
  rank?: string;
  pricePerGame?: number;
  
  // 线下技能字段
  availableTime?: string;
  location?: string;
  pricePerHour?: number;
  
  isOnline: boolean;
  createTime: string;
}
```

### 接口2：更新线上技能

**接口:** `PUT /api/user/skills/online/{skillId}`

**参数:**
```typescript
{
  skillId: string | number;  // 路径参数
  title?: string;
  description?: string;
  images?: string[];
  rank?: string;
  pricePerGame?: number;
}
```

**响应数据:** 同获取技能详情

### 接口3：更新线下技能

**接口:** `PUT /api/user/skills/offline/{skillId}`

**参数:**
```typescript
{
  skillId: string | number;  // 路径参数
  title?: string;
  description?: string;
  images?: string[];
  availableTime?: string;
  location?: string;
  pricePerHour?: number;
}
```

**响应数据:** 同获取技能详情

### 前端验证
- 同添加技能的验证规则
- 不能修改技能名称（只能删除后重新添加）

### 前端行为
- 成功后：
  - 返回技能列表或详情页
  - 刷新显示
  - 提示："修改成功"
- 失败后：保留修改内容，显示错误提示

---

## 六、删除技能

### 用户操作
1. 用户在技能列表长按某个技能
2. 或在编辑页点击"删除"按钮
3. **系统弹出确认对话框** → 不触发接口
4. 用户点击"确定"
5. **系统删除技能** → 触发接口

### 接口定义
**接口:** `DELETE /api/user/skills/{skillId}`

**参数:**
```typescript
{
  skillId: string | number;  // 路径参数
}
```

**响应数据:**
```typescript
{
  success: boolean;
}
```

### 前端行为
- 删除前弹出确认："确定删除该技能吗？"
- 成功后：
  - 从列表移除该技能
  - 提示："删除成功"
- 失败后：显示错误提示

---

## 七、上架/下架技能

### 用户操作
1. 用户在技能详情页点击"上架"或"下架"按钮
2. **系统切换上架状态** → 触发接口

### 接口定义
**接口:** `PUT /api/user/skills/{skillId}/status`

**参数:**
```typescript
{
  skillId: string | number;  // 路径参数
  isOnline: boolean;         // true=上架, false=下架
}
```

**响应数据:**
```typescript
{
  skillId: number;
  isOnline: boolean;
}
```

### 前端行为
- 成功后：
  - 更新按钮状态（上架 ↔ 下架）
  - 提示："已上架" 或 "已下架"
- 失败后：恢复原状态，显示错误提示

---

## 八、获取可选技能列表

### 用户操作
1. 用户点击"添加技能"按钮
2. **系统显示可选技能列表** → 触发接口

### 接口定义
**接口:** `GET /api/skills/available`

**参数:** 无

**响应数据:**
```typescript
{
  onlineSkills: Array<{
    skillName: string;       // 技能名称（如：王者荣耀）
    skillIcon: string;       // 图标URL
    skillType: 'online';
    category: string;        // 分类（如：游戏）
  }>;
  offlineSkills: Array<{
    skillName: string;       // 技能名称（如：探店、按摩）
    skillIcon: string;
    skillType: 'offline';
    category: string;        // 分类（如：生活服务）
  }>;
}
```

### 前端行为
- 显示所有可选技能图标和名称
- 分类显示（线上游戏类、线下服务类等）
- 已添加的技能显示已选标识或禁用

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 获取技能列表 | 进入资料Tab | `/api/user/skills` | GET |
| 2 | 获取技能配置 | 选择技能类型 | `/api/skills/config` | GET |
| 3 | 添加线上技能 | 点击完成按钮 | `/api/user/skills/online` | POST |
| 4 | 添加线下技能 | 点击完成按钮 | `/api/user/skills/offline` | POST |
| 5 | 上传技能图片 | 选择图片后 | `/api/skills/images/upload` | POST |
| 6 | 获取技能详情 | 点击编辑 | `/api/user/skills/{skillId}` | GET |
| 7 | 更新线上技能 | 点击完成按钮 | `/api/user/skills/online/{skillId}` | PUT |
| 8 | 更新线下技能 | 点击完成按钮 | `/api/user/skills/offline/{skillId}` | PUT |
| 9 | 删除技能 | 确认删除 | `/api/user/skills/{skillId}` | DELETE |
| 10 | 上架/下架 | 点击状态按钮 | `/api/user/skills/{skillId}/status` | PUT |
| 11 | 获取可选技能 | 点击添加技能 | `/api/skills/available` | GET |

---

## 通用验证规则

### 登录状态
- 所有接口都需要登录状态
- 未登录时跳转至登录页

### 文本输入验证
- **标题**: 0-50字符
- **描述**: 0-200字符
- 显示实时字符计数

### 图片上传规则
- **格式**: jpg, jpeg, png, webp
- **大小**: ≤ 5MB
- **数量**: 最多9张
- **尺寸**: 建议最小500x500

### 定价验证
- **线上技能**: 1-9999金币/局
- **线下技能**: 1-9999金币/小时
- 必须为正整数
- 不能为0

### 时间验证（线下技能）
- 不能选择过去的时间
- 选择范围：当前时间 ~ 未来3个月
- 格式：YYYY-MM-DD HH:mm

### 技能数量限制
- 每个用户最多添加20个技能
- 超过限制提示："技能数量已达上限"

---

## 非接口操作

以下操作不触发接口调用（纯前端交互）：

- **点击"取消"按钮** - 返回上一页，不保存
- **打开段位选择器** - 打开段位选择器面板
- **打开时间选择器** - 打开时间选择器面板
- **打开地点选择器** - 打开地点选择器面板
- **打开定价输入框** - 打开定价输入对话框
- **关闭选择器/对话框** - 点击"取消"关闭，不保存
- **字符计数** - 实时显示描述字符数（X/200）
- **图片预览** - 点击图片放大查看
- **删除图片** - 点击图片上的"×"删除（仅前端删除，未上传）

---

## 数据传递

### 技能类型识别
- 根据 `skillType` 字段判断是线上还是线下技能
- 线上技能：显示段位和金币/局
- 线下技能：显示时间、地点和金币/小时

### 图片上传流程
```
[选择图片]
  ↓
[压缩图片（前端）]
  ↓
[调用上传接口]
  ↓
[获得imageUrl]
  ↓
[保存到images数组]
  ↓
[提交技能时一并发送images数组]
```

### 状态同步
添加/编辑/删除技能成功后：
- 刷新技能列表显示
- 更新主页技能数量
- 清除技能缓存

---

## 段位选项（线上技能 - 王者荣耀示例）

基于UI显示，段位选项包括：
- 永恒钻石
- 至尊星耀
- 最强王者
- QQ区
- 微信区
- 非凡王者
- 无双王者

**说明**: 不同游戏技能有不同的段位选项，由后端配置返回

---

## 时间选择器（线下技能）

基于UI显示，时间选择器格式：
- **月份**: 6月、7月、8月（滚动选择）
- **日期**: 7号、8号、9号、10号、11号...（滚动选择）
- **小时**: 8:00、9:00、10:00、11:00、12:00...（滚动选择）

**说明**: 时间选择范围为未来3个月，精确到小时

---

## 异常处理

| 场景 | 前端处理方式 |
|-----|------------|
| 技能数量达上限（400） | 显示："技能数量已达上限（20个）" |
| 技能名称重复（409） | 显示："该技能已添加" |
| 图片过大（413） | 显示："图片大小不能超过5MB" |
| 图片格式错误（400） | 显示："仅支持jpg/png/webp格式" |
| 定价超出范围（400） | 显示："定价范围：1-9999金币" |
| 时间已过期（400） | 显示："不能选择过去的时间" |
| 网络错误 | 显示："网络异常，请稍后重试" + 重试按钮 |
| 未登录（401） | 跳转登录页 |
| 服务器错误（500） | 显示："服务异常，请稍后重试" |

---

## 交互细节

### 技能图标选择
- 显示所有可用技能的图标（图标+名称）
- 已选择的技能高亮显示或打勾
- 点击选择，再次点击取消选择（如果允许多选）
- 当前方案：单次只能添加一个技能

### 图片上传交互
- 支持多张图片上传
- 显示上传进度
- 上传成功显示缩略图
- 缩略图右上角显示"×"删除按钮
- 支持拖拽调整顺序（可选功能）

### 定价输入交互
- 弹出数字键盘
- 实时显示单位（金币/局 或 金币/小时）
- 输入范围提示："1-9999金币"

### 保存策略
- 点击右上角"完成"按钮统一保存
- 未保存离开时弹出确认："确定放弃修改吗？"

---

## 性能优化

### 图片上传优化
- 选择图片后先压缩再上传
- 建议压缩质量：80%
- 建议最大尺寸：1200x1200
- 支持批量上传（最多9张）

### 列表加载优化
- 技能列表支持分页（每页20个）
- 图片使用缩略图（300x300）
- 懒加载技能详情

### 缓存策略
- 可选技能列表缓存1天
- 技能配置数据缓存1天
- 用户技能列表缓存5分钟
- 修改后立即清除缓存

---

## 补充说明

### 线上 vs 线下技能区别

| 对比项 | 线上技能 | 线下技能 |
|-------|---------|---------|
| 典型场景 | 游戏陪玩（王者荣耀、英联盟等） | 线下服务（探店、按摩、台球等） |
| 必填字段 | 段位、金币/局 | 时间、地点、金币/小时 |
| 定价单位 | 金币/局 | 金币/小时 |
| 特殊要求 | 需要选择段位 | 需要选择时间和地点 |

### 后续扩展功能
- **技能分类** - 按游戏类、娱乐类、生活服务类分类
- **技能推荐** - 根据用户兴趣推荐技能
- **技能排序** - 支持拖拽调整技能显示顺序
- **技能统计** - 查看技能被查看/预约次数

### 与其他模块关联
- 添加技能后在个人主页"资料"Tab显示
- 技能可以被其他用户浏览和预约
- 技能定价涉及金币系统
- 技能时间涉及预约系统

