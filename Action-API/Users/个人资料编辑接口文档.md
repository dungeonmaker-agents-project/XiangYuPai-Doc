# 个人资料编辑模块接口文档

## 概述
本文档定义个人资料编辑模块的所有接口，包括用户操作触发时机和前端参数要求。

---

## 一、进入编辑页面

### 用户操作
1. 用户在"我的"页面点击个人头像区域
2. 或在个人主页点击"编辑"按钮
3. **系统跳转至个人资料编辑页** → 触发接口

### 接口定义
**接口:** `GET /api/user/profile/edit`

**参数:** 无（从登录态获取当前用户）

**响应数据:**
```typescript
{
  avatar: string;           // 头像URL
  nickname: string;         // 昵称（如：门前游过一群鸭）
  gender: string;           // 性别（男/女/暂未选择）
  bio: string;              // 个人介绍
  birthday: string;         // 生日（1999-09-29）
  height: string;           // 身高（如：暂未选择）
  weight: string;           // 体重（如：暂未选择）
  occupation: string;       // 职业（如：暂未选择）
  residence: string;        // 常居地（如：深圳）
  wechat: string;           // 微信号（如：213438647210）
}
```

### 前端行为
- 加载用户当前资料填充表单
- 未填写的字段显示"暂未选择"或为空

---

## 二、编辑头像

### 用户操作
1. 用户点击头像区域
2. **系统弹出操作菜单** → 不触发接口
3. 用户选择"拍照"或"从手机相册选择"
4. 用户完成图片选择/拍摄
5. **系统上传图片** → 触发接口

### 接口定义
**接口:** `POST /api/user/avatar/upload`

**参数:**
```typescript
{
  file: File;               // 图片文件（multipart/form-data）
}
```

**响应数据:**
```typescript
{
  avatarUrl: string;        // 上传后的图片URL
}
```

### 前端验证
- 图片格式：jpg, jpeg, png, webp
- 图片大小：≤ 5MB
- 建议尺寸：最小300x300

### 前端行为
- 上传成功后：
  - 更新页面头像显示
  - 自动保存（调用更新接口）
- 上传失败：显示错误提示

---

## 三、编辑昵称

### 用户操作
1. 用户点击"昵称"行
2. **系统跳转至昵称编辑页** → 不触发接口
3. 用户在输入框修改昵称
4. 用户点击右上角"完成"按钮
5. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/nickname`

**参数:**
```typescript
{
  nickname: string;         // 新昵称（如：门前游过一群鸭）
}
```

**响应数据:**
```typescript
{
  nickname: string;         // 更新后的昵称
}
```

### 前端验证
- 不能为空
- 长度限制：1-20字符
- 不能包含特殊符号（仅支持中文、英文、数字、下划线）
- 显示字符计数：X/20字

### 前端行为
- 成功后：
  - 返回资料编辑页
  - 更新昵称显示
  - 提示："修改成功"
- 失败后：保留输入内容，显示错误提示

---

## 四、编辑性别

### 用户操作
1. 用户点击"性别"行
2. **系统弹出性别选择器** → 不触发接口
3. 用户选择"男"或"女"
4. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/gender`

**参数:**
```typescript
{
  gender: 'male' | 'female';  // 性别
}
```

**响应数据:**
```typescript
{
  gender: string;           // 更新后的性别（男/女）
}
```

### 前端验证
- 必须选择一项（不能为空）

### 前端行为
- 成功后：
  - 关闭选择器
  - 更新页面显示
  - 提示："修改成功"

---

## 五、编辑个人介绍

### 用户操作
1. 用户点击"个人介绍"行
2. **系统跳转至个人介绍编辑页** → 不触发接口
3. 用户在文本框输入个人介绍
4. 用户点击右上角"完成"按钮
5. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/bio`

**参数:**
```typescript
{
  bio: string;              // 个人介绍内容
}
```

**响应数据:**
```typescript
{
  bio: string;              // 更新后的个人介绍
}
```

### 前端验证
- 可以为空
- 长度限制：0-30字符
- 显示字符计数：X/30字
- 不能为纯空格

### 前端行为
- 成功后：
  - 返回资料编辑页
  - 更新个人介绍显示
  - 提示："修改成功"
- 失败后：保留输入内容，显示错误提示

---

## 六、编辑生日

### 用户操作
1. 用户点击"生日"行
2. **系统弹出日期选择器** → 不触发接口
3. 用户滚动选择年月日
4. 用户点击"确定"按钮
5. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/birthday`

**参数:**
```typescript
{
  birthday: string;         // 生日（格式：YYYY-MM-DD，如：1999-09-29）
}
```

**响应数据:**
```typescript
{
  birthday: string;         // 更新后的生日
  age: number;              // 计算后的年龄
}
```

### 前端验证
- 年龄范围：18-100岁
- 不能选择未来日期
- 不能选择使年龄小于18岁的日期

### 前端行为
- 成功后：
  - 关闭选择器
  - 更新页面显示（格式：YYYY-MM-DD）
  - 提示："修改成功"
- 验证失败：显示"年龄必须满18岁"

---

## 七、编辑常居地

### 用户操作
1. 用户点击"常居地"行
2. **系统弹出城市选择器** → 不触发接口
3. 用户选择城市（如：北京、上海、深圳等）
4. 用户点击"确定"按钮
5. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/residence`

**参数:**
```typescript
{
  residence: string;        // 常居地（如：深圳）
}
```

**响应数据:**
```typescript
{
  residence: string;        // 更新后的常居地
}
```

### 前端验证
- 必须从城市列表中选择
- 不能自定义输入

### 前端行为
- 成功后：
  - 关闭选择器
  - 更新页面显示
  - 提示："修改成功"

---

## 八、编辑身高

### 用户操作
1. 用户点击"身高"行
2. **系统弹出身高选择器** → 不触发接口
3. 用户滚动选择身高（如：168cm, 169cm, 170cm）
4. 用户点击"确定"按钮
5. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/height`

**参数:**
```typescript
{
  height: string;           // 身高（如：170cm）
}
```

**响应数据:**
```typescript
{
  height: string;           // 更新后的身高
}
```

### 前端验证
- 范围：140cm - 220cm
- 步进：1cm

### 前端行为
- 成功后：
  - 关闭选择器
  - 更新页面显示
  - 提示："修改成功"

---

## 九、编辑体重

### 用户操作
1. 用户点击"体重"行
2. **系统弹出体重选择器** → 不触发接口
3. 用户滚动选择体重（如：48kg, 49kg, 50kg）
4. 用户点击"确定"按钮
5. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/weight`

**参数:**
```typescript
{
  weight: string;           // 体重（如：50kg）
}
```

**响应数据:**
```typescript
{
  weight: string;           // 更新后的体重
}
```

### 前端验证
- 范围：30kg - 200kg
- 步进：1kg

### 前端行为
- 成功后：
  - 关闭选择器
  - 更新页面显示
  - 提示："修改成功"

---

## 十、编辑职业

### 用户操作
1. 用户点击"职业"行
2. **系统跳转至职业编辑页** → 不触发接口
3. 用户点击已有职业的"×"删除
4. 或点击"添加职业"按钮添加（支持多选）
5. 用户点击右上角"完成"按钮
6. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/occupation`

**参数:**
```typescript
{
  occupations: string[];    // 职业列表（如：['模特', '主播']）
}
```

**响应数据:**
```typescript
{
  occupations: string[];    // 更新后的职业列表
}
```

### 前端验证
- 可以为空
- 最多选择3个职业
- 不能重复选择

### 前端行为
- 成功后：
  - 返回资料编辑页
  - 更新职业显示（逗号分隔）
  - 提示："修改成功"
- 未选择任何职业：显示"暂未选择"

---

## 十一、编辑微信

### 用户操作
1. 用户点击"微信"行
2. **系统跳转至微信编辑页** → 不触发接口
3. 用户在"微信"输入框输入微信号
4. 用户在"解锁微信"输入框输入解锁密码（可选）
5. 用户点击右上角"完成"按钮
6. **系统提交修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/wechat`

**参数:**
```typescript
{
  wechat: string;           // 微信号
  unlockPassword?: string;  // 解锁密码（可选）
}
```

**响应数据:**
```typescript
{
  wechat: string;           // 更新后的微信号
  hasUnlockPassword: boolean; // 是否设置了解锁密码
}
```

### 前端验证
- 微信号：
  - 可以为空
  - 长度：6-20字符
  - 支持字母、数字、下划线、减号
- 解锁密码：
  - 可选项
  - 如果填写，长度：6-20字符

### 前端行为
- 成功后：
  - 返回资料编辑页
  - 更新微信显示
  - 提示："修改成功"
- 失败后：保留输入内容，显示错误提示

---

## 十二、批量保存（可选）

### 用户操作
1. 用户在编辑页修改多个字段
2. 用户点击页面底部"保存"按钮（如果存在）
3. **系统提交所有修改** → 触发接口

### 接口定义
**接口:** `PUT /api/user/profile/batch`

**参数:**
```typescript
{
  avatar?: string;
  nickname?: string;
  gender?: 'male' | 'female';
  bio?: string;
  birthday?: string;
  height?: string;
  weight?: string;
  occupations?: string[];
  residence?: string;
  wechat?: string;
  unlockPassword?: string;
}
```

**响应数据:**
```typescript
{
  // 返回更新后的完整资料
  avatar: string;
  nickname: string;
  gender: string;
  bio: string;
  birthday: string;
  height: string;
  weight: string;
  occupation: string;
  residence: string;
  wechat: string;
}
```

### 前端验证
- 所有字段都进行独立验证
- 验证失败时高亮错误字段

### 前端行为
- 成功后：
  - 返回上一页
  - 提示："保存成功"
- 失败后：显示错误提示，不返回

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 加载编辑页 | 点击编辑按钮 | `/api/user/profile/edit` | GET |
| 2 | 上传头像 | 选择图片后 | `/api/user/avatar/upload` | POST |
| 3 | 修改昵称 | 点击完成按钮 | `/api/user/profile/nickname` | PUT |
| 4 | 修改性别 | 选择性别 | `/api/user/profile/gender` | PUT |
| 5 | 修改个人介绍 | 点击完成按钮 | `/api/user/profile/bio` | PUT |
| 6 | 修改生日 | 点击确定按钮 | `/api/user/profile/birthday` | PUT |
| 7 | 修改常居地 | 点击确定按钮 | `/api/user/profile/residence` | PUT |
| 8 | 修改身高 | 点击确定按钮 | `/api/user/profile/height` | PUT |
| 9 | 修改体重 | 点击确定按钮 | `/api/user/profile/weight` | PUT |
| 10 | 修改职业 | 点击完成按钮 | `/api/user/profile/occupation` | PUT |
| 11 | 修改微信 | 点击完成按钮 | `/api/user/profile/wechat` | PUT |
| 12 | 批量保存 | 点击保存按钮 | `/api/user/profile/batch` | PUT |

---

## 通用验证规则

### 登录状态
- 所有接口都需要登录状态
- 未登录时跳转至登录页

### 字符长度验证
- **昵称**: 1-20字符
- **个人介绍**: 0-30字符
- **微信号**: 6-20字符
- **解锁密码**: 6-20字符

### 数值范围验证
- **身高**: 140cm - 220cm
- **体重**: 30kg - 200kg
- **年龄**: ≥ 18岁

### 字符格式验证
- **昵称**: 中文、英文、数字、下划线
- **微信号**: 字母、数字、下划线、减号
- **日期格式**: YYYY-MM-DD

### 图片上传规则
- **格式**: jpg, jpeg, png, webp
- **大小**: ≤ 5MB
- **尺寸**: 建议最小300x300

---

## 非接口操作

以下操作不触发接口调用（纯前端交互）：

- **点击"取消"按钮** - 返回上一页，不保存修改
- **点击返回箭头** - 返回上一页（根据是否有修改提示确认）
- **打开选择器** - 打开性别/生日/城市/身高/体重选择器
- **关闭选择器** - 点击"取消"关闭选择器，不保存
- **字符计数** - 实时显示输入字符数
- **清空按钮** - 点击输入框的"×"清空内容
- **操作菜单** - 点击头像后弹出的菜单（拍照/相册/保存图片）

---

## 数据传递

### 跨页面传递
**从编辑主页 → 各编辑子页:**
- 传递：当前字段值
- 方式：路由参数或状态管理

**从各编辑子页 → 返回编辑主页:**
- 同步：更新后的字段值
- 方式：接口返回数据 + 页面刷新

### 实时同步
修改成功后需要同步到：
- 当前编辑页显示
- 个人主页显示
- "我的"页面显示
- 全局用户信息缓存

---

## 交互细节

### 保存策略（方案选择）

**方案一：实时保存（推荐）**
- 每个字段修改后立即调用对应接口保存
- 优点：操作简单，用户无需手动保存
- 缺点：接口调用频繁

**方案二：统一保存**
- 所有修改完成后点击"保存"按钮一次性提交
- 优点：减少接口调用
- 缺点：需要前端维护修改状态

**建议**: 根据UI设计选择，如果没有"保存"按钮，使用方案一

### 离开确认
- 用户修改后未保存（方案二）：
  - 点击返回时弹出确认："确定放弃修改吗？"
- 用户已保存或未修改：直接返回

### 错误提示位置
- **输入框验证错误**: 输入框下方显示红色提示文字
- **接口调用失败**: 页面顶部或底部显示Toast提示
- **网络错误**: 全局提示："网络异常，请稍后重试"

---

## 异常处理

| 场景 | 前端处理方式 |
|-----|------------|
| 昵称重复（409） | 显示："该昵称已被使用，请换一个" |
| 年龄不满18岁（400） | 显示："年龄必须满18岁" |
| 图片过大（413） | 显示："图片大小不能超过5MB" |
| 图片格式错误（400） | 显示："仅支持jpg/png/webp格式" |
| 网络错误 | 显示："网络异常，请稍后重试" + 重试按钮 |
| 未登录（401） | 跳转登录页 |
| 服务器错误（500） | 显示："服务异常，请稍后重试" |

---

## 性能优化

### 图片上传优化
- 选择图片后先压缩再上传
- 建议压缩质量：80%
- 建议最大尺寸：800x800

### 防抖处理
- 输入框实时验证：防抖500ms
- 避免频繁触发验证

### 缓存策略
- 加载编辑页数据可缓存5分钟
- 修改成功后立即清除缓存
- 下次进入重新加载

---

## 补充说明

### 后续待开发功能
- **关注列表页** - 查看关注/粉丝列表（另建文档）
- **技能管理页** - 添加/编辑/删除技能（另建文档）
- **相册管理** - 管理个人相册（如有此功能）

### 与其他模块关联
- 修改昵称/头像后，在动态列表、评论等处同步显示
- 修改生日后，年龄自动计算并同步到主页
- 修改常居地后，距离计算可能发生变化

