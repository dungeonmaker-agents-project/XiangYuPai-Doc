# 消息模块文档调整总结

## 调整完成时间
**Date:** 2025年

---

## 一、调整概览

### 调整目标
- ✅ 消除接口重复定义
- ✅ 明确Controller职责边界
- ✅ 规范跨模块接口引用
- ✅ 统一数据结构定义
- ✅ 便于前后端团队独立开发

### 涉及文档
1. **消息页面文档.md** - 已调整
2. **消息通知子页文档.md** - 已调整
3. **文档分析与重组建议.md** - 新增 (供参考)

---

## 二、主要调整内容

### 📄 消息页面文档.md (MessageController)

#### ✅ 删除的内容
1. **接口10-13** (4个通知列表接口)
   - `GET /api/message/notifications/likes`
   - `GET /api/message/notifications/comments`
   - `GET /api/message/notifications/followers`
   - `GET /api/message/notifications/system`
   - **原因:** 这些接口属于NotificationController,不应在MessageController中定义

2. **详细的通知分类交互描述**
   - 删除了冗长的通知Tab点击交互流程
   - **原因:** 具体实现已在通知子页文档中详细定义

#### ✅ 修改的内容
1. **概述部分**
   - 明确了文档范围: 会话管理和聊天功能
   - 添加了"本文档范围"说明
   - 添加了对通知文档的引用

2. **消息分类切换交互**
   - 简化为简洁的引用说明
   - 指向《消息通知子页文档》

3. **接口汇总表**
   - 从13个接口减少到9个接口
   - 添加了"通知相关接口"说明部分
   - 明确标注为"MessageController - 9个"

4. **相关文档部分**
   - 分类为"本模块相关文档"和"其他模块文档"
   - 突出显示消息通知子页文档的关联

#### 📊 接口数量变化
- **调整前:** 13个接口
- **调整后:** 9个接口
- **减少:** 4个重复接口

---

### 📄 消息通知子页文档.md (NotificationController)

#### ✅ 删除的内容
1. **三、粉丝通知页的接口2-3** (2个关注接口)
   - `POST /api/user/follow` - 关注用户
   - `DELETE /api/user/follow/{userId}` - 取消关注
   - **原因:** 这些接口属于UserController,不应在NotificationController中定义

#### ✅ 修改的内容
1. **概述部分**
   - 添加了"本文档范围"说明
   - 添加了对用户关系文档的引用
   - 明确说明关注功能由用户模块提供

2. **粉丝通知页-接口定义**
   - 保留了接口1: 获取粉丝通知列表
   - 删除了接口2-3: 关注/取消关注
   - 接口2变更为: 标记粉丝通知已读
   - 添加了followStatus字段说明

3. **粉丝通知页-前端行为**
   - 修改了关注按钮的交互说明
   - 明确指出调用"用户模块的关注接口"
   - 添加了"详见《用户关系文档》"的引用

4. **接口汇总表**
   - 从7个接口减少到5个接口
   - 添加了"用户关系接口"说明部分
   - 明确标注为"NotificationController - 5个"

5. **异常处理表**
   - 关注/取消关注失败的处理添加"详见用户关系文档"

6. **开发清单**
   - 修改为"关注/取消关注功能 (调用用户模块接口)"
   - 接口数量从7个改为5个

7. **相关文档部分**
   - 添加了用户关系文档的引用
   - 分类更清晰

#### 📊 接口数量变化
- **调整前:** 7个接口 (包含跨模块接口)
- **调整后:** 5个接口 (纯NotificationController)
- **移除:** 2个跨模块接口

---

## 三、Controller职责划分

### MessageController (9个接口)
**负责:** 私信聊天、会话管理

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/message/unread-count` | GET | 获取未读数 |
| `/api/message/conversations` | GET | 获取会话列表 |
| `/api/message/chat/{conversationId}` | GET | 获取聊天记录 |
| `/api/message/send/text` | POST | 发送文本消息 |
| `/api/message/send/image` | POST | 发送图片消息 |
| `/api/message/send/note` | POST | 分享笔记 |
| `/api/message/conversation/{conversationId}` | DELETE | 删除会话 |
| `/api/message/clear-all` | POST | 清除所有消息 |
| `/api/message/conversation/{conversationId}/read` | PUT | 标记会话已读 |

**文档:** 消息页面文档.md

---

### NotificationController (5个接口)
**负责:** 各类通知的查询和管理

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/message/notifications/likes` | GET | 获取赞和收藏通知 |
| `/api/message/notifications/comments` | GET | 获取评论通知 |
| `/api/message/notifications/followers` | GET | 获取粉丝通知 |
| `/api/message/notifications/system` | GET | 获取系统通知 |
| `/api/message/notifications/read` | PUT | 标记通知已读 |

**文档:** 消息通知子页文档.md

---

### UserRelationController (需其他团队创建)
**负责:** 用户关注、粉丝管理

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/user/follow` | POST | 关注用户 |
| `/api/user/follow/{userId}` | DELETE | 取消关注 |
| `/api/user/following` | GET | 获取关注列表 (建议) |
| `/api/user/followers` | GET | 获取粉丝列表 (建议) |

**文档:** 用户关系文档.md (待创建)

---

## 四、跨文档引用说明

### 消息页面文档 → 消息通知子页文档
**引用位置:**
1. 概述部分
2. 交互行为-消息分类切换
3. 接口汇总表
4. 相关文档部分

**引用方式:**
```markdown
详细功能和接口定义请参见 **《消息通知子页文档》**
```

---

### 消息通知子页文档 → 用户关系文档
**引用位置:**
1. 概述部分
2. 粉丝通知页-前端行为
3. 接口汇总表
4. 异常处理表
5. 相关文档部分

**引用方式:**
```markdown
调用用户模块的关注接口,详见 **《用户关系文档》**
```

---

## 五、数据结构优化

### 统一的响应格式
所有接口使用统一的响应结构:
```typescript
{
  code: number;      // 200=成功,其他=失败
  message: string;   // 提示信息
  data: any;         // 业务数据
}
```

### 粉丝通知字段优化
保留了更详细的followStatus字段:
```typescript
{
  followStatus: 'not_following' | 'following' | 'mutual';
  // not_following: 未关注
  // following: 已关注(单向)
  // mutual: 互相关注
}
```

---

## 六、文档依赖关系

```
┌─────────────────────────────────┐
│     消息页面文档.md              │
│   (MessageController - 9接口)   │
│   - 会话列表                     │
│   - 聊天对话                     │
└──────────────┬──────────────────┘
               │
               │ 引用
               ↓
┌─────────────────────────────────┐
│   消息通知子页文档.md            │
│ (NotificationController - 5接口) │
│   - 赞和收藏                     │
│   - 评论                         │
│   - 粉丝                         │
│   - 系统通知                     │
└──────────────┬──────────────────┘
               │
               │ 引用
               ↓
┌─────────────────────────────────┐
│    用户关系文档.md (待创建)      │
│  (UserController - 2+接口)      │
│   - 关注/取消关注                │
│   - 关注/粉丝列表                │
└─────────────────────────────────┘
```

---

## 七、后续工作建议

### 🔴 高优先级 (需要其他团队完成)

#### 1. 创建用户关系文档
**负责团队:** 用户模块团队

**需要定义的接口:**
- `POST /api/user/follow` - 关注用户
- `DELETE /api/user/follow/{userId}` - 取消关注用户
- `GET /api/user/following` - 获取关注列表
- `GET /api/user/followers` - 获取粉丝列表
- `GET /api/user/mutual-follows` - 获取互相关注列表

**参考:** 消息通知子页文档中的粉丝功能需求

---

### 🟡 中优先级 (可选优化)

#### 1. 接口路径优化评估
**当前路径:**
- 消息: `/api/message/*`
- 通知: `/api/message/notifications/*`
- 用户: `/api/user/*`

**优化建议:**
- 考虑将通知路径改为: `/api/notifications/*`
- 使通知模块更独立

**影响范围:**
- 前端路由调整
- 后端Controller路径调整
- API文档更新

---

#### 2. 补充缺失功能接口
**建议添加:**
- 批量删除会话
- 批量标记已读
- 会话置顶/免打扰
- 消息搜索
- 通知删除

**参考:** 文档分析与重组建议.md 第五章

---

### 🟢 低优先级 (未来优化)

#### 1. WebSocket事件归属明确
- 在文档中明确哪些WebSocket事件属于MessageController
- 哪些属于NotificationController

#### 2. 图片上传接口统一
- 确认是否有通用的文件上传接口
- 在文档中添加引用说明

---

## 八、给其他团队的说明

### 📌 对于用户模块团队
**需要你们提供的文档:**
1. **用户关系文档.md**
   - 包含关注/取消关注接口定义
   - 包含关注列表/粉丝列表接口定义

**参考资料:**
- 消息通知子页文档.md - 三、粉丝通知页
- 文档分析与重组建议.md - UserRelationController部分

**接口要求:**
- `POST /api/user/follow` - 需要返回followStatus
- `DELETE /api/user/follow/{userId}` - 取消关注
- followStatus类型: `'not_following' | 'following' | 'mutual'`

---

### 📌 对于前端团队
**开发顺序建议:**
1. **Phase 1:** 消息页面 (会话列表、聊天)
   - 参考: 消息页面文档.md
   - 接口: MessageController 9个接口

2. **Phase 2:** 通知子页 (除粉丝页的关注功能)
   - 参考: 消息通知子页文档.md
   - 接口: NotificationController 5个接口

3. **Phase 3:** 粉丝页的关注功能
   - 等待用户模块团队提供接口
   - 参考: 用户关系文档.md (待创建)

---

### 📌 对于后端团队
**Controller实现建议:**

#### MessageController.java
```java
@RestController
@RequestMapping("/api/message")
public class MessageController {
    // 9个接口实现
    @GetMapping("/unread-count")
    @GetMapping("/conversations")
    @GetMapping("/chat/{conversationId}")
    @PostMapping("/send/text")
    @PostMapping("/send/image")
    @PostMapping("/send/note")
    @DeleteMapping("/conversation/{conversationId}")
    @PostMapping("/clear-all")
    @PutMapping("/conversation/{conversationId}/read")
}
```

#### NotificationController.java
```java
@RestController
@RequestMapping("/api/message/notifications")
public class NotificationController {
    // 5个接口实现
    @GetMapping("/likes")
    @GetMapping("/comments")
    @GetMapping("/followers")
    @GetMapping("/system")
    @PutMapping("/read")
}
```

#### UserRelationController.java (由用户模块团队实现)
```java
@RestController
@RequestMapping("/api/user")
public class UserRelationController {
    // 至少2个接口
    @PostMapping("/follow")
    @DeleteMapping("/follow/{userId}")
    // 建议添加:
    @GetMapping("/following")
    @GetMapping("/followers")
}
```

---

## 九、文档交付清单

### ✅ 已完成
- [x] 消息页面文档.md (调整完成)
- [x] 消息通知子页文档.md (调整完成)
- [x] 文档分析与重组建议.md (新增)
- [x] 消息模块文档调整总结.md (本文档)

### ⏳ 待其他团队完成
- [ ] 用户关系文档.md (用户模块团队)
- [ ] 评论模块文档 (如需要)
- [ ] 点赞收藏模块文档 (如需要)

---

## 十、总结

### ✅ 调整成果
1. **消除了4个重复接口定义**
2. **明确了3个Controller的职责边界**
3. **建立了清晰的跨文档引用关系**
4. **统一了数据结构定义**
5. **便于前后端团队独立并行开发**

### 📊 最终接口统计
- **MessageController:** 9个接口
- **NotificationController:** 5个接口
- **UserRelationController:** 2+个接口 (待定义)
- **总计:** 16+个接口

### 🎯 关键改进
- 每个文档职责单一,对应一个Controller
- 跨模块功能通过引用说明,避免重复
- 数据结构更完整和一致
- 文档间依赖关系清晰

### 📝 下一步行动
1. 交付给前端团队开始开发 (Phase 1-2可以立即开始)
2. 通知用户模块团队创建用户关系文档
3. 后端团队按Controller职责开发
4. 定期review和完善文档

---

**文档调整完成,可以交付给各团队使用! ✅**
