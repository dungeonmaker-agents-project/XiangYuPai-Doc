# æ¶ˆæ¯é¡µé¢æ–‡æ¡£

## æ¦‚è¿°
æœ¬æ–‡æ¡£å®šä¹‰æ¶ˆæ¯é¡µé¢çš„ä¼šè¯ç®¡ç†å’ŒèŠå¤©åŠŸèƒ½å®ç°,åŒ…æ‹¬ä¼šè¯åˆ—è¡¨ã€èŠå¤©å¯¹è¯ã€æ¶ˆæ¯å‘é€ç­‰åŠŸèƒ½çš„UIå¸ƒå±€ã€äº¤äº’è¡Œä¸ºã€å‰ç«¯é€»è¾‘å’ŒAPIæ¥å£è§„èŒƒã€‚

**æœ¬æ–‡æ¡£èŒƒå›´:**
- æ¶ˆæ¯ä¸»é¡µ (ä¼šè¯åˆ—è¡¨éƒ¨åˆ†)
- èŠå¤©å¯¹è¯é¡µé¢
- ç§ä¿¡æ¶ˆæ¯æ”¶å‘

**ç›¸å…³æ–‡æ¡£:**
- æ¶ˆæ¯é€šçŸ¥å­é¡µæ–‡æ¡£ (èµå’Œæ”¶è—ã€è¯„è®ºã€ç²‰ä¸ã€ç³»ç»Ÿé€šçŸ¥åŠŸèƒ½)
- ä¸ªäººä¸»é¡µæ–‡æ¡£
- ç¬”è®°è¯¦æƒ…é¡µé¢æ–‡æ¡£

---

## APIæ¥å£è§„èŒƒ

### æ¥å£1:è·å–æ¶ˆæ¯åˆ†ç±»æœªè¯»æ•°
**æ¥å£:** `GET /api/message/unread-count`

**è§¦å‘æ—¶æœº:** è¿›å…¥æ¶ˆæ¯é¡µé¢æ—¶ / åº”ç”¨æ¢å¤å‰å°æ—¶

**è¯·æ±‚å‚æ•°:**
```typescript
// æ— éœ€å‚æ•°,ä»tokenä¸­è·å–ç”¨æˆ·ID
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;           // 200=æˆåŠŸ,å…¶ä»–=å¤±è´¥
  message: string;        // æç¤ºä¿¡æ¯
  data: {
    likes: number;        // èµå’Œæ”¶è—æœªè¯»æ•°
    comments: number;     // è¯„è®ºæœªè¯»æ•°
    followers: number;    // ç²‰ä¸æœªè¯»æ•°
    system: number;       // ç³»ç»Ÿé€šçŸ¥æœªè¯»æ•°
    total: number;        // æ€»æœªè¯»æ•°
  }
}
```

### æ¥å£2:è·å–ä¼šè¯åˆ—è¡¨
**æ¥å£:** `GET /api/message/conversations`

**è§¦å‘æ—¶æœº:** è¿›å…¥æ¶ˆæ¯é¡µé¢æ—¶ / ä¸‹æ‹‰åˆ·æ–° / ä¸Šæ‹‰åŠ è½½

**è¯·æ±‚å‚æ•°:**
```typescript
{
  page: number;           // é¡µç ,ä»1å¼€å§‹
  pageSize: number;       // æ¯é¡µæ•°é‡,é»˜è®¤20
  lastMessageId?: string; // æœ€åä¸€æ¡æ¶ˆæ¯ID,ç”¨äºåˆ†é¡µåŠ è½½
}
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;        // ä¼šè¯æ€»æ•°
    hasMore: boolean;     // æ˜¯å¦æœ‰æ›´å¤šæ•°æ®
    list: Array<{
      conversationId: string;   // ä¼šè¯ID
      userId: string;           // å¯¹æ–¹ç”¨æˆ·ID
      nickname: string;         // å¯¹æ–¹æ˜µç§°
      avatar: string;           // å¯¹æ–¹å¤´åƒURL
      lastMessage: string;      // æœ€åä¸€æ¡æ¶ˆæ¯å†…å®¹
      lastMessageTime: string;  // æœ€åæ¶ˆæ¯æ—¶é—´,ISOæ ¼å¼
      unreadCount: number;      // æœªè¯»æ¶ˆæ¯æ•°
      isOnline: boolean;        // å¯¹æ–¹æ˜¯å¦åœ¨çº¿
    }>;
  }
}
```

### æ¥å£3:è·å–èŠå¤©æ¶ˆæ¯è®°å½•
**æ¥å£:** `GET /api/message/chat/{conversationId}`

**è§¦å‘æ—¶æœº:** ç‚¹å‡»ä¼šè¯è¿›å…¥èŠå¤©é¡µé¢ / ä¸‹æ‹‰åŠ è½½å†å²æ¶ˆæ¯

**è¯·æ±‚å‚æ•°:**
```typescript
{
  conversationId: string; // ä¼šè¯ID (è·¯å¾„å‚æ•°)
  page: number;           // é¡µç ,ä»1å¼€å§‹
  pageSize: number;       // æ¯é¡µæ•°é‡,é»˜è®¤20
  beforeMessageId?: string; // è·å–è¯¥æ¶ˆæ¯ä¹‹å‰çš„æ¶ˆæ¯,ç”¨äºåŠ è½½å†å²
}
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: {
    conversationId: string;
    userId: string;         // å¯¹æ–¹ç”¨æˆ·ID
    nickname: string;       // å¯¹æ–¹æ˜µç§°
    avatar: string;         // å¯¹æ–¹å¤´åƒURL
    isOnline: boolean;      // å¯¹æ–¹åœ¨çº¿çŠ¶æ€
    hasMore: boolean;       // æ˜¯å¦æœ‰æ›´å¤šå†å²æ¶ˆæ¯
    messages: Array<{
      messageId: string;    // æ¶ˆæ¯ID
      senderId: string;     // å‘é€è€…ID
      content: string;      // æ¶ˆæ¯å†…å®¹
      contentType: 'text' | 'image' | 'note'; // æ¶ˆæ¯ç±»å‹
      noteData?: {          // å½“contentTypeä¸ºnoteæ—¶å­˜åœ¨
        noteId: string;     // ç¬”è®°ID
        coverImage: string; // ç¬”è®°å°é¢
        title: string;      // ç¬”è®°æ ‡é¢˜(å®é™…æ˜¾ç¤º"è¯·ä½ ä»¬çœ‹çœ‹")
        author: string;     // ç¬”è®°ä½œè€…æ˜µç§°
        viewCount: number;  // æµè§ˆé‡
      };
      timestamp: string;    // æ¶ˆæ¯æ—¶é—´,ISOæ ¼å¼
      status: 'sending' | 'sent' | 'failed'; // æ¶ˆæ¯çŠ¶æ€
    }>;
  }
}
```

### æ¥å£4:å‘é€æ–‡æœ¬æ¶ˆæ¯
**æ¥å£:** `POST /api/message/send/text`

**è§¦å‘æ—¶æœº:** ç”¨æˆ·è¾“å…¥æ–‡æœ¬åç‚¹å‡»å‘é€æŒ‰é’® / æŒ‰ä¸‹Enteré”®

**è¯·æ±‚å‚æ•°:**
```typescript
{
  conversationId: string; // ä¼šè¯ID
  receiverId: string;     // æ¥æ”¶è€…ç”¨æˆ·ID
  content: string;        // æ¶ˆæ¯å†…å®¹,1-500å­—ç¬¦
}
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: {
    messageId: string;    // ç”Ÿæˆçš„æ¶ˆæ¯ID
    timestamp: string;    // æœåŠ¡å™¨æ—¶é—´æˆ³
    status: 'sent';       // å‘é€çŠ¶æ€
  }
}
```

### æ¥å£5:å‘é€å›¾ç‰‡æ¶ˆæ¯
**æ¥å£:** `POST /api/message/send/image`

**è§¦å‘æ—¶æœº:** ç”¨æˆ·é€‰æ‹©å›¾ç‰‡åè‡ªåŠ¨å‘é€

**è¯·æ±‚å‚æ•°:**
```typescript
{
  conversationId: string; // ä¼šè¯ID
  receiverId: string;     // æ¥æ”¶è€…ç”¨æˆ·ID
  imageUrl: string;       // å›¾ç‰‡URL(å…ˆä¸Šä¼ åˆ°OSSå†å‘é€)
  thumbnailUrl?: string;  // ç¼©ç•¥å›¾URL
}
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: {
    messageId: string;
    timestamp: string;
    status: 'sent';
  }
}
```

### æ¥å£6:åˆ†äº«ç¬”è®°åˆ°ä¼šè¯
**æ¥å£:** `POST /api/message/send/note`

**è§¦å‘æ—¶æœº:** ç”¨æˆ·åœ¨ç¬”è®°è¯¦æƒ…é¡µç‚¹å‡»åˆ†äº«é€‰æ‹©è”ç³»äººå

**è¯·æ±‚å‚æ•°:**
```typescript
{
  conversationId: string; // ä¼šè¯ID
  receiverId: string;     // æ¥æ”¶è€…ç”¨æˆ·ID
  noteId: string;         // ç¬”è®°ID
}
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: {
    messageId: string;
    timestamp: string;
    status: 'sent';
    noteData: {           // è¿”å›ç¬”è®°å®Œæ•´ä¿¡æ¯ä¾›å‰ç«¯æ˜¾ç¤º
      noteId: string;
      coverImage: string;
      title: string;
      author: string;
      viewCount: number;
    };
  }
}
```

### æ¥å£7:åˆ é™¤ä¼šè¯
**æ¥å£:** `DELETE /api/message/conversation/{conversationId}`

**è§¦å‘æ—¶æœº:** ç”¨æˆ·å·¦æ»‘ä¼šè¯ç‚¹å‡»åˆ é™¤ / é•¿æŒ‰ä¼šè¯é€‰æ‹©åˆ é™¤

**è¯·æ±‚å‚æ•°:**
```typescript
{
  conversationId: string; // ä¼šè¯ID (è·¯å¾„å‚æ•°)
}
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: null
}
```

### æ¥å£8:æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯é€šçŸ¥
**æ¥å£:** `POST /api/message/clear-all`

**è§¦å‘æ—¶æœº:** ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’æ¸…é™¤æŒ‰é’®åç¡®è®¤

**è¯·æ±‚å‚æ•°:**
```typescript
// æ— éœ€å‚æ•°,ä»tokenä¸­è·å–ç”¨æˆ·ID
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: null
}
```

### æ¥å£9:æ ‡è®°ä¼šè¯å·²è¯»
**æ¥å£:** `PUT /api/message/conversation/{conversationId}/read`

**è§¦å‘æ—¶æœº:** è¿›å…¥èŠå¤©é¡µé¢æ—¶è‡ªåŠ¨è§¦å‘

**è¯·æ±‚å‚æ•°:**
```typescript
{
  conversationId: string; // ä¼šè¯ID (è·¯å¾„å‚æ•°)
}
```

**å“åº”æ•°æ®:**
```typescript
{
  code: number;
  message: string;
  data: null
}
```

**é”™è¯¯ç è¯´æ˜:**
| çŠ¶æ€ç  | è¯´æ˜ | å‰ç«¯æç¤º |
|-------|------|---------|
| 200 | æˆåŠŸ | æ­£å¸¸å¤„ç† |
| 400 | å‚æ•°é”™è¯¯ | "è¯·æ±‚å‚æ•°é”™è¯¯" |
| 401 | æœªç™»å½• | è·³è½¬ç™»å½•é¡µ |
| 403 | æƒé™ä¸è¶³ | "æ— æƒé™è®¿é—®è¯¥ä¼šè¯" |
| 404 | èµ„æºä¸å­˜åœ¨ | "ä¼šè¯ä¸å­˜åœ¨æˆ–å·²åˆ é™¤" |
| 500 | æœåŠ¡å™¨é”™è¯¯ | "æ“ä½œå¤±è´¥,è¯·ç¨åé‡è¯•" |

---

## é¡µé¢å¸ƒå±€

### é¡¶éƒ¨å¯¼èˆªæ 
```
        æ¶ˆæ¯  ğŸ—‘
```

**å¸ƒå±€:**
- æ ‡é¢˜:"æ¶ˆæ¯"
  - å­—ä½“å¤§å°:20pt
  - å­—ä½“ç²—ç»†:åŠ ç²—
  - é¢œè‰²:æ·±ç°è‰² (#1a1a1a)
  - ä½ç½®:å±…ä¸­
- æ¸…é™¤æŒ‰é’®:å³ä¸Šè§’åƒåœ¾æ¡¶å›¾æ ‡
  - å°ºå¯¸:24x24px
  - ç‚¹å‡»åŒºåŸŸ:44x44px
  - é¢œè‰²:æ·±ç°è‰² (#666)
- é«˜åº¦:56px
- èƒŒæ™¯:ç™½è‰²
- çŠ¶æ€æ :æ˜¾ç¤ºæ—¶é—´ã€ä¿¡å·ã€ç”µæ± ç­‰

### æ¶ˆæ¯åˆ†ç±»TabåŒº
```
[â¤]      [ğŸ’¬]      [ğŸ‘¤]      [ğŸ””]
èµå’Œæ”¶è—  è¯„è®º      ç²‰ä¸      ç³»ç»Ÿé€šçŸ¥
  1
```

**å¸ƒå±€:**
- 4ä¸ªåˆ†ç±»å¹¶æ’æ˜¾ç¤º
- æ¯ä¸ªåˆ†ç±»å®½åº¦:25% (å±å¹•å®½åº¦ / 4)
- é«˜åº¦:80px
- é—´è·:å·¦å³è¾¹è·24px

**æ¯ä¸ªåˆ†ç±»é¡¹åŒ…å«:**
1. **å›¾æ ‡**
   - å°ºå¯¸:48x48px
   - åœ†è§’:8px
   - èƒŒæ™¯è‰²:
     - èµå’Œæ”¶è—:ç²‰çº¢è‰²èƒŒæ™¯ (#fce7f3)
     - è¯„è®º:è“è‰²èƒŒæ™¯ (#dbeafe)
     - ç²‰ä¸:æ©™è‰²èƒŒæ™¯ (#fed7aa)
     - ç³»ç»Ÿé€šçŸ¥:ç´«è‰²èƒŒæ™¯ (#e9d5ff)
   - å›¾æ ‡é¢œè‰²:å¯¹åº”æ·±è‰²

2. **æ ‡é¢˜æ–‡å­—**
   - å­—ä½“å¤§å°:14pt
   - é¢œè‰²:æ·±ç°è‰² (#333)
   - ä½ç½®:å›¾æ ‡ä¸‹æ–¹8px
   - å¯¹é½:å±…ä¸­

3. **æœªè¯»è§’æ ‡**
   - ä½ç½®:å›¾æ ‡å³ä¸Šè§’
   - èƒŒæ™¯:çº¢è‰² (#ef4444)
   - æ–‡å­—:ç™½è‰²,12pt
   - å°ºå¯¸:
     - 1ä½æ•°:18x18pxåœ†å½¢
     - 2ä½æ•°:è‡ªåŠ¨æ‰©å±•å®½åº¦,é«˜åº¦18px
     - è¶…è¿‡99æ˜¾ç¤º"99+"
   - æ˜¾ç¤ºæ¡ä»¶:æœªè¯»æ•° > 0

### ä¼šè¯åˆ—è¡¨åŒº

**å•ä¸ªä¼šè¯é¡¹å¸ƒå±€:**
```
[å¤´åƒ]  ç”¨æˆ·åç§°123          1åˆ†é’Ÿå‰
       ä½ çš„ä½œå“å¥½æ£’,å¯ä»¥åŠ ä¸ªå¾®ä¿¡å—...
```

**å¸ƒå±€ç»“æ„:**
- å·¦ä¾§å¤´åƒ:
  - å°ºå¯¸:56x56px
  - åœ†å½¢
  - å·¦è¾¹è·:20px
  - åœ¨çº¿çŠ¶æ€è§’æ ‡:
    - ä½ç½®:å³ä¸‹è§’
    - å°ºå¯¸:12x12px
    - é¢œè‰²:ç»¿è‰² (#10b981)
    - è¾¹æ¡†:2pxç™½è‰²

- ä¸­é—´å†…å®¹åŒº:
  - å·¦è¾¹è·:12px (è·ç¦»å¤´åƒ)
  - å³è¾¹è·:60px (ä¸ºæ—¶é—´ç•™ç©ºé—´)

  **ç¬¬ä¸€è¡Œ:**
  - æ˜µç§°:
    - å­—ä½“å¤§å°:16pt
    - å­—ä½“ç²—ç»†:ä¸­ç­‰åŠ ç²—
    - é¢œè‰²:æ·±ç°è‰² (#1a1a1a)
    - æœ€å¤§å®½åº¦:60% (é˜²æ­¢é®æŒ¡æ—¶é—´)
    - è¶…é•¿æ˜¾ç¤ºçœç•¥å·

  **ç¬¬äºŒè¡Œ:**
  - æœ€åæ¶ˆæ¯å†…å®¹:
    - å­—ä½“å¤§å°:14pt
    - é¢œè‰²:æµ…ç°è‰² (#999)
    - æœ€å¤šæ˜¾ç¤º1è¡Œ
    - è¶…é•¿æ˜¾ç¤ºçœç•¥å·
    - è·ç¦»ç¬¬ä¸€è¡Œ:4px

- å³ä¸Šè§’æ—¶é—´:
  - å­—ä½“å¤§å°:12pt
  - é¢œè‰²:æµ…ç°è‰² (#999)
  - ä½ç½®:å³å¯¹é½,ä¸Šå¯¹é½
  - å³è¾¹è·:20px
  - æ ¼å¼:
    - 1å°æ—¶å†…:"Xåˆ†é’Ÿå‰"
    - ä»Šå¤©:"HH:MM" (å¦‚ 14:30)
    - æ˜¨å¤©:"æ˜¨å¤©"
    - æ›´æ—©:"MM-DD" (å¦‚ 06-10)

- æœªè¯»è§’æ ‡:
  - ä½ç½®:å³ä¾§,æ¶ˆæ¯å†…å®¹åŒä¸€è¡Œ
  - èƒŒæ™¯:çº¢è‰² (#ef4444)
  - æ–‡å­—:ç™½è‰²,12pt
  - å°ºå¯¸:
    - 1ä½æ•°:18x18pxåœ†å½¢
    - 2ä½æ•°:è‡ªåŠ¨æ‰©å±•,é«˜åº¦18px
  - æ˜¾ç¤ºæ¡ä»¶:æœªè¯»æ•° > 0
  - å³è¾¹è·:20px

**ä¼šè¯é¡¹é«˜åº¦:**
- æ ‡å‡†é«˜åº¦:88px
- åº•éƒ¨åˆ†å‰²çº¿:1pxæµ…ç°è‰² (#f5f5f5)

**ç©ºçŠ¶æ€:**
```
[ç©ºçŠ¶æ€å›¾æ ‡]
æš‚æ— æ¶ˆæ¯
```
- å›¾æ ‡:ç°è‰²æ¶ˆæ¯å›¾æ ‡
- æ–‡å­—:"æš‚æ— æ¶ˆæ¯"
- å­—ä½“å¤§å°:16pt
- é¢œè‰²:æµ…ç°è‰² (#999)
- ä½ç½®:å‚ç›´å±…ä¸­

### åº•éƒ¨Tabæ 
```
[ğŸ ]    [ğŸ”]    [ğŸ’¬]    [ğŸ‘¤]
é¦–é¡µ    å‘ç°    æ¶ˆæ¯    æˆ‘çš„
```
- é«˜åº¦:56px + å®‰å…¨åŒºåŸŸ
- èƒŒæ™¯:ç™½è‰²
- é¡¶éƒ¨åˆ†å‰²çº¿:1pxæµ…ç°è‰²
- å½“å‰é€‰ä¸­:"æ¶ˆæ¯"
  - å›¾æ ‡:ç´«è‰² (#9333ea)
  - æ–‡å­—:ç´«è‰²,åŠ ç²—
- æœªé€‰ä¸­:
  - å›¾æ ‡:ç°è‰² (#999)
  - æ–‡å­—:ç°è‰²

---

## èŠå¤©é¡µé¢å¸ƒå±€

### é¡¶éƒ¨å¯¼èˆªæ 
```
[â†]  ç”¨æˆ·æ˜µç§°
     åœ¨çº¿
```

**å¸ƒå±€:**
- è¿”å›æŒ‰é’®:å·¦ä¾§ç®­å¤´
  - å°ºå¯¸:44x44px
  - é¢œè‰²:æ·±ç°è‰²
- æ ‡é¢˜åŒºåŸŸ:å±…ä¸­
  - ç¬¬ä¸€è¡Œ:ç”¨æˆ·æ˜µç§°
    - å­—ä½“å¤§å°:18pt
    - å­—ä½“ç²—ç»†:ä¸­ç­‰åŠ ç²—
    - é¢œè‰²:æ·±ç°è‰² (#1a1a1a)
  - ç¬¬äºŒè¡Œ:åœ¨çº¿çŠ¶æ€
    - å­—ä½“å¤§å°:12pt
    - é¢œè‰²:æµ…ç°è‰² (#999)
    - æ–‡å­—:"åœ¨çº¿" / "ç¦»çº¿" / "XXåˆ†é’Ÿå‰åœ¨çº¿"

### æ¶ˆæ¯åˆ—è¡¨åŒº

**æ—¶é—´åˆ†éš”ç¬¦:**
```
1åˆ†é’Ÿå‰
```
- å­—ä½“å¤§å°:12pt
- é¢œè‰²:æµ…ç°è‰² (#999)
- èƒŒæ™¯:åŠé€æ˜ç°è‰²åœ†è§’èƒŒæ™¯
- å¯¹é½:å±…ä¸­
- ä¸Šä¸‹é—´è·:16px

**å¯¹æ–¹æ¶ˆæ¯æ°”æ³¡:**
```
[å¤´åƒ]  [ä»€ä¹ˆæ—¶å€™æœ‰ç©ºèƒ½æ¥æˆ‘çš„è®¢å•]
```

**å¸ƒå±€:**
- å·¦ä¾§å¯¹é½
- å¤´åƒ:
  - å°ºå¯¸:40x40px
  - åœ†å½¢
  - å·¦è¾¹è·:16px
- æ°”æ³¡:
  - å·¦è¾¹è·:8px (è·ç¦»å¤´åƒ)
  - æœ€å¤§å®½åº¦:70% (å±å¹•å®½åº¦)
  - èƒŒæ™¯:ç™½è‰² (#ffffff)
  - åœ†è§’:12px (å·¦ä¸Šè§’4px,å…¶ä»–12px)
  - è¾¹æ¡†:1pxæµ…ç°è‰² (#e5e5e5)
  - å†…è¾¹è·:12px
  - æ–‡å­—:
    - å­—ä½“å¤§å°:16pt
    - é¢œè‰²:æ·±ç°è‰² (#1a1a1a)
    - è¡Œé«˜:1.5

**è‡ªå·±æ¶ˆæ¯æ°”æ³¡:**
```
                          [ç°åœ¨å°±å¯ä»¥]  [å¤´åƒ]
```

**å¸ƒå±€:**
- å³ä¾§å¯¹é½
- å¤´åƒ:
  - å°ºå¯¸:40x40px
  - åœ†å½¢
  - å³è¾¹è·:16px
- æ°”æ³¡:
  - å³è¾¹è·:8px (è·ç¦»å¤´åƒ)
  - æœ€å¤§å®½åº¦:70%
  - èƒŒæ™¯:ç´«è‰²åˆ°è“è‰²æ¸å˜
    - èµ·å§‹è‰²:#b794f6
    - ç»“æŸè‰²:#a5b4fc
  - åœ†è§’:12px (å³ä¸Šè§’4px,å…¶ä»–12px)
  - å†…è¾¹è·:12px
  - æ–‡å­—:
    - å­—ä½“å¤§å°:16pt
    - é¢œè‰²:ç™½è‰² (#ffffff)
    - è¡Œé«˜:1.5

**ç¬”è®°åˆ†äº«å¡ç‰‡:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å°é¢å›¾]   è¯·ä½ ä»¬çœ‹çœ‹            â”‚
â”‚           ç”¨æˆ·æ˜µç§°              â”‚
â”‚           ğŸ‘ 88                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¸ƒå±€:**
- å®½åº¦:æœ€å¤§280px
- èƒŒæ™¯:ç™½è‰²
- åœ†è§’:12px
- è¾¹æ¡†:1pxæµ…ç°è‰²
- å†…è¾¹è·:12px

**å†…å®¹:**
- å°é¢å›¾:
  - å°ºå¯¸:80x80px
  - åœ†è§’:8px
  - ä½ç½®:å·¦ä¾§
- å³ä¾§æ–‡å­—åŒº:
  - å·¦è¾¹è·:12px

  **ç¬¬ä¸€è¡Œ:æ ‡é¢˜**
  - æ–‡å­—:"è¯·ä½ ä»¬çœ‹çœ‹"
  - å­—ä½“å¤§å°:16pt
  - å­—ä½“ç²—ç»†:ä¸­ç­‰åŠ ç²—
  - é¢œè‰²:æ·±ç°è‰² (#1a1a1a)
  - æœ€å¤š2è¡Œ,è¶…é•¿çœç•¥

  **ç¬¬äºŒè¡Œ:ä½œè€…**
  - å­—ä½“å¤§å°:14pt
  - é¢œè‰²:ç°è‰² (#666)
  - è·ç¦»æ ‡é¢˜:4px

  **ç¬¬ä¸‰è¡Œ:æµè§ˆé‡**
  - çœ¼ç›å›¾æ ‡ + æ•°å­—
  - å­—ä½“å¤§å°:12pt
  - é¢œè‰²:æµ…ç°è‰² (#999)
  - è·ç¦»ä½œè€…:4px

### åº•éƒ¨è¾“å…¥åŒº

```
[è¯·è¾“å…¥å†…å®¹...________________________] [ğŸ“·] [ğŸ–¼]
```

**å¸ƒå±€:**
- é«˜åº¦:60px + å®‰å…¨åŒºåŸŸ
- èƒŒæ™¯:ç™½è‰²
- é¡¶éƒ¨åˆ†å‰²çº¿:1pxæµ…ç°è‰²
- å†…è¾¹è·:8px 16px

**è¾“å…¥æ¡†:**
- å ä½ç¬¦:"è¯·è¾“å…¥å†…å®¹..."
- å ä½ç¬¦é¢œè‰²:æµ…ç°è‰² (#c0c0c0)
- æœ€å°é«˜åº¦:40px
- æœ€å¤§é«˜åº¦:120px (è¶…å‡ºå¯æ»šåŠ¨)
- åœ†è§’:20px
- èƒŒæ™¯:#f5f5f5
- å†…è¾¹è·:10px 16px
- å­—ä½“å¤§å°:16pt
- é¢œè‰²:æ·±ç°è‰² (#1a1a1a)
- å¼¹æ€§å®½åº¦:å æ®å‰©ä½™ç©ºé—´

**ç›¸æœºæŒ‰é’®:**
- å›¾æ ‡:ç›¸æœº
- å°ºå¯¸:44x44px
- é¢œè‰²:ç°è‰² (#666)
- å·¦è¾¹è·:8px

**å›¾ç‰‡æŒ‰é’®:**
- å›¾æ ‡:å›¾ç‰‡
- å°ºå¯¸:44x44px
- é¢œè‰²:ç°è‰² (#666)
- å·¦è¾¹è·:8px

---

## äº¤äº’è¡Œä¸º

### 1. é¡µé¢åŠ è½½
**è¿›å…¥æ¶ˆæ¯é¡µé¢æ—¶:**
1. æ˜¾ç¤ºéª¨æ¶å±æˆ–åŠ è½½åŠ¨ç”»
2. å¹¶è¡Œè°ƒç”¨ä»¥ä¸‹æ¥å£:
   - æ¥å£1:è·å–æœªè¯»æ•° â†’ æ›´æ–°Tabè§’æ ‡
   - æ¥å£2:è·å–ä¼šè¯åˆ—è¡¨ â†’ æ˜¾ç¤ºä¼šè¯åˆ—è¡¨
3. åŠ è½½å®Œæˆåéšè—éª¨æ¶å±

**åŠ è½½å¤±è´¥:**
- æ˜¾ç¤ºé”™è¯¯æç¤º:"åŠ è½½å¤±è´¥,ç‚¹å‡»é‡è¯•"
- æä¾›é‡è¯•æŒ‰é’®

### 2. æ¶ˆæ¯åˆ†ç±»åˆ‡æ¢
**ç‚¹å‡»åˆ†ç±»Tab:**

**é€šçŸ¥åˆ†ç±» (èµå’Œæ”¶è—ã€è¯„è®ºã€ç²‰ä¸ã€ç³»ç»Ÿé€šçŸ¥):**
1. è·³è½¬åˆ°å¯¹åº”çš„é€šçŸ¥å­é¡µé¢
2. è¯¦ç»†åŠŸèƒ½å’Œæ¥å£å®šä¹‰è¯·å‚è§ **ã€Šæ¶ˆæ¯é€šçŸ¥å­é¡µæ–‡æ¡£ã€‹**
3. é€šçŸ¥é¡µé¢ä¼šè‡ªåŠ¨æ ‡è®°ä¸ºå·²è¯»å¹¶æ¸…é™¤æœªè¯»è§’æ ‡

### 3. ä¼šè¯åˆ—è¡¨äº¤äº’

**ä¸‹æ‹‰åˆ·æ–°:**
1. æ˜¾ç¤ºä¸‹æ‹‰åˆ·æ–°åŠ¨ç”»
2. é‡æ–°è°ƒç”¨æ¥å£2:page=1
3. æ›¿æ¢å½“å‰åˆ—è¡¨æ•°æ®
4. éšè—åˆ·æ–°åŠ¨ç”»
5. æ˜¾ç¤ºæç¤º:"åˆ·æ–°æˆåŠŸ"

**ä¸Šæ‹‰åŠ è½½æ›´å¤š:**
1. æ£€æŸ¥hasMoreæ ‡å¿—
2. hasMoreä¸ºtrueæ—¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
3. è°ƒç”¨æ¥å£2:pageé€’å¢,ä¼ å…¥lastMessageId
4. è¿½åŠ æ–°æ•°æ®åˆ°åˆ—è¡¨æœ«å°¾
5. éšè—åŠ è½½åŠ¨ç”»

**ç‚¹å‡»ä¼šè¯:**
1. è°ƒç”¨æ¥å£3:è·å–èŠå¤©æ¶ˆæ¯è®°å½•
2. è·³è½¬åˆ°èŠå¤©é¡µé¢
3. ä¼ é€’å‚æ•°:conversationId, userId, nickname, avatar
4. è°ƒç”¨æ¥å£9:æ ‡è®°ä¼šè¯å·²è¯»
5. æ¸…é™¤è¯¥ä¼šè¯æœªè¯»è§’æ ‡
6. æ›´æ–°ä¼šè¯åˆ—è¡¨çš„æœªè¯»æ•°

**å·¦æ»‘åˆ é™¤(iOS):**
1. å·¦æ»‘ä¼šè¯é¡¹
2. æ˜¾ç¤º"åˆ é™¤"æŒ‰é’®(çº¢è‰²èƒŒæ™¯)
3. ç‚¹å‡»åˆ é™¤æŒ‰é’®:
   - å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†:"ç¡®å®šåˆ é™¤è¯¥ä¼šè¯å—?"
   - æŒ‰é’®1:"å–æ¶ˆ" - å…³é—­å¯¹è¯æ¡†
   - æŒ‰é’®2:"ç¡®å®š" - è°ƒç”¨æ¥å£7:åˆ é™¤ä¼šè¯
   - æˆåŠŸåä»åˆ—è¡¨ç§»é™¤è¯¥ä¼šè¯
   - æ˜¾ç¤ºæç¤º:"åˆ é™¤æˆåŠŸ"

**é•¿æŒ‰åˆ é™¤(Android):**
1. é•¿æŒ‰ä¼šè¯é¡¹
2. å¼¹å‡ºæ“ä½œèœå•:
   - "åˆ é™¤ä¼šè¯"
   - "å–æ¶ˆ"
3. ç‚¹å‡»åˆ é™¤ä¼šè¯:åŒä¸Šåˆ é™¤æµç¨‹

### 4. æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯

**ç‚¹å‡»å³ä¸Šè§’æ¸…é™¤æŒ‰é’®:**
1. å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†:
   ```
   ç¡®å®šæ¸…é™¤æ‰€æœ‰çš„æ¶ˆæ¯é€šçŸ¥å—?

   [å–æ¶ˆ]  [ç¡®å®š]
   ```
2. å¯¹è¯æ¡†æ ·å¼:
   - èƒŒæ™¯:åŠé€æ˜é»‘è‰²é®ç½©
   - å¡ç‰‡:ç™½è‰²,åœ†è§’12px
   - æ ‡é¢˜:å±…ä¸­,16pt,æ·±ç°è‰²
   - æŒ‰é’®:
     - å–æ¶ˆ:å·¦ä¾§,ç™½è‰²èƒŒæ™¯,ç°è‰²æ–‡å­—
     - ç¡®å®š:å³ä¾§,ç´«è‰²èƒŒæ™¯,ç™½è‰²æ–‡å­—

3. ç‚¹å‡»"å–æ¶ˆ":å…³é—­å¯¹è¯æ¡†
4. ç‚¹å‡»"ç¡®å®š":
   - è°ƒç”¨æ¥å£8:æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯é€šçŸ¥
   - æˆåŠŸå:
     - æ¸…ç©ºä¼šè¯åˆ—è¡¨
     - æ¸…ç©ºæ‰€æœ‰æœªè¯»è§’æ ‡
     - æ˜¾ç¤ºç©ºçŠ¶æ€:"æš‚æ— æ¶ˆæ¯"
     - æ˜¾ç¤ºæç¤º:"æ¸…é™¤æˆåŠŸ"
   - å¤±è´¥å:
     - æ˜¾ç¤ºé”™è¯¯æç¤º:"æ¸…é™¤å¤±è´¥,è¯·ç¨åé‡è¯•"

### 5. èŠå¤©é¡µé¢äº¤äº’

**è¿›å…¥èŠå¤©é¡µé¢:**
1. è°ƒç”¨æ¥å£3:è·å–èŠå¤©æ¶ˆæ¯è®°å½•
2. æ˜¾ç¤ºæ¶ˆæ¯åˆ—è¡¨(ä»ä¸‹å¾€ä¸ŠåŠ è½½)
3. è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
4. è°ƒç”¨æ¥å£9:æ ‡è®°å·²è¯»
5. è¾“å…¥æ¡†è‡ªåŠ¨èšç„¦

**ä¸‹æ‹‰åŠ è½½å†å²æ¶ˆæ¯:**
1. æ£€æŸ¥hasMoreæ ‡å¿—
2. hasMoreä¸ºtrueæ—¶:
   - è°ƒç”¨æ¥å£3,ä¼ å…¥beforeMessageId(æœ€æ—©ä¸€æ¡æ¶ˆæ¯çš„ID)
   - å°†æ–°æ¶ˆæ¯æ’å…¥åˆ°åˆ—è¡¨é¡¶éƒ¨
   - ä¿æŒå½“å‰æ»šåŠ¨ä½ç½®
3. hasMoreä¸ºfalseæ—¶:
   - æ˜¾ç¤ºæç¤º:"æ²¡æœ‰æ›´å¤šæ¶ˆæ¯äº†"

**å‘é€æ–‡æœ¬æ¶ˆæ¯:**
1. ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥æ–‡æœ¬
2. ç‚¹å‡»å‘é€æŒ‰é’®æˆ–æŒ‰Enteré”®
3. éªŒè¯å‰ç½®æ¡ä»¶:
   - å†…å®¹ä¸èƒ½ä¸ºç©º
   - å»é™¤å‰åç©ºæ ¼
   - é•¿åº¦1-500å­—ç¬¦
4. éªŒè¯é€šè¿‡:
   - åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ ä¸´æ—¶æ¶ˆæ¯(çŠ¶æ€:sending)
   - æ¸…ç©ºè¾“å…¥æ¡†
   - æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
   - è°ƒç”¨æ¥å£4:å‘é€æ–‡æœ¬æ¶ˆæ¯
5. å‘é€æˆåŠŸ:
   - æ›´æ–°æ¶ˆæ¯çŠ¶æ€:sent
   - æ›´æ–°messageIdå’Œtimestamp
6. å‘é€å¤±è´¥:
   - æ›´æ–°æ¶ˆæ¯çŠ¶æ€:failed
   - æ˜¾ç¤ºé‡è¯•æŒ‰é’®
   - ç‚¹å‡»é‡è¯•æŒ‰é’®é‡æ–°å‘é€

**å‘é€å›¾ç‰‡æ¶ˆæ¯:**
1. ç‚¹å‡»ç›¸æœºæŒ‰é’®:
   - æ‰“å¼€ç³»ç»Ÿç›¸æœº
   - æ‹ç…§åè¿”å›å›¾ç‰‡
2. ç‚¹å‡»å›¾ç‰‡æŒ‰é’®:
   - æ‰“å¼€ç³»ç»Ÿç›¸å†Œ
   - é€‰æ‹©å›¾ç‰‡åè¿”å›
3. å›¾ç‰‡éªŒè¯:
   - æ ¼å¼:jpg, jpeg, png, webp
   - å¤§å°:â‰¤10MB
   - éªŒè¯å¤±è´¥æ˜¾ç¤ºæç¤º
4. å›¾ç‰‡ä¸Šä¼ :
   - å…ˆä¸Šä¼ åˆ°OSS
   - æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
   - ä¸Šä¼ æˆåŠŸè·å¾—imageUrl
5. å‘é€æ¶ˆæ¯:
   - åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ ä¸´æ—¶å›¾ç‰‡æ¶ˆæ¯
   - è°ƒç”¨æ¥å£5:å‘é€å›¾ç‰‡æ¶ˆæ¯
   - å¤„ç†æˆåŠŸ/å¤±è´¥çŠ¶æ€(åŒæ–‡æœ¬æ¶ˆæ¯)

**åˆ†äº«ç¬”è®°åˆ°ä¼šè¯:**
1. ä»ç¬”è®°è¯¦æƒ…é¡µç‚¹å‡»åˆ†äº«
2. é€‰æ‹©è¯¥è”ç³»äºº
3. è‡ªåŠ¨è·³è½¬åˆ°èŠå¤©é¡µé¢
4. è°ƒç”¨æ¥å£6:åˆ†äº«ç¬”è®°åˆ°ä¼šè¯
5. åœ¨æ¶ˆæ¯åˆ—è¡¨æ˜¾ç¤ºç¬”è®°å¡ç‰‡
6. å¤„ç†æˆåŠŸ/å¤±è´¥çŠ¶æ€

**ç‚¹å‡»ç¬”è®°å¡ç‰‡:**
- è·³è½¬åˆ°ç¬”è®°è¯¦æƒ…é¡µ
- ä¼ é€’noteIdå‚æ•°

**å®æ—¶æ¶ˆæ¯æ¥æ”¶(WebSocket):**
- å»ºç«‹WebSocketè¿æ¥
- ç›‘å¬æ–°æ¶ˆæ¯äº‹ä»¶
- æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶:
  - æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨æœ«å°¾
  - æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
  - æ’­æ”¾æ¶ˆæ¯æç¤ºéŸ³
  - å¦‚æœæ˜¯å½“å‰ä¼šè¯,è‡ªåŠ¨æ ‡è®°å·²è¯»

**è¿”å›æ“ä½œ:**
- ç‚¹å‡»è¿”å›æŒ‰é’®
- æ–­å¼€WebSocketè¿æ¥
- è¿”å›ä¼šè¯åˆ—è¡¨
- åˆ·æ–°ä¼šè¯åˆ—è¡¨(æ›´æ–°æœ€åæ¶ˆæ¯å’Œæ—¶é—´)

---

## å‰ç«¯éªŒè¯è§„åˆ™

### æ¶ˆæ¯å†…å®¹éªŒè¯
```typescript
const isValidMessageContent = (content: string) => {
  const trimmed = content.trim();

  if (trimmed.length === 0) {
    return { valid: false, error: 'æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º' };
  }

  if (trimmed.length > 500) {
    return { valid: false, error: 'æ¶ˆæ¯å†…å®¹ä¸èƒ½è¶…è¿‡500å­—ç¬¦' };
  }

  return { valid: true };
}
```

### å›¾ç‰‡éªŒè¯
```typescript
const isValidImage = (file: File) => {
  const validFormats = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];

  if (!validFormats.includes(file.type)) {
    return { valid: false, error: 'ä»…æ”¯æŒjpgã€pngã€webpæ ¼å¼å›¾ç‰‡' };
  }

  const maxSize = 10 * 1024 * 1024; // 10MB
  if (file.size > maxSize) {
    return { valid: false, error: 'å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡10MB' };
  }

  return { valid: true };
}
```

### æ—¶é—´æ ¼å¼åŒ–
```typescript
const formatMessageTime = (timestamp: string) => {
  const now = new Date();
  const messageTime = new Date(timestamp);
  const diff = now.getTime() - messageTime.getTime();

  // 1å°æ—¶å†…
  if (diff < 60 * 60 * 1000) {
    const minutes = Math.floor(diff / (60 * 1000));
    return `${minutes}åˆ†é’Ÿå‰`;
  }

  // ä»Šå¤©
  if (now.toDateString() === messageTime.toDateString()) {
    const hours = messageTime.getHours().toString().padStart(2, '0');
    const minutes = messageTime.getMinutes().toString().padStart(2, '0');
    return `${hours}:${minutes}`;
  }

  // æ˜¨å¤©
  const yesterday = new Date(now);
  yesterday.setDate(yesterday.getDate() - 1);
  if (yesterday.toDateString() === messageTime.toDateString()) {
    return 'æ˜¨å¤©';
  }

  // æ›´æ—©
  const month = (messageTime.getMonth() + 1).toString().padStart(2, '0');
  const day = messageTime.getDate().toString().padStart(2, '0');
  return `${month}-${day}`;
}
```

### æ‰‹æœºå·è„±æ•
```typescript
const maskPhoneNumber = (phone: string) => {
  if (phone.length === 11) {
    return `${phone.slice(0, 3)} **** ${phone.slice(7)}`;
  }
  return phone;
}

// ç¤ºä¾‹:13147046323 â†’ 131 **** 6323
```

---

## æ ·å¼è§„èŒƒ

### é¢œè‰²ç³»ç»Ÿ
```css
/* ä¸»è‰²è°ƒ */
--primary-purple: #9333ea;
--primary-blue: #3b82f6;

/* æ¸å˜è‰² */
--gradient-start: #b794f6;
--gradient-end: #a5b4fc;

/* æ–‡å­—é¢œè‰² */
--text-primary: #1a1a1a;
--text-secondary: #666666;
--text-tertiary: #999999;
--text-placeholder: #c0c0c0;

/* èƒŒæ™¯è‰² */
--bg-white: #ffffff;
--bg-gray: #f5f5f5;
--bg-like: #fce7f3;
--bg-comment: #dbeafe;
--bg-follower: #fed7aa;
--bg-system: #e9d5ff;

/* è¾¹æ¡†é¢œè‰² */
--border-light: #e5e5e5;
--border-lighter: #f5f5f5;

/* çŠ¶æ€é¢œè‰² */
--success: #10b981;
--error: #ef4444;
--online: #10b981;
```

### æ¶ˆæ¯æ°”æ³¡æ ·å¼
```css
/* å¯¹æ–¹æ¶ˆæ¯ */
.message-bubble-other {
  max-width: 70%;
  background: var(--bg-white);
  border: 1px solid var(--border-light);
  border-radius: 12px;
  border-top-left-radius: 4px;
  padding: 12px;
  color: var(--text-primary);
  font-size: 16pt;
  line-height: 1.5;
}

/* è‡ªå·±æ¶ˆæ¯ */
.message-bubble-self {
  max-width: 70%;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  border-radius: 12px;
  border-top-right-radius: 4px;
  padding: 12px;
  color: white;
  font-size: 16pt;
  line-height: 1.5;
}

/* ç¬”è®°å¡ç‰‡ */
.note-card {
  max-width: 280px;
  background: var(--bg-white);
  border: 1px solid var(--border-light);
  border-radius: 12px;
  padding: 12px;
  display: flex;
  gap: 12px;
}

.note-card-cover {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  object-fit: cover;
}
```

### æœªè¯»è§’æ ‡æ ·å¼
```css
.unread-badge {
  min-width: 18px;
  height: 18px;
  background: var(--error);
  color: white;
  font-size: 12pt;
  font-weight: 500;
  border-radius: 9px;
  padding: 0 6px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.unread-badge.large {
  position: absolute;
  top: -4px;
  right: -4px;
}
```

---

## åŠ¨ç”»æ•ˆæœ

### æ¶ˆæ¯å‘é€åŠ¨ç”»
```css
@keyframes messageSend {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message-item.new {
  animation: messageSend 0.3s ease;
}
```

### ä¼šè¯å·¦æ»‘åˆ é™¤åŠ¨ç”»(iOS)
```css
.conversation-item.swiping {
  transition: transform 0.3s ease;
}

.conversation-item.delete-button-visible {
  transform: translateX(-80px);
}
```

### è¾“å…¥æ¡†é«˜åº¦è‡ªé€‚åº”
```css
.chat-input {
  min-height: 40px;
  max-height: 120px;
  transition: height 0.2s ease;
  resize: none;
  overflow-y: auto;
}
```

---

## æ¥å£æ±‡æ€»

**æœ¬æ–‡æ¡£æ¥å£ (MessageController - 9ä¸ª):**

| # | åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | æ¥å£ | æ–¹æ³• |
|---|------|---------|------|------|
| 1 | è·å–æœªè¯»æ•° | è¿›å…¥æ¶ˆæ¯é¡µé¢ | `/api/message/unread-count` | GET |
| 2 | è·å–ä¼šè¯åˆ—è¡¨ | è¿›å…¥æ¶ˆæ¯é¡µé¢/åˆ·æ–° | `/api/message/conversations` | GET |
| 3 | è·å–èŠå¤©è®°å½• | ç‚¹å‡»ä¼šè¯è¿›å…¥èŠå¤© | `/api/message/chat/{conversationId}` | GET |
| 4 | å‘é€æ–‡æœ¬æ¶ˆæ¯ | è¾“å…¥æ–‡æœ¬åå‘é€ | `/api/message/send/text` | POST |
| 5 | å‘é€å›¾ç‰‡æ¶ˆæ¯ | é€‰æ‹©å›¾ç‰‡åå‘é€ | `/api/message/send/image` | POST |
| 6 | åˆ†äº«ç¬”è®° | ä»ç¬”è®°é¡µåˆ†äº« | `/api/message/send/note` | POST |
| 7 | åˆ é™¤ä¼šè¯ | å·¦æ»‘/é•¿æŒ‰åˆ é™¤ | `/api/message/conversation/{conversationId}` | DELETE |
| 8 | æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯ | ç‚¹å‡»æ¸…é™¤æŒ‰é’®ç¡®è®¤ | `/api/message/clear-all` | POST |
| 9 | æ ‡è®°ä¼šè¯å·²è¯» | è¿›å…¥èŠå¤©é¡µé¢ | `/api/message/conversation/{conversationId}/read` | PUT |

**é€šçŸ¥ç›¸å…³æ¥å£:**
- èµå’Œæ”¶è—ã€è¯„è®ºã€ç²‰ä¸ã€ç³»ç»Ÿé€šçŸ¥ç­‰åŠŸèƒ½çš„æ¥å£å®šä¹‰è¯·å‚è§ **ã€Šæ¶ˆæ¯é€šçŸ¥å­é¡µæ–‡æ¡£ã€‹**

---

## é€šç”¨éªŒè¯è§„åˆ™

### ç™»å½•çŠ¶æ€
- æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç™»å½•çŠ¶æ€
- æœªç™»å½•æ—¶è·³è½¬è‡³ç™»å½•é¡µ

### æ¶ˆæ¯å†…å®¹
- ä¸èƒ½ä¸ºç©º
- é•¿åº¦é™åˆ¶:1-500å­—ç¬¦
- è‡ªåŠ¨å»é™¤å‰åç©ºæ ¼

### å›¾ç‰‡ä¸Šä¼ 
- æ ¼å¼:jpg, jpeg, png, webp
- å¤§å°:â‰¤10MB
- å…ˆä¸Šä¼ åˆ°OSSå†å‘é€æ¶ˆæ¯

### åˆ†é¡µå‚æ•°
- page:ä»1å¼€å§‹
- pageSize:é»˜è®¤20,èŒƒå›´10-50

---

## éæ¥å£æ“ä½œ

ä»¥ä¸‹æ“ä½œä¸è§¦å‘æ¥å£è°ƒç”¨(çº¯å‰ç«¯äº¤äº’):

- **ç‚¹å‡»åº•éƒ¨Tabåˆ‡æ¢** - è·¯ç”±è·³è½¬,ä¸è¯·æ±‚æ•°æ®
- **è¾“å…¥æ¡†èšç„¦** - å¼¹å‡ºé”®ç›˜,çº¯UIäº¤äº’
- **å·¦æ»‘ä¼šè¯** - æ˜¾ç¤ºåˆ é™¤æŒ‰é’®,ä»…UIçŠ¶æ€å˜åŒ–
- **ç‚¹å‡»æ¶ˆæ¯æ°”æ³¡** - å¦‚æœæ˜¯å›¾ç‰‡åˆ™é¢„è§ˆ,å¦‚æœæ˜¯ç¬”è®°åˆ™è·³è½¬è¯¦æƒ…
- **è¾“å…¥æ¡†é«˜åº¦è‡ªé€‚åº”** - æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´é«˜åº¦
- **æ—¶é—´æ ¼å¼åŒ–** - å‰ç«¯æœ¬åœ°è®¡ç®—æ˜¾ç¤º
- **æ‰‹æœºå·è„±æ•** - å‰ç«¯æœ¬åœ°å¤„ç†æ˜¾ç¤ºæ ¼å¼

---

## æ•°æ®ä¼ é€’

### è·¨é¡µé¢ä¼ é€’
**ä»ä¼šè¯åˆ—è¡¨ â†’ èŠå¤©é¡µé¢:**
- ä¼ é€’:conversationId, userId, nickname, avatar, isOnline
- æ–¹å¼:è·¯ç”±å‚æ•°

**ä»ç¬”è®°è¯¦æƒ…é¡µ â†’ èŠå¤©é¡µé¢(åˆ†äº«):**
- ä¼ é€’:noteId, conversationId, userId
- æ–¹å¼:è·¯ç”±å‚æ•° + å…¨å±€çŠ¶æ€

**ä»èŠå¤©é¡µé¢ â†’ ç¬”è®°è¯¦æƒ…é¡µ:**
- ä¼ é€’:noteId
- æ–¹å¼:è·¯ç”±å‚æ•°

### çŠ¶æ€åŒæ­¥
æ“ä½œæˆåŠŸåéœ€è¦åŒæ­¥åˆ°:
- ä¼šè¯åˆ—è¡¨(æ›´æ–°æœ€åæ¶ˆæ¯ã€æ—¶é—´ã€æœªè¯»æ•°)
- Tabæœªè¯»è§’æ ‡
- å…¨å±€æ¶ˆæ¯æ•°è§’æ ‡

---

## å¼‚å¸¸å¤„ç†

| åœºæ™¯ | å‰ç«¯å¤„ç†æ–¹å¼ |
|-----|------------|
| æƒé™ä¸è¶³(403) | æ˜¾ç¤º:"æ— æƒé™è®¿é—®è¯¥ä¼šè¯",è¿”å›ä¸Šä¸€é¡µ |
| ä¼šè¯ä¸å­˜åœ¨(404) | æ˜¾ç¤º:"ä¼šè¯ä¸å­˜åœ¨æˆ–å·²åˆ é™¤",è¿”å›ä¼šè¯åˆ—è¡¨ |
| å‚æ•°é”™è¯¯(400) | æ˜¾ç¤º:"è¯·æ±‚å‚æ•°é”™è¯¯" |
| ç½‘ç»œé”™è¯¯ | æ˜¾ç¤º:"ç½‘ç»œå¼‚å¸¸,è¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®" + é‡è¯•æŒ‰é’® |
| æœªç™»å½•(401) | è·³è½¬ç™»å½•é¡µ |
| æœåŠ¡å™¨é”™è¯¯(500) | æ˜¾ç¤º:"æ“ä½œå¤±è´¥,è¯·ç¨åé‡è¯•" |
| å›¾ç‰‡ä¸Šä¼ å¤±è´¥ | æ˜¾ç¤º:"å›¾ç‰‡ä¸Šä¼ å¤±è´¥,è¯·é‡è¯•",ä¿ç•™è‰ç¨¿ |
| æ¶ˆæ¯å‘é€å¤±è´¥ | æ˜¾ç¤ºå¤±è´¥æ ‡è®° + é‡è¯•æŒ‰é’® |

---

## WebSocketå®æ—¶é€šä¿¡

### è¿æ¥ç®¡ç†
```typescript
interface WebSocketConfig {
  url: string;              // ws://domain/message
  reconnectInterval: number; // é‡è¿é—´éš”,é»˜è®¤3000ms
  maxReconnectAttempts: number; // æœ€å¤§é‡è¿æ¬¡æ•°,é»˜è®¤5æ¬¡
}

// è¿æ¥æ—¶æœº
- è¿›å…¥èŠå¤©é¡µé¢æ—¶å»ºç«‹è¿æ¥
- æ–­çº¿åè‡ªåŠ¨é‡è¿
- ç¦»å¼€èŠå¤©é¡µé¢æ—¶æ–­å¼€è¿æ¥

// å¿ƒè·³æ£€æµ‹
- æ¯30ç§’å‘é€pingæ¶ˆæ¯
- è¶…è¿‡60ç§’æœªæ”¶åˆ°pongåˆ™é‡è¿
```

### æ¶ˆæ¯äº‹ä»¶
```typescript
// æ¥æ”¶æ–°æ¶ˆæ¯
{
  type: 'new_message',
  data: {
    messageId: string;
    senderId: string;
    content: string;
    contentType: 'text' | 'image' | 'note';
    timestamp: string;
  }
}

// å¯¹æ–¹æ­£åœ¨è¾“å…¥
{
  type: 'typing',
  data: {
    userId: string;
    isTyping: boolean;
  }
}

// åœ¨çº¿çŠ¶æ€å˜åŒ–
{
  type: 'online_status',
  data: {
    userId: string;
    isOnline: boolean;
  }
}

// æ¶ˆæ¯å·²è¯»
{
  type: 'message_read',
  data: {
    conversationId: string;
    messageIds: string[];
  }
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### åˆ—è¡¨ä¼˜åŒ–
- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨(é•¿åˆ—è¡¨)
- å›¾ç‰‡æ‡’åŠ è½½
- åˆ†é¡µåŠ è½½(æ¯é¡µ20æ¡)

### ç¼“å­˜ç­–ç•¥
- ä¼šè¯åˆ—è¡¨ç¼“å­˜5åˆ†é’Ÿ
- èŠå¤©è®°å½•ç¼“å­˜æœ¬åœ°å­˜å‚¨
- å›¾ç‰‡ç¼“å­˜åˆ°æœ¬åœ°

### å›¾ç‰‡ä¼˜åŒ–
- ç¼©ç•¥å›¾æ˜¾ç¤º(åˆ—è¡¨/å¤´åƒ)
- åŸå›¾æ‡’åŠ è½½(ç‚¹å‡»æŸ¥çœ‹å¤§å›¾)
- å‹ç¼©ä¸Šä¼ (â‰¤10MB)

### ç½‘ç»œä¼˜åŒ–
- æ¥å£é˜²æŠ–(è¾“å…¥æ¡†)
- æ¥å£åˆå¹¶(æœªè¯»æ•° + ä¼šè¯åˆ—è¡¨å¹¶è¡Œ)
- WebSocketé•¿è¿æ¥å¤ç”¨

---

## æµ‹è¯•ç”¨ä¾‹

### åŠŸèƒ½æµ‹è¯•
- [ ] æœªè¯»æ•°æ˜¾ç¤ºå‡†ç¡®
- [ ] ä¼šè¯åˆ—è¡¨åŠ è½½æ­£å¸¸
- [ ] åˆ†ç±»Tabåˆ‡æ¢æ­£å¸¸
- [ ] èŠå¤©æ¶ˆæ¯æ”¶å‘æ­£å¸¸
- [ ] å›¾ç‰‡å‘é€åŠŸèƒ½æ­£å¸¸
- [ ] ç¬”è®°åˆ†äº«åŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤ä¼šè¯åŠŸèƒ½æ­£å¸¸
- [ ] æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯åŠŸèƒ½æ­£å¸¸
- [ ] æ ‡è®°å·²è¯»åŠŸèƒ½æ­£å¸¸
- [ ] WebSocketå®æ—¶æ¶ˆæ¯æ¥æ”¶

### è¾¹ç•Œæµ‹è¯•
- [ ] ç©ºä¼šè¯åˆ—è¡¨æ˜¾ç¤º
- [ ] ç½‘ç»œå¼‚å¸¸å¤„ç†
- [ ] æ¶ˆæ¯å‘é€å¤±è´¥é‡è¯•
- [ ] å›¾ç‰‡ä¸Šä¼ å¤±è´¥å¤„ç†
- [ ] å¿«é€Ÿé‡å¤ç‚¹å‡»
- [ ] é•¿æ–‡æœ¬æ¶ˆæ¯æ˜¾ç¤º
- [ ] è¶…é•¿æ—¶é—´æ ¼å¼åŒ–

### å…¼å®¹æ€§æµ‹è¯•
- [ ] iOSç³»ç»Ÿ(13+)
- [ ] Androidç³»ç»Ÿ(8+)
- [ ] ä¸åŒå±å¹•å°ºå¯¸
- [ ] æ·±è‰²æ¨¡å¼é€‚é…

---

## å¼€å‘æ¸…å•

### å¿…é¡»å®ç°
- [x] æ¶ˆæ¯é¡µé¢å¸ƒå±€å’Œæ ·å¼
- [x] æ¶ˆæ¯åˆ†ç±»Tabå’Œæœªè¯»è§’æ ‡
- [x] ä¼šè¯åˆ—è¡¨æ˜¾ç¤º
- [x] èŠå¤©é¡µé¢å¸ƒå±€
- [x] æ–‡æœ¬æ¶ˆæ¯æ”¶å‘
- [x] å›¾ç‰‡æ¶ˆæ¯æ”¶å‘
- [x] ç¬”è®°åˆ†äº«åŠŸèƒ½
- [x] åˆ é™¤ä¼šè¯åŠŸèƒ½
- [x] æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯åŠŸèƒ½
- [x] æ ‡è®°å·²è¯»åŠŸèƒ½
- [x] WebSocketå®æ—¶é€šä¿¡
- [x] æ‰€æœ‰13ä¸ªæ¥å£è°ƒç”¨
- [x] é”™è¯¯å¤„ç†å’Œæç¤º

### å¯é€‰ä¼˜åŒ–
- [ ] æ¶ˆæ¯æ’¤å›åŠŸèƒ½
- [ ] è¯­éŸ³æ¶ˆæ¯åŠŸèƒ½
- [ ] è§†é¢‘æ¶ˆæ¯åŠŸèƒ½
- [ ] è¡¨æƒ…åŒ…åŠŸèƒ½
- [ ] æ¶ˆæ¯æœç´¢åŠŸèƒ½
- [ ] ä¼šè¯ç½®é¡¶åŠŸèƒ½
- [ ] æ¶ˆæ¯å…æ‰“æ‰°è®¾ç½®
- [ ] èŠå¤©èƒŒæ™¯è‡ªå®šä¹‰
- [ ] æ­£åœ¨è¾“å…¥æç¤º
- [ ] æ¶ˆæ¯å·²è¯»å›æ‰§

---

## ç›¸å…³æ–‡æ¡£

- **æœ¬æ¨¡å—ç›¸å…³æ–‡æ¡£:**
  - **æ¶ˆæ¯é€šçŸ¥å­é¡µæ–‡æ¡£** - èµå’Œæ”¶è—ã€è¯„è®ºã€ç²‰ä¸ã€ç³»ç»Ÿé€šçŸ¥åŠŸèƒ½
- **å…¶ä»–æ¨¡å—æ–‡æ¡£:**
  - ä¸ªäººä¸»é¡µæ–‡æ¡£
  - ç¬”è®°è¯¦æƒ…é¡µé¢æ–‡æ¡£
  - ç”¨æˆ·èµ„æ–™é¡µé¢æ–‡æ¡£
- **å…³è”åŠŸèƒ½:**
  - æ¨é€é€šçŸ¥
  - å®æ—¶é€šä¿¡(WebSocket)
  - æ–‡ä»¶ä¸Šä¼ (OSS)
