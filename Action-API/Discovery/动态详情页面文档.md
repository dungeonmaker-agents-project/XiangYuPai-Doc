# 动态详情页面文档

## 概述
本文档定义动态详情页面的完整实现,包括UI布局、交互行为、前端逻辑和API接口规范。动态详情页是用户查看完整动态内容、浏览评论、进行互动的核心页面。

**相关文档:**
- 发现主页面文档
- 发布动态页面文档
- 用户主页接口文档

**通用接口文档:**
- ../Interaction/互动接口文档.md (点赞、收藏、分享)
- ../Users/用户关系接口文档.md (关注、取关)
- ../Moderation/举报接口文档.md (举报)

**UI设计稿参考:**
- `UI页面/发现/动态详情页面/动态-图文.png`
- `UI页面/发现/动态详情页面/动态-图文-更多.png`
- `UI页面/发现/动态详情页面/动态-已点赞收藏.png`
- `UI页面/发现/动态详情页面/动态-视频.png`
- `UI页面/发现/动态详情页面/举报.png`
- `UI页面/发现/动态详情页面/举报-提交弹窗.png`

---

## 一、获取动态详情

### 用户操作
1. 从发现主页点击动态卡片
2. **进入详情页** → 自动触发接口加载详情数据
3. 页面显示完整动态内容、用户信息、互动数据

### 接口定义
**接口:** `GET /api/v1/content/detail/{feedId}`

**触发时机:** 页面初始化时

**路径参数:**
```typescript
{
  feedId: string;  // 动态ID
}
```

**响应数据:**
```typescript
{
  code: number;           // 200=成功,其他=失败
  message: string;        // 提示信息
  data: {
    id: string;
    userId: string;

    // 内容信息
    type: number;              // 内容类型(1=动态,2=活动,3=技能)
    typeDesc: string;          // 类型描述
    title?: string;            // 标题(可选)
    summary?: string;          // 摘要
    content: string;           // 完整内容文本
    coverImage?: string;       // 封面图URL

    // 用户信息
    userInfo: {
      id: string;
      nickname: string;
      avatar: string;
      gender?: 'male' | 'female';
      age?: number;
      isFollowed: boolean;     // 当前用户是否已关注
      isRealVerified?: boolean; // 实名认证
      isGodVerified?: boolean;  // 大神认证
      isVip?: boolean;          // VIP用户
      isPopular?: boolean;      // 人气用户
    };

    // 媒体列表
    mediaList: Array<{
      id: string;
      type: 'image' | 'video';
      url: string;
      thumbnailUrl?: string;
      width: number;
      height: number;
      duration?: number;       // 视频时长(秒)
    }>;

    // 话题列表
    topicList: Array<{
      name: string;
      description?: string;
      participantCount: number;
      postCount: number;
    }>;

    // 地理位置
    locationName?: string;     // 地点名称
    locationAddress?: string;  // 详细地址
    longitude?: number;        // 经度
    latitude?: number;         // 纬度
    distance?: number;         // 距离(km)

    // 互动数据
    likeCount: number;         // 点赞数
    commentCount: number;      // 评论数
    shareCount: number;        // 分享数
    collectCount: number;      // 收藏数
    viewCount: number;         // 浏览数

    // 用户互动状态
    isLiked: boolean;          // 当前用户是否已点赞
    isCollected: boolean;      // 当前用户是否已收藏

    // 权限控制
    canEdit: boolean;          // 是否可编辑(作者本人)
    canDelete: boolean;        // 是否可删除(作者本人)

    // 时间戳
    createdAt: number;         // 创建时间(毫秒)
    updatedAt: number;         // 更新时间(毫秒)
  } | null
}
```

### 前端验证
- 无需登录即可查看详情
- 互动操作(点赞/收藏/评论)需要登录
- 编辑/删除操作需要是作者本人

### 前端行为
**加载中:**
- 显示骨架屏(内容区域、评论区域)
- 顶部导航栏正常显示

**成功后:**
- 显示完整动态内容
- 渲染媒体列表(图片/视频)
- 显示话题标签
- 显示位置信息
- 更新浏览数(+1)
- 加载评论列表

**失败后:**
- 显示错误页面
- 提示信息:
  - 404: "动态不存在或已删除"
  - 403: "该动态仅作者可见"
  - 500: "加载失败,请稍后重试"
- 提供返回按钮

---

## 二、获取评论列表

### 用户操作
1. 进入动态详情页
2. **向下滚动到评论区** → 自动加载评论列表
3. 下拉加载更多评论

### 接口定义
**接口:** `GET /api/v1/content/comments/{feedId}`

**触发时机:**
- 详情页加载完成后
- 下拉加载更多时
- 发布评论成功后刷新

**路径参数:**
```typescript
{
  feedId: string;  // 动态ID
}
```

**查询参数:**
```typescript
{
  page: number;        // 页码,从1开始
  pageSize: number;    // 每页数量,默认20
  sortType?: 'time' | 'hot' | 'like';  // 排序方式,默认time
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    list: Comment[];
    total: number;       // 评论总数
    hasMore: boolean;    // 是否有更多
  } | null
}

// Comment数据结构
interface Comment {
  id: string;
  feedId: string;
  userId: string;

  // 用户信息
  userInfo: {
    id: string;
    nickname: string;
    avatar: string;
    isRealVerified?: boolean;
    isGodVerified?: boolean;
  };

  // 评论内容
  content: string;

  // 回复关系(支持二级评论)
  parentId?: string;       // 一级评论ID(NULL=一级评论)
  replyToUserId?: string;  // 被回复用户ID
  replyToUserNickname?: string; // 被回复用户昵称

  // 统计数据
  likeCount: number;
  replyCount: number;      // 回复数量
  isTop: boolean;          // 是否置顶

  // 用户互动
  isLiked: boolean;        // 当前用户是否已点赞

  // 二级回复列表(仅一级评论返回,最多3条)
  replies: Comment[];
  totalReplies?: number;   // 二级回复总数
  hasMoreReplies?: boolean; // 是否有更多回复

  // 权限
  canDelete: boolean;      // 是否可删除

  // 时间
  createdAt: number;
}
```

### 前端验证
- 无需登录即可查看评论
- 点赞评论需要登录
- 发布评论需要登录

### 前端行为
**首次加载:**
- 在详情内容下方显示评论区域
- 显示评论总数
- 显示排序切换按钮(按时间/按热度/按点赞)
- 加载第1页评论

**成功后:**
- 显示评论列表
- 一级评论显示完整信息
- 二级回复收起显示(最多3条)
- 显示"展开更多回复"按钮

**下拉加载更多:**
- 滚动到底部时加载下一页
- 追加到列表末尾
- hasMore=false时显示"没有更多了"

**空状态:**
- 显示"暂无评论,快来发表第一条评论吧"
- 显示评论输入框引导

---

## 三、发布评论

### 用户操作
1. 在详情页底部
2. **点击评论输入框** → 弹出键盘
3. 输入评论内容
4. **点击发送按钮** → 触发发布接口

### 接口定义
**接口:** `POST /api/v1/content/comment`

**触发时机:** 用户点击发送按钮

**请求参数:**
```typescript
{
  feedId: string;        // 动态ID
  content: string;       // 评论内容,1-500字符
  parentId?: string;     // 回复的一级评论ID(可选)
  replyToUserId?: string; // 回复的用户ID(可选)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    comment: Comment;    // 新创建的评论对象
  } | null
}
```

### 前端验证
**必须登录:**
- 未登录时点击输入框弹出登录提示

**内容验证:**
- 不能为空
- 长度: 1-500字符
- 显示字符计数: "0/500"

**发送按钮状态:**
- 内容为空: 禁用(灰色)
- 有内容: 启用(紫色)

### 前端行为
**点击输入框:**
1. 检查登录状态
2. 未登录: 弹出登录提示
3. 已登录:
   - 输入框获得焦点
   - 弹出键盘
   - 底部输入框固定在键盘上方

**输入评论:**
- 实时显示字符计数
- 达到500字符时禁止继续输入
- 输入框自动扩展高度(最多4行)

**发送评论:**
1. 验证内容不为空
2. 按钮显示加载状态
3. 调用发布接口
4. 成功后:
   - 清空输入框
   - 收起键盘
   - 新评论插入列表顶部(乐观更新)
   - 评论总数+1
   - 显示"评论成功"Toast
5. 失败后:
   - 保留输入内容
   - 显示错误提示
   - 允许重新发送

**回复评论:**
1. 点击某条评论的"回复"按钮
2. 输入框显示"回复 @用户昵称:"
3. 设置parentId和replyToUserId
4. 发送流程同上
5. 成功后评论显示在对应一级评论下方

---

## 四、点赞评论

### 用户操作
1. 浏览评论列表
2. **点击评论的点赞图标** → 触发点赞接口

### 接口定义
**详见:** `../Interaction/互动接口文档.md` - **点赞/取消点赞**

**接口:** `POST /api/v1/interaction/like`

**参数:**
- targetType: 'comment' (固定值)
- targetId: 评论ID
- action: 'like' | 'unlike'

### 前端行为
**乐观更新:**
1. 立即切换图标状态(空心 ↔ 实心)
2. 立即更新点赞数(+1 或 -1)
3. 调用接口
4. 成功: 保持UI状态
5. 失败: 回滚UI状态,显示错误Toast

---

## 五、删除评论

### 用户操作
1. 浏览评论列表
2. **长按自己的评论** → 弹出操作菜单
3. **点击"删除"** → 弹出确认对话框
4. **确认删除** → 触发删除接口

### 接口定义
**接口:** `DELETE /api/v1/content/comment/{commentId}`

**触发时机:** 用户确认删除后

**路径参数:**
```typescript
{
  commentId: string;  // 评论ID
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: null
}
```

### 前端验证
- 只能删除自己的评论
- canDelete=true时才显示删除选项
- 需要二次确认

### 前端行为
**长按评论:**
1. 检查canDelete权限
2. 弹出操作菜单:
   - "删除"(红色)
   - "取消"

**点击删除:**
1. 弹出确认对话框
2. 标题: "确认删除评论?"
3. 内容: "删除后将无法恢复"
4. 按钮: "取消" | "删除"(红色)

**确认删除:**
1. 调用删除接口
2. 成功后:
   - 从列表中移除该评论
   - 评论总数-1
   - 如果是一级评论,同时移除其所有二级回复
   - 显示"删除成功"Toast
3. 失败后:
   - 显示错误Toast

---

## 六、点赞动态

### 用户操作
1. 查看动态详情
2. **点击底部点赞按钮** → 触发点赞接口

### 接口定义
**详见:** `../Interaction/互动接口文档.md` - **点赞/取消点赞**

**接口:** `POST /api/v1/interaction/like`

**参数:**
- targetType: 'feed' (固定值)
- targetId: 动态ID
- action: 'like' | 'unlike'

### 前端行为
**乐观更新:**
1. 立即切换按钮状态(空心图标 ↔ 实心红色图标)
2. 立即更新点赞数(+1 或 -1)
3. 播放点赞动画(心跳效果)
4. 调用接口
5. 成功: 保持UI状态
6. 失败: 回滚UI状态,显示错误Toast

---

## 七、收藏动态

### 用户操作
1. 查看动态详情
2. **点击底部收藏按钮** → 触发收藏接口

### 接口定义
**详见:** `../Interaction/互动接口文档.md` - **收藏/取消收藏**

**接口:** `POST /api/v1/interaction/collect`

**参数:**
- targetType: 'feed' (固定值)
- targetId: 动态ID
- action: 'collect' | 'uncollect'

### 前端行为
**乐观更新:**
1. 立即切换按钮状态(空心 ↔ 实心金色)
2. 立即更新收藏数(+1 或 -1)
3. 调用接口
4. 成功: 显示Toast,保持UI状态
5. 失败: 回滚UI状态,显示错误Toast

---

## 八、分享动态

### 用户操作
1. 查看动态详情
2. **点击底部分享按钮** → 打开分享面板
3. 选择分享方式

### 接口定义
**详见:** `../Interaction/互动接口文档.md` - **分享**

**接口:** `POST /api/v1/interaction/share`

**参数:**
- targetType: 'feed' (固定值)
- targetId: 动态ID
- shareChannel: 'wechat' | 'moments' | 'qq' | 'weibo' | 'copy_link'

### 前端行为
**点击分享按钮:**
1. 打开底部分享面板(从底部滑入)
2. 显示分享选项: 好友 / 微信 / QQ / 微博 / 举报
3. 选择分享方式 → 调用接口获取链接
4. 调用对应平台SDK分享或复制链接
5. 成功: 更新分享数(+1),显示成功Toast
6. 失败: 显示错误Toast

---

## 九、举报动态

### 用户操作
1. 查看动态详情
2. **点击更多按钮(...)** → 打开分享面板
3. **点击"举报"** → 进入举报页面
4. 选择举报类型、填写描述、上传图片
5. **点击"提交"** → 触发举报接口

### 接口定义
**详见:** `../Moderation/举报接口文档.md` - **举报内容**

**接口:** `POST /api/v1/content/report`

**参数:**
- targetType: 'feed' (固定值)
- targetId: 动态ID
- reasonType: 举报类型(harassment/pornography/fraud/illegal/false_info/underage/offensive/other)
- description: 举报描述(可选,0-200字符)
- evidenceImages: 举报图片(可选,最多3张)

### 前端行为
**打开举报页面:**
1. 全屏页面,显示8个举报类型选项
2. 选择举报类型(必选)
3. 填写描述(可选,0-200字符)
4. 上传证据图片(可选,最多3张)
5. 点击"提交" → 调用接口
6. 成功后显示确认对话框: "已收到您的举报,我们会尽快处理"
7. 点击确定返回详情页

---

## 十、关注/取关用户

### 用户操作
1. 查看动态详情
2. **点击作者头像旁的"关注"按钮** → 触发关注接口

### 接口定义
**详见:** `../Users/用户关系接口文档.md` - **关注/取关用户**

**接口:** `POST /api/v1/user/follow`

**参数:**
- targetUserId: 目标用户ID
- action: 'follow' | 'unfollow'

### 前端行为
**按钮状态:**
- 本人动态: 不显示关注按钮
- 未关注: 显示"关注"按钮(紫色边框)
- 已关注: 显示"已关注"按钮(灰色填充)

**点击关注:**
1. 乐观更新按钮状态
2. 调用接口
3. 成功: 显示Toast,保持UI状态
4. 失败: 回滚按钮状态,显示错误Toast

---

## 十一、删除动态

### 用户操作
1. 查看自己发布的动态
2. **点击更多按钮(...)** → 打开操作菜单
3. **点击"删除"** → 弹出确认对话框
4. **确认删除** → 触发删除接口

### 接口定义
**接口:** `DELETE /api/v1/content/{feedId}`

**触发时机:** 用户确认删除后

**路径参数:**
```typescript
{
  feedId: string;  // 动态ID
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: null
}
```

### 前端验证
- 只能删除自己的动态
- canDelete=true时才显示删除选项
- 需要二次确认

### 前端行为
**点击更多按钮:**
1. 检查canDelete权限
2. 弹出操作菜单:
   - "删除"(红色) - 仅作者可见
   - "举报"(灰色)
   - "取消"

**点击删除:**
1. 弹出确认对话框
2. 标题: "确认删除动态?"
3. 内容: "删除后将无法恢复"
4. 按钮: "取消" | "删除"(红色)

**确认删除:**
1. 调用删除接口
2. 成功后:
   - 显示"删除成功"Toast
   - 返回上一页(发现主页)
   - 从列表中移除该动态
3. 失败后:
   - 显示错误Toast

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 获取动态详情 | 进入详情页 | `/api/v1/content/detail/{feedId}` | GET |
| 2 | 获取评论列表 | 滚动到评论区 | `/api/v1/content/comments/{feedId}` | GET |
| 3 | 发布评论 | 点击发送按钮 | `/api/v1/content/comment` | POST |
| 4 | 点赞评论 | 点击评论点赞图标 | `/api/v1/interaction/like` | POST |
| 5 | 删除评论 | 长按评论→删除 | `/api/v1/content/comment/{commentId}` | DELETE |
| 6 | 点赞动态 | 点击点赞按钮 | `/api/v1/interaction/like` | POST |
| 7 | 收藏动态 | 点击收藏按钮 | `/api/v1/interaction/collect` | POST |
| 8 | 分享动态 | 选择分享方式 | `/api/v1/interaction/share` | POST |
| 9 | 举报动态 | 提交举报信息 | `/api/v1/content/report` | POST |
| 10 | 关注用户 | 点击关注按钮 | `/api/v1/user/follow` | POST |
| 11 | 删除动态 | 确认删除 | `/api/v1/content/{feedId}` | DELETE |

---

## 通用验证规则

### 登录状态
**需要登录的操作:**
- 发布评论
- 点赞评论/动态
- 收藏动态
- 关注用户
- 删除评论/动态

**未登录时:**
- 显示登录提示弹窗
- 提供"立即登录"按钮
- 点击后跳转登录页面

### 评论输入
**内容验证:**
- 不能为空
- 长度: 1-500字符
- 实时显示字符计数: "0/500"

**发送按钮状态:**
- 内容为空: 禁用(灰色)
- 有内容且未超长: 启用(紫色)

### 举报验证
**类型选择:**
- 必须选择一个举报类型
- 未选择时"提交"按钮禁用

**描述输入:**
- 长度: 0-200字符(可选)
- 实时显示字符计数: "0/200"

**图片上传:**
- 格式: jpg, jpeg, png, webp
- 大小: ≤ 5MB
- 数量: 最多3张
- 可选

### 权限验证
**编辑/删除动态:**
- canEdit=true时显示编辑入口
- canDelete=true时显示删除入口
- 只有作者本人拥有这些权限

**删除评论:**
- canDelete=true时显示删除选项
- 作者可删除自己的评论
- 动态作者可删除所有评论(可选)

---

## 非接口操作

以下操作不触发接口调用(纯前端交互):

- **返回按钮** - 返回上一页
- **图片预览** - 点击图片查看大图(全屏查看器)
- **视频播放** - 点击视频播放
- **话题标签点击** - 跳转话题详情页(前端路由)
- **用户头像点击** - 跳转用户主页(前端路由)
- **相对时间计算** - "刚刚"、"5分钟前"等时间显示
- **评论展开/收起** - 展开/收起二级回复列表
- **输入框聚焦** - 弹出键盘,输入框上移
- **字符计数** - 实时显示输入字符数
- **分享面板展开** - 从底部滑入动画
- **操作菜单展开** - 更多按钮弹出菜单

---

## 页面布局

### 顶部导航栏
```
┌─────────────────────────────────────┐
│ ←                            •••    │
└─────────────────────────────────────┘
```

**布局:**
- 高度: 56px
- 背景: 透明或半透明(滚动时变白色)
- 左侧: 返回按钮
- 右侧: 更多按钮(•••)

**返回按钮:**
- 图标: ← 箭头
- 颜色: 白色(透明背景) / 黑色(白色背景)
- 尺寸: 24x24px
- 点击区域: 44x44px

**更多按钮:**
- 图标: ••• 三个点
- 颜色: 白色(透明背景) / 黑色(白色背景)
- 点击后弹出操作菜单

### 内容区域

**媒体区域(图片/视频):**
```
┌─────────────────────────────────────┐
│                                     │
│         [大图/视频播放器]            │
│                                     │
└─────────────────────────────────────┘
```

**样式:**
- 宽度: 100%屏幕宽度
- 高度: 自适应内容比例
- 背景: 黑色
- 图片: 居中显示,保持比例
- 视频: 显示播放控件

**用户信息区:**
```
┌─────────────────────────────────────┐
│ [头像] 用户昵称 [关注]               │
│        5分钟前                       │
└─────────────────────────────────────┘
```

**布局:**
- 内边距: 16px
- 头像尺寸: 40x40px,圆形
- 昵称字体: 16pt,加粗
- 时间字体: 13pt,浅灰色
- 关注按钮: 60x28px,圆角14px

**内容文本区:**
```
┌─────────────────────────────────────┐
│ 今天逛街的时候                       │
│ 发现超好玩的店,一定要分享...         │
│                                     │
│ #探店日记# #美食分享#                │
│                                     │
│ 📍 XX商场 · 2.3km                   │
└─────────────────────────────────────┘
```

**样式:**
- 内边距: 16px
- 文字字体: 15pt,常规
- 行高: 1.5
- 话题标签: 紫色,可点击
- 位置信息: 灰色,带定位图标

**互动数据栏:**
```
┌─────────────────────────────────────┐
│ 👍 28   💬 评论 16                  │
└─────────────────────────────────────┘
```

**布局:**
- 内边距: 16px
- 字体: 13pt
- 颜色: 灰色 (#999)
- 分隔线: 上方1px浅灰色

**评论区域:**
```
┌─────────────────────────────────────┐
│ 评论 16          [按时间 ▼]          │
├─────────────────────────────────────┤
│ [头像] 用户A                         │
│        人肉窝这个不真的很宝藏呢        │
│        ♡ 5   回复   5分钟前          │
│                                     │
│        [头像] 用户B 回复 用户A       │
│               确实很不错!             │
│               ♡ 2   5分钟前          │
│                                     │
│        展开更多2条回复 ▼              │
├─────────────────────────────────────┤
│ [更多评论...]                        │
└─────────────────────────────────────┘
```

**一级评论样式:**
- 内边距: 16px
- 头像: 36x36px
- 昵称: 14pt,加粗
- 内容: 14pt,常规
- 操作栏: 13pt,灰色
- 背景: 白色

**二级回复样式:**
- 内边距: 左侧52px(缩进)
- 头像: 32x32px
- 样式同一级评论
- 背景: 浅灰色 (#FAFAFA)

**展开按钮:**
- 文字: "展开更多X条回复 ▼"
- 颜色: 灰色
- 点击后加载所有二级回复

### 底部操作栏
```
┌─────────────────────────────────────┐
│ [说点什么...____________] ♡ 28 ⭐ 💬 │
└─────────────────────────────────────┘
```

**布局:**
- 高度: 56px
- 背景: 白色
- 顶部分割线: 1px浅灰色
- 固定在底部

**评论输入框:**
- 占位符: "说点什么..."
- 宽度: 占据剩余空间
- 高度: 36px
- 圆角: 18px
- 背景: 浅灰色 (#F5F5F5)
- 内边距: 0 16px

**互动按钮:**
- 点赞: ♡ (空心) / ♥ (实心红色)
- 收藏: ⭐ (空心) / ⭐ (实心金色)
- 评论: 💬
- 尺寸: 24x24px
- 间距: 16px
- 显示数字

**输入框展开状态:**
```
┌─────────────────────────────────────┐
│ [评论输入框________________________]│
│                                     │
│ [发送] (紫色按钮)                    │
└─────────────────────────────────────┘
```

**样式:**
- 输入框高度: 自适应(1-4行)
- 字符计数: "0/500"
- 发送按钮: 右侧,紫色,启用/禁用

---

## 交互行为

### 1. 页面加载
**进入详情页:**
1. 显示顶部导航栏
2. 显示骨架屏(媒体区+内容区+评论区)
3. 调用详情接口
4. 成功后:
   - 渲染完整内容
   - 加载评论列表
   - 更新浏览数
5. 失败后:
   - 显示错误页面
   - 提供返回按钮

### 2. 图片查看
**点击图片:**
1. 打开全屏图片查看器
2. 背景: 黑色
3. 显示当前图片
4. 支持操作:
   - 左右滑动切换图片
   - 双击放大/缩小
   - 双指缩放
   - 长按保存图片
5. 显示图片序号: "1/3"
6. 点击空白区域或返回键关闭

### 3. 视频播放
**点击视频:**
1. 显示播放控件
2. 自动播放
3. 支持操作:
   - 播放/暂停
   - 进度条拖动
   - 音量调节
   - 全屏切换
4. 双击全屏播放

### 4. 评论输入
**点击输入框:**
1. 检查登录状态
2. 未登录: 弹出登录提示
3. 已登录:
   - 输入框获得焦点
   - 弹出键盘
   - 输入框固定在键盘上方
   - 底部操作栏隐藏
   - 显示发送按钮

**输入评论:**
- 实时显示字符计数
- 达到500字符禁止继续输入
- 输入框自动扩展(最多4行)
- 超过4行启用滚动

**发送评论:**
1. 验证内容不为空
2. 发送按钮显示加载状态
3. 调用发布接口
4. 成功后:
   - 清空输入框
   - 收起键盘
   - 新评论插入列表顶部
   - 评论数+1
   - 显示"评论成功"Toast
5. 失败后:
   - 保留输入内容
   - 显示错误提示

**回复评论:**
1. 点击某条评论的"回复"按钮
2. 输入框显示"回复 @用户昵称:"前缀
3. 自动聚焦输入框
4. 其他流程同发布评论

### 5. 评论点赞
**点击评论点赞:**
1. 检查登录状态
2. 乐观更新UI
3. 调用接口
4. 失败时回滚

### 6. 评论删除
**长按自己的评论:**
1. 检查canDelete权限
2. 弹出操作菜单: "删除" | "取消"
3. 点击删除:
   - 弹出确认对话框
   - "确认删除评论?"
   - "删除后将无法恢复"
4. 确认后:
   - 调用删除接口
   - 成功后从列表移除
   - 评论数-1

### 7. 动态互动
**点赞/收藏/分享:**
- 参考主页面文档中的交互行为
- 乐观更新UI
- 调用对应接口
- 失败时回滚

### 8. 分享面板
**点击分享按钮:**
1. 从底部滑入分享面板(动画300ms)
2. 显示分享选项网格:
   ```
   [好友] [微信] [QQ] [微博] [举报]
   ```
3. 点击某个选项执行对应操作
4. 点击空白区域关闭面板

### 9. 举报流程
**点击举报:**
1. 跳转到举报页面(全屏)
2. 选择举报类型(必选)
3. 填写描述(可选,0-200字)
4. 上传图片(可选,最多3张)
5. 点击提交:
   - 验证类型已选择
   - 调用举报接口
   - 成功后显示确认对话框
   - 点击确定返回详情页

### 10. 更多操作菜单
**点击更多按钮(•••):**
1. 弹出操作菜单:
   - 作者本人:
     - "删除"(红色)
     - "举报"(灰色)
     - "取消"
   - 其他用户:
     - "举报"(灰色)
     - "取消"
2. 点击对应选项执行操作

---

## 前端验证规则

### 评论内容验证
```typescript
const validateComment = (content: string) => {
  if (!content || content.trim().length === 0) {
    return { valid: false, error: '评论内容不能为空' };
  }

  if (content.length > 500) {
    return { valid: false, error: '评论内容不能超过500字符' };
  }

  return { valid: true };
};
```

### 举报验证
```typescript
const validateReport = (reasonType: string, description: string) => {
  if (!reasonType) {
    return { valid: false, error: '请选择举报类型' };
  }

  if (description && description.length > 200) {
    return { valid: false, error: '描述不能超过200字符' };
  }

  return { valid: true };
};
```

### 权限验证
```typescript
// 检查是否可以删除动态
const canDeleteFeed = (feed: Feed, currentUserId: string) => {
  return feed.userId === currentUserId && feed.canDelete;
};

// 检查是否可以删除评论
const canDeleteComment = (comment: Comment, currentUserId: string) => {
  return comment.userId === currentUserId && comment.canDelete;
};
```

---

## 样式规范

### 颜色系统
```css
/* 主色调 */
--primary-purple: #8A2BE2;
--primary-light: #A855F7;
--primary-dark: #6B21A8;

/* 文字颜色 */
--text-primary: #000000;
--text-secondary: #666666;
--text-tertiary: #999999;

/* 背景颜色 */
--bg-page: #FFFFFF;
--bg-comment: #FAFAFA;
--bg-input: #F5F5F5;

/* 功能颜色 */
--like-color: #FF0000;
--collect-color: #FFD700;
--comment-color: #666666;

/* 分割线 */
--divider: #F0F0F0;
--border: #E5E5E5;
```

### 间距系统
```css
--spacing-xs: 4px;
--spacing-sm: 8px;
--spacing-md: 12px;
--spacing-lg: 16px;
--spacing-xl: 24px;

--content-padding: 16px;
```

### 字体系统
```css
--font-xs: 12pt;
--font-sm: 13pt;
--font-md: 14pt;
--font-base: 15pt;
--font-lg: 16pt;

--font-normal: 400;
--font-medium: 500;
--font-semibold: 600;
```

---

## 数据传递

### 跨页面传递
**从发现主页 → 详情页:**
- 传递: `feedId`(动态ID)
- 方式: 路由参数

**从详情页 → 用户主页:**
- 传递: `userId`(用户ID)
- 方式: 路由参数

**从详情页 → 话题详情:**
- 传递: `topicName`(话题名称)
- 方式: 路由参数

**从详情页 → 举报页:**
- 传递:
  - `targetType`: 'feed'
  - `targetId`: feedId
- 方式: 路由参数

### 状态同步
**互动操作成功后需要同步到:**
- 详情页面数据(点赞数、收藏数等)
- 主页面列表中的对应动态
- 全局用户关注列表

**评论操作成功后需要同步到:**
- 详情页评论列表
- 详情页评论总数
- 主页面动态的评论数

---

## 异常处理

| 场景 | 错误码 | 前端处理方式 |
|-----|-------|------------|
| 动态不存在 | 404 | 显示"动态不存在或已删除",提供返回按钮 |
| 动态仅作者可见 | 403 | 显示"该动态仅作者可见",提供返回按钮 |
| 未登录评论 | 401 | 显示"请先登录",提供登录按钮 |
| 评论内容违规 | 400 | 显示"评论内容违规,请修改" |
| 举报重复提交 | 400 | 显示"您已举报过该内容" |
| 网络错误 | - | 显示"网络异常,请稍后重试",提供重试按钮 |
| 服务器错误 | 500 | 显示"服务异常,请稍后重试",提供重试按钮 |
| 评论加载失败 | 400/500 | 显示"评论加载失败",提供重试按钮 |

---

## 性能优化

### 媒体加载
**图片优化:**
- 使用渐进式加载
- 加载前显示模糊缩略图
- 大图懒加载
- 支持WebP格式

**视频优化:**
- 预加载封面图
- 支持多种清晰度
- 自适应码率
- 预加载前几秒

### 评论列表优化
**虚拟滚动:**
- 评论过多时使用虚拟列表
- 只渲染可见区域评论
- 提升滚动性能

**二级回复懒加载:**
- 初始只显示3条二级回复
- 点击"展开"后加载全部
- 减少初始渲染量

### 数据缓存
**详情数据缓存:**
- 缓存已加载的详情数据
- 再次进入时优先显示缓存
- 后台静默刷新最新数据

**评论缓存:**
- 缓存已加载的评论
- 发布新评论后更新缓存

---

## 状态管理

### 页面状态
```typescript
interface DetailPageState {
  // 动态数据
  feed: Feed | null;
  loading: boolean;
  error: Error | null;

  // 评论数据
  comments: Comment[];
  commentLoading: boolean;
  commentPage: number;
  commentHasMore: boolean;
  commentSortType: 'time' | 'hot' | 'like';

  // 输入状态
  commentText: string;
  replyTo: {
    commentId: string;
    userId: string;
    nickname: string;
  } | null;

  // UI状态
  showSharePanel: boolean;
  showReportPage: boolean;
}
```

### 初始状态
```typescript
const initialState: DetailPageState = {
  feed: null,
  loading: true,
  error: null,

  comments: [],
  commentLoading: false,
  commentPage: 1,
  commentHasMore: true,
  commentSortType: 'time',

  commentText: '',
  replyTo: null,

  showSharePanel: false,
  showReportPage: false,
};
```

---

## 测试用例

### 功能测试
- [ ] 详情页加载正常
- [ ] 媒体展示正常(图片/视频)
- [ ] 评论列表加载正常
- [ ] 发布评论功能正常
- [ ] 回复评论功能正常
- [ ] 点赞评论功能正常
- [ ] 删除评论功能正常
- [ ] 点赞动态功能正常
- [ ] 收藏动态功能正常
- [ ] 分享功能正常
- [ ] 举报功能正常
- [ ] 关注用户功能正常
- [ ] 删除动态功能正常

### 边界测试
- [ ] 动态不存在处理
- [ ] 评论为空处理
- [ ] 评论内容超长验证
- [ ] 举报重复提交处理
- [ ] 网络异常处理
- [ ] 权限验证正确
- [ ] 快速重复点赞/收藏

### 性能测试
- [ ] 大图加载性能
- [ ] 视频播放流畅度
- [ ] 评论列表滚动流畅
- [ ] 二级回复展开性能
- [ ] 内存占用控制

### 兼容性测试
- [ ] iOS系统 (13+)
- [ ] Android系统 (8+)
- [ ] 不同屏幕尺寸
- [ ] 横屏模式
- [ ] 深色模式(可选)

---

## 开发清单

### 必须实现
- [x] 详情页面布局
- [x] 媒体展示(图片/视频)
- [x] 评论列表展示
- [x] 发布评论功能
- [x] 回复评论功能
- [x] 点赞功能
- [x] 收藏功能
- [x] 分享功能
- [x] 举报功能
- [x] 关注功能
- [x] 删除功能
- [x] 权限验证
- [x] 错误处理

### 可选优化
- [ ] 图片/视频预加载
- [ ] 评论虚拟滚动
- [ ] 二级回复分页
- [ ] 评论排序切换
- [ ] 评论搜索功能
- [ ] 深色模式
- [ ] 无障碍支持
- [ ] 离线缓存

---

## 相关文档

- **设计稿:**
  - `UI页面/发现/动态详情页面/动态-图文.png`
  - `UI页面/发现/动态详情页面/动态-图文-更多.png`
  - `UI页面/发现/动态详情页面/动态-已点赞收藏.png`
  - `UI页面/发现/动态详情页面/动态-视频.png`
  - `UI页面/发现/动态详情页面/举报.png`
  - `UI页面/发现/动态详情页面/举报-提交弹窗.png`

- **相关页面文档:**
  - 发现主页面文档
  - 发布动态页面文档
  - 用户主页接口文档
  - 话题详情页面文档

- **技术文档:**
  - Discovery模块README
  - DetailPage组件文档
  - API_USAGE_GUIDE_v7.1
