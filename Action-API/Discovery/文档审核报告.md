# Discovery模块文档审核报告

## 📋 概述
本报告分析Discovery模块的三个核心文档,识别接口重复、缺失、归属问题,并提出优化建议。

---

## 📊 文档概览

### 1. 发现主页面文档 (658行)
**核心职责:** 浏览和发现内容
**接口数量:** 10个
**关键功能:**
- 三Tab动态列表(关注/热门/同城)
- 基础互动(点赞/收藏/分享)
- 关注/取关用户
- 页面跳转导航

### 2. 动态详情页面文档 (931行)
**核心职责:** 查看详情和深度互动
**接口数量:** 11个
**关键功能:**
- 动态完整内容展示
- 2级评论系统
- 举报功能
- 删除动态/评论

### 3. 发布动态页面文档 (986行)
**核心职责:** 创建和发布内容
**接口数量:** 7个
**关键功能:**
- 内容编辑(标题/正文)
- 媒体上传(图片/视频)
- 话题和地点选择
- 发布提交

---

## 🔍 接口分析

### 1. 接口分布矩阵

| 接口路径 | 方法 | 主页 | 详情 | 发布 | 归属建议 |
|---------|------|-----|------|-----|---------|
| `/api/v1/content/feed/{tabType}` | GET | ✅ | - | - | ✅ Content |
| `/api/v1/content/detail/{feedId}` | GET | - | ✅ | - | ✅ Content |
| `/api/v1/content/publish` | POST | - | - | ✅ | ✅ Content |
| `/api/v1/content/comments/{feedId}` | GET | - | ✅ | - | ✅ Content |
| `/api/v1/content/comment` | POST | - | ✅ | - | ✅ Content |
| `/api/v1/content/comment/{id}` | DELETE | - | ✅ | - | ✅ Content |
| `/api/v1/content/{feedId}` | DELETE | - | ✅ | - | ✅ Content |
| `/api/v1/content/report` | POST | - | ✅ | - | ⚠️ Moderation |
| `/api/v1/content/topics/hot` | GET | - | - | ✅ | ✅ Content |
| `/api/v1/content/topics/search` | GET | - | - | ✅ | ✅ Content |
| `/api/v1/interaction/like` | POST | ✅ | ✅ | - | ✅ Interaction |
| `/api/v1/interaction/collect` | POST | ✅ | ✅ | - | ✅ Interaction |
| `/api/v1/interaction/share` | POST | ✅ | ✅ | - | ✅ Interaction |
| `/api/v1/user/follow` | POST | ✅ | ✅ | - | ⚠️ User |
| `/api/v1/media/upload` | POST | - | - | ✅ | ⚠️ Media |
| `/api/v1/location/nearby` | GET | - | - | ✅ | ⚠️ Location |
| `/api/v1/location/search` | GET | - | - | ✅ | ⚠️ Location |

**总计:** 17个唯一接口,28次引用(有重复)

### 2. 🔴 重复接口分析

#### A. Interaction接口 (重复3次)
**接口组:**
- `POST /api/v1/interaction/like`
- `POST /api/v1/interaction/collect`
- `POST /api/v1/interaction/share`

**当前状态:**
- 主页文档定义: ✅ (点赞动态/收藏动态/分享动态)
- 详情文档定义: ✅ (点赞动态/收藏动态/分享动态 + 点赞评论)

**问题:**
1. 同一接口在两个文档中重复定义
2. `like`接口支持feed和comment两种targetType,但分散在不同文档
3. 参数定义完全相同,造成冗余

**建议整合:**
```
选项1: 创建独立的"互动接口文档" (推荐)
- 路径: Action-API/Common/互动接口文档.md
- 包含: like, collect, share的完整定义
- 主页和详情页只保留"触发时机"和"前端行为"

选项2: 归并到主页文档
- 详情页引用主页文档的接口定义
- 只在详情页补充"点赞评论"的特殊说明
```

#### B. User Follow接口 (重复2次)
**接口:** `POST /api/v1/user/follow`

**当前状态:**
- 主页文档定义: ✅ (关注/取关用户)
- 详情文档定义: ✅ (关注/取关用户)

**问题:**
1. 完全相同的接口定义重复两次
2. 属于User模块,不应在Discovery模块重复定义

**建议:**
```
方案: 移至User模块文档
- 创建: Action-API/Users/用户关系接口文档.md
- 包含: follow, unfollow, followers, following等
- Discovery文档改为引用: "详见用户关系接口文档"
```

---

## ⚠️ 跨模块接口问题

### 1. Media Upload (媒体上传)
**接口:** `POST /api/v1/media/upload`

**当前归属:** 发布动态文档

**问题:**
- 媒体上传是通用能力,不只在发布动态使用
- 可能在修改动态、用户头像、聊天等多处使用

**建议:**
```
方案: 创建独立Media模块文档
- 路径: Action-API/Media/媒体上传接口文档.md
- 包含: 图片上传、视频上传、图片压缩规则等
- 发布文档改为引用
```

### 2. Location (地点服务)
**接口:**
- `GET /api/v1/location/nearby`
- `GET /api/v1/location/search`

**当前归属:** 发布动态文档

**问题:**
- 地点服务可能在多处使用(发布动态、签到、活动等)
- 应该是独立的服务模块

**建议:**
```
方案: 创建独立Location模块文档 或 归入Common
- 路径: Action-API/Common/地点服务接口文档.md
- 包含: 附近地点、地点搜索、地点详情等
- 发布文档改为引用
```

### 3. Content Report (举报)
**接口:** `POST /api/v1/content/report`

**当前归属:** 详情页文档

**问题:**
- 举报功能可以举报feed、comment、user
- 是通用的内容审核能力
- 可能在多个模块使用

**建议:**
```
方案1: 归入Common/Moderation模块
- 路径: Action-API/Common/举报与审核接口文档.md
- 详情文档改为引用

方案2: 保留在详情文档(如果仅用于动态举报)
- 当前位置合理,暂不调整
```

---

## 🔄 后端Controller映射建议

基于接口分析,建议的后端Controller组织:

### 1. **ContentController** (内容管理)
**路径:** `/api/v1/content`
**职责:** 动态的CRUD和列表查询

**接口列表:**
```java
@RestController
@RequestMapping("/api/v1/content")
public class ContentController {
    // 1. 查询相关
    GET  /feed/{tabType}           // 获取动态列表(关注/热门/同城)
    GET  /detail/{feedId}          // 获取动态详情
    GET  /comments/{feedId}        // 获取评论列表

    // 2. 创建相关
    POST /publish                  // 发布动态
    POST /comment                  // 发布评论

    // 3. 删除相关
    DELETE /{feedId}               // 删除动态
    DELETE /comment/{commentId}    // 删除评论

    // 4. 话题相关
    GET  /topics/hot               // 获取热门话题
    GET  /topics/search            // 搜索话题
}
```

### 2. **InteractionController** (互动管理)
**路径:** `/api/v1/interaction`
**职责:** 点赞、收藏、分享等互动行为

**接口列表:**
```java
@RestController
@RequestMapping("/api/v1/interaction")
public class InteractionController {
    POST /like      // 点赞/取消点赞(支持feed和comment)
    POST /collect   // 收藏/取消收藏
    POST /share     // 分享
}
```

### 3. **MediaController** (媒体管理) ⚠️ 建议独立
**路径:** `/api/v1/media`
**职责:** 图片、视频上传和处理

**接口列表:**
```java
@RestController
@RequestMapping("/api/v1/media")
public class MediaController {
    POST /upload    // 上传媒体(图片/视频)
    // 未来可扩展:
    // POST /compress  // 图片压缩
    // GET  /{id}      // 获取媒体信息
}
```

### 4. **LocationController** (地点服务) ⚠️ 建议独立
**路径:** `/api/v1/location`
**职责:** 地点查询和搜索

**接口列表:**
```java
@RestController
@RequestMapping("/api/v1/location")
public class LocationController {
    GET /nearby   // 获取附近地点
    GET /search   // 搜索地点
}
```

### 5. **UserRelationController** (用户关系) ⚠️ 应移至User模块
**路径:** `/api/v1/user`
**职责:** 关注、粉丝等关系管理

**接口列表:**
```java
@RestController
@RequestMapping("/api/v1/user")
public class UserRelationController {
    POST /follow   // 关注/取消关注
    // 未来可扩展:
    // GET  /followers/{userId}
    // GET  /following/{userId}
}
```

### 6. **ModerationController** (内容审核) ⚠️ 可选独立
**路径:** `/api/v1/moderation` 或 `/api/v1/content/report`
**职责:** 举报和内容审核

**接口列表:**
```java
@RestController
@RequestMapping("/api/v1/moderation")
public class ModerationController {
    POST /report   // 举报内容(feed/comment/user)
}
```

---

## 📝 文档重组建议

### 方案A: 最小改动方案 (保守)

**保留现有三个文档,仅做标注和引用:**

1. **发现主页面文档** - 保持不变
   - 添加引用标注: "互动接口详见XXX"

2. **动态详情页面文档** - 保持不变
   - 添加引用标注: "互动接口详见XXX"

3. **发布动态页面文档** - 保持不变
   - 添加引用标注: "媒体上传详见XXX,地点服务详见XXX"

**新增通用文档:**
- `Common/互动接口文档.md` - 提取重复的like/collect/share
- `Common/媒体上传接口文档.md` - 提取media upload
- `Common/地点服务接口文档.md` - 提取location

### 方案B: 标准重组方案 (推荐)

**按功能重新组织:**

```
Action-API/
├── Discovery/
│   ├── 发现主页面文档.md          (简化,移除重复接口)
│   ├── 动态详情页面文档.md        (简化,移除重复接口)
│   ├── 发布动态页面文档.md        (简化,移除跨模块接口)
│   └── 话题功能接口文档.md        (新增,从发布文档提取)
│
├── Interaction/
│   └── 互动接口文档.md            (新增,整合like/collect/share)
│
├── Media/
│   └── 媒体上传接口文档.md        (新增,从发布文档移出)
│
├── Location/
│   └── 地点服务接口文档.md        (新增,从发布文档移出)
│
├── Moderation/
│   └── 举报与审核接口文档.md      (新增,从详情文档移出)
│
└── Users/
    └── 用户关系接口文档.md        (新增,从主页/详情移出)
```

### 方案C: 模块化方案 (激进)

**完全按后端Controller组织:**

```
Action-API/
├── Content/
│   ├── 动态管理接口文档.md       (feed CRUD)
│   ├── 评论管理接口文档.md       (comment CRUD)
│   └── 话题管理接口文档.md       (topic)
│
├── Interaction/
│   └── 互动接口文档.md           (like/collect/share)
│
├── Media/
│   └── 媒体服务接口文档.md       (upload)
│
├── Location/
│   └── 地点服务接口文档.md       (nearby/search)
│
├── User/
│   └── 用户关系接口文档.md       (follow)
│
└── Moderation/
    └── 审核接口文档.md           (report)
```

---

## ✅ 推荐实施方案

**采用方案B (标准重组方案)**

### 第一阶段: 创建通用文档(不影响现有文档)

1. **创建 `Action-API/Interaction/互动接口文档.md`**
   - 内容: 提取like/collect/share的完整定义
   - 包含: targetType支持(feed/comment)
   - 时间: 2小时

2. **创建 `Action-API/Media/媒体上传接口文档.md`**
   - 内容: 图片/视频上传,压缩规则
   - 时间: 1.5小时

3. **创建 `Action-API/Location/地点服务接口文档.md`**
   - 内容: nearby/search接口
   - 时间: 1小时

4. **创建 `Action-API/Users/用户关系接口文档.md`**
   - 内容: follow/unfollow接口
   - 时间: 1小时

### 第二阶段: 更新现有文档(添加引用)

5. **更新三个Discovery文档**
   - 移除重复接口的详细定义
   - 添加引用链接到通用文档
   - 保留"触发时机"和"前端行为"
   - 时间: 2小时

### 第三阶段: 补充缺失文档

6. **创建 `Discovery/话题功能接口文档.md`** (可选)
   - 内容: topics/hot, topics/search
   - 时间: 1小时

---

## 🐛 发现的问题和缺失

### 1. 缺失的接口

#### A. 评论相关
- ❌ `GET /api/v1/content/comment/{commentId}/replies` - 获取二级回复完整列表
- ❌ `PUT /api/v1/content/comment/{commentId}` - 编辑评论(如需要)

#### B. 动态相关
- ❌ `PUT /api/v1/content/{feedId}` - 编辑动态
- ❌ `GET /api/v1/content/{feedId}/likers` - 获取点赞列表(查看谁点赞了)

#### C. 话题相关
- ❌ `GET /api/v1/content/topic/{topicName}` - 获取话题详情
- ❌ `GET /api/v1/content/topic/{topicName}/feeds` - 获取话题下的动态列表

#### D. 媒体相关
- ❌ `DELETE /api/v1/media/{mediaId}` - 删除已上传的媒体(取消发布时)

### 2. 参数不一致

#### A. 分页参数
- ✅ 统一使用: `page`, `pageSize`
- ✅ 响应包含: `list`, `total`, `hasMore`

#### B. targetType枚举
- ⚠️ like接口: 'feed' | 'comment' (已明确)
- ⚠️ collect接口: 仅'feed' (需确认是否支持comment)
- ⚠️ share接口: 仅'feed' (需确认)
- ⚠️ report接口: 'feed' | 'comment' | 'user' (已明确)

### 3. 数据结构不一致

#### Feed对象
**问题:** 主页和详情页返回的Feed结构略有差异

**主页版本:**
```typescript
interface Feed {
  // 基础字段都有
  // 缺少: canEdit, canDelete
}
```

**详情版本:**
```typescript
interface Feed {
  // 比主页多:
  canEdit: boolean;
  canDelete: boolean;
}
```

**建议:** 统一Feed数据结构,权限字段应该在所有场景都返回

---

## 📊 后端开发优先级

### P0 - 核心功能 (必须)
1. ✅ ContentController
   - GET /feed/{tabType}
   - GET /detail/{feedId}
   - POST /publish
   - DELETE /{feedId}

2. ✅ InteractionController
   - POST /like (支持feed和comment)
   - POST /collect
   - POST /share

3. ✅ MediaController
   - POST /upload

### P1 - 重要功能 (第一版需要)
4. ✅ ContentController (评论)
   - GET /comments/{feedId}
   - POST /comment
   - DELETE /comment/{commentId}

5. ✅ LocationController
   - GET /nearby
   - GET /search

6. ✅ UserRelationController
   - POST /follow

### P2 - 辅助功能 (可延后)
7. ✅ ContentController (话题)
   - GET /topics/hot
   - GET /topics/search

8. ⚠️ ModerationController
   - POST /report

### P3 - 增强功能 (V2)
9. ❌ 编辑动态
10. ❌ 话题详情页
11. ❌ 点赞列表
12. ❌ 二级回复分页

---

## 📋 具体修改清单

### 立即执行 (修复重复和错误)

#### 1. 创建 `Interaction/互动接口文档.md`
```markdown
# 互动接口文档

## 一、点赞/取消点赞
接口: POST /api/v1/interaction/like
支持类型: feed, comment

## 二、收藏/取消收藏
接口: POST /api/v1/interaction/collect
支持类型: feed

## 三、分享
接口: POST /api/v1/interaction/share
支持类型: feed
```

#### 2. 创建 `Media/媒体上传接口文档.md`
从 `发布动态页面文档.md` 提取 "二、上传图片" 和 "三、上传视频"

#### 3. 创建 `Location/地点服务接口文档.md`
从 `发布动态页面文档.md` 提取 "五、选择地点"

#### 4. 创建 `Users/用户关系接口文档.md`
从 `发现主页面文档.md` 和 `动态详情页面文档.md` 提取 "关注/取关用户"

#### 5. 更新 `发现主页面文档.md`
- 删除 "二、点赞动态" 到 "四、分享动态" 的接口定义部分
- 删除 "六、关注/取关用户" 的接口定义部分
- 保留前端行为,添加引用:
```markdown
## 二、点赞动态
接口定义详见: [互动接口文档](../Interaction/互动接口文档.md#点赞)

### 前端行为
(保留原有内容)
```

#### 6. 更新 `动态详情页面文档.md`
- 删除重复的interaction接口定义
- 删除 "十、关注/取关用户" 的接口定义
- 删除 "九、举报动态" 移至 `Moderation/举报接口文档.md`
- 添加引用链接

#### 7. 更新 `发布动态页面文档.md`
- 删除 "二、上传图片" 和 "三、上传视频" 的接口定义
- 删除 "五、选择地点" 的接口定义
- 添加引用链接

---

## 🎯 最终目标结构

```
Action-API/
├── Discovery/              # 发现模块(页面级文档)
│   ├── 发现主页面文档.md         - 10接口 → 3接口 (精简70%)
│   ├── 动态详情页面文档.md       - 11接口 → 5接口 (精简55%)
│   ├── 发布动态页面文档.md       - 7接口 → 1接口 (精简85%)
│   └── 话题功能接口文档.md       - 2接口 (新增,可选)
│
├── Content/                # 内容模块(功能级文档)
│   └── (Discovery文档已覆盖,暂不拆分)
│
├── Interaction/            # 互动模块
│   └── 互动接口文档.md           - 3接口 (新增,整合)
│
├── Media/                  # 媒体模块
│   └── 媒体上传接口文档.md       - 1接口 (新增)
│
├── Location/               # 地点模块
│   └── 地点服务接口文档.md       - 2接口 (新增)
│
├── Moderation/             # 审核模块
│   └── 举报接口文档.md           - 1接口 (新增)
│
└── Users/                  # 用户模块
    └── 用户关系接口文档.md       - 1接口 (新增)
```

**统计:**
- 原始: 3个文档, 28个接口引用(重复)
- 优化: 10个文档, 17个接口(无重复)
- 减少重复: 39%

---

## ⏰ 实施时间估算

| 任务 | 工时 | 优先级 |
|-----|------|--------|
| 创建Interaction文档 | 2h | P0 |
| 创建Media文档 | 1.5h | P0 |
| 创建Location文档 | 1h | P0 |
| 创建Users文档 | 1h | P0 |
| 创建Moderation文档 | 1h | P1 |
| 更新Discovery三个文档 | 2h | P0 |
| 创建话题功能文档 | 1h | P2 |
| **总计** | **9.5h** | |

---

## ✍️ 审核结论

### ✅ 优点
1. 三个文档都遵循统一模板,结构清晰
2. 接口定义详细,包含TypeScript类型
3. 前端验证和交互行为描述完整
4. UI布局和样式规范详细

### ⚠️ 问题
1. **接口重复严重** - like/collect/share/follow重复定义
2. **跨模块接口混杂** - media/location/user接口不应在Discovery
3. **缺少通用文档** - 互动、媒体、地点应独立成文档
4. **后端Controller不清晰** - 需要明确接口归属

### 🎯 建议
1. **立即执行:** 创建5个通用接口文档(Interaction/Media/Location/User/Moderation)
2. **立即执行:** 更新三个Discovery文档,移除重复,添加引用
3. **可选执行:** 创建话题功能独立文档
4. **长期规划:** 考虑按Controller而非Page组织文档

### 📌 后续工作
1. 根据本报告执行文档重组
2. 补充缺失的接口文档(编辑动态、话题详情等)
3. 统一Feed数据结构(添加权限字段)
4. 确认targetType支持范围(collect/share是否支持comment)

---

**报告完成时间:** 2025-01-XX
**审核人:** AI Assistant
**状态:** 待执行
