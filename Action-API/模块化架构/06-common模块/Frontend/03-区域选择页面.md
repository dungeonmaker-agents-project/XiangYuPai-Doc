# 03-区域选择页面

## 一、页面概述

### 页面信息
- **路由路径**: `/location/district`
- **页面名称**: 区域选择
- **用户角色**: 所有用户
- **页面类型**: 选择器页面

### 页面功能
区域选择页面允许用户选择当前城市的具体区域,用于精准定位和筛选内容。用户可以:
1. 查看当前城市的所有区域选项
2. 选择"全[城市名]"查看全城内容
3. 选择具体区域查看该区域内容
4. 立即应用选择并返回首页

### 进入方式
- 从首页点击当前区域/位置按钮
- 从城市选择页面选择城市后自动进入(如该城市有区域划分)

---

## 二、页面UI结构

### 2.1 顶部导航栏
```
[返回] | 区域 |
```

**UI组件:**
- **返回按钮**: 点击返回上一页
- **标题**: 显示"区域"

### 2.2 区域选项网格
```
+----------------------------------+
| [全深圳] [南山区] [宝安区]       |
| [福田区] [龙岗区] [龙华区]       |
| [罗湖区] [坪山区] [光明区]       |
+----------------------------------+
```

**布局:**
- 网格布局,每行3个选项
- 响应式设计,自动换行
- "全[城市名]"选项排在第一位

**选项样式:**
- **选中**: 紫色渐变背景 + 白色文字
- **未选中**: 浅灰色背景 + 黑色文字
- 圆角矩形按钮
- 等宽等高

---

## 三、接口列表

### 3.1 页面加载时调用

#### 1. 获取区域列表
**接口:** `GET /api/location/districts`

**调用时机:**
- 页面打开时

**请求参数:**
```typescript
{
  cityCode: string;  // 当前城市代码
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    cityName: string;        // 城市名称(如:深圳)
    currentDistrict?: string; // 当前选中的区域代码
    districts: Array<{
      code: string;          // 区域代码
      name: string;          // 区域名称
      isAll: boolean;        // 是否为"全部"选项
    }>;
  }
}
```

**后续操作:**
- 渲染区域选项网格
- 高亮当前选中的区域

---

### 3.2 用户操作触发

#### 2. 选择区域
**接口:** `POST /api/location/district/select`

**调用时机:**
- 点击某个区域选项

**请求参数:**
```typescript
{
  cityCode: string;
  districtCode: string;  // 'all'表示全城
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    success: boolean;
    selectedDistrict: {
      code: string;
      name: string;
    };
  }
}
```

**后续操作:**
- 关闭区域选择页面
- 返回首页
- 更新首页顶部显示的区域名称
- 刷新首页Feed流(按新区域筛选)
- 保存选择到本地缓存

---

## 四、数据流

### 4.1 页面打开流程
```
1. 用户点击首页位置按钮
2. 获取当前城市代码
3. 调用GET /api/location/districts
4. 显示Loading骨架屏
5. 收到响应 → 渲染区域选项
6. 高亮当前选中区域
```

### 4.2 选择区域流程
```
1. 用户点击某个区域选项
2. 显示Loading动画
3. 调用POST /api/location/district/select
4. 成功响应:
   - 保存选择到本地缓存
   - 更新全局位置状态
   - 关闭当前页面
   - 返回首页
   - 刷新首页Feed流
5. 失败响应:
   - 显示错误提示
   - 保持在当前页面
```

---

## 五、状态管理

### 5.1 页面级状态
```typescript
{
  cityCode: string;                   // 当前城市代码
  cityName: string;                   // 城市名称
  currentDistrict: string | null;     // 当前选中区域代码
  districts: Array<{
    code: string;
    name: string;
    isAll: boolean;
  }>;
  loading: boolean;                   // 是否加载中
  error: string | null;               // 错误信息
}
```

### 5.2 全局状态
```typescript
{
  location: {
    cityCode: string;
    cityName: string;
    districtCode: string;
    districtName: string;
  };
}
```

### 5.3 本地缓存
```typescript
{
  selectedLocation: {
    cityCode: string;
    cityName: string;
    districtCode: string;
    districtName: string;
    timestamp: number;
  };
  // 缓存30天
}
```

---

## 六、路由参数

### 6.1 进入参数
```typescript
{
  cityCode: string;      // 城市代码(必填)
  cityName?: string;     // 城市名称(可选)
}
```

### 6.2 跳转目标

#### 选择区域后
```typescript
// 返回首页,刷新Feed流
this.$router.replace({
  path: '/home',
  query: { refresh: true }
});
```

#### 点击返回
```typescript
// 返回上一页
this.$router.back();
```

---

## 七、错误处理

### 7.1 网络错误
```
显示: "网络异常,请稍后重试"
操作: 提供"重试"按钮,重新加载区域列表
```

### 7.2 城市代码无效
```
显示: "城市信息无效,请重新选择城市"
操作: 跳转到城市选择页面
```

### 7.3 区域列表为空
```
显示: "该城市暂无区域划分"
操作: 自动选择"全城"并返回
```

### 7.4 选择失败
```
显示: "选择失败,请重试"
操作: 保持在当前页面,允许重新选择
```

---

## 八、测试要点

### 8.1 页面加载测试
- [ ] 区域选择页面正常打开
- [ ] 区域列表正确显示
- [ ] "全[城市名]"选项排在第一位
- [ ] 当前选中区域正确高亮
- [ ] Loading状态正确显示

### 8.2 选择功能测试
- [ ] 点击区域选项正确响应
- [ ] 选择后正确应用
- [ ] 返回首页后区域名称更新
- [ ] Feed流按新区域筛选
- [ ] 选择保存到本地缓存

### 8.3 交互测试
- [ ] 点击返回按钮正常工作
- [ ] 选择动画流畅
- [ ] 选中状态正确切换

### 8.4 边界测试
- [ ] 城市无区域时的处理
- [ ] 网络异常的错误处理
- [ ] 城市代码无效的处理

---

## 九、使用的后端服务

### LocationService
- `GET /api/location/districts` - 获取区域列表
- `POST /api/location/district/select` - 选择区域

---

## 十、前端实现要点

### 组件结构
```
DistrictSelector/
├── index.vue                  // 页面主组件
├── components/
│   └── DistrictGrid.vue       // 区域网格组件
└── hooks/
    └── useDistricts.ts        // 区域数据管理
```

### 关键逻辑
1. **区域加载**: 根据城市代码加载区域列表
2. **选项渲染**: 网格布局,响应式设计
3. **选择处理**: 单选,点击即选中并应用
4. **状态同步**: 更新全局位置状态和本地缓存
5. **页面跳转**: 选择后自动返回并刷新首页

### UI细节
1. **网格布局**: 每行3个,等宽等高
2. **选中效果**: 紫色渐变背景
3. **动画效果**: 点击时的缩放动画
4. **加载状态**: 骨架屏或Loading动画

---

## 十一、性能优化

### 1. 数据缓存
- 区域列表缓存1小时
- 减少重复请求

### 2. 用户体验
- 点击立即响应
- 选择后平滑关闭
- 首页刷新使用过渡动画

### 3. 状态管理
- 选择保存到本地缓存(30天)
- 全局状态实时更新

---

**文档版本**: v1.0
**最后更新**: 2025-01-XX
**维护者**: 前端团队
