# 01-密码登录页面

## 一、页面概述

- **路由路径**: `/auth/login/password`
- **页面功能**: 用户使用手机号+密码登录
- **用户角色**: 未登录用户
- **页面类型**: 认证页面

## 二、页面结构

### 2.1 顶部状态栏
- 系统状态栏（时间、信号、电池）
- 背景：白色/浅色

### 2.2 欢迎区域
```
您好！
欢迎使用探店
```
- **主标题**: "您好！"
  - 字体加粗，32-36pt
  - 颜色：#1a1a1a
  - 距离顶部 80-100px

- **副标题**: "欢迎使用探店"
  - 常规字体，32-36pt
  - 颜色：#1a1a1a

### 2.3 表单区域

#### 手机号输入
```
[+86 ▼]  [请输入手机号_________________ ⊗]
```

**国家区号选择器:**
- 默认值：`+86`
- 宽度：80px，高度：48px
- 支持国家：中国(+86)、香港(+852)、澳门(+853)、台湾(+886)、澳大利亚(+61)、韩国(+82)、泰国(+66)

**手机号输入框:**
- 占位符："请输入手机号"
- 输入类型：`tel`（数字键盘）
- 最大长度：11位（+86）
- 清空按钮：有内容时显示

#### 密码输入
```
[●●●●●●●●_________________________________ 👁]
```

**密码输入框:**
- 占位符："请输入6-20位密码"
- 输入类型：`password`（可切换为`text`）
- 长度限制：6-20位字符
- 显示/隐藏切换按钮

**密码要求:**
- 6-20位字符
- 不可纯数字（至少包含一个字母或符号）

#### 登陆按钮
```
┌──────────────────────────────────────┐
│              登陆                     │
└──────────────────────────────────────┘
```

**样式:**
- 宽度：100%（左右边距24px）
- 高度：52px，圆角：26px
- 背景渐变：#b794f6 → #a5b4fc（启用）
- 背景：浅灰色（禁用）

**启用条件:**
- 手机号格式正确
- 密码长度符合要求
- 用户协议已同意（默认）

#### 辅助链接
```
验证码登陆                    忘记密码？
```

- **验证码登陆**：紫色(#9333ea)，跳转到验证码登录页
- **忘记密码？**：浅灰色(#888)，跳转到忘记密码流程

### 2.4 底部用户协议
```
登陆即表明同意《探店用户协议》和《隐私政策》
```
- 位置：页面底部，距离底部安全区域32px
- 协议链接可点击，打开对应页面

## 三、接口列表

### 3.1 页面加载时调用

无初始化接口

### 3.2 用户操作触发

#### 1. 密码登录

**接口:** `POST /api/auth/login/password`

**触发时机:** 用户点击"登陆"按钮

**请求参数:**
```typescript
{
  countryCode: string;      // 国家区号，例如："+86"
  mobile: string;           // 手机号，例如："13147046323"
  password: string;         // 密码，6-20位字符
  agreeToTerms: boolean;    // 用户协议勾选状态，必须为true
}
```

**响应数据:**
```typescript
{
  code: number;           // 200=成功，其他=失败
  message: string;        // 提示信息
  data: {
    token: string;        // 登录凭证
    userId: string;       // 用户ID
    nickname: string;     // 用户昵称
    avatar?: string;      // 用户头像
  } | null
}
```

**错误处理:**
| 状态码 | 说明 | 前端提示 |
|-------|------|---------|
| 200 | 登录成功 | 跳转到主页 |
| 400 | 参数错误 | "请检查输入信息" |
| 401 | 认证失败 | "手机号或密码错误" |
| 403 | 账号禁用 | "账号已被禁用，请联系客服" |
| 500 | 服务器错误 | "登录失败，请稍后重试" |
| 网络错误 | 网络异常 | "网络连接失败，请检查网络设置" |

## 四、数据流

```
用户输入手机号和密码
  ↓
实时验证格式
  ↓
点击"登陆"按钮
  ↓
POST /api/auth/login/password
  ↓
成功: 保存token → 跳转主页
失败: 显示错误提示
```

## 五、状态管理

```typescript
interface PasswordLoginPageState {
  countryCode: string;        // 国家区号，默认："+86"
  mobile: string;             // 手机号
  password: string;           // 密码
  showPassword: boolean;      // 密码是否显示，默认：false
  isSubmitting: boolean;      // 是否正在提交
  errors: {
    mobile?: string;          // 手机号错误信息
    password?: string;        // 密码错误信息
  };
}
```

## 六、前端验证

### 手机号验证
```typescript
// +86 中国大陆
const isValidPhoneNumber = (phone: string, countryCode: string) => {
  if (countryCode === '+86') {
    return /^1[3-9]\d{9}$/.test(phone); // 11位，1开头
  }
  // 其他国家区号规则...
  return phone.length >= 8 && phone.length <= 15;
}
```

### 密码验证
```typescript
const isValidPassword = (password: string) => {
  if (password.length < 6 || password.length > 20) {
    return { valid: false, error: '密码长度为6-20位字符' };
  }

  // 检查是否纯数字
  if (/^\d+$/.test(password)) {
    return { valid: false, error: '密码不能为纯数字' };
  }

  return { valid: true };
}
```

## 七、交互行为

### 7.1 国家区号选择
1. 点击区号选择器
2. 打开底部弹出选择器(Bottom Sheet)
3. 选择国家/地区
4. 更新区号显示
5. 更新手机号最大长度限制

### 7.2 手机号输入
- 实时验证格式
- 只允许输入数字
- 达到最大长度自动停止
- 有内容时显示清空按钮
- 格式错误显示提示：`⚠ 请输入正确的手机号格式`

### 7.3 密码输入
- 默认显示圆点(●)
- 实时计算长度
- 达到20位停止输入
- 显示/隐藏切换：点击眼睛图标
- 格式错误显示提示

### 7.4 提交登录
1. 验证所有字段
2. 按钮进入加载状态
3. 禁用所有输入框
4. 调用登录接口
5. 成功：保存token → 延迟200-300ms → 跳转主页
6. 失败：恢复状态 → 显示错误提示

### 7.5 页面跳转
- **点击"验证码登陆"**: 跳转到 `/auth/login/sms`
- **点击"忘记密码？"**: 跳转到 `/auth/forgot-password`
- **点击用户协议**: 打开协议页面(WebView)

## 八、测试要点

### 功能测试
- [ ] 国家区号选择正常
- [ ] 手机号输入验证正确
- [ ] 密码显示/隐藏切换正常
- [ ] 清空按钮功能正常
- [ ] 表单验证准确
- [ ] 登录接口调用成功
- [ ] 错误提示显示正确
- [ ] 页面跳转正常

### 边界测试
- [ ] 手机号输入超长字符
- [ ] 密码输入特殊字符
- [ ] 网络异常处理
- [ ] 快速重复点击登陆按钮
- [ ] 密码错误次数限制

### 安全测试
- [ ] 密码输入默认隐藏
- [ ] 登录失败不泄露具体原因
- [ ] Token安全存储

## 九、使用的后端服务

- **AuthService** (认证服务)
  - `POST /api/auth/login/password` - 密码登录

## 十、样式规范

### 颜色
```css
--primary-purple: #9333ea;
--primary-blue: #3b82f6;
--gradient-start: #b794f6;
--gradient-end: #a5b4fc;
--text-primary: #1a1a1a;
--text-placeholder: #c0c0c0;
--error: #ef4444;
```

### 间距
```css
--page-padding: 24px;
--spacing-lg: 24px;
--spacing-xl: 40px;
--spacing-2xl: 60px;
```

---

**使用后端服务:** AuthService (auth模块)
**相关页面:** [02-验证码登录页面](./02-验证码登录页面.md), [03-忘记密码页面](./03-忘记密码页面.md)
**最后更新:** 2025-11-14
