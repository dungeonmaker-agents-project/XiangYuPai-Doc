# 06-搜索页面

## 一、页面概述

### 页面信息
- **路由路径**: `/search`
- **页面名称**: 搜索
- **用户角色**: 所有用户
- **页面类型**: 搜索输入页面

### 页面功能
搜索页面是用户进行内容搜索的入口。用户可以:
1. 查看搜索历史记录
2. 查看热门搜索关键词
3. 输入搜索关键词
4. 实时查看搜索建议
5. 执行搜索并跳转结果页
6. 删除单个或全部搜索历史

### 进入方式
- 从首页点击搜索框/搜索图标

---

## 二、页面UI结构

### 2.1 顶部搜索栏
```
[返回] [搜索框____________________] [搜索]
```

**UI组件:**
- **返回按钮**: 点击返回首页
- **搜索框**: 占位符"搜索更多",自动获取焦点
- **搜索按钮**: 紫色文字,点击执行搜索

### 2.2 历史记录区(搜索前)
```
历史记录           [清空]
[王者荣耀] [探店] [K歌]
```

**UI组件:**
- 标题: "历史记录" + "清空"按钮
- 历史项: 圆角矩形标签,白色背景
- 最多显示10条
- 长按可删除单条

### 2.3 热门搜索区(可选)
```
热门搜索
[王者荣耀 🔥] [英雄联盟] [探店]
```

### 2.4 搜索建议区(输入时)
```
👤 王者荣耀112
#  王者荣耀排位
🔍 王者荣耀陪玩
```

**UI组件:**
- 覆盖在搜索框下方
- 图标区分类型(用户/话题/关键词)
- 高亮匹配的关键词
- 点击填充并执行搜索

---

## 三、接口列表

### 3.1 页面加载时调用

#### 1. 获取搜索初始数据
**接口:** `GET /api/search/init`

**调用时机:**
- 打开搜索页面时

**请求参数:**
```typescript
{
  // 无参数,从token获取用户ID
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    searchHistory: Array<{
      keyword: string;
      searchTime: string;
      type?: string;
    }>;
    hotKeywords: Array<{
      keyword: string;
      rank?: number;
      isHot?: boolean;
    }>;
    placeholder: string;
  }
}
```

**后续操作:**
- 显示搜索历史
- 显示热门搜索(如有)
- 搜索框获取焦点,弹出键盘

---

### 3.2 用户操作触发

#### 2. 获取搜索建议
**接口:** `GET /api/search/suggest`

**调用时机:**
- 用户输入关键词时(防抖300ms)

**请求参数:**
```typescript
{
  keyword: string;       // 搜索关键词
  limit?: number;        // 建议数量(默认10)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    suggestions: Array<{
      text: string;
      type: 'user' | 'topic' | 'keyword';
      highlight?: string;
      icon?: string;
      extra?: string;
    }>;
  }
}
```

**后续操作:**
- 显示搜索建议列表
- 高亮匹配部分

---

#### 3. 删除搜索历史
**接口:** `DELETE /api/search/history`

**调用时机:**
- 长按历史记录项
- 点击"清空"按钮

**请求参数:**
```typescript
{
  keyword?: string;      // 要删除的关键词
  clearAll?: boolean;    // 是否清空所有
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    success: boolean;
  }
}
```

**后续操作:**
- 从列表移除该项
- 或清空整个历史列表

---

## 四、数据流

### 4.1 页面打开流程
```
1. 用户点击首页搜索框
2. 调用GET /api/search/init
3. 显示Loading动画
4. 收到响应 → 显示历史记录和热门搜索
5. 搜索框自动获取焦点,弹出键盘
```

### 4.2 输入搜索流程
```
1. 用户输入文字
2. 防抖300ms后触发
3. 调用GET /api/search/suggest
4. 显示搜索建议
5. 高亮匹配的关键词部分
```

### 4.3 执行搜索流程
```
1. 用户点击"搜索"按钮或搜索建议
2. 保存关键词到历史记录
3. 跳转到搜索结果页
4. 传递搜索关键词
```

### 4.4 删除历史流程
```
1. 用户长按历史记录项
2. 显示删除确认
3. 调用DELETE /api/search/history
4. 成功后从列表移除
```

---

## 五、状态管理

### 5.1 页面级状态
```typescript
{
  searchKeyword: string;
  searchHistory: string[];
  hotKeywords: string[];
  suggestions: Array<{
    text: string;
    type: string;
    icon?: string;
  }>;
  showSuggestions: boolean;
  loading: boolean;
}
```

### 5.2 本地缓存
```typescript
{
  searchHistory: string[];  // 最多50条,30天过期
}
```

---

## 六、路由参数

### 6.1 进入参数
```typescript
{
  // 通常无参数
}
```

### 6.2 跳转目标

#### 执行搜索
```typescript
this.$router.push({
  path: '/search/results',
  query: {
    keyword: this.searchKeyword,
    type: 'all'
  }
});
```

---

## 七、错误处理

### 7.1 搜索关键词为空
```
提示: "请输入搜索关键词"
操作: 不执行搜索
```

### 7.2 网络错误
```
显示: "网络异常,请稍后重试"
操作: 允许离线查看历史记录
```

---

## 八、测试要点

### 8.1 页面测试
- [ ] 搜索页面正常打开
- [ ] 搜索历史正确显示
- [ ] 热门搜索正确显示
- [ ] 搜索框自动获取焦点

### 8.2 输入测试
- [ ] 搜索建议实时显示
- [ ] 防抖功能正常工作
- [ ] 清空搜索框功能正常

### 8.3 历史测试
- [ ] 历史记录正确保存
- [ ] 删除单条历史正常
- [ ] 清空所有历史正常

---

## 九、使用的后端服务

### SearchService
- `GET /api/search/init` - 获取初始数据
- `GET /api/search/suggest` - 获取搜索建议
- `DELETE /api/search/history` - 删除搜索历史

---

## 十、前端实现要点

### 组件结构
```
SearchPage/
├── index.vue                  // 页面主组件
├── components/
│   ├── SearchBar.vue          // 搜索栏
│   ├── SearchHistory.vue      // 搜索历史
│   ├── HotKeywords.vue        // 热门搜索
│   └── Suggestions.vue        // 搜索建议
└── hooks/
    └── useSearch.ts           // 搜索逻辑
```

---

**文档版本**: v1.0
**最后更新**: 2025-01-XX
**维护者**: 前端团队
