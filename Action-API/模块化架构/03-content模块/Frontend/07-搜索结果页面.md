# 07-搜索结果页面

## 一、页面概述

### 页面信息
- **路由路径**: `/search/results`
- **页面名称**: 搜索结果
- **用户角色**: 所有用户
- **页面类型**: Tab列表页面

### 页面功能
搜索结果页面展示综合搜索结果。用户可以:
1. 查看综合搜索结果(全部Tab)
2. 切换到用户/下单/话题Tab查看分类结果
3. 上拉加载更多结果
4. 点击内容/用户/话题查看详情
5. 关注/取消关注用户(用户Tab)

### 进入方式
- 从搜索页面执行搜索后跳转
- 点击搜索历史或搜索建议

---

## 二、页面UI结构

### 2.1 顶部搜索栏
```
[返回] [关键词_________________] [搜索]
```

### 2.2 Tab栏
```
[ 全部(123) ] | [ 用户(45) ] | [ 下单(67) ] | [ 话题(11) ]
```

**Tab状态:**
- 激活Tab:紫色文字 + 底部紫色下划线
- 未激活Tab:黑色文字
- 显示结果数量

### 2.3 全部Tab - 内容卡片(瀑布流/网格)
```
+----------------+  +----------------+
| [缩略图]       |  | [缩略图]       |
| 描述文字       |  | 描述文字       |
| [头像]昵称 ❤88|  | [头像]昵称 ❤66|
+----------------+  +----------------+
```

### 2.4 用户Tab - 用户列表
```
+----------------------------------+
| [头像]  昵称 ♂ 19          [关注]|
|         实名认证                 |
|         个性签名...              |
+----------------------------------+
```

### 2.5 下单Tab - 服务提供者列表
```
+----------------------------------+
| [头像]  昵称 ♀ 22      3.2km    |
|         [可线上][2元]            |
|         描述文字...              |
|                   10 金币/单 →  |
+----------------------------------+
```

### 2.6 话题Tab - 话题列表
```
+----------------------------------+
| [图标]  王者荣耀        [热门]   |
|         话题描述...              |
+----------------------------------+
```

---

## 三、接口列表

### 3.1 页面加载时调用

#### 1. 执行搜索(综合)
**接口:** `POST /api/search/search`

**调用时机:**
- 页面打开时
- 修改搜索词重新搜索

**请求参数:**
```typescript
{
  keyword: string;
  type: 'all' | 'user' | 'order' | 'topic';
  pageNum: number;
  pageSize: number;
  filters?: {
    cityCode?: string;
    districtCode?: string;
    gender?: 'all' | 'male' | 'female';
    sortBy?: string;
  };
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    keyword: string;
    total: number;
    hasMore: boolean;
    tabs: Array<{
      type: string;
      label: string;
      count: number;
    }>;
    results: {
      // 根据type返回不同结构
    };
  }
}
```

---

#### 2. 获取全部Tab结果
**接口:** `GET /api/search/all`

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      itemType: 'post' | 'video' | 'user';
      itemId: number;
      post?: {
        postId: number;
        title?: string;
        description: string;
        thumbnail: string;
        mediaType: 'image' | 'video';
        author: {
          userId: number;
          avatar: string;
          nickname: string;
        };
        stats: {
          likes: number;
          comments?: number;
        };
      };
      user?: {
        userId: number;
        avatar: string;
        nickname: string;
        signature?: string;
      };
    }>;
  }
}
```

---

#### 3. 获取用户Tab结果
**接口:** `GET /api/search/users`

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      userId: number;
      avatar: string;
      nickname: string;
      age?: number;
      gender: 'male' | 'female';
      signature?: string;
      isVerified: boolean;
      relationStatus: 'none' | 'following' | 'followed' | 'mutual';
    }>;
  }
}
```

---

#### 4. 获取下单Tab结果
**接口:** `GET /api/search/orders`

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      userId: number;
      avatar: string;
      nickname: string;
      gender: 'male' | 'female';
      distance: number;
      tags: Array<{
        text: string;
        type: string;
        color?: string;
      }>;
      description: string;
      price: {
        amount: number;
        unit: string;
        displayText: string;
      };
      isOnline: boolean;
    }>;
  }
}
```

---

#### 5. 获取话题Tab结果
**接口:** `GET /api/search/topics`

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      topicId: number;
      topicName: string;
      icon?: string;
      description: string;
      isHot: boolean;
      hotLabel?: string;
      stats: {
        posts: number;
        views?: number;
      };
    }>;
  }
}
```

---

### 3.2 用户操作触发

#### 6. 关注/取消关注用户
**接口:** `POST /api/user/follow`

**调用时机:**
- 用户Tab中点击关注按钮

**请求参数:**
```typescript
{
  targetUserId: number;
  action: 'follow' | 'unfollow';
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    success: boolean;
    relationStatus: 'none' | 'following' | 'followed' | 'mutual';
  }
}
```

---

## 四、数据流

### 4.1 页面打开流程
```
1. 从搜索页面跳转,携带keyword
2. 调用POST /api/search/search (type='all')
3. 显示Loading骨架屏
4. 收到响应 → 渲染Tab栏和内容
5. 保存关键词到搜索历史
```

### 4.2 Tab切换流程
```
1. 用户点击Tab(如:"用户")
2. 更新Tab高亮状态
3. 清空当前列表
4. 重置pageNum=1
5. 调用对应接口(GET /api/search/users)
6. 显示Loading动画
7. 收到响应 → 渲染列表
```

### 4.3 上拉加载流程
```
1. 列表滚动到底部
2. 检查hasMore状态
3. pageNum+1
4. 调用当前Tab对应接口
5. 显示底部Loading
6. 追加数据到列表
```

---

## 五、状态管理

### 5.1 页面级状态
```typescript
{
  keyword: string;
  currentTab: 'all' | 'user' | 'order' | 'topic';
  tabsData: {
    all: { list: any[]; pageNum: number; hasMore: boolean };
    user: { list: any[]; pageNum: number; hasMore: boolean };
    order: { list: any[]; pageNum: number; hasMore: boolean };
    topic: { list: any[]; pageNum: number; hasMore: boolean };
  };
  loading: boolean;
  error: string | null;
}
```

---

## 六、路由参数

### 6.1 进入参数
```typescript
{
  keyword: string;       // 搜索关键词(必填)
  type?: string;         // Tab类型(可选,默认'all')
}
```

### 6.2 跳转目标

#### 点击内容卡片
```typescript
this.$router.push({
  path: '/post/detail',
  query: {
    postId: post.postId,
    from: 'search',
    keyword: this.keyword
  }
});
```

#### 点击用户卡片
```typescript
this.$router.push({
  path: '/user/profile',
  query: {
    userId: user.userId,
    from: 'search'
  }
});
```

#### 点击话题卡片
```typescript
this.$router.push({
  path: '/topic/detail',
  query: {
    topicId: topic.topicId,
    from: 'search'
  }
});
```

---

## 七、错误处理

### 7.1 搜索无结果
```
显示: "暂无搜索结果,换个关键词试试"
操作: 提供搜索建议
```

### 7.2 网络错误
```
显示: "网络异常,请稍后重试"
操作: 提供"重试"按钮
```

---

## 八、测试要点

### 8.1 页面测试
- [ ] 搜索结果页正常显示
- [ ] 4个Tab正确显示
- [ ] 各Tab结果正确加载

### 8.2 Tab切换测试
- [ ] Tab切换正常工作
- [ ] 各Tab独立分页状态

### 8.3 关注功能测试
- [ ] 关注按钮状态正确
- [ ] 关注/取消关注正常

---

## 九、使用的后端服务

### SearchService
- `POST /api/search/search` - 执行搜索
- `GET /api/search/all` - 获取全部Tab结果
- `GET /api/search/users` - 获取用户Tab结果
- `GET /api/search/orders` - 获取下单Tab结果
- `GET /api/search/topics` - 获取话题Tab结果

### UserService
- `POST /api/user/follow` - 关注/取消关注

---

## 十、前端实现要点

### 组件结构
```
SearchResults/
├── index.vue                  // 页面主组件
├── components/
│   ├── TabBar.vue             // Tab栏
│   ├── AllTab.vue             // 全部Tab
│   ├── UserTab.vue            // 用户Tab
│   ├── OrderTab.vue           // 下单Tab
│   └── TopicTab.vue           // 话题Tab
└── hooks/
    ├── useSearchResults.ts    // 搜索结果管理
    └── useFollow.ts           // 关注逻辑
```

---

**文档版本**: v1.0
**最后更新**: 2025-01-XX
**维护者**: 前端团队
