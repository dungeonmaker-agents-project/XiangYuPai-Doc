# 05-限时专享页面

## 一、页面概述

### 页面信息
- **路由路径**: `/home/limited-time`
- **页面名称**: 限时专享
- **用户角色**: 所有用户
- **页面类型**: 列表页面

### 页面功能
限时专享页面展示特定条件下的特价/促销服务提供者。用户可以:
1. 浏览限时专享用户列表
2. 使用智能排序/价格排序
3. 按性别筛选用户
4. 按语言筛选用户
5. 上拉加载更多用户
6. 点击用户卡片查看详情

### 进入方式
- 从首页点击"限时专享"入口

---

## 二、页面UI结构

### 2.1 顶部导航栏
```
[返回] | 限时专享 |
```

### 2.2 筛选栏
```
[智能推荐 ▼] | [不限性别 ▼] | [语话 ▼]
```

**三个下拉框:**
- **智能推荐**: 智能推荐/价格从低到高/价格从高到低/距离最近
- **不限性别**: 不限性别/男/女
- **语话**: 语话(不限)/普通话/粤语/英语

### 2.3 用户列表
```
+----------------------------------+
| [头像]  昵称 ♀ 22      3.2km    |
|         [可线上][2元][探店]     |
|         描述文字...              |
|                   10 金币/单 →  |
+----------------------------------+
```

**用户卡片:**
- 左侧:正方形头像(约80x80)
- 右侧:
  - 第一行:昵称 + 性别图标 + 距离
  - 第二行:标签行(横向滚动)
  - 第三行:描述文字(最多2行)
  - 第四行:价格(红色加粗,右对齐)

**促销标签:**
- 位置:头像左上角或右上角
- 样式:小标签,红色或橙色背景
- 文字:"限时"、"特价"等

---

## 三、接口列表

### 3.1 页面加载时调用

#### 1. 获取限时专享列表
**接口:** `GET /api/home/limited-time/list`

**调用时机:**
- 页面首次打开
- 切换筛选条件
- 上拉加载更多

**请求参数:**
```typescript
{
  cityCode?: string;      // 当前城市
  districtCode?: string;  // 当前区域
  pageNum: number;        // 页码
  pageSize: number;       // 每页数量(建议10)
  sortBy?: string;        // 排序方式
  gender?: 'all' | 'male' | 'female';
  language?: string;      // 语言筛选
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    filters: {
      sortOptions: Array<{
        value: string;
        label: string;
      }>;
      genderOptions: Array<{
        value: string;
        label: string;
      }>;
      languageOptions: Array<{
        value: string;
        label: string;
      }>;
    };
    list: Array<{
      userId: number;
      avatar: string;
      nickname: string;
      gender: 'male' | 'female';
      age?: number;
      distance: number;
      tags: Array<{
        text: string;
        type: 'feature' | 'price' | 'skill';
        color?: string;
      }>;
      description: string;
      price: {
        amount: number;
        unit: 'per_order' | 'per_hour' | 'per_game';
        displayText: string;
      };
      promotionTag?: string;
      isOnline: boolean;
      skillLevel?: string;
    }>;
  }
}
```

**后续操作:**
- 渲染用户列表
- 显示筛选选项

---

## 四、数据流

### 4.1 页面打开流程
```
1. 用户点击"限时专享"入口
2. 获取当前城市和区域
3. 调用GET /api/home/limited-time/list (pageNum=1)
4. 显示Loading骨架屏
5. 收到响应 → 渲染用户列表
```

### 4.2 筛选流程
```
1. 用户点击下拉框选择筛选条件
2. 更新下拉框显示文本
3. 关闭下拉菜单
4. 清空当前列表
5. 重置pageNum=1
6. 调用接口获取筛选后列表
```

### 4.3 上拉加载流程
```
1. 监听列表滚动
2. 距离底部触发加载
3. 检查hasMore状态
4. pageNum+1 → 调用接口
5. 显示底部Loading
6. 追加数据到列表
```

---

## 五、状态管理

### 5.1 页面级状态
```typescript
{
  userList: User[];
  pageNum: number;
  hasMore: boolean;
  loading: boolean;
  filters: {
    sortBy: string;
    gender: string;
    language: string;
  };
  error: string | null;
}
```

### 5.2 缓存策略
- 列表数据:会话级缓存,退出页面清除
- 筛选条件:会话级缓存,退出App清除

---

## 六、路由参数

### 6.1 进入参数
```typescript
{
  // 通常无参数
}
```

### 6.2 跳转目标

#### 点击用户卡片
```typescript
this.$router.push({
  path: '/user/profile',
  query: {
    userId: user.userId,
    from: 'limited-time'
  }
});
```

---

## 七、错误处理

### 7.1 未选择城市
```
显示: "请先选择城市"
操作: 跳转城市选择页面
```

### 7.2 列表为空
```
显示: "暂无限时专享用户,请稍后再试"
操作: 显示空状态页
```

### 7.3 网络错误
```
显示: "网络异常,请稍后重试"
操作: 提供"重试"按钮
```

---

## 八、测试要点

### 8.1 页面加载测试
- [ ] 限时专享页面正常打开
- [ ] 用户列表正确显示
- [ ] 筛选下拉框正常工作

### 8.2 筛选功能测试
- [ ] 选择筛选条件后列表更新
- [ ] 筛选条件正确保持

### 8.3 分页测试
- [ ] 上拉加载正常工作
- [ ] 无更多数据时显示提示

---

## 九、使用的后端服务

### HomeService
- `GET /api/home/limited-time/list` - 获取限时专享列表

---

## 十、前端实现要点

### 组件结构
```
LimitedTime/
├── index.vue                  // 页面主组件
├── components/
│   ├── FilterBar.vue          // 筛选栏
│   └── UserCard.vue           // 用户卡片
└── hooks/
    └── useLimitedTime.ts      // 数据管理
```

---

**文档版本**: v1.0
**最后更新**: 2025-01-XX
**维护者**: 前端团队
