# 10-发布组局页面

## 一、页面概述

### 页面信息
- **路由路径**: `/activity/publish`
- **页面名称**: 发布组局
- **用户角色**: 登录用户
- **页面类型**: 表单页面

### 页面功能
发布组局页面允许用户创建新的活动。用户可以:
1. 选择活动类型
2. 填写活动标题和描述
3. 上传活动图片
4. 设置活动时间和地点
5. 设置定价和人数限制
6. 设置报名截止时间
7. 发布活动并支付平台费(如需要)

### 进入方式
- 从组局中心列表点击"发布组局"按钮

---

## 二、页面UI结构

### 2.1 顶部导航栏
```
[取消] | 发布组局 |
```

### 2.2 活动类型选择区
```
[探店] [私影] [台球]
[K歌]  [喝酒] [按摩]
```

**样式**: 2行3列网格,每个图标带文字

### 2.3 表单区
```
添加标题
[输入框]

添加正文
[多行文本框]
[+] [图片1] [图片2]
字数: 0/200

时间
[选择 >]

地点
[选择 >]

定价
[0金币/小时 >]

人数
[选择 >]

报名截止时间
[选择 >]
```

### 2.4 规则说明区
```
· 发布后团局,平台会收取一定的下单费
· 组队成团后,因您的问题临时取消,则要扣除保证金
· 组队成团后,因达人爽约,则补偿您一定的保证金
```

### 2.5 底部发布按钮
```
[✈ 发布]
```

---

## 三、接口列表

### 3.1 页面加载时调用

#### 1. 获取发布配置
**接口:** `GET /api/activity/publish/config`

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    activityTypes: Array<{
      value: string;
      label: string;
      icon: string;
    }>;
    priceUnit: {
      options: Array<{value: string; label: string}>;
    };
    memberCountOptions: Array<{value: number; label: string}>;
    platformFee: {rate: number; description: string};
    depositRules: {depositAmount: number; description: string};
  }
}
```

---

### 3.2 用户操作触发

#### 2. 上传活动图片
**接口:** `POST /api/common/upload/image`

**请求参数:**
```typescript
{
  file: File;
  type: 'activity';
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    imageUrl: string;
    thumbnailUrl?: string;
  }
}
```

---

#### 3. 发布活动
**接口:** `POST /api/activity/publish`

**请求参数:**
```typescript
{
  activityType: string;
  title: string;
  content: string;
  images?: string[];
  schedule: {startTime: string; endTime?: string};
  location: {address: string; coordinates?: {latitude: number; longitude: number}};
  price: {amount: number; unit: 'per_person' | 'per_hour'};
  memberLimit: number;
  registrationDeadline: string;
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    activityId: number;
    needPayment: boolean;
    paymentInfo?: {amount: number; platformFee: number; deposit: number};
  }
}
```

---

#### 4. 支付平台费
**接口:** `POST /api/activity/publish/pay`

**请求参数:**
```typescript
{
  activityId: number;
  paymentMethod: 'balance' | 'alipay' | 'wechat';
  amount: number;
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    orderId: string;
    paymentStatus: 'success' | 'pending' | 'failed';
    activityId: number;
    balance?: number;
  }
}
```

---

## 四、数据流

### 4.1 页面打开流程
```
1. 用户点击"发布组局"按钮
2. 调用GET /api/activity/publish/config
3. 显示Loading动画
4. 收到响应 → 渲染活动类型选项
```

### 4.2 图片上传流程
```
1. 用户点击"+"按钮
2. 打开图片选择器
3. 选择图片后上传
4. 调用POST /api/common/upload/image
5. 显示上传进度
6. 成功后显示图片缩略图
```

### 4.3 发布流程
```
1. 用户填写所有必填信息
2. 点击"发布"按钮
3. 验证表单数据
4. 调用POST /api/activity/publish
5. 如果needPayment=false → 显示成功 → 跳转详情页
6. 如果needPayment=true → 显示支付弹窗
```

### 4.4 支付流程
```
1. 显示支付弹窗
2. 用户确认支付
3. 调用POST /api/activity/publish/pay
4. 支付成功 → 显示成功 → 跳转详情页
5. 支付失败 → 显示错误 → 保持在支付弹窗
```

---

## 五、状态管理

### 5.1 页面级状态
```typescript
{
  activityType: string;
  title: string;
  content: string;
  images: string[];
  schedule: {startTime: string; endTime?: string};
  location: {address: string};
  price: {amount: number; unit: string};
  memberLimit: number;
  registrationDeadline: string;
  uploading: boolean;
  submitting: boolean;
}
```

### 5.2 草稿保存
```typescript
{
  draftActivity: object;  // 本地缓存7天
}
```

---

## 六、路由参数

### 跳转目标

#### 发布成功后
```typescript
this.$router.replace({
  path: '/activity/detail',
  query: { activityId: data.activityId }
});
```

---

## 七、错误处理

### 7.1 表单验证
```
- 活动类型:必选
- 标题:1-50字符
- 内容:0-200字符
- 图片:最多9张,单张≤5MB
- 时间:必须晚于当前时间
- 地点:必填
- 价格:≥0
- 人数:2-100人
```

### 7.2 上传失败
```
显示: "图片上传失败,请重试"
操作: 提供重试按钮
```

### 7.3 余额不足
```
显示: "余额不足,请先充值"
操作: 提供充值入口
```

---

## 八、使用的后端服务

### ActivityService
- `GET /api/activity/publish/config` - 获取配置
- `POST /api/activity/publish` - 发布活动
- `POST /api/activity/publish/pay` - 支付平台费

### CommonService
- `POST /api/common/upload/image` - 上传图片

---

**文档版本**: v1.0
**最后更新**: 2025-01-XX
**维护者**: 前端团队
