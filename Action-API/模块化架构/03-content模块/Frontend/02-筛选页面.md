# 02-筛选页面

## 一、页面概述

### 页面信息
- **路由路径**: `/home/filter`
- **页面名称**: 首页筛选
- **用户角色**: 登录用户
- **页面类型**: 全屏筛选页面

### 页面功能
筛选页面允许用户对首页Feed流进行精细化筛选,支持线上和线下两种模式。用户可以:
1. 设置年龄范围筛选
2. 选择性别偏好
3. 设置用户活跃状态
4. 切换线上/线下模式
5. 选择技能、价格、位置、标签等多维度筛选
6. 重置所有筛选条件
7. 应用筛选并返回首页查看结果

### 进入方式
- 从首页点击筛选按钮/图标
- 首页顶部导航栏的筛选入口

---

## 二、页面UI结构

### 2.1 顶部导航栏
```
[返回] | 筛选 |
```

**UI组件:**
- **返回按钮**: 点击返回首页,不保存当前调整
- **标题**: 显示"筛选"

### 2.2 年龄范围选择器
```
年龄范围
[18] ←────────────→ [不限]
```

**UI组件:**
- 双滑块设计
- 左滑块:最小年龄(≥18岁)
- 右滑块:最大年龄(可选择"不限")
- 紫色滑块和进度条
- 实时显示当前选择的年龄范围

### 2.3 性别选择
```
性别
[ 全部 ] [ 男 ] [ 女 ]
```

**UI组件:**
- 单选按钮组
- 选中:紫色渐变背景 + 白色文字
- 未选中:浅灰色背景 + 黑色文字

### 2.4 状态选择
```
状态
[ 在线 ] [ 近三天活跃 ] [ 近七天活跃 ]
```

**UI组件:**
- 单选按钮组
- 默认选择"在线"

### 2.5 类型切换
```
类型
[ 线上 ] [ 线下 ]
```

**UI组件:**
- 单选按钮组
- 切换后显示不同的筛选选项

### 2.6 技能选择(线上模式)
```
技能
[ 尊贵钻金 ] [ 永恒钻石 ] [ 至尊星耀 ]
[ 最强王者 ] [ 荣耀王者 ] [ 英雄联盟 ]
```

**UI组件:**
- 多选按钮组
- 可选择0-多个
- 选中:紫色背景
- 未选中:灰色背景

### 2.7 价格选择(仅线上模式)
```
价格
[ 4~9币 ] [ 10~19币 ] [ 20币以上 ]
```

### 2.8 位置选择(仅线上模式)
```
位置
[ 打野 ] [ 上路 ] [ 中路 ] [ 下路 ] [ 辅助 ]
```

### 2.9 标签选择
```
标签
[ 荣耀王者 ] [ 大神认证 ] [ 巅峰赛 ]
[ 带粉上分 ] [ 官方认证 ] [ 声优陪玩 ]
```

### 2.10 底部操作栏
```
[ 重置 ]          [ 完成 ]
```

**UI组件:**
- **重置按钮**: 白色背景 + 灰色边框,清空所有筛选条件
- **完成按钮**: 紫色渐变背景 + 白色文字,应用筛选并返回首页

---

## 三、接口列表

### 3.1 页面加载时调用

#### 1. 获取筛选配置
**接口:** `GET /api/home/filter/config`

**调用时机:**
- 打开筛选页面时

**请求参数:**
```typescript
{
  type: 'online' | 'offline';  // 从当前Tab获取
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    ageRange: {
      min: number;        // 最小年龄(如:18)
      max: number | null; // 最大年龄(null表示不限)
    };
    genderOptions: Array<{
      value: string;      // 'all' | 'male' | 'female'
      label: string;      // '全部' | '男' | '女'
    }>;
    statusOptions: Array<{
      value: string;      // 'online' | 'active_3d' | 'active_7d'
      label: string;      // '在线' | '近三天活跃' | '近七天活跃'
    }>;
    skillOptions: Array<{
      value: string;
      label: string;
      category?: string;
    }>;
    priceOptions?: Array<{  // 仅线上模式
      value: string;
      label: string;
      min: number;
      max: number | null;
    }>;
    positionOptions?: Array<{  // 仅线上模式
      value: string;
      label: string;
    }>;
    tagOptions: Array<{
      value: string;
      label: string;
      highlighted?: boolean;
    }>;
  }
}
```

**后续操作:**
- 渲染筛选选项
- 回显已有筛选条件(如果有)

---

### 3.2 用户操作触发

#### 2. 应用筛选条件
**接口:** `POST /api/home/filter/apply`

**调用时机:**
- 点击"完成"按钮

**请求参数:**
```typescript
{
  type: 'online' | 'offline';
  filters: {
    age?: {
      min: number;
      max: number | null;
    };
    gender?: 'all' | 'male' | 'female';
    status?: 'online' | 'active_3d' | 'active_7d';
    skills?: string[];
    priceRange?: string[];      // 仅线上
    positions?: string[];        // 仅线上
    tags?: string[];
  };
  pageNum: number;               // 固定为1
  pageSize: number;              // 建议10
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      userId: number;
      avatar: string;
      nickname: string;
      age: number;
      gender: 'male' | 'female';
      status: 'online' | 'offline';
      isOnline: boolean;
      skills: Array<{
        name: string;
        level?: string;
      }>;
      price?: number;
      position?: string;
      tags: string[];
      distance?: number;
      location?: string;
    }>;
    appliedFilters: {
      count: number;
      summary: string[];
    };
  }
}
```

**后续操作:**
- 关闭筛选页面
- 返回首页
- 显示筛选后的结果列表
- 在首页显示筛选标签和数量

---

## 四、数据流

### 4.1 页面打开流程
```
1. 从首页点击筛选按钮
2. 获取当前Tab类型(线上/线下)
3. 调用GET /api/home/filter/config
4. 显示Loading骨架屏
5. 收到响应 → 渲染筛选选项
6. 回显已有筛选条件
```

### 4.2 类型切换流程
```
1. 用户点击"线下"类型
2. 更新类型状态
3. 隐藏线上专属选项(价格、位置)
4. 更新技能选项列表
5. 保留适用的筛选条件
```

### 4.3 应用筛选流程
```
1. 用户点击"完成"按钮
2. 验证筛选条件
3. 调用POST /api/home/filter/apply
4. 显示Loading动画
5. 收到响应 → 关闭筛选页面
6. 返回首页并显示筛选结果
7. 更新全局筛选状态
```

### 4.4 重置流程
```
1. 用户点击"重置"按钮
2. 清空所有选项选择
3. 恢复默认值:
   - 年龄:18岁 - 不限
   - 性别:全部
   - 状态:在线
   - 类型:保持当前选择
   - 清空所有多选项
4. 不触发接口调用
5. 不关闭页面
```

---

## 五、状态管理

### 5.1 页面级状态
```typescript
{
  currentType: 'online' | 'offline';  // 当前类型
  filters: {
    age: { min: number; max: number | null };
    gender: string;
    status: string;
    skills: string[];
    priceRange: string[];
    positions: string[];
    tags: string[];
  };
  isModified: boolean;                // 是否有修改
  loading: boolean;                   // 是否加载中
  error: string | null;               // 错误信息
}
```

### 5.2 全局状态
```typescript
{
  appliedFilters: {
    type: 'online' | 'offline';
    filters: object;
    count: number;
    summary: string[];
  };
}
```

---

## 六、路由参数

### 6.1 进入参数
```typescript
{
  type?: 'online' | 'offline';  // 当前Tab类型
  currentFilters?: object;       // 已有筛选条件
}
```

### 6.2 跳转目标

#### 点击完成按钮
```typescript
// 返回首页,传递筛选结果
this.$router.replace({
  path: '/home',
  query: { filtered: true }
});
```

#### 点击返回按钮
```typescript
// 返回首页,不应用筛选
this.$router.back();
```

---

## 七、错误处理

### 7.1 网络错误
```
显示: "网络异常,请稍后重试"
操作: 提供"重试"按钮,重新加载筛选配置
```

### 7.2 筛选条件为空
```
显示: "请至少选择一个筛选条件"
操作: 不关闭页面,提示用户选择条件
```

### 7.3 年龄范围无效
```
显示: "年龄范围设置不正确"
操作: 重置年龄滑块
```

### 7.4 筛选结果为空
```
显示: "暂无符合条件的用户,请调整筛选条件"
操作: 在首页显示空状态,提供"调整筛选"按钮
```

---

## 八、测试要点

### 8.1 页面加载测试
- [ ] 筛选页面正常打开
- [ ] 筛选选项正确显示
- [ ] 已有筛选条件正确回显
- [ ] Loading状态正确显示

### 8.2 筛选功能测试
- [ ] 年龄滑块可正常拖动
- [ ] 性别选择单选互斥
- [ ] 状态选择正确工作
- [ ] 类型切换更新选项
- [ ] 技能多选功能正常
- [ ] 价格多选功能正常(线上)
- [ ] 位置多选功能正常(线上)
- [ ] 标签多选功能正常

### 8.3 操作测试
- [ ] 重置按钮清空所有条件
- [ ] 完成按钮应用筛选
- [ ] 返回按钮不保存修改
- [ ] 筛选结果正确返回首页

### 8.4 边界测试
- [ ] 不选择条件点击完成的提示
- [ ] 年龄范围边界值测试
- [ ] 线上/线下切换条件保留测试
- [ ] 网络异常错误处理

---

## 九、使用的后端服务

### HomeService
- `GET /api/home/filter/config` - 获取筛选配置
- `POST /api/home/filter/apply` - 应用筛选条件

---

## 十、前端实现要点

### 组件结构
```
FilterPage/
├── index.vue                  // 页面主组件
├── components/
│   ├── AgeRangeSlider.vue    // 年龄范围滑块
│   ├── RadioGroup.vue         // 单选按钮组
│   ├── CheckboxGroup.vue      // 多选按钮组
│   └── FilterActions.vue      // 底部操作按钮
└── hooks/
    ├── useFilterConfig.ts     // 筛选配置管理
    └── useFilterState.ts      // 筛选状态管理
```

### 关键逻辑
1. **年龄滑块**: 使用双滑块组件,支持拖动和点击
2. **类型切换**: 动态显示/隐藏选项,保留适用条件
3. **选项管理**: 统一管理单选和多选状态
4. **重置逻辑**: 恢复默认值,保持类型选择
5. **应用筛选**: 验证条件,调用接口,更新全局状态

---

## 十一、性能优化

### 1. 选项渲染优化
- 使用虚拟滚动(如选项过多)
- 懒加载非可见选项

### 2. 状态管理优化
- 临时调整仅保存在组件状态
- 点击完成才同步全局状态
- 点击返回丢弃临时调整

### 3. 用户体验优化
- 滑块拖动使用防抖
- 选项点击立即响应
- 页面切换使用过渡动画
- 显示骨架屏优化加载体验

---

**文档版本**: v1.0
**最后更新**: 2025-01-XX
**维护者**: 前端团队
