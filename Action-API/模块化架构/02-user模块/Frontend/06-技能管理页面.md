# 06-技能管理页面

## 一、页面概述

- **路由路径**: `/user/skills` 或 `/user/skills/manage`
- **页面功能**: 管理个人技能，包括查看、创建、编辑、删除和上下架技能
- **用户角色**: 已登录用户
- **页面类型**: 管理页面

## 二、页面结构

### 2.1 顶部导航栏

```
[←]  我的技能                      [+ 发布]
```
- 返回按钮：左侧箭头图标
- 标题："我的技能"（居中，18pt）
- 发布按钮：右侧加号图标 + "发布"文字
- 高度：44px
- 底部分割线：1px 浅灰色

### 2.2 Tab导航栏

```
┌────────────────────────────────────────┐
│  [线上技能]  [线下技能]                │
└────────────────────────────────────────┘
```

**Tab样式:**
- 2个Tab：线上技能、线下技能
- 选中状态：紫色下划线，加粗
- 未选中：灰色文字

### 2.3 技能列表

**技能卡片:**
```
┌────────────────────────────────────────┐
│  [技能封面图]                    [•••]  │
│                                         │
│  技能名称                        [上架] │
│  ⭐⭐⭐⭐⭐ 5.0  (128条评价)           │
│  💰 ¥99/局  或  ¥99/小时              │
│                                         │
│  [编辑]                    [查看详情]  │
└────────────────────────────────────────┘
```

**封面图:**
- 宽度：100%，高度：200px
- 圆角：8px
- 支持点击查看大图

**更多按钮（•••）:**
- 位置：右上角
- 点击弹出操作菜单：
  - 删除技能

**上架/下架标签:**
- 上架：绿色标签，文字"上架"
- 下架：灰色标签，文字"下架"
- 点击可切换状态

**技能信息:**
- 技能名称：粗体，18pt
- 评分：星星图标 + 分数 + 评价数
- 价格：金额 + 单位（/局 或 /小时）

**操作按钮:**
- 编辑按钮：灰色边框，跳转到编辑页面
- 查看详情按钮：紫色边框，跳转到技能详情页

### 2.4 空状态

**无线上技能时:**
```
┌────────────────────────────────────────┐
│           🎮                            │
│      还没有发布线上技能                 │
│   发布你擅长的游戏技能，赚取收入！      │
│                                         │
│        [发布线上技能]                   │
└────────────────────────────────────────┘
```

**无线下技能时:**
```
┌────────────────────────────────────────┐
│           🛠                            │
│      还没有发布线下技能                 │
│   发布你的生活服务技能，帮助他人！      │
│                                         │
│        [发布线下技能]                   │
└────────────────────────────────────────┘
```

---

## 三、接口列表

### 3.1 获取技能列表

**接口:** `GET /api/user/skills`

**触发时机:** 页面加载时、切换Tab时

**请求头:**
```
Authorization: Bearer <token>
```

**请求参数:**
```typescript
{
  skillType?: "online" | "offline";  // 技能类型，不传则返回全部
  page: number;
  pageSize: number;
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    skills: Array<{
      skillId: string;
      skillName: string;
      skillType: "online" | "offline";
      coverImage: string;
      price: number;
      priceUnit: string;      // "局" or "小时"
      rating: number;         // 评分 0-5
      reviewCount: number;    // 评价数量
      isOnline: boolean;      // 是否上架
      createdAt: string;
      // 线上技能特有字段
      gameName?: string;
      gameRank?: string;
      // 线下技能特有字段
      serviceType?: string;
      location?: string;
    }>;
    total: number;
    hasMore: boolean;
  };
}
```

### 3.2 删除技能

**接口:** `DELETE /api/user/skills/{skillId}`

**触发时机:** 点击"删除"菜单项，确认后

**请求头:**
```
Authorization: Bearer <token>
```

**路径参数:**
- `skillId`: 技能ID

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: null;
}
```

### 3.3 切换技能上下架状态

**接口:** `PUT /api/user/skills/{skillId}/status`

**触发时机:** 点击上架/下架标签

**请求头:**
```
Authorization: Bearer <token>
```

**路径参数:**
- `skillId`: 技能ID

**请求参数:**
```typescript
{
  isOnline: boolean;  // true=上架，false=下架
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    isOnline: boolean;
  };
}
```

---

## 四、创建/编辑技能页面

### 4.1 选择技能类型（创建时）

**页面路由:** `/user/skills/create`

**选择界面:**
```
┌────────────────────────────────────────┐
│       选择技能类型                      │
│                                         │
│  ┌──────────────────────┐              │
│  │       🎮              │              │
│  │    线上技能           │              │
│  │  游戏陪玩、电竞教学   │              │
│  └──────────────────────┘              │
│                                         │
│  ┌──────────────────────┐              │
│  │       🛠              │              │
│  │    线下技能           │              │
│  │  生活服务、技能帮助   │              │
│  └──────────────────────┘              │
└────────────────────────────────────────┘
```

**点击卡片:**
- 线上技能：跳转到 `/user/skills/create/online`
- 线下技能：跳转到 `/user/skills/create/offline`

### 4.2 创建线上技能页面

**页面路由:** `/user/skills/create/online`

**表单结构:**
```
┌────────────────────────────────────────┐
│  [←]  发布线上技能               [保存] │
│                                         │
│  技能封面                               │
│  [点击上传封面图_______________]        │
│                                         │
│  游戏名称 *                             │
│  [请选择游戏______________ ▼]           │
│                                         │
│  游戏段位 *                             │
│  [请选择段位______________ ▼]           │
│                                         │
│  技能名称 *                             │
│  [请输入技能名称________________]       │
│                                         │
│  技能介绍 *                             │
│  [详细介绍你的技能...                   │
│   ___________________________           │
│   ___________________________]          │
│  0/500                                  │
│                                         │
│  价格设置 *                             │
│  [99________] 元/局                     │
│                                         │
│  服务时长 *                             │
│  [1.5________] 小时/局                  │
│                                         │
│  技能展示图（最多9张）                  │
│  [+] [图1] [图2]                        │
│                                         │
│  服务承诺                               │
│  ☑ 准时开始                            │
│  ☑ 耐心指导                            │
│  ☑ 友好交流                            │
│                                         │
│  接单设置                               │
│  立即上架 [开关]                        │
└────────────────────────────────────────┘
```

**字段说明:**

1. **技能封面** (必填)
   - 格式：JPG、PNG
   - 大小：< 5MB
   - 尺寸建议：16:9

2. **游戏名称** (必填)
   - 类型：下拉选择
   - 从游戏配置列表选择
   - 示例：王者荣耀、英雄联盟、和平精英

3. **游戏段位** (必填)
   - 类型：下拉选择
   - 根据选择的游戏动态加载段位列表
   - 示例：王者荣耀（青铜-王者）

4. **技能名称** (必填)
   - 类型：文本输入
   - 长度：2-50字符
   - 示例："王者荣耀上分带练"

5. **技能介绍** (必填)
   - 类型：多行文本
   - 长度：10-500字符
   - 说明：详细介绍技能、优势、服务内容

6. **价格设置** (必填)
   - 类型：数字输入
   - 单位：元/局
   - 范围：1-9999

7. **服务时长** (必填)
   - 类型：数字输入
   - 单位：小时/局
   - 范围：0.5-24

8. **技能展示图** (可选)
   - 数量：最多9张
   - 格式：JPG、PNG
   - 大小：< 5MB/张

9. **服务承诺** (可选)
   - 类型：多选
   - 可自定义承诺内容

10. **接单设置** (必填)
    - 立即上架：发布后立即可被预约
    - 暂不上架：发布后需手动上架

### 4.3 创建线下技能页面

**页面路由:** `/user/skills/create/offline`

**表单结构:**
```
┌────────────────────────────────────────┐
│  [←]  发布线下技能               [保存] │
│                                         │
│  技能封面                               │
│  [点击上传封面图_______________]        │
│                                         │
│  服务类型 *                             │
│  [请选择服务类型__________ ▼]           │
│                                         │
│  技能名称 *                             │
│  [请输入技能名称________________]       │
│                                         │
│  技能介绍 *                             │
│  [详细介绍你的技能...                   │
│   ___________________________           │
│   ___________________________]          │
│  0/500                                  │
│                                         │
│  价格设置 *                             │
│  [99________] 元/小时                   │
│                                         │
│  服务地点 *                             │
│  [请选择服务地点__________ 📍]          │
│                                         │
│  服务时间                               │
│  周一 [09:00-18:00] ☑                  │
│  周二 [09:00-18:00] ☑                  │
│  周三 [09:00-18:00] ☑                  │
│  周四 [09:00-18:00] ☑                  │
│  周五 [09:00-18:00] ☑                  │
│  周六 [09:00-18:00] ☑                  │
│  周日 [09:00-18:00] ☑                  │
│                                         │
│  技能展示图（最多9张）                  │
│  [+] [图1] [图2]                        │
│                                         │
│  服务承诺                               │
│  ☑ 上门服务                            │
│  ☑ 工具齐全                            │
│  ☑ 专业可靠                            │
│                                         │
│  接单设置                               │
│  立即上架 [开关]                        │
└────────────────────────────────────────┘
```

**字段说明:**

1. **服务类型** (必填)
   - 类型：下拉选择
   - 示例：家政服务、电器维修、电脑维修、摄影摄像、设计服务等

2. **服务地点** (必填)
   - 类型：地图选择
   - 支持当前位置或手动搜索

3. **服务时间** (必填)
   - 设置每天的可服务时间
   - 可按天勾选开关

---

## 五、数据流

### 页面加载流程
```
用户进入技能管理页面
  ↓
GET /api/user/skills
  ↓
默认显示"线上技能"Tab
  ↓
显示线上技能列表
```

### 创建技能流程
```
用户点击"+ 发布"按钮
  ↓
跳转到选择技能类型页面
  ↓
用户选择线上或线下技能
  ↓
跳转到对应的创建页面
  ↓
用户填写表单
  ↓
点击"保存"按钮
  ↓
前端验证表单
  ├─ 验证失败: 显示错误提示
  └─ 验证成功:
      ↓
      POST /api/user/skills/online 或 offline
      ↓
      成功:
        - 显示Toast "发布成功"
        - 返回技能管理页面
        - 刷新列表
      失败:
        - 显示错误提示
```

### 编辑技能流程
```
用户点击"编辑"按钮
  ↓
跳转到编辑页面
  - 线上技能: /user/skills/{skillId}/edit/online
  - 线下技能: /user/skills/{skillId}/edit/offline
  ↓
加载技能详情数据
  ↓
用户修改表单
  ↓
点击"保存"按钮
  ↓
PUT /api/user/skills/online/{skillId} 或 offline/{skillId}
  ↓
成功: 显示Toast "保存成功"，返回管理页面
失败: 显示错误提示
```

### 删除技能流程
```
用户点击"•••" → "删除"
  ↓
弹出确认对话框
  - 标题: "删除技能"
  - 内容: "确定删除【技能名称】吗？删除后将无法恢复"
  - 按钮: "取消" / "确定删除"
  ↓
用户点击"确定删除"
  ↓
DELETE /api/user/skills/{skillId}
  ↓
成功:
  - 从列表中移除该技能
  - 显示Toast "删除成功"
失败:
  - 显示错误提示
```

### 上下架切换流程
```
用户点击上架/下架标签
  ↓
立即切换UI状态（乐观更新）
  ↓
PUT /api/user/skills/{skillId}/status
  ↓
成功:
  - 保持UI状态
  - 显示Toast "已上架"或"已下架"
失败:
  - 恢复UI状态
  - 显示错误提示
```

---

## 六、状态管理

```typescript
interface SkillsManagePageState {
  // 当前Tab
  currentTab: 'online' | 'offline';

  // 技能列表
  skills: {
    data: Skill[];
    page: number;
    total: number;
    hasMore: boolean;
    isLoading: boolean;
  };

  // 删除确认对话框
  deleteDialog: {
    visible: boolean;
    skill: Skill | null;
    isDeleting: boolean;
  };

  // UI状态
  isRefreshing: boolean;
  error?: string;
}

interface Skill {
  skillId: string;
  skillName: string;
  skillType: "online" | "offline";
  coverImage: string;
  price: number;
  priceUnit: string;
  rating: number;
  reviewCount: number;
  isOnline: boolean;
  createdAt: string;
  // 线上技能
  gameName?: string;
  gameRank?: string;
  // 线下技能
  serviceType?: string;
  location?: string;
  isTogglingStatus?: boolean;
}

// 创建/编辑表单状态
interface SkillFormState {
  // 基本信息
  coverImage: string;
  skillName: string;
  description: string;
  price: number;
  images: string[];
  isOnline: boolean;

  // 线上技能
  onlineSkill?: {
    gameName: string;
    gameRank: string;
    serviceHours: number;  // 服务时长（小时/局）
  };

  // 线下技能
  offlineSkill?: {
    serviceType: string;
    location: {
      address: string;
      latitude: number;
      longitude: number;
    };
    availableTimes: Array<{
      dayOfWeek: number;  // 0-6 (周日-周六)
      startTime: string;  // "09:00"
      endTime: string;    // "18:00"
      enabled: boolean;
    }>;
  };

  // 服务承诺
  promises: string[];

  // 表单验证
  errors: {
    [field: string]: string;
  };

  // UI状态
  isSubmitting: boolean;
  isUploading: boolean;
}
```

---

## 七、前端验证

### 技能名称验证
```typescript
const validateSkillName = (name: string) => {
  if (name.length < 2 || name.length > 50) {
    return { valid: false, error: '技能名称长度为2-50字符' };
  }
  return { valid: true };
}
```

### 技能介绍验证
```typescript
const validateDescription = (desc: string) => {
  if (desc.length < 10 || desc.length > 500) {
    return { valid: false, error: '技能介绍长度为10-500字符' };
  }
  return { valid: true };
}
```

### 价格验证
```typescript
const validatePrice = (price: number) => {
  if (price < 1 || price > 9999) {
    return { valid: false, error: '价格范围为1-9999元' };
  }
  return { valid: true };
}
```

### 服务时长验证（线上技能）
```typescript
const validateServiceHours = (hours: number) => {
  if (hours < 0.5 || hours > 24) {
    return { valid: false, error: '服务时长范围为0.5-24小时' };
  }
  return { valid: true };
}
```

---

## 八、交互行为

### 8.1 列表操作

**点击技能卡片:**
1. 跳转到技能详情页
2. 路由: `/skills/{skillId}`

**点击编辑按钮:**
1. 跳转到编辑页面
2. 根据技能类型跳转到对应页面

**点击查看详情按钮:**
1. 跳转到技能详情页（前台展示）
2. 查看用户视角的技能页面

**点击上架/下架标签:**
1. 立即切换状态
2. 调用接口
3. 成功：显示Toast
4. 失败：恢复状态

**点击删除:**
1. 弹出确认对话框
2. 用户确认后删除
3. 成功：从列表移除
4. 失败：显示错误

### 8.2 创建/编辑表单操作

**上传封面图:**
1. 点击上传区域
2. 选择图片
3. 前端压缩（如果过大）
4. 上传到服务器
5. 显示上传进度
6. 成功：显示图片预览

**上传展示图:**
1. 支持多张图片
2. 最多9张
3. 可拖拽排序
4. 可删除

**表单提交:**
1. 前端验证所有必填项
2. 验证通过：调用接口
3. 显示提交加载状态
4. 成功：返回管理页面
5. 失败：显示错误，允许修改

---

## 九、测试要点

### 功能测试
- [ ] 技能列表正确加载
- [ ] Tab切换正常
- [ ] 创建线上技能成功
- [ ] 创建线下技能成功
- [ ] 编辑技能成功
- [ ] 删除技能成功
- [ ] 上下架切换成功
- [ ] 图片上传成功

### 边界测试
- [ ] 空列表显示正确
- [ ] 表单验证准确
- [ ] 图片格式验证
- [ ] 图片大小限制
- [ ] 价格范围验证
- [ ] 网络异常处理

### 用户体验测试
- [ ] 表单填写流畅
- [ ] 图片上传反馈清晰
- [ ] 删除确认明确
- [ ] 成功提示友好
- [ ] 错误提示准确

---

## 十、使用的后端服务

- **UserService** (用户服务)
  - `GET /api/user/skills` - 获取技能列表
  - `POST /api/user/skills/online` - 创建线上技能
  - `POST /api/user/skills/offline` - 创建线下技能
  - `PUT /api/user/skills/online/{skillId}` - 编辑线上技能
  - `PUT /api/user/skills/offline/{skillId}` - 编辑线下技能
  - `DELETE /api/user/skills/{skillId}` - 删除技能
  - `PUT /api/user/skills/{skillId}/status` - 切换上下架状态
  - `POST /api/skills/images/upload` - 上传技能图片
  - `GET /api/skills/config` - 获取技能配置（游戏列表、服务类型等）

---

## 十一、相关页面

- [01-个人主页页面](./01-个人主页页面.md) - 个人主页
- [07-技能预约订单页面](./07-技能预约订单页面.md) - 技能预约和订单

---

**使用后端服务:** UserService (user模块)
**最后更新:** 2025-11-14
