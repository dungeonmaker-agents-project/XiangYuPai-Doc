# 02-user模块 - 测试计划文档

> **版本**: 1.0.0
> **创建时间**: 2025-11-14
> **测试范围**: xypai-user微服务完整测试
> **测试环境**: 开发环境 (dev)

---

## 一、测试概述

### 1.1 测试目标

- 验证所有API接口功能正确性
- 验证数据库操作的准确性
- 验证RPC接口集成
- 验证缓存策略有效性
- 验证异常处理和错误码
- 验证性能指标

### 1.2 测试范围

| 模块 | API数量 | 覆盖度目标 |
|------|---------|-----------|
| 用户资料管理 | 12 | 100% |
| 社交关系 | 7 | 100% |
| 技能管理 | 10 | 100% |
| RPC接口 | 17 | 100% |
| **总计** | **46** | **100%** |

### 1.3 测试环境

```yaml
服务端口: 9401
数据库: xypai_user (MySQL 8.0)
Redis: localhost:6379 (db=1)
Nacos: localhost:8848
网关: localhost:8080
```

---

## 二、单元测试计划

### 2.1 Mapper层测试

#### 2.1.1 UserMapper测试

**测试文件**: `UserMapperTest.java`

```java
@SpringBootTest
class UserMapperTest {

    @Test
    void testSelectByMobile() {
        // Given
        String mobile = "13800138000";
        String countryCode = "+86";

        // When
        User user = userMapper.selectByMobile(mobile, countryCode);

        // Then
        assertNotNull(user);
        assertEquals(mobile, user.getMobile());
    }

    @Test
    void testFindNearbyUsers() {
        // Given
        BigDecimal latitude = new BigDecimal("23.1291");
        BigDecimal longitude = new BigDecimal("113.2644");
        int radiusMeters = 10000; // 10km

        // When
        List<User> users = userMapper.findNearbyUsers(latitude, longitude, radiusMeters, 10);

        // Then
        assertNotNull(users);
        assertTrue(users.size() <= 10);
    }

    @Test
    void testUpdateLastLoginInfo() {
        // Given
        Long userId = 1L;
        String loginIp = "192.168.1.1";

        // When
        int count = userMapper.updateLastLoginInfo(userId, loginIp);

        // Then
        assertEquals(1, count);
    }
}
```

**测试用例清单**:

| 用例ID | 测试方法 | 预期结果 |
|--------|----------|----------|
| UM-001 | testSelectByMobile | 返回正确用户 |
| UM-002 | testSelectByMobile_NotFound | 返回null |
| UM-003 | testFindNearbyUsers | 返回距离排序的用户列表 |
| UM-004 | testFindNearbyUsers_EmptyResult | 半径内无用户返回空列表 |
| UM-005 | testSelectBatchByIds | 批量查询正确 |
| UM-006 | testUpdateOnlineStatus | 更新成功 |
| UM-007 | testUpdateLastLoginInfo | 更新成功 |

#### 2.1.2 UserStatsMapper测试

**测试用例清单**:

| 用例ID | 测试方法 | 预期结果 |
|--------|----------|----------|
| USM-001 | testSelectByUserId | 返回用户统计 |
| USM-002 | testIncrementFollowingCount | 关注数+1 |
| USM-003 | testDecrementFollowingCount | 关注数-1 |
| USM-004 | testIncrementFansCount | 粉丝数+1 |
| USM-005 | testDecrementFansCount | 粉丝数-1 |
| USM-006 | testSelectBatchByUserIds | 批量查询统计 |

#### 2.1.3 UserRelationMapper测试

**测试用例清单**:

| 用例ID | 测试方法 | 预期结果 |
|--------|----------|----------|
| URM-001 | testSelectRelation | 查询关注关系 |
| URM-002 | testIsMutualFollow_True | 互相关注返回true |
| URM-003 | testIsMutualFollow_False | 非互关返回false |
| URM-004 | testSelectFans | 返回粉丝ID列表 |
| URM-005 | testSelectFollowing | 返回关注ID列表 |
| URM-006 | testSelectBatchRelations | 批量查询关注状态 |

#### 2.1.4 SkillMapper测试

**测试用例清单**:

| 用例ID | 测试方法 | 预期结果 |
|--------|----------|----------|
| SM-001 | testFindNearbySkills | 返回附近技能列表 |
| SM-002 | testSelectByUserId | 返回用户所有技能 |
| SM-003 | testSelectOnlineSkillsByUserId | 仅返回上架技能 |

### 2.2 Service层测试

#### 2.2.1 UserService测试

**测试文件**: `UserServiceTest.java`

```java
@SpringBootTest
class UserServiceTest {

    @MockBean
    private RedisUtils redisUtils;

    @Autowired
    private IUserService userService;

    @Test
    void testGetUserProfile_CacheHit() {
        // Given
        Long userId = 1L;
        UserProfileVo cachedVo = UserProfileVo.builder()
            .userId(userId)
            .nickname("TestUser")
            .build();
        when(redisUtils.getCacheObject(anyString())).thenReturn(cachedVo);

        // When
        R<UserProfileVo> result = userService.getUserProfile(userId);

        // Then
        assertTrue(result.isSuccess());
        assertEquals("TestUser", result.getData().getNickname());
        verify(redisUtils, times(1)).getCacheObject(anyString());
    }

    @Test
    void testUpdateNickname_Success() {
        // Given
        Long userId = 1L;
        UpdateNicknameDto dto = new UpdateNicknameDto();
        dto.setNickname("NewNickname");

        // When
        R<Void> result = userService.updateNickname(userId, dto);

        // Then
        assertTrue(result.isSuccess());
        verify(redisUtils, times(1)).deleteObject(anyString());
    }

    @Test
    void testCreateUser_Success() {
        // Given
        Long userId = 100L;
        String mobile = "13900139000";
        String countryCode = "+86";

        // When
        Long createdUserId = userService.createUser(userId, mobile, countryCode, "User100", null);

        // Then
        assertEquals(userId, createdUserId);
    }
}
```

**测试用例清单**:

| 用例ID | 测试方法 | 预期结果 |
|--------|----------|----------|
| US-001 | testGetUserProfile_CacheHit | 命中缓存，不查库 |
| US-002 | testGetUserProfile_CacheMiss | 未命中，查库并缓存 |
| US-003 | testGetUserProfile_NotFound | 返回失败响应 |
| US-004 | testGetOtherUserProfile_Blocked | 被拉黑返回403 |
| US-005 | testUpdateNickname_Success | 更新成功并清缓存 |
| US-006 | testUpdateGender_Success | 更新成功 |
| US-007 | testUpdateBirthday_Success | 更新成功 |
| US-008 | testUploadAvatar_Success | 上传成功返回URL |
| US-009 | testCreateUser_Success | 创建用户和统计记录 |
| US-010 | testUpdateLastLoginInfo_Success | 更新登录信息 |

#### 2.2.2 RelationService测试

**测试用例清单**:

| 用例ID | 测试方法 | 预期结果 |
|--------|----------|----------|
| RS-001 | testFollowUser_Success | 关注成功，统计+1 |
| RS-002 | testFollowUser_AlreadyFollowing | 返回已关注错误 |
| RS-003 | testFollowUser_FollowSelf | 返回不能关注自己 |
| RS-004 | testFollowUser_Blocked | 返回被拉黑错误 |
| RS-005 | testUnfollowUser_Success | 取消关注成功，统计-1 |
| RS-006 | testUnfollowUser_NotFollowing | 返回未关注错误 |
| RS-007 | testGetFansList_WithKeyword | 返回搜索结果 |
| RS-008 | testGetFollowingList_Empty | 返回空列表 |
| RS-009 | testBlockUser_Success | 拉黑成功，互相取关 |
| RS-010 | testBlockUser_BlockSelf | 返回不能拉黑自己 |
| RS-011 | testUnblockUser_Success | 取消拉黑成功 |
| RS-012 | testReportUser_Success | 举报成功 |
| RS-013 | testGetFollowStatus_None | 返回none |
| RS-014 | testGetFollowStatus_Following | 返回following |
| RS-015 | testGetFollowStatus_Mutual | 返回mutual |

#### 2.2.3 SkillService测试

**测试用例清单**:

| 用例ID | 测试方法 | 预期结果 |
|--------|----------|----------|
| SS-001 | testCreateSkill_OnlineSuccess | 创建线上技能成功 |
| SS-002 | testCreateSkill_OfflineSuccess | 创建线下技能成功 |
| SS-003 | testCreateSkill_WithImages | 创建技能并保存图片 |
| SS-004 | testUpdateSkill_Success | 更新技能成功 |
| SS-005 | testUpdateSkill_NotOwner | 返回无权限错误 |
| SS-006 | testDeleteSkill_Success | 删除成功 |
| SS-007 | testToggleSkillOnline_ToOnline | 上架成功 |
| SS-008 | testToggleSkillOnline_ToOffline | 下架成功 |
| SS-009 | testGetSkillDetail_Success | 返回完整详情 |
| SS-010 | testGetMySkills_WithPagination | 返回分页列表 |
| SS-011 | testSearchNearbySkills_Found | 返回附近技能 |
| SS-012 | testSearchNearbySkills_Empty | 返回空列表 |

---

## 三、集成测试计划

### 3.1 Controller层集成测试

#### 3.1.1 ProfileController测试

**测试文件**: `ProfileControllerTest.java`

```java
@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
class ProfileControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @Test
    @WithMockUser(userId = "1")
    void testGetProfileHeader_Success() throws Exception {
        mockMvc.perform(get("/api/user/profile/header")
                .header("Authorization", "Bearer test-token"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(200))
            .andExpect(jsonPath("$.data.userId").exists())
            .andExpect(jsonPath("$.data.nickname").exists())
            .andExpect(jsonPath("$.data.stats").exists());
    }

    @Test
    @WithMockUser(userId = "1")
    void testUpdateNickname_Success() throws Exception {
        String requestBody = """
            {
                "nickname": "NewNickname"
            }
            """;

        mockMvc.perform(put("/api/user/profile/nickname")
                .contentType(MediaType.APPLICATION_JSON)
                .header("Authorization", "Bearer test-token")
                .content(requestBody))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(200));
    }

    @Test
    @WithMockUser(userId = "1")
    void testUpdateNickname_ValidationFailed() throws Exception {
        String requestBody = """
            {
                "nickname": "A"
            }
            """;

        mockMvc.perform(put("/api/user/profile/nickname")
                .contentType(MediaType.APPLICATION_JSON)
                .header("Authorization", "Bearer test-token")
                .content(requestBody))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.code").value(400));
    }
}
```

**测试用例清单**:

| 用例ID | 接口 | 测试场景 | 预期结果 |
|--------|------|----------|----------|
| PC-001 | GET /api/user/profile/header | 获取个人主页头部 | 200 + 数据 |
| PC-002 | GET /api/user/profile/edit | 获取编辑数据 | 200 + 完整数据 |
| PC-003 | GET /api/user/profile/other/{userId} | 获取他人主页 | 200 + 隐私控制 |
| PC-004 | GET /api/user/profile/other/{userId} | 被拉黑 | 403 |
| PC-005 | PUT /api/user/profile/nickname | 更新昵称 - 成功 | 200 |
| PC-006 | PUT /api/user/profile/nickname | 昵称太短 | 400 |
| PC-007 | PUT /api/user/profile/nickname | 昵称太长 | 400 |
| PC-008 | PUT /api/user/profile/gender | 更新性别 - 成功 | 200 |
| PC-009 | PUT /api/user/profile/birthday | 更新生日 - 成功 | 200 |
| PC-010 | PUT /api/user/profile/height | 身高超范围 | 400 |
| PC-011 | PUT /api/user/profile/weight | 体重超范围 | 400 |
| PC-012 | POST /api/user/profile/avatar/upload | 上传头像 - 成功 | 200 + URL |
| PC-013 | POST /api/user/profile/avatar/upload | 文件过大 | 400 |

#### 3.1.2 RelationController测试

**测试用例清单**:

| 用例ID | 接口 | 测试场景 | 预期结果 |
|--------|------|----------|----------|
| RC-001 | POST /api/user/relation/follow/{id} | 关注用户 - 成功 | 200 |
| RC-002 | POST /api/user/relation/follow/{id} | 重复关注 | 400 |
| RC-003 | POST /api/user/relation/follow/{id} | 关注自己 | 400 |
| RC-004 | DELETE /api/user/relation/follow/{id} | 取消关注 - 成功 | 200 |
| RC-005 | GET /api/user/relation/fans | 获取粉丝列表 | 200 + 分页数据 |
| RC-006 | GET /api/user/relation/fans?keyword=test | 搜索粉丝 | 200 + 搜索结果 |
| RC-007 | GET /api/user/relation/following | 获取关注列表 | 200 + 分页数据 |
| RC-008 | POST /api/user/relation/block | 拉黑用户 - 成功 | 200 |
| RC-009 | DELETE /api/user/relation/block/{id} | 取消拉黑 - 成功 | 200 |
| RC-010 | POST /api/user/relation/report | 举报用户 - 成功 | 200 |

#### 3.1.3 SkillController测试

**测试用例清单**:

| 用例ID | 接口 | 测试场景 | 预期结果 |
|--------|------|----------|----------|
| SC-001 | POST /api/user/skill | 创建线上技能 | 200 + skillId |
| SC-002 | POST /api/user/skill | 创建线下技能 | 200 + skillId |
| SC-003 | POST /api/user/skill | 缺少必填字段 | 400 |
| SC-004 | PUT /api/user/skill/{id} | 更新技能 - 成功 | 200 |
| SC-005 | PUT /api/user/skill/{id} | 非所有者更新 | 403 |
| SC-006 | DELETE /api/user/skill/{id} | 删除技能 - 成功 | 200 |
| SC-007 | PUT /api/user/skill/{id}/toggle | 上架技能 | 200 |
| SC-008 | PUT /api/user/skill/{id}/toggle | 下架技能 | 200 |
| SC-009 | GET /api/user/skill/{id} | 获取技能详情 | 200 + 完整数据 |
| SC-010 | GET /api/user/skill/my | 获取我的技能 | 200 + 分页列表 |
| SC-011 | GET /api/user/skill/user/{userId} | 获取用户技能 | 200 + 仅上架 |
| SC-012 | GET /api/user/skill/nearby | 搜索附近技能 | 200 + 距离排序 |

### 3.2 RPC接口集成测试

#### 3.2.1 RemoteAppUserService测试

**测试文件**: `RemoteAppUserServiceTest.java`

```java
@SpringBootTest
class RemoteAppUserServiceTest {

    @DubboReference
    private RemoteAppUserService remoteAppUserService;

    @Test
    void testGetUserByMobile_Success() {
        // Given
        String mobile = "13800138000";
        String countryCode = "+86";

        // When
        AppLoginUser user = remoteAppUserService.getUserByMobile(mobile, countryCode);

        // Then
        assertNotNull(user);
        assertEquals(mobile, user.getMobile());
    }

    @Test
    void testGetUserByMobile_NotFound() {
        // Given
        String mobile = "99999999999";
        String countryCode = "+86";

        // When & Then
        assertThrows(UserException.class, () -> {
            remoteAppUserService.getUserByMobile(mobile, countryCode);
        });
    }

    @Test
    void testRegisterOrGetByMobile_NewUser() {
        // Given
        String mobile = "13900139999";
        String countryCode = "+86";

        // When
        AppLoginUser user = remoteAppUserService.registerOrGetByMobile(mobile, countryCode);

        // Then
        assertNotNull(user);
        assertTrue(user.getIsNewUser());
        assertEquals(mobile, user.getMobile());
    }

    @Test
    void testRegisterOrGetByMobile_ExistingUser() {
        // Given
        String mobile = "13800138000"; // 已存在
        String countryCode = "+86";

        // When
        AppLoginUser user = remoteAppUserService.registerOrGetByMobile(mobile, countryCode);

        // Then
        assertNotNull(user);
        assertFalse(user.getIsNewUser());
    }
}
```

**测试用例清单**:

| 用例ID | RPC方法 | 测试场景 | 预期结果 |
|--------|---------|----------|----------|
| RPC-001 | getUserByMobile | 用户存在 | 返回用户信息 |
| RPC-002 | getUserByMobile | 用户不存在 | 抛出UserException |
| RPC-003 | getUserById | 用户存在 | 返回用户信息 |
| RPC-004 | registerOrGetByMobile | 新用户注册 | isNewUser=true |
| RPC-005 | registerOrGetByMobile | 已存在用户 | isNewUser=false |
| RPC-006 | updateLastLoginInfo | 更新成功 | 返回true |
| RPC-007 | existsByMobile | 用户存在 | 返回true |
| RPC-008 | existsByMobile | 用户不存在 | 返回false |

---

## 四、性能测试计划

### 4.1 性能测试目标

| 指标 | 目标值 | 测试工具 |
|------|--------|----------|
| QPS - 获取用户信息 | ≥ 1000 | JMeter |
| QPS - 资料编辑 | ≥ 100 | JMeter |
| QPS - 关注操作 | ≥ 200 | JMeter |
| P95响应时间 - 用户信息 | < 100ms | JMeter |
| P95响应时间 - 资料编辑 | < 200ms | JMeter |
| 缓存命中率 | ≥ 85% | Redis Monitor |

### 4.2 性能测试场景

#### 4.2.1 获取用户信息压测

**JMeter配置**:
```
Thread Group:
  - Threads: 100
  - Ramp-up: 10s
  - Duration: 60s

HTTP Request:
  - Method: GET
  - Path: /api/user/profile/header
  - Headers: Authorization: Bearer ${token}

Assertions:
  - Response Code: 200
  - Response Time: < 100ms (95%)
```

#### 4.2.2 更新资料压测

**JMeter配置**:
```
Thread Group:
  - Threads: 50
  - Ramp-up: 10s
  - Duration: 60s

HTTP Request:
  - Method: PUT
  - Path: /api/user/profile/nickname
  - Body: {"nickname": "User${__Random(1,999999)}"}
```

#### 4.2.3 关注操作压测

**JMeter配置**:
```
Thread Group:
  - Threads: 100
  - Ramp-up: 10s
  - Duration: 60s

HTTP Request:
  - Method: POST
  - Path: /api/user/relation/follow/${__Random(1,10000)}
```

### 4.3 性能测试报告模板

```markdown
## 性能测试报告

### 测试环境
- CPU: 4核
- 内存: 8GB
- 数据库: MySQL 8.0
- Redis: 7.0

### 测试结果

| 接口 | 并发数 | QPS | P50 | P95 | P99 | 错误率 |
|------|--------|-----|-----|-----|-----|--------|
| GET /api/user/profile/header | 100 | 1250 | 65ms | 92ms | 120ms | 0.1% |
| PUT /api/user/profile/nickname | 50 | 125 | 120ms | 180ms | 250ms | 0.3% |
| POST /api/user/relation/follow | 100 | 230 | 80ms | 140ms | 200ms | 0.5% |

### 缓存性能
- 缓存命中率: 88.5%
- 平均响应时间（缓存命中）: 15ms
- 平均响应时间（缓存未命中）: 85ms

### 结论
✅ 所有指标达标
```

---

## 五、数据库测试计划

### 5.1 数据库完整性测试

**测试用例**:

| 用例ID | 测试项 | SQL | 预期结果 |
|--------|--------|-----|----------|
| DB-001 | 用户表主键 | `SELECT COUNT(*) FROM users WHERE user_id IS NULL` | 0 |
| DB-002 | 手机号唯一性 | `SELECT COUNT(*) - COUNT(DISTINCT mobile, country_code) FROM users` | 0 |
| DB-003 | 关注关系唯一性 | `SELECT COUNT(*) - COUNT(DISTINCT follower_id, following_id) FROM user_relations` | 0 |
| DB-004 | 软删除索引 | `SHOW INDEX FROM users WHERE Column_name='deleted'` | 存在 |
| DB-005 | 空间索引 | `SHOW INDEX FROM skills WHERE Index_type='SPATIAL'` | 存在 |
| DB-006 | 外键约束 | `SELECT * FROM user_stats WHERE user_id NOT IN (SELECT user_id FROM users)` | 0 |

### 5.2 数据库性能测试

**测试用例**:

| 用例ID | 测试项 | SQL | 性能目标 |
|--------|--------|-----|----------|
| DBP-001 | 用户查询 | `SELECT * FROM users WHERE mobile=? AND country_code=?` | < 10ms |
| DBP-002 | 附近用户查询 | `SELECT ... ST_Distance_Sphere(...)` | < 50ms |
| DBP-003 | 关注列表查询 | `SELECT ... FROM user_relations WHERE follower_id=?` | < 20ms |
| DBP-004 | 技能列表查询 | `SELECT * FROM skills WHERE user_id=?` | < 15ms |

---

## 六、缓存测试计划

### 6.1 缓存功能测试

**测试用例**:

| 用例ID | 测试场景 | 操作步骤 | 预期结果 |
|--------|----------|----------|----------|
| CACHE-001 | 首次查询用户信息 | 1. 清空缓存<br>2. 查询用户 | Redis中新增缓存 |
| CACHE-002 | 缓存命中 | 1. 查询用户<br>2. 再次查询 | 第二次从缓存读取 |
| CACHE-003 | 更新后缓存失效 | 1. 查询用户<br>2. 更新昵称<br>3. 再次查询 | 缓存已清除并重建 |
| CACHE-004 | 缓存过期 | 1. 查询用户<br>2. 等待31分钟<br>3. 再次查询 | 缓存已过期，重新查询 |

### 6.2 缓存性能测试

**测试指标**:

```bash
# Redis监控命令
redis-cli --stat

# 查看缓存命中率
redis-cli INFO stats | grep keyspace_hits

# 计算命中率
命中率 = keyspace_hits / (keyspace_hits + keyspace_misses) * 100%
```

---

## 七、安全测试计划

### 7.1 认证授权测试

**测试用例**:

| 用例ID | 测试场景 | 预期结果 |
|--------|----------|----------|
| SEC-001 | 无Token访问 | 401 Unauthorized |
| SEC-002 | 错误Token访问 | 401 Unauthorized |
| SEC-003 | 过期Token访问 | 401 Unauthorized |
| SEC-004 | Token正确访问 | 200 OK |
| SEC-005 | 访问他人资料（已拉黑） | 403 Forbidden |

### 7.2 数据验证测试

**测试用例**:

| 用例ID | 测试场景 | 输入数据 | 预期结果 |
|--------|----------|----------|----------|
| VAL-001 | 昵称长度验证 | "A" | 400 + 错误信息 |
| VAL-002 | 身高范围验证 | 300 | 400 + 错误信息 |
| VAL-003 | 微信号格式验证 | "abc" | 400 + 错误信息 |
| VAL-004 | SQL注入测试 | "'; DROP TABLE users; --" | 400 + 参数错误 |
| VAL-005 | XSS测试 | "<script>alert('XSS')</script>" | 转义后保存 |

---

## 八、测试数据准备

### 8.1 测试用户数据

```sql
-- 插入测试用户
INSERT INTO users (user_id, mobile, country_code, nickname, avatar, is_online) VALUES
(1, '13800138000', '+86', 'TestUser1', 'https://cdn.test.com/avatar1.jpg', true),
(2, '13800138001', '+86', 'TestUser2', 'https://cdn.test.com/avatar2.jpg', false),
(3, '13800138002', '+86', 'TestUser3', 'https://cdn.test.com/avatar3.jpg', true);

-- 插入用户统计
INSERT INTO user_stats (user_id, following_count, fans_count, likes_count) VALUES
(1, 10, 20, 100),
(2, 5, 15, 50),
(3, 8, 12, 80);

-- 插入关注关系
INSERT INTO user_relations (follower_id, following_id) VALUES
(1, 2),
(1, 3),
(2, 1);
```

### 8.2 测试技能数据

```sql
-- 插入线上技能
INSERT INTO skills (user_id, skill_type, skill_name, description, price, price_unit,
                    game_name, game_rank, service_hours, is_online) VALUES
(1, 'online', '王者荣耀陪玩', '擅长打野和中路', 30.00, '局', '王者荣耀', '王者50星', 2.0, true);

-- 插入线下技能
INSERT INTO skills (user_id, skill_type, skill_name, description, price, price_unit,
                    service_type, service_location, latitude, longitude, is_online) VALUES
(1, 'offline', '摄影服务', '商业摄影、婚纱摄影', 500.00, '小时', '摄影服务',
 '广东省广州市天河区', 23.1291, 113.2644, true);
```

---

## 九、测试执行计划

### 9.1 测试阶段

| 阶段 | 时间 | 测试类型 | 负责人 |
|------|------|----------|--------|
| 第1天 | Day 1 | 单元测试 - Mapper | Backend Team |
| 第2天 | Day 2 | 单元测试 - Service | Backend Team |
| 第3天 | Day 3 | 集成测试 - Controller | Backend + QA |
| 第4天 | Day 4 | RPC接口测试 | Backend + Auth Team |
| 第5天 | Day 5 | 性能测试 | QA Team |
| 第6天 | Day 6 | 安全测试 | Security Team |
| 第7天 | Day 7 | 回归测试 | Full Team |

### 9.2 测试报告

每日测试完成后提交测试报告：

```markdown
# 测试日报 - Day X

## 测试进度
- 计划用例数: 50
- 已执行: 45
- 通过: 42
- 失败: 3
- 跳过: 5

## 失败用例
1. **TC-XXX**: 描述
   - 失败原因: ...
   - 修复负责人: ...
   - 预计修复时间: ...

## 风险
- ...

## 明日计划
- ...
```

---

## 十、测试工具

### 10.1 工具清单

| 工具 | 用途 | 版本 |
|------|------|------|
| JUnit 5 | 单元测试 | 5.9.x |
| Mockito | Mock框架 | 4.x |
| Spring Boot Test | 集成测试 | 3.2.x |
| JMeter | 性能测试 | 5.5 |
| Postman | API测试 | Latest |
| Redis Commander | Redis监控 | - |
| MySQL Workbench | 数据库测试 | 8.0 |

### 10.2 测试环境配置

```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/xypai_user_test
    username: test_user
    password: test_pass

  data:
    redis:
      host: localhost
      port: 6379
      database: 2  # 测试专用DB

logging:
  level:
    org.dromara.user: debug
```

---

## 十一、验收标准

### 11.1 功能验收

- ✅ 所有单元测试通过率 ≥ 95%
- ✅ 所有集成测试通过率 ≥ 90%
- ✅ RPC接口测试通过率 = 100%
- ✅ 无P0/P1级别Bug

### 11.2 性能验收

- ✅ QPS达到设计目标
- ✅ P95响应时间 < 设计目标
- ✅ 缓存命中率 ≥ 85%
- ✅ 数据库慢查询数 = 0

### 11.3 安全验收

- ✅ 所有接口需Token认证
- ✅ 参数验证完整
- ✅ SQL注入测试通过
- ✅ XSS防御测试通过

---

## 十二、附录

### 附录A: 测试数据清理脚本

```sql
-- 清理测试数据
DELETE FROM users WHERE mobile LIKE '139%';
DELETE FROM user_stats WHERE user_id IN (SELECT user_id FROM users WHERE mobile LIKE '139%');
DELETE FROM user_relations WHERE follower_id > 1000;
DELETE FROM skills WHERE user_id > 1000;
```

### 附录B: 性能测试脚本

见 `/tests/performance/` 目录

### 附录C: 自动化测试CI配置

```yaml
# .github/workflows/test.yml
name: User Service Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: '17'
      - name: Run tests
        run: mvn clean test
      - name: Generate coverage report
        run: mvn jacoco:report
```

---

**文档版本**: 1.0.0
**创建时间**: 2025-11-14
**最后更新**: 2025-11-14
**维护人**: QA Team
