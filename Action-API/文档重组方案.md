# API文档重组方案

## 概述
将现有的 Home 模块文档重组为两个并行的文档体系:
1. **Frontend/** - 按页面组织,供前端开发使用
2. **Backend/** - 按微服务组织,供后端开发使用

---

## 一、前端文档结构 (按页面)

### Frontend/Home/ - 首页相关页面

```
Frontend/
└── Home/
    ├── 01-首页Feed流页面.md
    ├── 02-筛选页面.md
    ├── 03-区域选择页面.md
    ├── 04-城市定位页面.md
    ├── 05-限时专享页面.md
    ├── 06-搜索页面.md
    ├── 07-搜索结果页面.md
    ├── 08-组局中心列表页面.md
    ├── 09-组局详情页面.md
    ├── 10-发布组局页面.md
    ├── 11-服务列表页面.md
    ├── 12-服务详情页面.md
    ├── 13-确认订单页面.md
    ├── 14-支付页面.md
    ├── 15-支付成功页面.md
    └── 16-订单详情页面.md
```

### 每个前端文档包含:
1. **页面概述**: 页面功能和用户操作流程
2. **页面UI结构**: 布局和组件说明
3. **接口列表**: 该页面使用的所有API
4. **数据流**: 页面加载、用户操作、数据更新流程
5. **状态管理**: 页面级和全局状态
6. **路由参数**: 进入该页面的参数和跳转目标
7. **错误处理**: 页面级异常处理
8. **测试要点**: 该页面的测试清单

---

## 二、后端文档结构 (按微服务)

### Backend/ - 按微服务组织

```
Backend/
├── Common/
│   └── 通用服务接口文档.md           [CommonService]
├── Home/
│   └── 首页服务接口文档.md            [HomeService]
├── Location/
│   └── 位置服务接口文档.md            [LocationService]
├── Search/
│   └── 搜索服务接口文档.md            [SearchService]
├── Activity/
│   └── 活动服务接口文档.md            [ActivityService]
├── Service/
│   └── 技能服务接口文档.md            [ServiceService]
├── Order/
│   └── 订单服务接口文档.md            [OrderService]
├── Payment/
│   └── 支付服务接口文档.md            [PaymentService]
└── User/
    └── 用户服务接口文档.md            [UserService]
```

### 每个后端文档包含:
1. **服务概述**: 服务职责和业务边界
2. **接口列表**: 该服务提供的所有API
3. **数据模型**: 实体定义和数据库表结构
4. **业务规则**: 业务逻辑和验证规则
5. **依赖服务**: 调用的其他微服务(RPC/Feign)
6. **性能要求**: QPS、响应时间等
7. **缓存策略**: Redis缓存设计
8. **监控告警**: 关键指标和告警规则

---

## 三、API映射关系

### 3.1 前端页面 → 后端服务映射

| 前端页面 | 使用的后端服务 | 主要接口数量 |
|---------|--------------|------------|
| 01-首页Feed流页面 | HomeService, UserService | 3 APIs |
| 02-筛选页面 | HomeService | 3 APIs |
| 03-区域选择页面 | LocationService | 2 APIs |
| 04-城市定位页面 | LocationService | 3 APIs |
| 05-限时专享页面 | HomeService, LocationService | 2 APIs |
| 06-搜索页面 | SearchService | 2 APIs |
| 07-搜索结果页面 | SearchService, UserService | 6 APIs |
| 08-组局中心列表页面 | ActivityService | 2 APIs |
| 09-组局详情页面 | ActivityService | 2 APIs |
| 10-发布组局页面 | ActivityService, CommonService, PaymentService | 4 APIs |
| 11-服务列表页面 | ServiceService | 2 APIs |
| 12-服务详情页面 | ServiceService | 2 APIs |
| 13-确认订单页面 | OrderService | 2 APIs |
| 14-支付页面 | PaymentService, OrderService | 3 APIs |
| 15-支付成功页面 | OrderService | 1 API |
| 16-订单详情页面 | OrderService | 2 APIs |

### 3.2 后端服务接口清单

#### CommonService (通用服务) - 可被远程调用
```
POST   /api/common/upload/image           图片上传
POST   /api/common/upload/video           视频上传
GET    /api/common/config                 获取配置
```

#### HomeService (首页服务)
```
GET    /api/home/feed                     获取首页Feed流
GET    /api/home/tabs                     获取Tab配置
GET    /api/home/filter/config            获取筛选配置
POST   /api/home/filter/apply             应用筛选
GET    /api/home/filter/results           获取筛选结果
GET    /api/home/limited-time/list        获取限时专享列表
```

#### LocationService (位置服务) - 可被远程调用
```
GET    /api/location/districts            获取区域列表
POST   /api/location/district/select      选择区域
GET    /api/location/cities               获取城市列表
POST   /api/location/detect               GPS定位
POST   /api/location/city/select          选择城市
```

#### SearchService (搜索服务)
```
GET    /api/search/init                   初始化搜索
GET    /api/search/suggest                搜索建议
POST   /api/search/search                 执行搜索
GET    /api/search/all                    全部结果
GET    /api/search/users                  用户结果
GET    /api/search/orders                 下单结果
GET    /api/search/topics                 话题结果
DELETE /api/search/history                删除历史
```

#### ActivityService (活动服务)
```
GET    /api/activity/list                 活动列表
GET    /api/activity/publish/config       发布配置
POST   /api/activity/publish              发布活动
GET    /api/activity/detail               活动详情
POST   /api/activity/register             报名参加
POST   /api/activity/register/cancel      取消报名
POST   /api/activity/registration/approve 审核报名
POST   /api/activity/share                分享活动
```

#### ServiceService (技能服务)
```
GET    /api/service/list                  服务列表
GET    /api/service/detail                服务详情
GET    /api/service/reviews               评价列表
POST   /api/service/review/submit         提交评价 (需新增)
```

#### OrderService (订单服务)
```
GET    /api/order/preview                 订单预览
POST   /api/order/preview/update          更新预览
POST   /api/order/create                  创建订单
GET    /api/order/detail                  订单详情
GET    /api/order/status                  订单状态
POST   /api/order/cancel                  取消订单
```

#### PaymentService (支付服务) - 可被远程调用
```
POST   /api/order/pay                     执行支付
POST   /api/order/pay/verify              验证支付密码
POST   /api/activity/publish/pay          发布活动支付
POST   /api/activity/register/pay         报名支付
GET    /api/payment/methods               获取支付方式
GET    /api/wallet/balance                获取余额
```

#### UserService (用户服务) - 可被远程调用
```
POST   /api/user/follow                   关注/取关
GET    /api/user/profile                  用户资料 (需新增)
GET    /api/user/posts                    用户动态 (需新增)
GET    /api/user/followers                粉丝列表 (需新增)
GET    /api/user/following                关注列表 (需新增)
```

---

## 四、文档模板

### 4.1 前端文档模板

```markdown
# [页面名称]

## 一、页面概述
- **路由路径**: /path/to/page
- **页面功能**: 简要描述
- **用户角色**: 游客/登录用户/VIP
- **进入方式**: 从哪里可以进入此页面

## 二、页面UI结构
- 顶部导航
- 主要内容区
- 底部操作栏
- 弹窗/模态框

## 三、接口列表
### 3.1 页面加载时调用
1. GET /api/xxx - 功能描述
2. GET /api/yyy - 功能描述

### 3.2 用户操作触发
1. POST /api/zzz - 功能描述
   - **触发时机**: 点击按钮时
   - **参数**: {...}
   - **响应**: {...}
   - **后续操作**: 刷新列表/跳转页面

## 四、数据流
1. **初始加载**: 页面mount → 调用API → 渲染数据
2. **用户操作**: 点击 → 验证 → 调用API → 更新UI
3. **分页加载**: 滚动 → 检测 → 调用API → 追加数据

## 五、状态管理
- **页面状态**: loading, error, data
- **全局状态**: userInfo, location, filters
- **缓存策略**: 哪些数据需要缓存

## 六、路由参数
### 进入参数
- `id`: 实体ID
- `from`: 来源页面

### 跳转目标
- 点击卡片 → 详情页
- 点击按钮 → 确认页

## 七、错误处理
- 网络错误: 显示重试按钮
- 数据为空: 显示空状态
- 权限不足: 跳转登录

## 八、测试要点
- [ ] 页面正常加载
- [ ] 所有接口正常调用
- [ ] 用户操作响应正确
- [ ] 边界条件处理
```

### 4.2 后端文档模板

```markdown
# [服务名称]Service

## 一、服务概述
- **服务职责**: 核心业务功能
- **技术栈**: Spring Boot / Node.js / Go
- **端口**: 8001
- **数据库**: MySQL / MongoDB

## 二、接口列表
### 2.1 对外API
[方法] [路径] - [功能描述]

### 2.2 内部RPC (供其他服务调用)
[方法] [路径] - [功能描述]

## 三、接口详细定义
### 接口名称
**请求:**
```typescript
{
  参数定义
}
```

**响应:**
```typescript
{
  响应定义
}
```

**业务规则:**
- 规则1
- 规则2

## 四、数据模型
### 实体1
```sql
CREATE TABLE xxx (
  id BIGINT PRIMARY KEY,
  ...
)
```

## 五、依赖服务
- UserService.getProfile() - 获取用户信息
- PaymentService.createPayment() - 创建支付

## 六、性能要求
- QPS: 1000
- 响应时间: <200ms
- 可用性: 99.9%

## 七、缓存策略
- Redis缓存: key设计, 过期时间
- 本地缓存: Caffeine配置

## 八、监控告警
- 接口成功率 < 99% 告警
- 响应时间 > 500ms 告警
- 错误日志关键字告警
```

---

## 五、重组步骤

### Phase 1: 创建新文档结构 ✅
```bash
mkdir Frontend Frontend/Home
mkdir Backend Backend/{Common,Home,Location,Search,Activity,Service,Order,Payment,User}
```

### Phase 2: 提取前端文档
从现有6个文档中提取页面级文档:

**来源: 首页接口文档.md**
→ 01-首页Feed流页面.md

**来源: 首页筛选功能接口文档.md**
→ 02-筛选页面.md

**来源: 首页区域定位与限时专享接口文档.md**
→ 03-区域选择页面.md
→ 04-城市定位页面.md
→ 05-限时专享页面.md

**来源: 首页搜索功能接口文档.md**
→ 06-搜索页面.md
→ 07-搜索结果页面.md

**来源: 组局中心接口文档.md**
→ 08-组局中心列表页面.md
→ 09-组局详情页面.md
→ 10-发布组局页面.md

**来源: 技能服务下单接口文档.md**
→ 11-服务列表页面.md
→ 12-服务详情页面.md
→ 13-确认订单页面.md
→ 14-支付页面.md
→ 15-支付成功页面.md
→ 16-订单详情页面.md

### Phase 3: 创建后端文档
按微服务重新组织接口:

**CommonService**
- 图片上传
- 视频上传
- 配置管理

**HomeService**
- Feed流
- 筛选
- 限时专享

**LocationService**
- 区域选择
- 城市定位
- GPS定位

**SearchService**
- 搜索初始化
- 搜索建议
- 搜索执行
- 结果分类

**ActivityService**
- 活动列表
- 活动详情
- 发布活动
- 报名管理

**ServiceService**
- 服务列表
- 服务详情
- 评价管理

**OrderService**
- 订单创建
- 订单管理
- 订单状态

**PaymentService**
- 支付执行
- 密码验证
- 余额管理

**UserService**
- 关注管理
- 用户资料
- 关系管理

### Phase 4: 保留原始文档
```
mkdir _Original_Home_Docs
mv Home/*.md _Original_Home_Docs/
```

---

## 六、重组后的目录结构

```
Action-API/
├── 文档重组方案.md                    (本文档)
├── 接口文档编写模板与规范.md          (保留)
├── Frontend/                          (新增 - 前端文档)
│   └── Home/
│       ├── 01-首页Feed流页面.md
│       ├── 02-筛选页面.md
│       ├── 03-区域选择页面.md
│       ├── 04-城市定位页面.md
│       ├── 05-限时专享页面.md
│       ├── 06-搜索页面.md
│       ├── 07-搜索结果页面.md
│       ├── 08-组局中心列表页面.md
│       ├── 09-组局详情页面.md
│       ├── 10-发布组局页面.md
│       ├── 11-服务列表页面.md
│       ├── 12-服务详情页面.md
│       ├── 13-确认订单页面.md
│       ├── 14-支付页面.md
│       ├── 15-支付成功页面.md
│       └── 16-订单详情页面.md
├── Backend/                           (新增 - 后端文档)
│   ├── Common/
│   │   └── 通用服务接口文档.md
│   ├── Home/
│   │   └── 首页服务接口文档.md
│   ├── Location/
│   │   └── 位置服务接口文档.md
│   ├── Search/
│   │   └── 搜索服务接口文档.md
│   ├── Activity/
│   │   └── 活动服务接口文档.md
│   ├── Service/
│   │   └── 技能服务接口文档.md
│   ├── Order/
│   │   └── 订单服务接口文档.md
│   ├── Payment/
│   │   └── 支付服务接口文档.md
│   └── User/
│       └── 用户服务接口文档.md
└── _Original_Home_Docs/               (备份原始文档)
    ├── 首页接口文档.md
    ├── 首页筛选功能接口文档.md
    ├── 首页区域定位与限时专享接口文档.md
    ├── 首页搜索功能接口文档.md
    ├── 组局中心接口文档.md
    └── 技能服务下单接口文档.md
```

---

## 七、使用说明

### 前端开发团队:
1. 打开 `Frontend/Home/` 文件夹
2. 找到要开发的页面文档(如: `11-服务列表页面.md`)
3. 阅读该文档,了解:
   - 页面UI结构
   - 需要调用的所有API
   - 数据流和状态管理
   - 路由和参数传递
4. 按文档实现该页面的所有功能

### 后端开发团队:
1. 打开 `Backend/` 文件夹
2. 找到要开发的微服务文档(如: `Service/技能服务接口文档.md`)
3. 阅读该文档,了解:
   - 服务职责和边界
   - 所有API接口定义
   - 数据模型和业务规则
   - 依赖的其他服务(RPC调用)
4. 实现该微服务的所有接口

### 远程调用(RPC):
某些服务标记为"可被远程调用",如:
- **CommonService**: 图片上传 (所有服务都可能需要)
- **LocationService**: 位置信息 (Feed流、搜索、活动等都需要)
- **PaymentService**: 支付功能 (订单、活动等都需要)
- **UserService**: 用户信息 (几乎所有服务都需要)

---

## 八、优势总结

### 前端视角:
✅ 按页面组织,符合前端开发流程
✅ 一个文档对应一个页面组件,清晰明确
✅ 包含完整的用户操作流程和UI交互
✅ 减少跨文档查找接口的时间

### 后端视角:
✅ 按微服务组织,符合后端架构
✅ 一个文档对应一个微服务,便于团队分工
✅ 明确服务边界和依赖关系
✅ 便于RPC接口管理和版本控制

### 团队协作:
✅ 前后端文档完全解耦,各自独立维护
✅ 接口契约清晰,减少沟通成本
✅ 新成员快速上手,文档即教程
✅ 测试团队可同时参考两套文档

---

## 九、下一步行动

1. ✅ 确认重组方案
2. 📝 创建文档目录结构
3. ✍️ 编写前端文档(16个页面)
4. ✍️ 编写后端文档(9个微服务)
5. 🔍 交叉验证接口一致性
6. 📋 更新团队开发规范
7. 🎓 组织文档培训会

---

**等待确认: 是否按此方案开始重组文档?**
