# 首页模块接口文档

## 概述
本文档定义首页模块的所有接口，包括用户操作触发时机和前端参数要求。

---

## 一、首页初始化加载

### 用户操作
1. 用户打开App或切换到首页Tab
2. **系统加载首页数据** → 触发接口

### 接口定义
**接口:** `GET /api/home/init`

**参数:**
```typescript
{
  // 无参数，从token获取当前用户ID
}
```

**响应数据:**
```typescript
{
  userInfo: {
    userId: number;
    avatar: string;           // 左上角头像
    unreadCount: number;      // 右上角消息未读数
  };
  banner: {
    imageUrl: string;         // Banner图片URL
    linkType?: 'webview' | 'native';
    linkUrl?: string;         // 点击跳转链接
  };
  quickEntries: Array<{       // 快捷入口（签到、电竞赛事等）
    icon: string;
    title: string;
    linkUrl: string;
  }>;
  giftItems: Array<{          // 横向滚动的礼物/道具
    icon: string;
    name?: string;
  }>;
}
```

### 前端行为
- 显示用户头像和未读消息数
- 展示Banner图片
- 显示快捷入口图标行
- 显示礼物道具横向滚动列表

---

## 二、明日专家推荐

### 用户操作
1. 首页加载后自动展示"明日专家"模块
2. **系统加载专家列表** → 触发接口

### 接口定义
**接口:** `GET /api/home/experts`

**参数:**
```typescript
{
  // 无参数
}
```

**响应数据:**
```typescript
{
  title: string;              // 模块标题（如：明日专家）
  tag?: string;               // 标签（如：HOT推广中）
  experts: Array<{
    userId: number;
    avatar: string;
    label: string;            // 标签（如：明日23）
  }>;
}
```

### 前端行为
- 横向滚动展示专家卡片
- 显示"HOT推广中"标签（如果有）
- 点击专家卡片跳转至用户主页

---

## 三、你什么名模块

### 用户操作
1. 首页滚动至"你什么名"模块
2. **系统加载模块内容** → 触发接口

### 接口定义
**接口:** `GET /api/home/topic-banner`

**参数:**
```typescript
{
  // 无参数
}
```

**响应数据:**
```typescript
{
  title: string;              // 模块标题（如：你什么名）
  bannerImage: string;        // Banner图片URL
  linkUrl?: string;           // 点击跳转链接
}
```

### 前端行为
- 显示模块标题
- 显示Banner图片
- 点击Banner跳转至对应页面

---

## 四、内容Feed流

### 用户操作
1. 首页加载完成后自动展示内容流
2. 下拉刷新或上拉加载更多
3. **系统加载内容列表** → 触发接口

### 接口定义
**接口:** `GET /api/home/feed`

**参数:**
```typescript
{
  pageNum: number;            // 页码（从1开始）
  pageSize: number;           // 每页数量（建议10）
}
```

**响应数据:**
```typescript
{
  total: number;
  hasMore: boolean;
  list: Array<{
    postId: number;
    author: {
      userId: number;
      avatar: string;
      nickname: string;       // 如：昵称屑屑123
      tags?: string[];        // 用户标签
    };
    description: string;      // 描述文字（如：明天见，两个相机开播加油！）
    thumbnails: string[];     // 缩略图列表（最多3张）
    mediaType: 'image' | 'video';
    location?: string;        // 发布地点（如：舞厅1号台）
    additionalInfo?: string;  // 附加信息（如：查看他的信息）
  }>;
}
```

### 前端验证
- pageNum ≥ 1
- pageSize 范围：5-20

### 前端行为
- 首次加载：pageNum=1
- 下拉刷新：重置pageNum=1，清空列表
- 上拉加载：pageNum递增，追加列表
- 无更多数据时：显示"已经到底了~"
- 每个内容显示：头像、昵称、描述、3张缩略图、位置信息

---

## 五、搜索

### 用户操作
1. 用户点击顶部搜索栏
2. **系统跳转至搜索页** → 触发接口（搜索接口在"搜索模块"文档中定义）

### 前端行为
- 点击搜索框跳转至搜索页面
- 不在首页触发搜索接口

---

## 六、查看消息通知

### 用户操作
1. 用户点击右上角消息图标
2. **系统跳转至消息页** → 触发接口（消息接口在"消息模块"文档中定义）

### 前端行为
- 显示未读消息数角标
- 点击跳转至消息列表页

---

## 七、点击用户头像

### 用户操作
1. 用户点击左上角个人头像
2. **系统跳转至个人主页** → 触发接口（接口在"用户主页模块"文档中定义）

### 前端行为
- 点击跳转至当前用户的个人主页

---

## 八、点击内容卡片

### 用户操作
1. 用户点击Feed流中的内容卡片
2. **系统跳转至内容详情页** → 触发接口（接口在"内容详情模块"文档中定义）

### 前端行为
- 点击内容卡片跳转至详情页
- 传递postId参数

---

## 九、点击快捷入口

### 用户操作
1. 用户点击快捷入口（如：签到、电竞赛事等）
2. **系统执行跳转** → 根据配置跳转不同页面

### 签到功能
**用户操作：** 点击"签到"图标

**接口:** `POST /api/user/check-in`

**参数:**
```typescript
{
  // 无参数，从token获取用户ID
}
```

**响应数据:**
```typescript
{
  success: boolean;
  todayChecked: boolean;      // 今日是否已签到
  continuousDays: number;     // 连续签到天数
  reward?: {
    type: 'points' | 'coins';
    amount: number;
  };
}
```

**前端验证：**
- 需要登录状态

**前端行为：**
- 成功后显示签到成功提示
- 显示奖励信息
- 已签到则提示"今日已签到"

### 其他快捷入口
- **电竞赛事** → 跳转至电竞赛事页面
- **电竞资料** → 跳转至电竞资料页面
- 其他入口根据配置跳转

---

## 十、点击Banner

### 用户操作
1. 用户点击顶部Banner图片
2. **系统执行跳转** → 根据linkType跳转

### 前端行为
- linkType为'webview'：打开内置浏览器
- linkType为'native'：跳转至指定原生页面
- 无linkUrl则不响应点击

---

## 十一、下拉刷新

### 用户操作
1. 用户在首页下拉屏幕
2. **系统刷新首页数据** → 重新触发初始化接口

### 涉及接口
- `GET /api/home/init` - 刷新首页基础数据
- `GET /api/home/experts` - 刷新专家推荐
- `GET /api/home/topic-banner` - 刷新你什么名模块
- `GET /api/home/feed` - 刷新内容流（pageNum=1）

### 前端行为
- 显示下拉刷新动画
- 并发请求所有接口
- 全部完成后关闭动画
- 列表滚动回顶部

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 首页初始化 | 打开首页 | `/api/home/init` | GET |
| 2 | 明日专家 | 加载首页 | `/api/home/experts` | GET |
| 3 | 你什么名 | 加载首页 | `/api/home/topic-banner` | GET |
| 4 | 内容Feed流 | 打开首页/上拉 | `/api/home/feed` | GET |
| 5 | 签到 | 点击签到按钮 | `/api/user/check-in` | POST |

---

## 通用验证规则

### 登录状态
签到操作需要用户登录状态，未登录时：
- 弹出提示："请先登录"
- 跳转至登录页

### 分页加载
内容Feed流：
- 首屏：pageNum=1, pageSize=10
- 下拉刷新：重置pageNum=1，清空列表
- 上拉加载：pageNum递增，追加列表
- 无更多数据时：显示"已经到底了~"

---

## 非接口操作

以下操作不触发接口调用（纯前端交互）：

- **Banner展示** - 静态展示Banner图片
- **快捷入口展示** - 静态展示图标行
- **礼物横向滚动** - 纯前端滚动交互
- **下拉刷新动画** - 下拉刷新的视觉效果
- **上拉加载动画** - 上拉加载的加载动画
- **骨架屏** - 数据加载中的占位UI
- **底部Tab切换** - 切换导航Tab
- **返回顶部** - 点击按钮滚动回顶部

**跳转至其他模块（接口在对应模块文档中定义）：**
- 点击搜索框 → 跳转搜索页
- 点击消息图标 → 跳转消息页
- 点击个人头像 → 跳转个人主页
- 点击内容卡片 → 跳转内容详情页
- 点击Feed中的用户头像 → 跳转该用户主页

---

## 数据传递

### 跨页面传递
**从首页 → 内容详情页：**
- 传递：`postId`（内容ID）
- 方式：路由参数

**从首页 → 用户主页：**
- 传递：`userId`（用户ID）
- 方式：路由参数

### 本地缓存
以下数据可以本地缓存：
- Banner数据（缓存30分钟）
- 快捷入口配置（缓存24小时）
- Feed流数据（退出App清除）

---

## 异常处理

| 场景 | 前端处理方式 |
|-----|------------|
| 网络错误 | 显示："网络异常，请稍后重试" + 重试按钮 |
| 服务器错误（500） | 显示："服务异常，请稍后重试" |
| 接口超时 | 显示："请求超时，请重试" |
| 未登录（401） | 跳转登录页（签到等需要登录的操作） |
| 签到已完成 | 提示："今日已签到" |

---

## 页面展示说明

### 首页结构（从上到下）
1. **顶部栏**
   - 左：个人头像（可点击）
   - 中：搜索框（可点击）
   - 右：消息图标（显示未读数）

2. **Banner区域**
   - 大图Banner（可点击）

3. **快捷入口**
   - 横向排列的图标+文字（签到、电竞赛事等）

4. **礼物/道具区域**
   - 横向滚动的图标列表

5. **明日专家**
   - 模块标题 + HOT标签
   - 横向滚动的用户卡片（头像+标签）

6. **你什么名**
   - 模块标题
   - Banner图片

7. **内容Feed流**
   - 瀑布流展示用户发布的内容
   - 每条内容包含：头像、昵称、描述、3张缩略图、位置等信息

8. **底部导航**
   - 多个Tab导航按钮

