# 首页筛选功能接口文档

## 概述
本文档定义首页筛选功能的所有接口,包括用户操作触发时机和前端参数要求。筛选功能支持线上和线下两种模式,每种模式有不同的筛选条件。

---

## 一、打开筛选页面

### 用户操作
1. 用户在首页点击筛选按钮/图标
2. **系统打开筛选页面** → 触发接口获取筛选配置

### 接口定义
**接口:** `GET /api/home/filter/config`

**参数:**
```typescript
{
  type: 'online' | 'offline';  // 类型:线上或线下(从当前Tab获取)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    ageRange: {
      min: number;        // 最小年龄(如:18)
      max: number | null; // 最大年龄(null表示不限)
    };
    genderOptions: Array<{
      value: string;      // 'all' | 'male' | 'female'
      label: string;      // '全部' | '男' | '女'
    }>;
    statusOptions: Array<{
      value: string;      // 'online' | 'active_3d' | 'active_7d'
      label: string;      // '在线' | '近三天活跃' | '近七天活跃'
    }>;
    skillOptions: Array<{
      value: string;
      label: string;
      category?: string;  // 技能分类(可选)
    }>;
    priceOptions?: Array<{  // 仅线上模式有价格筛选
      value: string;      // 'range_4_9' | 'range_10_19' | 'above_20'
      label: string;      // '4~9币' | '10~19币' | '20币以上'
      min: number;
      max: number | null;
    }>;
    positionOptions?: Array<{  // 仅线上模式有位置筛选
      value: string;
      label: string;      // '打野' | '上路' | '中路' | '下路' | '辅助'
    }>;
    tagOptions: Array<{
      value: string;
      label: string;      // '荣耀王者' | '大神认证' | '巅峰赛' 等
      highlighted?: boolean;  // 是否高亮显示
    }>;
  }
}
```

### 前端验证
- type必须为'online'或'offline'

### 前端行为
- 根据type渲染不同的筛选选项
- 线上模式:显示技能、价格、位置、标签等完整筛选项
- 线下模式:仅显示基础筛选项(年龄、性别、状态)和技能
- 如果用户之前已有筛选条件,回显已选项

---

## 二、调整筛选条件

### 用户操作
1. 用户调整年龄范围滑块
2. 用户点击性别选项
3. 用户点击状态选项
4. 用户点击类型切换(线上/线下)
5. 用户选择/取消技能标签
6. 用户选择/取消价格范围(仅线上)
7. 用户选择/取消位置(仅线上)
8. 用户选择/取消标签

### 前端行为(纯前端交互)
- **年龄滑块**: 拖动滑块实时更新显示的年龄值
  - 左滑块:最小年龄(18岁起)
  - 右滑块:最大年龄(可选择"不限")
- **单选项**(性别、状态、类型):
  - 点击选中,显示紫色高亮背景
  - 同组内其他选项自动取消选中
- **多选项**(技能、价格、位置、标签):
  - 点击切换选中/未选中状态
  - 选中:紫色高亮背景
  - 未选中:灰色背景
  - 可同时选中多个
- **类型切换**:
  - 点击"线上"/"线下"切换模式
  - 切换后重新加载对应模式的筛选选项
  - 之前选择的条件保留(如果适用)

---

## 三、重置筛选条件

### 用户操作
1. 用户点击"重置"按钮
2. **系统清空所有筛选条件** → 不触发接口,纯前端操作

### 前端行为
- 清空所有已选筛选条件
- 年龄滑块恢复默认值(18岁 - 不限)
- 性别恢复"全部"
- 状态恢复"在线"
- 类型保持当前选择(线上/线下)
- 清空所有多选项(技能、价格、位置、标签)
- 不关闭筛选页面
- 不触发搜索接口

---

## 四、应用筛选条件

### 用户操作
1. 用户调整完筛选条件
2. 用户点击"完成"按钮
3. **系统应用筛选条件并返回首页** → 触发接口

### 接口定义
**接口:** `POST /api/home/filter/apply`

**参数:**
```typescript
{
  type: 'online' | 'offline';      // 类型:线上或线下
  filters: {
    age?: {
      min: number;                   // 最小年龄(18+)
      max: number | null;            // 最大年龄(null=不限)
    };
    gender?: 'all' | 'male' | 'female';  // 性别
    status?: 'online' | 'active_3d' | 'active_7d';  // 状态
    skills?: string[];               // 技能列表(多选)
    priceRange?: string[];           // 价格范围列表(仅线上,多选)
    positions?: string[];            // 位置列表(仅线上,多选)
    tags?: string[];                 // 标签列表(多选)
  };
  pageNum: number;                   // 固定为1(应用筛选后从第一页开始)
  pageSize: number;                  // 每页数量(建议10)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      userId: number;
      avatar: string;
      nickname: string;
      age: number;
      gender: 'male' | 'female';
      status: 'online' | 'offline';
      isOnline: boolean;
      skills: Array<{
        name: string;
        level?: string;        // 段位/等级
      }>;
      price?: number;          // 价格(仅线上)
      position?: string;       // 位置(仅线上)
      tags: string[];          // 标签列表
      distance?: number;       // 距离(仅线下,单位:km)
      location?: string;       // 位置(仅线下)
    }>;
    appliedFilters: {          // 已应用的筛选条件(用于显示筛选标签)
      count: number;           // 筛选条件数量
      summary: string[];       // 筛选条件摘要(如:['男','在线','打野'])
    };
  }
}
```

### 前端验证
- age.min ≥ 18
- age.max ≥ age.min (如果不为null)
- 如果选择了多个筛选项,至少有一个有效条件
- 价格、位置筛选仅在type='online'时有效
- pageNum = 1(应用筛选后重置为第一页)

### 前端行为
- 成功后:
  - 关闭筛选页面
  - 返回首页
  - 清空当前Feed流列表
  - 显示筛选后的结果列表
  - 在首页顶部显示筛选标签(如:"男 在线 打野 共3个筛选条件")
  - 显示"清除筛选"按钮
- 失败后:
  - 显示错误提示
  - 保持在筛选页面
  - 不关闭页面

---

## 五、获取筛选后的用户列表(分页加载)

### 用户操作
1. 用户在首页上拉加载更多
2. **系统加载下一页筛选结果** → 触发接口

### 接口定义
**接口:** `GET /api/home/filter/results`

**参数:**
```typescript
{
  type: 'online' | 'offline';
  filters: {
    // 与"应用筛选条件"接口的filters参数相同
    age?: { min: number; max: number | null };
    gender?: string;
    status?: string;
    skills?: string[];
    priceRange?: string[];
    positions?: string[];
    tags?: string[];
  };
  pageNum: number;        // 页码(从1开始)
  pageSize: number;       // 每页数量
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      // 与"应用筛选条件"接口的list结构相同
      userId: number;
      avatar: string;
      nickname: string;
      // ... 其他字段
    }>;
  }
}
```

### 前端验证
- pageNum ≥ 1
- pageSize 范围:5-20
- filters必须与应用时的条件一致

### 前端行为
- 首页初始加载:pageNum=1
- 上拉加载:pageNum递增,追加列表
- 无更多数据时:显示"已经到底了~"
- 下拉刷新:重置pageNum=1,清空列表

---

## 六、清除筛选条件

### 用户操作
1. 用户在首页点击"清除筛选"按钮
2. **系统清除筛选并加载默认列表** → 触发接口

### 接口定义
**接口:** `GET /api/home/feed`

**参数:**
```typescript
{
  pageNum: number;        // 固定为1
  pageSize: number;       // 每页数量
  type?: 'online' | 'offline';  // 类型(可选,保持当前类型)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    list: Array<{
      // 默认Feed流数据结构
    }>;
  }
}
```

### 前端行为
- 清空筛选条件缓存
- 隐藏筛选标签和"清除筛选"按钮
- 清空当前列表
- 加载默认Feed流
- 列表滚动回顶部

---

## 七、点击返回按钮

### 用户操作
1. 用户在筛选页面点击左上角返回按钮
2. **系统返回首页** → 不触发接口,不应用筛选

### 前端行为
- 关闭筛选页面
- 返回首页
- 不保存当前调整的筛选条件
- 保持首页原有的列表数据不变
- 如果之前有筛选条件,继续保持

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 获取筛选配置 | 打开筛选页面 | `/api/home/filter/config` | GET |
| 2 | 应用筛选条件 | 点击完成按钮 | `/api/home/filter/apply` | POST |
| 3 | 获取筛选结果(分页) | 上拉加载更多 | `/api/home/filter/results` | GET |
| 4 | 清除筛选 | 点击清除筛选按钮 | `/api/home/feed` | GET |

---

## 通用验证规则

### 年龄范围
- 最小年龄:≥ 18岁
- 最大年龄:≥ 最小年龄 或 不限(null)
- 滑块范围:18岁 - 不限

### 类型切换
- 线上模式:显示完整筛选项(技能、价格、位置、标签)
- 线下模式:仅显示基础筛选项(年龄、性别、状态、技能)
- 切换类型时保留适用的筛选条件

### 多选项
- 技能:可选0-多个
- 价格:可选0-多个(仅线上)
- 位置:可选0-多个(仅线上)
- 标签:可选0-多个
- 至少选择一个筛选条件才能应用

### 分页加载
- 首屏:pageNum=1, pageSize=10
- 上拉加载:pageNum递增,追加列表
- 下拉刷新:重置pageNum=1,清空列表
- 无更多数据时:显示"已经到底了~"

---

## 非接口操作

以下操作不触发接口调用(纯前端交互):

- **拖动年龄滑块** - 实时更新显示的年龄值
- **点击单选项** - 性别、状态、类型切换(本地状态)
- **点击多选项** - 技能、价格、位置、标签切换选中状态
- **点击重置按钮** - 清空所有筛选条件,恢复默认值
- **点击返回按钮** - 返回首页,不保存当前调整
- **选中状态高亮** - 选中项显示紫色背景,未选中显示灰色背景
- **类型切换UI更新** - 切换线上/线下后更新显示的筛选选项

---

## 数据传递

### 筛选页面 → 首页
**应用筛选后传递:**
- 筛选条件对象(filters)
- 类型(type: 'online' | 'offline')
- 方式:全局状态管理或路由参数

**首页显示:**
- 筛选标签摘要(如:"男 在线 打野")
- 筛选条件数量(如:"共3个筛选条件")
- "清除筛选"按钮

### 本地缓存
**需要缓存的数据:**
- 筛选配置(skillOptions, tagOptions等) - 缓存1小时
- 当前应用的筛选条件 - 会话级缓存,退出App清除
- 上次调整未应用的筛选条件 - 不缓存,点击返回即丢弃

### 状态同步
**应用筛选后需要同步:**
- 首页Feed流列表更新
- 首页顶部显示筛选标签
- 筛选按钮显示筛选数量角标
- 全局筛选状态更新

---

## 异常处理

| 场景 | 前端处理方式 |
|-----|------------|
| 网络错误 | 显示:"网络异常,请稍后重试" + 重试按钮 |
| 服务器错误(500) | 显示:"服务异常,请稍后重试" |
| 接口超时 | 显示:"请求超时,请重试" |
| 筛选条件为空 | 提示:"请至少选择一个筛选条件" |
| 年龄范围无效 | 提示:"年龄范围设置不正确" |
| 筛选结果为空 | 显示:"暂无符合条件的用户,请调整筛选条件" |
| 筛选配置加载失败 | 显示:"筛选配置加载失败" + 重试按钮 |

---

## 筛选选项详细说明

### 线上模式筛选项

#### 年龄
- 类型:范围选择(双滑块)
- 范围:18岁 - 不限
- 默认值:18岁 - 不限

#### 性别
- 选项:全部 | 男 | 女
- 类型:单选
- 默认值:全部

#### 状态
- 选项:在线 | 近三天活跃 | 近七天活跃
- 类型:单选
- 默认值:在线

#### 类型
- 选项:线上 | 线下
- 类型:单选
- 说明:切换后重新加载筛选选项

#### 技能(线上)
- 选项:尊贵钻金 | 永恒钻石 | 至尊星耀 | 最强王者 | 荣耀王者 | 英雄联盟
- 类型:多选
- 默认值:无

#### 价格(仅线上)
- 选项:4~9币 | 10~19币 | 20币以上
- 类型:多选
- 默认值:无

#### 位置(仅线上)
- 选项:打野 | 上路 | 中路 | 下路 | 辅助
- 类型:多选
- 默认值:无

#### 标签(线上)
- 选项:荣耀王者 | 大神认证 | 巅峰赛 | 带粉上分 | 官方认证 | 声优陪玩
- 类型:多选
- 默认值:无
- 说明:某些标签可能有高亮显示

### 线下模式筛选项

#### 年龄
- 同线上模式

#### 性别
- 同线上模式

#### 状态
- 同线上模式

#### 类型
- 同线上模式

#### 技能(线下)
- 选项:私影 (及其他线下技能)
- 类型:多选
- 默认值:无
- 说明:线下技能选项与线上不同

**注意:线下模式不包含价格和位置筛选**

---

## UI交互细节

### 年龄滑块
- 双滑块设计,可独立拖动左右滑块
- 左滑块:设置最小年龄(≥18岁)
- 右滑块:设置最大年龄(可拖至"不限")
- 实时显示当前选择的年龄范围
- 紫色滑块和进度条

### 选项按钮样式
- **未选中**:浅灰色背景 + 黑色文字
- **选中**:紫色渐变背景 + 白色文字
- **单选项**:同组内只能选一个,点击自动切换
- **多选项**:可选多个,点击切换选中状态

### 底部操作按钮
- **重置按钮**:
  - 位置:左侧
  - 样式:白色背景 + 灰色边框 + 灰色文字
  - 功能:清空所有筛选条件
- **完成按钮**:
  - 位置:右侧
  - 样式:紫色渐变背景 + 白色文字
  - 功能:应用筛选并返回首页

### 页面布局
- 顶部:返回按钮 + 标题"筛选"
- 中间:滚动区域,包含所有筛选选项
- 底部:重置和完成按钮(固定在底部)
- 滚动时底部按钮始终可见

---

## 性能优化建议

### 接口请求优化
- 筛选配置接口:缓存1小时,减少重复请求
- 筛选结果接口:支持分页,避免一次加载过多数据
- 应用筛选时:并发请求可能需要的其他接口

### 用户体验优化
- 滑块拖动:使用防抖,避免频繁触发更新
- 选项点击:立即响应,显示选中状态
- 页面切换:使用过渡动画,提升流畅度
- 筛选结果:显示骨架屏,优化加载体验

### 状态管理
- 筛选条件:使用全局状态管理(Redux/Zustand)
- 临时调整:仅保存在组件状态,点击完成才同步
- 点击返回:丢弃临时调整,不影响全局状态

---

## 业务规则说明

### 筛选条件优先级
1. **类型(线上/线下)**:最高优先级,决定显示哪些筛选项
2. **状态(在线/活跃)**:影响用户可见性
3. **其他条件**:按"与"逻辑组合(必须同时满足所有选中的条件)

### 筛选逻辑
- 单选项(性别、状态):必须匹配选中的值
- 多选项(技能、价格、位置、标签):用户至少匹配其中一个选中的值
- 年龄范围:用户年龄必须在设置的范围内
- 所有条件:使用"与"逻辑组合(AND)

### 示例
如果用户选择:
- 性别:男
- 状态:在线
- 技能:最强王者、荣耀王者
- 位置:打野、上路

则筛选逻辑为:
```
性别=男 AND 状态=在线 AND (技能=最强王者 OR 技能=荣耀王者) AND (位置=打野 OR 位置=上路)
```

---

## 测试要点

### 功能测试
- [ ] 筛选页面正常打开,显示所有筛选选项
- [ ] 年龄滑块可正常拖动,范围正确
- [ ] 单选项点击切换正常,同组互斥
- [ ] 多选项可同时选择多个
- [ ] 类型切换后筛选选项正确更新
- [ ] 重置按钮清空所有条件
- [ ] 完成按钮应用筛选并返回首页
- [ ] 返回按钮不保存调整,保持原有状态
- [ ] 筛选结果正确显示
- [ ] 分页加载正常工作

### 边界测试
- [ ] 不选择任何条件点击完成的提示
- [ ] 年龄范围设置无效的提示
- [ ] 筛选结果为空的提示
- [ ] 网络异常的错误处理
- [ ] 接口超时的错误处理

### 兼容性测试
- [ ] 线上/线下模式切换正常
- [ ] 不同筛选条件组合正确工作
- [ ] 筛选状态在页面切换后保持
- [ ] 清除筛选后恢复默认列表

---
