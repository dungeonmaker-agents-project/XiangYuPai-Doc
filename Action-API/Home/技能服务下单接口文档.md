# 技能服务下单接口文档

## 概述
本文档定义技能服务下单功能的所有接口,包括服务列表、筛选、服务详情、确认订单、支付流程等用户操作触发时机和前端参数要求。这是平台最核心的商业功能,涉及完整的订单和支付流程。

---

## 一、打开技能服务列表

### 用户操作
1. 用户在首页点击技能服务入口(如:"王者荣耀")
2. **系统打开服务列表页** → 触发接口

### 接口定义
**接口:** `GET /api/service/list`

**参数:**
```typescript
{
  skillType: string;            // 技能类型(如:'王者荣耀','探店'等)
  pageNum: number;              // 页码(从1开始)
  pageSize: number;             // 每页数量(建议10)
  sortBy?: string;              // 排序方式(默认'smart')
  filters?: {
    status?: 'online' | 'active_3d' | 'active_7d';  // 在线状态
    gender?: 'all' | 'male' | 'female';             // 性别
    gameArea?: string;          // 游戏大区(QQ区/微信区等)
    rank?: string[];            // 段位(多选)
    priceRange?: string[];      // 价格范围(多选)
    position?: string[];        // 位置/角色(多选)
    tags?: string[];            // 标签(多选)
    location?: 'same_city';     // 同城筛选
    cityCode?: string;          // 城市代码
  };
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    skillType: {
      type: string;
      label: string;            // 如:'王者荣耀'
      icon?: string;
    };
    tabs: Array<{
      value: string;
      label: string;            // '荣耀王者','线上','线下','我的'
      count?: number;
    }>;
    filters: {
      sortOptions: Array<{
        value: string;
        label: string;          // '智能排序','最新排序','人气排序'
      }>;
      genderOptions: Array<{
        value: string;
        label: string;          // '不限性别','只看女生','只看男生'
      }>;
      statusOptions: Array<{
        value: string;
        label: string;          // '在线','近三天活跃','近七天活跃'
      }>;
      gameAreas?: Array<{       // 游戏大区(可选)
        value: string;
        label: string;          // 'QQ区','微信区'
      }>;
      ranks?: Array<{           // 段位选项(可选)
        value: string;
        label: string;          // '尊贵钻金','永恒钻石','至尊星耀'等
      }>;
      priceRanges?: Array<{
        value: string;
        label: string;          // '4~9币','10~19币','20币以上'
        min: number;
        max: number | null;
      }>;
      positions?: Array<{       // 位置/角色(可选)
        value: string;
        label: string;          // '打野','上路','中路','下路','辅助','全能'
      }>;
      tags?: Array<{
        value: string;
        label: string;          // '荣耀王者','大神认证','巅峰赛'等
      }>;
    };
    total: number;
    hasMore: boolean;
    list: Array<{
      serviceId: number;
      provider: {
        userId: number;
        avatar: string;
        nickname: string;       // 如:'昵称123'
        gender: 'male' | 'female';
        age?: number;
        isOnline: boolean;
        isVerified: boolean;
      };
      skillInfo: {
        skillType: string;      // 技能类型
        gameArea?: string;      // 游戏大区(如:'微信区')
        rank?: string;          // 段位(如:'荣耀王者')
        rankScore?: number;     // 段位分数(如:1800+)
        position?: string[];    // 擅长位置
      };
      tags: Array<{
        text: string;
        type: 'feature' | 'price' | 'skill' | 'badge';
        color?: string;
      }>;
      description: string;      // 服务描述
      price: {
        amount: number;
        unit: 'per_game' | 'per_hour' | 'per_order';
        displayText: string;    // 如:'10金币/局'
      };
      distance?: number;        // 距离(km)
      stats: {
        orders: number;         // 接单数
        rating: number;         // 评分(1-5)
        reviewCount: number;    // 评价数
      };
    }>;
  }
}
```

### 前端验证
- skillType:必填
- pageNum ≥ 1
- pageSize 范围:5-20

### 前端行为
- 显示技能类型标题(如:"王者荣耀")
- 显示Tab栏(荣耀王者/线上/线下/我的)
- 显示筛选栏:
  - 智能排序下拉框
  - 不限性别下拉框
  - 筛选按钮(带上箭头表示已展开或下箭头表示收起)
- 垂直列表展示服务提供者卡片
- 每个卡片显示:
  - 左侧:用户头像
  - 右侧:
    - 昵称 + 性别图标 + 距离
    - 标签行(横向滚动)
    - 描述文字(最多2行)
    - 价格(红色加粗)
- 支持下拉刷新和上拉加载
- 点击卡片:跳转服务详情页

---

## 二、排序和性别筛选

### 用户操作
1. 用户点击"智能排序"或"不限性别"下拉框
2. 用户选择排序方式或性别选项
3. **系统应用选择并刷新列表** → 触发接口

### 前端行为
- **智能排序下拉**:
  - 显示选项:智能排序、最新排序、人气排序
  - 选中项显示✓
  - 点击选项后关闭下拉框并刷新列表

- **不限性别下拉**:
  - 显示选项:不限性别、只看女生、只看男生
  - 选中项显示✓
  - 点击选项后关闭下拉框并刷新列表

- 选择后:
  - 更新下拉框显示文本
  - 清空当前列表
  - 重置pageNum=1
  - 调用列表接口获取新数据

---

## 三、打开高级筛选面板

### 用户操作
1. 用户点击"筛选"按钮
2. **系统打开筛选面板** → 不触发接口,使用已有的filters数据

### 前端行为
- 显示全屏或底部弹出的筛选面板
- 显示多个筛选分类:
  - **状态**: 在线(默认选中)
  - **大区**: QQ区、微信区(如适用)
  - **段位**: 尊贵钻金、永恒钻石、至尊星耀、最强王者、荣耀王者
  - **价格**: 4~9币、10~19币、20币以上
  - **位置**: 打野、上路、中路、下路、辅助、全能
  - **标签**: 荣耀王者、大神认证、巅峰赛、带粉上分、官方认证、声优陪玩
  - **所在地**: 同城
- 每个选项显示为圆角矩形按钮
- 选中状态:紫色背景
- 未选中状态:灰色背景
- 支持多选(除状态和大区为单选)
- 底部显示"重置"和"完成"按钮

---

## 四、应用高级筛选

### 用户操作
1. 用户在筛选面板选择各项条件
2. 用户点击"完成"按钮
3. **系统应用筛选并刷新列表** → 触发接口

### 接口定义
**接口:** `GET /api/service/list`

**参数:**
```typescript
{
  skillType: string;
  pageNum: number;        // 重置为1
  pageSize: number;
  sortBy?: string;
  filters: {
    status?: string;
    gameArea?: string;
    rank?: string[];      // 选中的段位数组
    priceRange?: string[];
    position?: string[];
    tags?: string[];
    location?: string;
    // ... 其他筛选条件
  };
}
```

**响应数据:**
```typescript
{
  // 同"打开技能服务列表"接口
}
```

### 前端行为
- 关闭筛选面板
- 清空当前列表
- 重置pageNum=1
- 调用列表接口获取筛选后的数据
- 在筛选按钮上显示已选筛选数量(如:"筛选(5)")
- 如果无结果:显示"暂无符合条件的服务提供者"

---

## 五、获取服务详情

### 用户操作
1. 用户在列表中点击服务提供者卡片
2. **系统打开服务详情页** → 触发接口

### 接口定义
**接口:** `GET /api/service/detail`

**参数:**
```typescript
{
  serviceId: number;          // 服务ID
  userId?: number;            // 服务提供者ID(可选,用于查看特定用户服务)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    serviceId: number;
    provider: {
      userId: number;
      avatar: string;
      nickname: string;
      gender: 'male' | 'female';
      age?: number;
      isOnline: boolean;
      isVerified: boolean;
      verifiedLabel?: string;
      level?: number;           // 用户等级
    };
    bannerImage?: string;       // 服务封面图/Banner
    images?: string[];          // 服务图片集
    skillInfo: {
      skillType: string;
      skillLabel: string;
      gameArea?: string;        // 如:'微信区'
      rank?: string;            // 如:'荣耀王者'
      rankScore?: number;       // 如:1800
      rankDisplay?: string;     // 如:'巅峰1800+'
      position?: string[];      // 擅长位置
      voiceType?: string;       // 声音类型(如有)
    };
    tags: Array<{
      text: string;
      type: string;
      color?: string;
    }>;
    description: string;        // 服务描述
    price: {
      amount: number;
      unit: 'per_game' | 'per_hour' | 'per_order';
      displayText: string;      // 如:'10金币/局'
    };
    schedule?: {                // 服务时间(可选)
      available: string;        // 如:'每天18:00-23:00'
    };
    location?: {                // 位置信息(可选,线下服务)
      address: string;
      district?: string;
      distance?: number;
    };
    stats: {
      orders: number;           // 总接单数
      rating: number;           // 评分(1-5)
      reviewCount: number;      // 评价总数
    };
    reviews: {
      total: number;
      summary: {
        excellent: number;      // 好评数
        positive: number;       // 中评数
        negative: number;       // 差评数
      };
      tags: Array<{             // 高频评价标签
        text: string;           // 如:'声音好听'
        count: number;
      }>;
      recent: Array<{           // 最近评价(显示2-3条)
        reviewId: number;
        reviewer: {
          userId: number;
          avatar: string;
          nickname: string;
        };
        rating: number;         // 1-5星
        content: string;
        images?: string[];
        createdAt: string;
        reply?: string;         // 服务者回复(可选)
      }>;
    };
    availability: {
      isAvailable: boolean;     // 是否可下单
      reason?: string;          // 不可下单原因(如:'已下线','订单已满')
    };
  }
}
```

### 前端行为
- 显示服务详情页
- 顶部显示Banner或服务图片
- 显示服务提供者信息:
  - 头像 + 昵称 + 性别 + 在线状态
  - 认证标签
- 显示价格(红色加粗)
- 显示技能信息:
  - 游戏大区、段位、段位分数
  - 擅长位置等
- 显示服务描述
- 显示统计信息:
  - 评价数(如:"评价 (100+)")
  - 星级评分
- 显示评价区域:
  - 高频标签(如:"声音好听")
  - 最近评价列表(2-3条)
  - "查看全部评价"链接
- 底部操作按钮:
  - 左侧:"☐ 贴贴"(收藏/关注)
  - 右侧:"☐ 下单"(紫色)
- 如果不可下单:
  - "下单"按钮置灰
  - 显示不可下单原因

---

## 六、查看全部评价

### 用户操作
1. 用户在服务详情页点击"查看全部评价"或评价区域
2. **系统打开全部评价页面** → 触发接口

### 接口定义
**接口:** `GET /api/service/reviews`

**参数:**
```typescript
{
  serviceId: number;
  pageNum: number;
  pageSize: number;
  filterBy?: 'all' | 'excellent' | 'positive' | 'negative';  // 筛选类型
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    total: number;
    hasMore: boolean;
    summary: {
      averageRating: number;
      excellent: number;
      positive: number;
      negative: number;
    };
    tags: Array<{
      text: string;
      count: number;
    }>;
    list: Array<{
      reviewId: number;
      reviewer: {
        userId: number;
        avatar: string;
        nickname: string;
      };
      rating: number;
      content: string;
      images?: string[];
      createdAt: string;
      reply?: {
        content: string;
        createdAt: string;
      };
    }>;
  }
}
```

### 前端行为
- 显示"全部评价"页面
- 顶部显示高频标签(如:"声音好听")
- 显示评价列表
- 每条评价显示:
  - 评价者头像 + 昵称
  - 星级评分(5星制)
  - 评价内容
  - 评价图片(如有)
  - 评价时间
  - 服务者回复(如有)
- 支持上拉加载更多
- 可能支持筛选(全部/好评/中评/差评)

---

## 七、点击下单按钮

### 用户操作
1. 用户在服务详情页点击"下单"按钮
2. **系统打开确认订单页面** → 触发接口

### 接口定义
**接口:** `GET /api/order/preview`

**参数:**
```typescript
{
  serviceId: number;          // 服务ID
  quantity?: number;          // 数量(默认1)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    provider: {
      userId: number;
      avatar: string;
      nickname: string;
      gender: 'male' | 'female';
      age?: number;
      tags: string[];
      skillInfo: {
        gameArea?: string;
        rank?: string;
        rankDisplay?: string;
      };
    };
    service: {
      serviceId: number;
      name: string;             // 服务名称(如:'王者荣耀')
      icon?: string;
    };
    price: {
      unitPrice: number;        // 单价
      unit: string;             // 单位(如:'局','小时')
      displayText: string;      // 如:'10金币/局'
    };
    quantityOptions: {
      min: number;              // 最小数量
      max: number;              // 最大数量
      default: number;          // 默认数量
    };
    preview: {
      quantity: number;
      subtotal: number;         // 小计
      serviceFee: number;       // 服务费
      total: number;            // 总计
    };
    userBalance: number;        // 用户余额
  }
}
```

### 前端验证
- serviceId:必填
- 需要登录状态

### 前端行为
- 显示"确认订单"页面
- 显示服务提供者信息卡片:
  - 服务图片/截图
  - 昵称 + 性别 + 年龄
  - 认证标签 + 等级标签
  - 技能信息(游戏大区、段位等)
- 显示订单信息:
  - **购买**: 服务名称(如:'王者荣耀')
  - **价格**: 单价(如:'10金币/局')
  - **场次**(或小时数等):
    - 左侧:减号按钮(圆形,紫色边框)
    - 中间:数量显示
    - 右侧:加号按钮(圆形,紫色填充)
  - **共计**: 总价(红色加粗,大号字体,如:'10 金币')
- 底部显示"立即支付"按钮(紫色渐变)
- 数量按钮:
  - 减号:数量>1时可点击
  - 加号:数量<最大值时可点击
  - 点击后实时更新总价

---

## 八、调整订单数量

### 用户操作
1. 用户在确认订单页面点击增加/减少数量按钮
2. **系统更新订单预览** → 可能触发接口或前端计算

### 接口定义(可选,也可以前端直接计算)
**接口:** `POST /api/order/preview/update`

**参数:**
```typescript
{
  serviceId: number;
  quantity: number;           // 新的数量
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    quantity: number;
    subtotal: number;
    serviceFee: number;
    total: number;
  }
}
```

### 前端验证
- quantity ≥ min
- quantity ≤ max

### 前端行为
- 点击减号:
  - quantity > min时,减1
  - quantity = min时,按钮置灰不可点击
- 点击加号:
  - quantity < max时,加1
  - quantity = max时,按钮置灰不可点击
- 数量变化后:
  - 实时更新"共计"金额
  - 可以前端计算或调用接口更新

---

## 九、提交订单

### 用户操作
1. 用户确认订单信息和数量
2. 用户点击"立即支付"按钮
3. **系统创建订单** → 触发接口

### 接口定义
**接口:** `POST /api/order/create`

**参数:**
```typescript
{
  serviceId: number;
  quantity: number;
  totalAmount: number;        // 总金额(用于验证)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    orderId: string;          // 订单ID
    orderNo: string;          // 订单编号
    amount: number;           // 支付金额
    needPayment: boolean;     // 是否需要支付
    paymentInfo?: {
      amount: number;
      currency: 'coin';       // 金币
      userBalance: number;    // 用户余额
      sufficientBalance: boolean;  // 余额是否充足
    };
  }
}
```

### 前端验证
- serviceId:必填
- quantity:必须在有效范围内
- totalAmount:必须正确

### 前端行为
- 显示加载动画
- 创建订单成功:
  - 显示支付弹窗
- 创建订单失败:
  - 显示错误提示
  - 保持在确认订单页面

---

## 十、显示支付弹窗

### 用户操作
1. 订单创建成功后自动显示支付弹窗
2. **用户查看支付信息** → 前端显示,不触发接口

### 前端行为
- **支付弹窗结构**:
  - 标题:"确认支付"
  - 右上角:关闭按钮(×)
  - 支付金额(右对齐):"10金币"
  - 支付方式选项:
    - 左侧:金币图标
    - 中间:"金币" + 余额显示
      - 余额充足:"剩余: 100"(灰色)
      - 余额不足:"余额不足,请充值"(红色或橙色)
    - 右侧:紫色对勾(选中状态)
  - 同意条款:
    - 复选框(或默认同意)
    - 文字(紫色,可点击):"我同意支付以下所示的总金额（含服务费）"
  - "立即支付"按钮(紫色渐变,全宽)

- **余额状态判断**:
  - 余额充足:
    - 显示剩余金额
    - "立即支付"按钮可点击
  - 余额不足:
    - 显示"余额不足,请充值"
    - "立即支付"按钮可能置灰或点击后跳转充值页面

---

## 十一、执行支付

### 用户操作
1. 用户在支付弹窗中点击"立即支付"按钮
2. **系统验证余额并执行支付流程** → 触发接口

### 接口定义
**接口:** `POST /api/order/pay`

**参数:**
```typescript
{
  orderId: string;            // 订单ID
  orderNo: string;            // 订单编号
  paymentMethod: 'balance' | 'alipay' | 'wechat';  // 支付方式
  amount: number;             // 支付金额
  paymentPassword?: string;   // 支付密码(如需要)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    orderId: string;
    orderNo: string;
    paymentStatus: 'success' | 'pending' | 'require_password' | 'failed';
    requirePassword?: boolean;  // 是否需要输入支付密码
    balance?: number;          // 支付后余额(如成功)
    failureReason?: string;    // 失败原因(如失败)
  }
}
```

### 前端验证
- 余额必须充足(如使用余额支付)
- 需要同意支付条款(如有复选框)

### 前端行为
- **点击"立即支付"**:
  - 显示加载动画
  - 调用支付接口

- **如果paymentStatus='require_password'**:
  - 关闭支付弹窗
  - 显示支付密码输入弹窗

- **如果paymentStatus='success'**:
  - 关闭支付弹窗
  - 显示支付成功页面

- **如果paymentStatus='failed'**:
  - 显示错误提示
  - 根据failureReason显示具体原因:
    - 余额不足:提供充值入口
    - 订单已失效:返回服务详情页
    - 其他错误:显示错误信息 + 重试按钮

---

## 十二、输入支付密码

### 用户操作
1. 系统要求输入支付密码
2. 用户输入6位支付密码
3. **系统验证密码并完成支付** → 触发接口

### 接口定义
**接口:** `POST /api/order/pay/verify`

**参数:**
```typescript
{
  orderId: string;
  orderNo: string;
  paymentPassword: string;    // 6位支付密码
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    orderId: string;
    orderNo: string;
    paymentStatus: 'success' | 'failed';
    balance?: number;          // 支付后余额
    failureReason?: string;    // 失败原因(如:密码错误)
  }
}
```

### 前端验证
- paymentPassword:必须为6位数字

### 前端行为
- **支付密码弹窗**:
  - 标题:"请输入支付密码"
  - 提示文字:"付款10金币"
  - 密码输入区:6个圆点/方框
  - 数字键盘:
    - 布局:3x4网格
    - 数字:1-9, 0
    - 删除按钮:退格图标
  - 右上角:关闭按钮(×)

- **输入交互**:
  - 点击数字:输入到密码框
  - 密码框显示为圆点(已输入)或空(未输入)
  - 输入6位后自动提交

- **提交验证**:
  - 自动调用验证接口
  - 验证成功:跳转支付成功页
  - 验证失败:
    - 清空密码输入
    - 显示错误提示(如:"密码错误,请重新输入")
    - 可能有重试次数限制

---

## 十三、支付成功

### 用户操作
1. 支付验证成功
2. **系统显示支付成功页面** → 可能触发接口获取订单详情

### 接口定义(可选)
**接口:** `GET /api/order/detail`

**参数:**
```typescript
{
  orderId: string;
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    orderId: string;
    orderNo: string;
    status: 'pending' | 'accepted' | 'in_progress' | 'completed' | 'cancelled';
    amount: number;
    createdAt: string;
    autoCancel Time?: string;  // 自动取消时间(如:10分钟后)
    provider: {
      userId: number;
      nickname: string;
      avatar: string;
    };
    service: {
      name: string;
      quantity: number;
    };
  }
}
```

### 前端行为
- 显示"支付成功"页面
- **页面结构**:
  - 标题:"支付成功" + 右上角"完成"按钮
  - 中央:
    - 绿色对勾图标(圆形背景)
    - "支付成功"文字
    - 支付金额(大号字体):"10 金币"
  - 订单详情:
    - 付款金币:10个
    - 订单编号:25060610042501
    - 提现时间:2025-06-06 10:04:25
  - 提示信息:"注：10分钟后未接单自动取消"

- **点击"完成"按钮**:
  - 跳转到订单详情页或订单列表页
  - 或返回首页

- **自动跳转**(可选):
  - 3-5秒后自动跳转到订单详情页

---

## 十四、查询订单状态

### 用户操作
1. 用户在订单列表或订单详情中查看订单
2. **系统显示订单状态** → 触发接口

### 接口定义
**接口:** `GET /api/order/status`

**参数:**
```typescript
{
  orderId: string;
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    orderId: string;
    orderNo: string;
    status: 'pending' | 'accepted' | 'in_progress' | 'completed' | 'cancelled' | 'refunded';
    statusLabel: string;      // 状态文本
    provider: {
      userId: number;
      nickname: string;
      avatar: string;
      isOnline: boolean;
    };
    service: {
      name: string;
      quantity: number;
      unitPrice: number;
    };
    amount: number;
    createdAt: string;
    acceptedAt?: string;      // 接单时间
    completedAt?: string;     // 完成时间
    cancelledAt?: string;     // 取消时间
    autoCancel: {
      enabled: boolean;
      cancelAt?: string;      // 自动取消时间
      remainingSeconds?: number;  // 剩余秒数
    };
    actions: Array<{          // 可执行操作
      action: 'cancel' | 'contact' | 'rate' | 'refund';
      label: string;
      enabled: boolean;
    }>;
  }
}
```

### 前端行为
- 根据订单状态显示不同内容:
  - **pending**(待接单):
    - 显示"等待服务者接单"
    - 显示倒计时:"10分钟后未接单自动取消"
    - 提供"取消订单"按钮
  - **accepted**(已接单):
    - 显示"服务者已接单"
    - 提供"联系服务者"按钮
  - **in_progress**(进行中):
    - 显示"服务进行中"
  - **completed**(已完成):
    - 显示"服务已完成"
    - 提供"评价"按钮
  - **cancelled**(已取消):
    - 显示"订单已取消"
    - 显示取消原因和退款信息
  - **refunded**(已退款):
    - 显示"已退款"
    - 显示退款金额和时间

---

## 十五、取消订单

### 用户操作
1. 用户在订单详情页点击"取消订单"按钮
2. **系统取消订单并退款** → 触发接口

### 接口定义
**接口:** `POST /api/order/cancel`

**参数:**
```typescript
{
  orderId: string;
  reason?: string;            // 取消原因(可选)
}
```

**响应数据:**
```typescript
{
  code: number;
  message: string;
  data: {
    orderId: string;
    status: 'cancelled';
    refundAmount: number;     // 退款金额
    refundTime: string;       // 退款时间
    balance: number;          // 退款后余额
  }
}
```

### 前端验证
- 只能取消'pending'状态的订单
- 未超过取消时限

### 前端行为
- 显示取消确认对话框:
  - 标题:"确认取消订单?"
  - 说明:取消政策和退款说明
  - 按钮:"取消" | "确定"
- 取消成功:
  - 显示"取消成功"提示
  - 更新订单状态
  - 显示退款信息
- 取消失败:
  - 显示错误提示

---

## 接口汇总

| # | 功能 | 用户操作 | 接口 | 方法 |
|---|------|---------|------|------|
| 1 | 获取服务列表 | 打开服务列表 | `/api/service/list` | GET |
| 2 | 获取服务详情 | 点击服务卡片 | `/api/service/detail` | GET |
| 3 | 获取全部评价 | 点击查看评价 | `/api/service/reviews` | GET |
| 4 | 订单预览 | 点击下单按钮 | `/api/order/preview` | GET |
| 5 | 更新订单预览 | 调整数量 | `/api/order/preview/update` | POST |
| 6 | 创建订单 | 点击立即支付 | `/api/order/create` | POST |
| 7 | 执行支付 | 确认支付 | `/api/order/pay` | POST |
| 8 | 验证支付密码 | 输入密码 | `/api/order/pay/verify` | POST |
| 9 | 获取订单详情 | 查看订单 | `/api/order/detail` | GET |
| 10 | 查询订单状态 | 查看订单状态 | `/api/order/status` | GET |
| 11 | 取消订单 | 点击取消订单 | `/api/order/cancel` | POST |

---

## 通用验证规则

### 登录状态
- 所有操作都需要登录状态
- 未登录时跳转登录页

### 服务筛选
- 支持多条件组合筛选
- 筛选条件保存在当前会话
- 清空筛选:返回默认列表

### 订单创建
- 服务必须可用(服务者在线且接单)
- 数量必须在有效范围内(min-max)
- 用户余额必须充足(或选择其他支付方式)

### 支付规则
- 支付方式:余额、支付宝、微信
- 余额支付:可能需要支付密码
- 支付超时时间:5分钟
- 支付密码:6位数字
- 密码错误次数限制:通常5次

### 订单规则
- 订单创建后10分钟内未接单自动取消
- 取消订单:全额退款(如未接单)
- 服务者接单后用户不能取消
- 订单完成后可以评价

### 评价规则
- 订单完成后才能评价
- 评价包含:星级(1-5星)、文字、图片(可选)
- 评价后不可修改
- 服务者可以回复评价

---

## 非接口操作

以下操作不触发接口调用(纯前端交互):

### 列表页面
- **下拉框展开/收起** - 点击排序和性别下拉框
- **服务卡片显示** - 渲染服务提供者信息
- **滚动加载** - 列表滚动交互

### 筛选页面
- **选项选择** - 点击筛选条件切换选中状态
- **重置按钮** - 清空所有筛选条件
- **选中状态高亮** - 选中项显示紫色背景

### 服务详情页
- **图片轮播** - 服务图片轮播展示
- **评价标签显示** - 显示高频评价标签
- **收藏/关注** - 点击"贴贴"按钮(可能触发接口)

### 确认订单页
- **数量增减** - 点击+/-按钮调整数量(可能触发接口)
- **金额计算** - 实时更新总价(前端计算或接口)

### 支付弹窗
- **显示/隐藏** - 支付弹窗的打开和关闭动画
- **同意条款** - 复选框状态切换(如有)
- **金额显示** - 格式化显示金额和余额

### 支付密码输入
- **密码输入** - 点击数字键盘输入密码
- **密码显示** - 密码框显示圆点
- **删除输入** - 点击退格删除最后一位

### 支付成功页
- **页面显示** - 显示支付成功信息
- **自动跳转** - 可能3-5秒后自动跳转

---

## 数据传递

### 列表页 → 详情页
**点击服务卡片传递:**
- serviceId(服务ID)
- userId(服务提供者ID)
- 方式:路由参数

### 详情页 → 确认订单页 → 支付流程
**下单流程传递:**
- serviceId(服务ID)
- quantity(数量)
- 方式:路由参数或状态管理

**支付流程传递:**
- orderId(订单ID)
- orderNo(订单编号)
- amount(支付金额)
- 方式:状态管理

**支付成功后传递:**
- orderId(订单ID)
- 方式:路由参数

### 详情页 → 评价列表页
**查看评价传递:**
- serviceId(服务ID)
- 方式:路由参数

### 本地缓存
**需要缓存的数据:**
- 服务列表 - 会话级缓存,退出页面清除
- 筛选条件 - 会话级缓存,退出App清除
- 服务详情 - 缓存5分钟,减少重复请求
- 用户余额 - 实时更新,不缓存或缓存1分钟
- 订单状态 - 实时查询,不缓存

### 状态同步
**操作后需要同步:**
- 下单成功:订单列表新增订单,余额更新
- 支付成功:订单状态更新,余额更新
- 取消订单:订单状态更新,余额更新
- 评价完成:服务详情评价数更新

---

## 异常处理

| 场景 | 前端处理方式 |
|-----|------------|
| 网络错误 | 显示:"网络异常,请稍后重试" + 重试按钮 |
| 服务器错误(500) | 显示:"服务异常,请稍后重试" |
| 接口超时 | 显示:"请求超时,请重试" |
| 未登录 | 提示:"请先登录" + 跳转登录页 |
| 服务不可用 | 提示:"该服务暂时不可用" |
| 服务者已下线 | 提示:"服务者已下线,请选择其他服务" |
| 余额不足 | 提示:"余额不足,请先充值" + 充值入口 |
| 支付密码错误 | 提示:"密码错误,请重新输入" |
| 支付密码锁定 | 提示:"密码错误次数过多,请稍后再试" |
| 订单已失效 | 提示:"订单已失效,请重新下单" |
| 订单已被接单 | 提示:"订单已被接单,无法取消" |
| 重复下单 | 提示:"您有未完成的订单,请先完成或取消" |
| 数量超限 | 提示:"数量已达上限" |
| 价格变动 | 提示:"价格已变动,请重新确认" |

---

## 服务列表页详细说明

### 页面结构
- **顶部**: 返回按钮 + 技能类型标题(如:"王者荣耀")
- **Tab栏**: 荣耀王者 | 线上 | 线下 | 我的
- **筛选栏**: 智能排序 ▼ | 不限性别 ▼ | 筛选 ▲/▼
- **内容区**: 垂直滚动的服务提供者卡片列表

### 服务提供者卡片
**布局**:
- 左侧:用户头像(圆形,约60x60)
- 右侧:服务信息

**服务信息**:
- **第一行**: 昵称 + 性别图标 + 距离(如:"3.2km")
- **第二行**: 标签行(横向滚动)
  - 不同类型标签不同颜色
  - 如:"可线上"(绿色)、"2元"(橙色)等
- **第三-四行**: 描述文字(灰色,最多2行)
- **第五行**: 价格(红色加粗,右对齐,如:"10 金币/局")

### 筛选面板
**完整筛选选项**:
1. **状态**(单选):
   - 在线

2. **大区**(单选,游戏类):
   - QQ区
   - 微信区

3. **段位**(多选,游戏类):
   - 尊贵钻金
   - 永恒钻石
   - 至尊星耀
   - 最强王者
   - 荣耀王者

4. **价格**(多选):
   - 4~9币
   - 10~19币
   - 20币以上

5. **位置**(多选,游戏类):
   - 打野
   - 上路
   - 中路
   - 下路
   - 辅助
   - 全能

6. **标签**(多选):
   - 荣耀王者
   - 大神认证
   - 巅峰赛
   - 带粉上分
   - 官方认证
   - 声优陪玩

7. **所在地**(单选):
   - 同城

---

## 服务详情页详细说明

### 页面结构
- **顶部**: 返回按钮 + "详情"标题
- **Hero区**: 服务封面图/游戏截图
- **服务者信息区**: 服务者基本信息
- **价格区**: 价格显示
- **描述区**: 服务描述
- **评价区**: 评价摘要和最近评价
- **底部**: 操作按钮

### 服务者信息区
- 头像(圆形) + 昵称
- 性别图标 + 在线状态
- 认证标签:"实名认证"(蓝色背景)
- 等级标签:"大神"(橙色背景)
- 技能信息:
  - 游戏大区(如:"微信区")
  - 段位(如:"荣耀王者")
  - 段位分数(如:"巅峰1800+")

### 价格区
- 大号红色文字:"10 金币/局"

### 评价区
- **评价摘要**:
  - "评价 (100+)" + 星级评分
  - 高频标签(如:"声音好听")
- **最近评价**:
  - 显示2-3条最近评价
  - 每条包含:
    - 评价者头像 + 昵称
    - 5星评分
    - 评价内容
    - 评价时间
  - "查看全部评价"链接

### 底部操作按钮
- **贴贴按钮**(左侧):
  - 白色背景 + 紫色边框
  - 图标:心形或收藏图标
  - 可能是收藏/关注功能

- **下单按钮**(右侧):
  - 紫色渐变背景
  - 白色文字:"下单"
  - 图标:购物车或订单图标

---

## 确认订单页详细说明

### 页面结构
- **顶部**: 返回按钮 + "确认订单"标题
- **服务者信息卡片**: 完整的服务者和服务信息
- **订单信息区**: 可编辑的订单详情
- **底部**: "立即支付"按钮

### 服务者信息卡片
- **左侧**: 服务图片/游戏截图(圆角矩形,约100x100)
- **右侧**:
  - 第一行:昵称 + 性别图标 + 年龄
  - 第二行:认证和等级标签
  - 第三行:技能详情(如:"微信区 荣耀王者 巅峰1800+")

### 订单信息区
采用列表布局,每行包含:

1. **购买** (左) | **王者荣耀** (右)
2. **价格** (左) | **10金币/局** (右)
3. **场次** (左) | **数量选择器** (右)
   - 数量选择器:
     - 左:减号按钮(○ -)
     - 中:数字显示
     - 右:加号按钮(○ +)
     - 按钮样式:圆形,紫色

### 总价显示
- 右对齐
- "共计:" + 金额
- 金额:红色加粗大号字体(如:"10 金币")

### 立即支付按钮
- 紫色渐变背景
- 白色文字:"立即支付"
- 全宽按钮
- 固定在底部

---

## 支付流程详细说明

### 1. 确认支付弹窗
**布局**:
- 从底部弹出或居中显示
- 圆角白色背景
- 模态遮罩(半透明黑色)

**内容**:
- **标题**: "确认支付"(居中)
- **关闭按钮**: 右上角(×)
- **支付金额**: "10金币"(右对齐)
- **支付方式**:
  - 金币图标(黄色硬币)
  - "金币"文字
  - 余额显示:
    - 充足:"剩余: 100"(灰色)
    - 不足:"余额不足,请充值"(红色/橙色)
  - 选中标记:紫色对勾(右侧)
- **同意条款**: "我同意支付以下所示的总金额（含服务费）"(紫色)
- **立即支付按钮**: 紫色渐变全宽按钮

### 2. 支付密码输入弹窗
**布局**:
- 从底部弹出
- 圆角白色背景

**内容**:
- **标题**: "请输入支付密码"(居中)
- **关闭按钮**: 右上角(×)
- **提示文字**: "付款10金币"(灰色,居中)
- **密码输入区**:
  - 6个圆点/方框
  - 已输入:显示实心圆点
  - 未输入:显示空圆圈或方框
  - 横向排列,居中
- **数字键盘**:
  - 3x4网格布局
  - 数字1-9排列在前3行
  - 第4行:空白 | 0 | 删除
  - 删除按钮:退格图标(⌫)
  - 键盘固定在底部

**交互**:
- 点击数字:填充到密码框
- 自动移动到下一位
- 输入6位后自动提交验证

### 3. 支付成功页面
**布局**:
- 全屏白色背景

**内容**:
- **顶部**: "支付成功"标题 + 右上角"完成"按钮
- **中央区域**:
  - 绿色对勾图标(圆形背景,约80x80)
  - "支付成功"文字(居中)
  - 支付金额(大号字体):"10 金币"
- **订单详情**:
  - 付款金币:10个
  - 订单编号:25060610042501
  - 提现时间:2025-06-06 10:04:25
- **提示信息**: "注：10分钟后未接单自动取消"(灰色小字,居中)

---

## 全部评价页详细说明

### 页面结构
- **顶部**: 返回按钮 + "全部评价"标题
- **标签区**: 高频评价标签
- **评价列表**: 滚动列表

### 高频标签
- 横向排列
- 紫色背景圆角矩形
- 如:"声音好听"、"声音好听"
- 可能显示数量(如:"声音好听(128)")

### 评价列表
每条评价包含:
- **评价者信息**:
  - 头像(圆形,约40x40)
  - 昵称
- **评分**: 5颗星(黄色填充表示评分)
- **评价内容**: 文字描述(可能多行)
- **评价图片**: 缩略图(如有,横向排列)
- **评价时间**: 灰色小字(如:"2025-06-06")
- **服务者回复**: 灰色背景区域(如有)
  - "服务者回复:"标题
  - 回复内容
  - 回复时间

### 筛选选项(可选)
- Tab或下拉选择:
  - 全部评价
  - 好评
  - 中评
  - 差评

---

## 性能优化建议

### 列表加载
- 分页加载:每页10-15条
- 图片懒加载:仅加载可见区域
- 图片压缩:头像和缩略图使用小尺寸
- 骨架屏:加载时显示占位UI

### 服务详情
- 详情缓存:缓存5分钟
- 评价懒加载:初始只加载2-3条
- 图片预加载:预加载Hero图

### 订单流程
- 订单预览:前端直接计算价格
- 支付状态轮询:定时查询支付结果(间隔1-2秒)
- 支付超时处理:5分钟超时自动取消

### 状态管理
- 服务列表:会话级缓存
- 筛选条件:会话级缓存
- 订单状态:实时查询,不缓存
- 用户余额:支付后立即更新

---

## 业务规则说明

### 服务定价规则
- 定价单位:金币/局、金币/小时、金币/单
- 价格范围:通常1-999金币
- 服务费:平台可能收取5-10%服务费
- 价格显示:始终显示用户实付金额

### 下单规则
- 用户必须登录
- 服务者必须在线且可接单
- 用户不能给自己下单
- 同一时间只能有一个进行中的订单(可选限制)
- 最小订单数量:通常1
- 最大订单数量:根据服务类型,通常10-100

### 支付规则
- 支付方式优先级:余额 > 第三方支付
- 余额支付:可能需要支付密码
- 支付密码:6位数字
- 密码错误限制:5次错误后锁定30分钟
- 支付超时:5分钟内必须完成支付
- 支付失败:订单自动取消,金额原路退回

### 订单状态流转
1. **pending**(待接单):
   - 订单创建后,等待服务者接单
   - 10分钟内未接单自动取消
   - 用户可以取消订单,全额退款

2. **accepted**(已接单):
   - 服务者接单
   - 用户不能取消
   - 服务者可以联系用户

3. **in_progress**(进行中):
   - 服务正在进行
   - 双方可以联系沟通

4. **completed**(已完成):
   - 服务完成
   - 用户可以评价
   - 款项结算给服务者

5. **cancelled**(已取消):
   - 订单取消
   - 根据取消时间和原因决定退款金额

6. **refunded**(已退款):
   - 退款完成
   - 款项返回用户账户

### 评价规则
- 订单完成后7天内可以评价
- 评价包含:星级(1-5)、文字(可选)、图片(可选,最多9张)
- 评价后不可修改(某些平台允许追评)
- 服务者可以回复评价
- 恶意评价可以申诉

### 取消和退款规则
- **用户取消**:
  - 待接单状态:全额退款
  - 已接单状态:不能取消(特殊情况可申诉)
- **服务者取消**:
  - 任何状态取消:全额退款给用户
  - 服务者可能受到处罚
- **自动取消**:
  - 10分钟未接单:自动取消,全额退款
  - 24小时未完成:可能自动取消
- **退款方式**:原路退回(余额支付退回余额)
- **退款时间**:即时到账

---

## 测试要点

### 列表功能
- [ ] 服务列表正常显示
- [ ] 排序和性别筛选正常工作
- [ ] 高级筛选功能正常
- [ ] 分页加载正常
- [ ] 点击服务跳转详情页

### 服务详情
- [ ] 详情页信息完整显示
- [ ] 评价区域正常显示
- [ ] 点击查看全部评价正常
- [ ] 下单按钮状态正确
- [ ] 不可用服务正确提示

### 下单流程
- [ ] 确认订单页正常显示
- [ ] 数量增减功能正常
- [ ] 价格计算正确
- [ ] 立即支付按钮正常触发

### 支付流程
- [ ] 支付弹窗正确显示
- [ ] 余额显示正确
- [ ] 余额不足时提示充值
- [ ] 支付密码输入正常
- [ ] 密码验证正确
- [ ] 支付成功页正常显示

### 订单管理
- [ ] 订单状态正确显示
- [ ] 订单详情完整
- [ ] 取消订单功能正常
- [ ] 退款流程正常

### 评价功能
- [ ] 评价列表正常显示
- [ ] 评价标签正确
- [ ] 评价分页加载正常

### 边界测试
- [ ] 未登录时提示登录
- [ ] 余额不足时的处理
- [ ] 服务不可用时的提示
- [ ] 支付密码错误的处理
- [ ] 网络异常的错误处理
- [ ] 订单超时的处理

### 兼容性测试
- [ ] 不同技能类型正常显示
- [ ] 不同服务状态正确处理
- [ ] 图片上传和显示正常
- [ ] 支付流程在不同场景下正常工作

---
