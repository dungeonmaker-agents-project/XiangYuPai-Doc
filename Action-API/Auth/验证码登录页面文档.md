# 验证码登录页面文档

## 概述
本文档定义验证码登录页面的完整实现，包括UI布局、交互行为、前端逻辑和API接口规范。

**相关文档:**
- 密码登录页面文档
- 忘记密码页面文档

---

## API接口规范

### 接口1：发送验证码
**接口:** `POST /auth/sms/send`

**触发时机:** 用户点击"获取验证码"按钮

**请求参数:**
```typescript
{
  countryCode: string;      // 国家区号，例如："+86"
  phoneNumber: string;      // 手机号，例如："13147046323"
  purpose: "LOGIN"          // 固定值，表示用于登录
}
```

**响应数据:**
```typescript
{
  code: number;           // 200=成功，其他=失败
  message: string;        // 提示信息
  data: null
}
```

### 接口2：验证码登录
**接口:** `POST /auth/login/sms`

**触发时机:** 用户输入完第6位验证码后自动触发

**请求参数:**
```typescript
{
  countryCode: string;      // 国家区号，例如："+86"
  phoneNumber: string;      // 手机号，例如："13147046323"
  verificationCode: string; // 6位验证码，例如："361234"
  agreeToTerms: boolean;    // 用户协议勾选状态，必须为true
}
```

**响应数据:**
```typescript
{
  code: number;           // 200=成功，其他=失败
  message: string;        // 提示信息
  data: {
    token: string;        // 登录凭证
    userId: string;       // 用户ID
    nickname: string;     // 用户昵称
    avatar?: string;      // 用户头像
    isNewUser: boolean;   // 是否新注册用户
  } | null
}
```

**特殊说明:** 未注册手机号验证后自动创建账号

**错误码说明:**
| 状态码 | 说明 | 前端提示 |
|-------|------|---------|
| 200 | 成功 | 跳转到主页 |
| 400 | 参数错误 | "请检查输入信息" |
| 401 | 验证码错误 | "验证码错误，请重新输入" |
| 429 | 发送频繁 | "发送过于频繁，请稍后再试" |
| 500 | 服务器错误 | "操作失败，请稍后重试" |

---

## 页面布局

### 顶部状态栏
- 系统状态栏：显示时间、信号、电池等
- 背景：白色/浅色

### 欢迎区域
```
您好！
欢迎使用探店
```
- **主标题:** "您好！"
  - 字体：加粗
  - 大小：32-36pt
  - 颜色：深灰色/黑色 (#1a1a1a)
  - 位置：距离顶部 80-100px

- **副标题:** "欢迎使用探店"
  - 字体：常规
  - 大小：32-36pt
  - 颜色：深灰色/黑色 (#1a1a1a)
  - 位置：紧跟主标题下方

### 表单区域

#### 1. 手机号输入区
**布局:**
```
[+86 ▼]  [请输入手机号_________________ ⊗]
```

**国家区号选择器:**
- 默认值：`+86`
- 显示：区号 + 下拉箭头图标
- 宽度：80px
- 高度：48px
- 字体大小：16pt
- 颜色：深灰色 (#333)
- 背景：透明
- 底部边框：1px 浅灰色分割线

**手机号输入框:**
- 占位符："请输入手机号"
- 占位符颜色：浅灰色 (#c0c0c0)
- 输入类型：`tel` (数字键盘)
- 最大长度：11位 (根据区号动态调整)
- 字体大小：16pt
- 输入文字颜色：黑色 (#1a1a1a)
- 底部边框：1px 浅灰色分割线
- 间距：距离欢迎文字 60-80px

**清空按钮 (X图标):**
- 位置：输入框右侧
- 显示条件：有输入内容时显示
- 图标：圆形背景 + X符号
- 颜色：浅灰色 (#c0c0c0)
- 尺寸：20x20px
- 点击区域：44x44px

#### 2. 获取验证码按钮
**布局:**
```
┌──────────────────────────────────────┐
│          获取验证码                   │
└──────────────────────────────────────┘
```

**初始状态:**
- 文字："获取验证码"
- 宽度：100% (左右边距 24px)
- 高度：52px
- 圆角：26px
- 背景：紫色到蓝色渐变
  - 起始色：#b794f6
  - 结束色：#a5b4fc
- 文字颜色：白色 (#ffffff)
- 字体大小：18pt
- 启用条件：手机号已输入且格式正确

**倒计时状态:**
- 文字："59秒后重新获取验证码" (59→58→...→1)
- 背景：浅灰色 (#e5e5e5)
- 文字颜色：灰色 (#999)
- 禁用状态：不可点击
- 倒计时结束后恢复初始状态

**间距:**
- 距离手机号输入框：24px

#### 3. 验证码输入区
**布局:**
```
[3] [6] [1] [2] [3] [4]
```

**6个独立输入框:**
- 数量：6个
- 每个宽度：48px
- 高度：56px
- 间距：12px
- 圆角：8px
- 边框：1px 浅灰色 (#e5e5e5)
- 聚焦边框：2px 紫色 (#9333ea)
- 背景：白色
- 字体大小：24pt
- 文字居中显示
- 输入类型：`tel` (数字键盘)
- 最大长度：每个输入框1位数字

**自动聚焦逻辑:**
- 输入数字后自动跳到下一个输入框
- 删除数字后自动跳回上一个输入框
- 第6个输入框输入完成后：
  - 自动收起键盘
  - 自动提交验证码登录

**间距:**
- 距离获取验证码按钮：32px

#### 4. 辅助链接
```
密码登陆
```

**密码登陆链接:**
- 文字："密码登陆"
- 位置：居中或左侧
- 字体大小：14pt
- 颜色：紫色 (#9333ea)
- 点击效果：高亮
- 功能：切换到密码登录页面

**间距:**
- 距离验证码输入区：24px

### 底部用户协议
```
登陆即表明同意《探店用户协议》和《隐私政策》
```

**布局:**
- 位置：页面底部，距离底部安全区域 32px
- 对齐：居中
- 字体大小：12pt

**样式:**
- 普通文字颜色：浅灰色 (#999)
- 协议链接颜色：紫色 (#9333ea)
- 链接：《探店用户协议》《隐私政策》可点击

---

## 交互行为

### 1. 国家区号选择
**触发:** 点击区号选择器

**行为:**
1. 打开底部弹出选择器 (Bottom Sheet)
2. 显示国家/地区列表：
   - 中国大陆 +86
   - 中国香港 +852
   - 中国澳门 +853
   - 中国台湾 +886
   - 澳大利亚 +61
   - 韩国 +82
   - 泰国 +66
3. 选中当前区号
4. 点击某项后：
   - 更新区号显示
   - 关闭选择器
   - 更新手机号最大长度限制

### 2. 手机号输入
**输入时:**
- 实时验证格式
- 只允许输入数字
- 达到最大长度时自动停止输入
- 有内容时显示清空按钮
- 手机号正确后启用"获取验证码"按钮

**失去焦点时:**
- 验证手机号格式
- 格式错误显示提示：
  ```
  ⚠ 请输入正确的手机号格式
  ```
  - 位置：输入框下方
  - 颜色：红色 (#ef4444)
  - 字体大小：12pt

**清空按钮:**
- 点击后清空输入内容
- 隐藏清空按钮
- 禁用"获取验证码"按钮

### 3. 获取验证码
**点击"获取验证码"按钮:**

**验证前置条件:**
1. 手机号不能为空
2. 手机号格式正确

**调用接口:**
- 接口：`POST /auth/sms/send`
- 参数：countryCode, phoneNumber, purpose: "LOGIN"

**成功响应:**
1. 显示成功提示："验证码已发送"
2. 按钮文字变为："59秒后重新获取验证码"
3. 开始60秒倒计时
4. 按钮进入禁用状态（灰色）
5. 验证码输入框自动聚焦到第1个输入框

**失败响应:**
- 显示错误提示：
  - "发送失败，请稍后重试" (500)
  - "发送过于频繁，请稍后再试" (429)
  - "手机号格式错误" (400)
- 按钮保持可点击状态

**倒计时结束:**
- 按钮文字恢复："重新获取验证码"
- 按钮恢复为渐变色
- 可再次点击发送

### 4. 验证码输入
**输入行为:**
1. 自动聚焦到第1个输入框
2. 输入数字后自动跳到下一个输入框
3. 按删除键自动跳回上一个输入框
4. 每个输入框只能输入1位数字
5. 输入完第6位后：
   - 自动收起键盘
   - 自动触发验证码登录

**自动提交验证码登录:**

**验证前置条件:**
1. 验证码必须是6位数字
2. 用户协议已同意（默认同意）

**调用接口:**
- 接口：`POST /auth/login/sms`
- 参数：countryCode, phoneNumber, verificationCode, agreeToTerms: true

**显示加载状态:**
- 验证码输入框禁用
- 显示加载提示或旋转图标

**成功响应:**
1. 显示成功提示
2. 保存登录token和用户信息
3. 检查isNewUser标记：
   - 新用户：跳转到完善资料页面
   - 老用户：跳转到主页
4. 清除登录页面栈

**失败响应:**
1. 恢复输入框状态
2. 显示错误提示：
   - "验证码错误，请重新输入" (401)
   - "验证码已过期，请重新获取" (401)
   - "登录失败，请稍后重试" (500)
3. 清空验证码输入框
4. 聚焦到第1个输入框
5. 允许重新输入

### 5. 页面跳转

**点击"密码登陆":**
- 路由跳转到密码登录页面
- 不保存当前输入内容

**点击用户协议/隐私政策:**
- 打开对应协议页面 (WebView或新页面)
- 返回后保留当前输入内容

---

## 前端验证规则

### 手机号验证
```typescript
// +86 中国大陆
const isValidPhoneNumber = (phone: string, countryCode: string) => {
  if (countryCode === '+86') {
    return /^1[3-9]\d{9}$/.test(phone); // 11位，1开头
  }
  // 其他国家区号规则...
  return phone.length >= 8 && phone.length <= 15;
}
```

### 验证码验证
```typescript
const isValidVerificationCode = (code: string) => {
  return /^\d{6}$/.test(code); // 必须是6位数字
}
```

### 发送验证码条件
```typescript
const canSendCode = () => {
  const phoneValid = phoneNumber && isValidPhoneNumber(phoneNumber, countryCode);
  const notInCountdown = countdown === 0; // 倒计时结束

  return phoneValid && notInCountdown;
}
```

### 自动提交条件
```typescript
const shouldAutoSubmit = () => {
  const codeComplete = verificationCode.length === 6;
  const codeValid = isValidVerificationCode(verificationCode);

  return codeComplete && codeValid;
}
```

---

## 样式规范

### 颜色系统
```css
/* 主色调 */
--primary-purple: #9333ea;
--primary-blue: #3b82f6;

/* 渐变色 */
--gradient-start: #b794f6;
--gradient-end: #a5b4fc;

/* 文字颜色 */
--text-primary: #1a1a1a;
--text-secondary: #666666;
--text-placeholder: #c0c0c0;
--text-disabled: #999999;

/* 边框颜色 */
--border-light: #e5e5e5;
--border-focus: #9333ea;

/* 错误颜色 */
--error: #ef4444;

/* 背景色 */
--bg-white: #ffffff;
--bg-disabled: #f5f5f5;
--bg-code-input: #fafafa;
```

### 验证码输入框样式
```css
.code-input {
  width: 48px;
  height: 56px;
  border: 1px solid var(--border-light);
  border-radius: 8px;
  background: var(--bg-white);
  font-size: 24pt;
  text-align: center;
  transition: border-color 0.2s ease;
}

.code-input:focus {
  border: 2px solid var(--border-focus);
  outline: none;
}

.code-input.filled {
  background: var(--bg-code-input);
  border-color: var(--border-focus);
}
```

### 倒计时按钮样式
```css
.countdown-button {
  background: var(--bg-disabled);
  color: var(--text-disabled);
  cursor: not-allowed;
  pointer-events: none;
}
```

---

## 响应式适配

### 屏幕尺寸
- **小屏幕** (宽度 < 375px):
  - 减小边距至 16px
  - 验证码输入框缩小至 44px
- **标准屏幕** (375px - 428px): 默认样式
- **大屏幕** (> 428px): 最大内容宽度 428px，居中显示

### 安全区域
```css
/* 顶部安全区域 */
padding-top: env(safe-area-inset-top);

/* 底部安全区域 */
padding-bottom: env(safe-area-inset-bottom);
```

---

## 动画效果

### 验证码输入框聚焦
```css
transition: all 0.2s ease;

/* 聚焦 */
border: 2px solid var(--border-focus);
transform: scale(1.05);
```

### 倒计时数字更新
```css
/* 数字变化淡入淡出 */
animation: fadeInOut 0.3s ease;

@keyframes fadeInOut {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
```

### 自动提交加载
```css
/* 旋转加载图标 */
animation: spin 1s linear infinite;

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}
```

---

## 状态管理

### 页面状态
```typescript
interface VerificationLoginPageState {
  countryCode: string;        // 国家区号
  phoneNumber: string;        // 手机号
  verificationCode: string;   // 验证码（6位）
  countdown: number;          // 倒计时秒数 (0-60)
  isSubmitting: boolean;      // 是否正在提交
  errors: {
    phoneNumber?: string;     // 手机号错误信息
    verificationCode?: string; // 验证码错误信息
  };
}
```

### 初始状态
```typescript
const initialState: VerificationLoginPageState = {
  countryCode: '+86',
  phoneNumber: '',
  verificationCode: '',
  countdown: 0,
  isSubmitting: false,
  errors: {},
};
```

### 倒计时管理
```typescript
let countdownTimer: NodeJS.Timeout | null = null;

const startCountdown = () => {
  countdown = 60;

  countdownTimer = setInterval(() => {
    countdown -= 1;

    if (countdown <= 0) {
      clearInterval(countdownTimer!);
      countdownTimer = null;
    }
  }, 1000);
};

// 页面卸载时清理
onUnmount(() => {
  if (countdownTimer) {
    clearInterval(countdownTimer);
  }
});
```

---

## 特殊功能

### 自动注册新用户
**说明:** 未注册的手机号验证成功后自动创建账号

**流程:**
1. 用户输入未注册手机号
2. 获取并输入验证码
3. 验证成功后：
   - 后端自动创建账号
   - 返回 `isNewUser: true`
4. 前端根据标记跳转：
   - 新用户 → 完善资料页面
   - 老用户 → 主页

**提示文字:**
- 位置：验证码输入区下方
- 内容："未注册手机号验证后自动创建账号"
- 字体大小：12pt
- 颜色：浅灰色 (#999)

### 验证码有效期
- 有效期：5-10分钟（后端控制）
- 过期提示："验证码已过期，请重新获取"
- 自动清空输入框

### 发送频率限制
- 限制：60秒内只能发送一次
- 前端倒计时控制
- 后端也会做频率限制（429错误）

---

## 测试用例

### 功能测试
- [ ] 国家区号选择正常
- [ ] 手机号输入验证正确
- [ ] 获取验证码接口调用成功
- [ ] 倒计时显示准确
- [ ] 验证码输入自动跳转正常
- [ ] 输入完成自动提交
- [ ] 登录成功跳转正确
- [ ] 新用户自动注册
- [ ] 错误提示显示正确

### 边界测试
- [ ] 手机号输入超长字符
- [ ] 验证码输入非数字
- [ ] 快速重复点击获取验证码
- [ ] 倒计时期间尝试发送
- [ ] 网络异常处理
- [ ] 验证码过期处理

### 兼容性测试
- [ ] iOS系统 (13+)
- [ ] Android系统 (8+)
- [ ] 不同屏幕尺寸
- [ ] 横屏模式

---

## 开发清单

### 必须实现
- [x] 页面布局和样式
- [x] 手机号输入和验证
- [x] 获取验证码功能
- [x] 60秒倒计时
- [x] 6位验证码输入
- [x] 自动跳转输入框
- [x] 输入完成自动提交
- [x] 登录接口调用
- [x] 新用户自动注册
- [x] 错误处理和提示
- [x] 页面跳转
- [x] 加载状态

### 可选优化
- [ ] 记住手机号功能
- [ ] 验证码语音播报
- [ ] 剪贴板自动识别验证码
- [ ] 发送成功震动反馈
- [ ] 输入错误晃动动画

---

## 相关文档

- **相关页面文档:**
  - 密码登录页面文档
  - 忘记密码页面文档
- **关联页面:**
  - 完善资料页面
  - 用户协议页面
  - 隐私政策页面
